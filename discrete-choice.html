<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.0.37">

  <meta name="author" content="Matt Bhagat-Conway">
  <meta name="dcterms.date" content="2022-08-11">
  <title>Data Matters Discrete Choice Models - Introduction to discrete choice models in R</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; background-color: #2a0f15; font-weight: bold; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
    }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
  <h1 class="title">Introduction to discrete choice models in R</h1>
  <p class="author">Matt Bhagat-Conway</p>
  <p class="institute">Odum Institute<br>University of North Carolina at Chapel Hill</p>
  <p class="date">August 11, 2022</p>
</section>

<section id="about-me" class="slide level2">
<h2>About me</h2>
<div class="cell">

</div>
<ul>
<li>Assistant professor of City and Regional Planning</li>
<li>Research focus: transportation modeling and simulation
<ul>
<li>Heavy use of discrete choice models</li>
</ul></li>
<li>PhD in Geography from Arizona State</li>
<li>Three years experience as transportation modeling software developer</li>
</ul>
</section>
<section id="before-we-go-any-further" class="slide level2">
<h2>Before we go any further</h2>
<ul>
<li>If you haven’t already installed R, RStudio, <code>apollo</code>, and <code>tidyverse</code>, do so now</li>
<li>R: <a href="https://r-project.org">https://r-project.org</a></li>
<li>RStudio: <a href="https://rstudio.com">https://rstudio.com</a></li>
<li><code>apollo</code> and <code>tidyverse</code>: in RStudio console, run:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">install.packages</span>(<span class="st">"apollo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="what-are-discrete-choice-models" class="slide level2">
<h2>What are discrete choice models?</h2>
<ul>
<li>Any model of a variable that takes on discrete values</li>
<li>Could be binary (two values), categorical (more than two values), or quantized (e.g., integers)</li>
</ul>
</section>
<section id="types-of-discrete-choice-models" class="slide level2">
<h2>Types of discrete choice models</h2>
<ul>
<li>Random utility models
<ul>
<li>Logistic regression, multinomial logistic regression, ordered logit, mixed logit</li>
</ul></li>
<li>Count models
<ul>
<li>Poisson and negative binomial regression</li>
</ul></li>
<li>Machine learning
<ul>
<li>Random forests, support vector machines, <em>k</em> nearest neighbors</li>
</ul></li>
</ul>
</section>
<section id="random-utility-theory" class="slide level2">
<h2>Random utility theory</h2>
<ul>
<li>Individuals are maximizing the <em>utility</em> of their choices</li>
<li>Utility is an abstract concept of value</li>
<li>Individuals choose the choice with the highest utility</li>
<li>Utility is random because there is a random component to utility</li>
<li>We won’t know which choice is the highest utility for an individual, only the probabilities that a particular choice will have the highest utility</li>
</ul>
</section>
<section>
<section id="binary-logistic-regression" class="title-slide slide level1 center">
<h1>Binary logistic regression</h1>

</section>
<section id="binary-logistic-regression-1" class="slide level2">
<h2>Binary logistic regression</h2>
<ul>
<li>A very common model for binary (yes/no) outcomes</li>
<li>Probably familiar to many</li>
<li>Usually presented as a generalized linear model</li>
</ul>
</section>
<section id="binary-logistic-regression-intuition" class="slide level2">
<h2>Binary logistic regression: Intuition</h2>
<ul>
<li>Linear functions can take on any value</li>
<li>Probabilities need to be between 0 and 1</li>
<li>The logit function transforms arbitrary linear values to (0, 1)</li>
</ul>
</section>
<section id="binary-logistic-regression-the-math" class="slide level2">
<h2>Binary logistic regression: the math</h2>
<p><span class="math display">\[
y^* = \alpha + \beta_1 x_1 + \beta_2 x_2 \cdots + \epsilon
\]</span></p>
<p><span class="math display">\[
\epsilon \thicksim \mathrm{Logistic}
\]</span></p>
<p><span class="math display">\[
p(y = 1) = p(y^* &gt; 0) = \frac{e^{y^*}}{1 + e^{y^*}}
\]</span></p>
</section>
<section id="the-logit-function" class="slide level2">
<h2>The logit function</h2>
<!-- run logistic regression -->

<img data-src="discrete-choice_files/figure-revealjs/unnamed-chunk-3-1.svg" alt="Logistic regression, showing sigmoid function" width="1200" class="r-stretch quarto-figure-center"></section>
<section id="logistic-regression-in-r" class="slide level2">
<h2>Logistic regression in R</h2>
<p><code>nhts-carpool-glm.R</code></p>
<div class="cell" data-filename="nhts-carpool-glm.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-4_c4ba8bff9388d0f440b2979b54e7f890">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>data <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/nhts/carpool.csv"</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a>glm_model <span class="ot">=</span> <span class="fu">glm</span>(carpool<span class="sc">~</span>hhsize<span class="sc">+</span>cars_per_driver<span class="sc">+</span>commute<span class="sc">+</span>social,</span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"logit"</span>), data)</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="fu">summary</span>(glm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="logistic-regression-in-r-1" class="slide level2">
<h2>Logistic regression in R</h2>
<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-5_c23b5ba86fb5dd796cc580d79c335a34">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = carpool ~ hhsize + cars_per_driver + commute + 
    social, family = binomial(link = "logit"), data = data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1549  -1.1352   0.5586   1.1124   2.2076  

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -0.67693    0.10222  -6.622 3.54e-11 ***
hhsize           0.37661    0.02452  15.360  &lt; 2e-16 ***
cars_per_driver -0.11756    0.05692  -2.065   0.0389 *  
commuteTRUE     -1.57463    0.11061 -14.237  &lt; 2e-16 ***
socialTRUE       0.31370    0.09999   3.137   0.0017 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 6930.5  on 4999  degrees of freedom
Residual deviance: 6380.7  on 4995  degrees of freedom
AIC: 6390.7

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section>
<section id="binary-logistic-regression-as-a-random-utility-model" class="slide level2">
<h2>Binary logistic regression as a random utility model</h2>
<ul>
<li>We can treat the linear predictor in logistic regression as the utility of the modeled outcome</li>
<li>In this case, the utility of carpooling</li>
<li>We also need a utility of not carpooling</li>
<li>Decisionmakers will choose the highest utility <em>alternative</em></li>
</ul>
</section>
<section id="binary-logistic-regression-as-a-random-utility-model-1" class="slide level2">
<h2>Binary logistic regression as a random utility model</h2>
<ul>
<li>Utilities are only meaningful relative to each other</li>
<li>Usual practice is to set utility of one alternative to 0</li>
</ul>
</section>
<section id="binary-logistic-regression-as-a-random-utility-model-2" class="slide level2">
<h2>Binary logistic regression as a random utility model</h2>
<p><span class="math display">\[
y^* = \alpha + \beta_1 x_1 + \beta_2 x_2 \cdots + \epsilon
\]</span></p>
<p><span class="math display">\[
p(y = 1) = p(y^* &gt; 0)\\= \frac{e^{y^*}}{1 + e^{y^*}}
\]</span></p>
</section>
<section id="binary-logistic-regression-as-a-random-utility-model-3" class="slide level2">
<h2>Binary logistic regression as a random utility model</h2>
<p><span class="math display">\[
U_{y=1} = \alpha + \beta_1 x_1 + \beta_2 x_2 \cdots + \epsilon_1
\]</span></p>
<p><span class="math display">\[
U_{y=0} = 0 + \epsilon_0
\]</span></p>
<p><span class="math display">\[
p(y = 1) = p(U_{y=1} &gt; U_{y=0})\\= \frac{e^{U_{y=1}}}{e^{U_{y=0}} + e^{U_{y=1}}}
\]</span></p>
</section>
<section id="binary-logistic-regression-as-a-random-utility-model-in-r" class="slide level2">
<h2>Binary logistic regression as a random utility model in R</h2>
<p><code>nhts-carpool-apollo.R</code></p>
<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-7_cd7ca6bc75f24a4f58694445c495ea59">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">library</span>(apollo)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># Read data - variable must be called "database"</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>database <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/nhts/carpool.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-8_2d0185790338db8ca615d556e3f847ee">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Initialize Apollo library</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">apollo_initialise</span>()</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># set parameters for overall model</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>apollo_control <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="at">modelName=</span><span class="st">"Carpool_binary"</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="at">indivID=</span><span class="st">"id"</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-9_f28fb68482f9797b5522cdd992d81d6e">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># In Apollo, you specify your utility functions by hand,</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># first telling Apollo what coefficients to estimate</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>apollo_beta <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="at">constant_carpool =</span> <span class="dv">0</span>, <span class="co"># 0 is starting value</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="at">b_hhsize =</span> <span class="dv">0</span>,</span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="at">b_cars_per_driver =</span> <span class="dv">0</span>,</span>
<span id="cb6-7"><a href="#cb6-7"></a>    <span class="at">b_commute =</span> <span class="dv">0</span>,</span>
<span id="cb6-8"><a href="#cb6-8"></a>    <span class="at">b_social =</span> <span class="dv">0</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>)</span>
<span id="cb6-10"><a href="#cb6-10"></a></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co"># any parameters that you want to remain constant go here</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>apollo_fixed <span class="ot">=</span> <span class="fu">c</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-10_b32393a346d8a9c88c6049d4643c3728">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># prepare the inputs to the Apollo estimation code</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>apollo_inputs <span class="ot">=</span> <span class="fu">apollo_validateInputs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>All checks on apollo_control completed.
All checks on database completed.</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-11_2c9669efedb36bc44041eee1003a2817">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># this function calculates probabilities of each alternative</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>apollo_probabilities <span class="ot">=</span> <span class="cf">function</span>(apollo_beta, apollo_inputs,</span>
<span id="cb9-3"><a href="#cb9-3"></a>        <span class="at">functionality=</span><span class="st">"estimate"</span>) {</span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="co"># so we can refer to variables by name</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="fu">apollo_attach</span>(apollo_beta, apollo_inputs)</span>
<span id="cb9-6"><a href="#cb9-6"></a>    <span class="fu">on.exit</span>(<span class="fu">apollo_detach</span>(apollo_beta, apollo_inputs))</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a>    <span class="co"># This is the list of probabilities for the alternatives</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>    <span class="co"># for each observation</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>    P <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb9-11"><a href="#cb9-11"></a></span>
<span id="cb9-12"><a href="#cb9-12"></a>    <span class="co"># Define utility functions</span></span>
<span id="cb9-13"><a href="#cb9-13"></a>    V <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb9-14"><a href="#cb9-14"></a>    V[[<span class="st">"carpool"</span>]] <span class="ot">=</span> constant_carpool <span class="sc">+</span> b_hhsize <span class="sc">*</span> hhsize <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>        b_cars_per_driver <span class="sc">*</span> cars_per_driver <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>        b_commute <span class="sc">*</span> commute <span class="sc">+</span> b_social <span class="sc">*</span> social</span>
<span id="cb9-17"><a href="#cb9-17"></a>    V[[<span class="st">"not_carpool"</span>]] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb9-18"><a href="#cb9-18"></a></span>
<span id="cb9-19"><a href="#cb9-19"></a>    <span class="co"># associate utility functions with data</span></span>
<span id="cb9-20"><a href="#cb9-20"></a>    logit_settings <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb9-21"><a href="#cb9-21"></a>        <span class="at">alternatives =</span> <span class="fu">c</span>(<span class="at">carpool=</span>T, <span class="at">not_carpool=</span>F),</span>
<span id="cb9-22"><a href="#cb9-22"></a>        <span class="at">avail        =</span> <span class="fu">list</span>(<span class="at">carpool=</span>T, <span class="at">not_carpool=</span>T),</span>
<span id="cb9-23"><a href="#cb9-23"></a>        <span class="at">choiceVar    =</span> carpool,</span>
<span id="cb9-24"><a href="#cb9-24"></a>        <span class="at">utilities    =</span> V</span>
<span id="cb9-25"><a href="#cb9-25"></a>    )</span>
<span id="cb9-26"><a href="#cb9-26"></a></span>
<span id="cb9-27"><a href="#cb9-27"></a>    <span class="co"># compute probabilities</span></span>
<span id="cb9-28"><a href="#cb9-28"></a>    P[[<span class="st">"model"</span>]] <span class="ot">=</span> <span class="fu">apollo_mnl</span>(logit_settings, functionality)</span>
<span id="cb9-29"><a href="#cb9-29"></a></span>
<span id="cb9-30"><a href="#cb9-30"></a>    P <span class="ot">=</span> <span class="fu">apollo_prepareProb</span>(P, apollo_inputs, functionality)</span>
<span id="cb9-31"><a href="#cb9-31"></a>    <span class="fu">return</span>(P)</span>
<span id="cb9-32"><a href="#cb9-32"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-12_705bc9d05dee3c9118bb81a54e8e8792">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># finally, estimate the model</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>model <span class="ot">=</span> <span class="fu">apollo_estimate</span>(apollo_beta, apollo_fixed,</span>
<span id="cb10-3"><a href="#cb10-3"></a>    apollo_probabilities, apollo_inputs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Preparing user-defined functions.

Testing likelihood function...

Overview of choices for MNL model component :
                                 carpool not_carpool
Times available                   5000.0      5000.0
Times chosen                      2535.0      2465.0
Percentage chosen overall           50.7        49.3
Percentage chosen when available    50.7        49.3

Pre-processing likelihood function...

Testing influence of parameters
Starting main estimation
Initial function value: -3465.736 
Initial gradient value:
 constant_carpool          b_hhsize b_cars_per_driver         b_commute 
         35.00000         852.00000         -45.93929        -175.00000 
         b_social 
         58.00000 
initial  value 3465.735903 
iter   2 value 3432.622012
iter   3 value 3307.741025
iter   4 value 3204.155864
iter   5 value 3202.592363
iter   6 value 3200.242615
iter   7 value 3192.478779
iter   8 value 3190.335277
iter   9 value 3190.333251
iter   9 value 3190.333216
iter   9 value 3190.333216
final  value 3190.333216 
converged
Additional convergence test using scaled estimation. Parameters will be
  scaled by their current estimates and additional iterations will be
  performed.
initial  value 3190.333216 
iter   1 value 3190.333216
final  value 3190.333216 
converged
Estimated parameters:
                     Estimate
constant_carpool      -0.6770
b_hhsize               0.3766
b_cars_per_driver     -0.1176
b_commute             -1.5746
b_social               0.3137

Computing covariance matrix using analytical gradient.
 0%....25%....50%...100%
Negative definite Hessian with maximum eigenvalue: -75.088512
Computing score matrix...
Calculating LL(0) for applicable models...
Calculating LL(c) for applicable models...
Calculating LL of each model component...</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-13_1ebb222e7e4ffa6c08217ed33c97e081">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># print results</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">apollo_modelOutput</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model run by mwbc using Apollo 0.2.7 on R 4.2.1 for Darwin.
www.ApolloChoiceModelling.com

Model name                       : Carpool_binary
Model description                : No model description provided in apollo_control
Model run at                     : 2022-08-05 11:11:26
Estimation method                : bfgs
Model diagnosis                  : successful convergence 
Number of individuals            : 5000
Number of rows in database       : 5000
Number of modelled outcomes      : 5000

Number of cores used             :  1 
Model without mixing

LL(start)                        : -3465.74
LL(0)                            : -3465.74
LL(C)                            : -3465.25
LL(final)                        : -3190.33
Rho-square (0)                   :  0.0795 
Adj.Rho-square (0)               :  0.078 
Rho-square (C)                   :  0.0793 
Adj.Rho-square (C)               :  0.0779 
AIC                              :  6390.67 
BIC                              :  6423.25 

Estimated parameters             :  5
Time taken (hh:mm:ss)            :  00:00:0.46 
     pre-estimation              :  00:00:0.24 
     estimation                  :  00:00:0.06 
     post-estimation             :  00:00:0.15 
Iterations                       :  13  
Min abs eigenvalue of Hessian    :  75.08851 

Unconstrained optimisation.

Estimates:
                     Estimate        s.e.   t.rat.(0)    Rob.s.e. Rob.t.rat.(0)
constant_carpool      -0.6770     0.10222      -6.623     0.10192        -6.642
b_hhsize               0.3766     0.02452      15.360     0.02501        15.062
b_cars_per_driver     -0.1176     0.05692      -2.066     0.05726        -2.053
b_commute             -1.5746     0.11061     -14.237     0.11384       -13.832
b_social               0.3137     0.09999       3.137     0.09735         3.222</code></pre>
</div>
</div>
</section>
<section id="but-dont-take-my-word-for-it" class="slide level2">
<h2>But don’t take my word for it…</h2>
<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-14_c5b1daf32d912b389c45ac9f2a3df08c">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = carpool ~ hhsize + cars_per_driver + commute + 
    social, family = binomial(link = "logit"), data = data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.1549  -1.1352   0.5586   1.1124   2.2076  

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -0.67693    0.10222  -6.622 3.54e-11 ***
hhsize           0.37661    0.02452  15.360  &lt; 2e-16 ***
cars_per_driver -0.11756    0.05692  -2.065   0.0389 *  
commuteTRUE     -1.57463    0.11061 -14.237  &lt; 2e-16 ***
socialTRUE       0.31370    0.09999   3.137   0.0017 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 6930.5  on 4999  degrees of freedom
Residual deviance: 6380.7  on 4995  degrees of freedom
AIC: 6390.7

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section></section>
<section id="questions" class="title-slide slide level1 center">
<h1>Questions?</h1>

</section>

<section>
<section id="the-multinomial-logit-model" class="title-slide slide level1 center">
<h1>The multinomial logit model</h1>

</section>
<section id="what-about-more-than-two-outcomes" class="slide level2">
<h2>What about more than two outcomes?</h2>
<ul>
<li>Random utility theory doesn’t constrain us to two outcomes</li>
<li>We can have many outcomes, and decisionmakers choose the one with the highest utility</li>
<li>This is known as a <em>multinomial</em> model</li>
</ul>
</section>
<section id="extending-logistic-regression-to-the-multinomial-case" class="slide level2">
<h2>Extending logistic regression to the multinomial case</h2>
<ul>
<li>Instead of two utilities <span class="math inline">\(U_{y=1}\)</span> and <span class="math inline">\(U_{y=0}\)</span>, we have arbitrary number of utility functions <span class="math inline">\(U_i\)</span></li>
<li>Decisionmakers choose the option with the highest utility</li>
<li>As with binary logistic regression, utility functions are usually linear combinations of parameters</li>
</ul>
</section>
<section id="multinomial-logistic-regression-the-math" class="slide level2">
<h2>Multinomial logistic regression: the math</h2>
<ul>
<li>Probability then becomes</li>
</ul>
<p><span class="math display">\[
p(y=i)\\= p(U_i &gt; \mathrm{all~other}~U)\\
    =\frac{e^{U_i}}{e^{U_1} + e^{U_2} \cdots}\\
    =\frac{e^{U_i}}{\sum_{j \in I} e^{U_j}}
\]</span></p>
</section>
<section id="multinomial-logistic-regression-in-r" class="slide level2">
<h2>Multinomial logistic regression in R</h2>
<ul>
<li>We will build a model of working from home expectation post-pandemic, using data from the <a href="https://covidfuture.org">COVID Future</a> study.</li>
<li>We will estimate four utility functions, for being unable to, rarely, frequently, and always working from home</li>
<li>Based on age, income, and job type</li>
<li>These utility functions will have the same variables but different coefficients</li>
<li>Each will also have a <em>alternative specific constant</em>—like a constant in logistic regression that represents the base rate, but for each alternative</li>
<li>One utility function will be held at zero</li>
</ul>
</section>
<section id="multinomial-logistic-regression-in-r-1" class="slide level2">
<h2>Multinomial logistic regression in R</h2>
<p><code>covidfuture-wfh-mnl.R</code></p>
<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-16_1975716c4e3657f6d7a731744f183479">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">library</span>(apollo)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a>database <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/covidfuture_wfh.csv"</span>)</span>
<span id="cb15-5"><a href="#cb15-5"></a></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="fu">apollo_initialise</span>()</span>
<span id="cb15-7"><a href="#cb15-7"></a></span>
<span id="cb15-8"><a href="#cb15-8"></a>apollo_control <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb15-9"><a href="#cb15-9"></a>    <span class="at">modelName=</span><span class="st">"WFH_Postpandemic"</span>,</span>
<span id="cb15-10"><a href="#cb15-10"></a>    <span class="at">indivID=</span><span class="st">"resp_id"</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-17_593bb5eea6c6a9be8f5eb8776231798d">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">head</span>(database)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  resp_id wfh      age income_100k_plus service_worker
    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;lgl&gt;            &lt;lgl&gt;         
1    1201 Often     29 TRUE             FALSE         
2    1228 Often     28 TRUE             FALSE         
3    1229 Often     25 FALSE            TRUE          
4    1230 Unable    36 FALSE            FALSE         
5    1231 Unable    33 FALSE            FALSE         
6    1233 Often     30 FALSE            FALSE         </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-18_2481b50b0e0dc83a626018381cae9dc5">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># now, we must define all the coefficients</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># we have separate sets of coefficients for each utility</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co"># function, because the utilities need to be different</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>apollo_beta <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="at">asc_rarely =</span> <span class="dv">0</span>,</span>
<span id="cb18-6"><a href="#cb18-6"></a>    <span class="at">asc_often =</span> <span class="dv">0</span>,</span>
<span id="cb18-7"><a href="#cb18-7"></a>    <span class="at">asc_always =</span> <span class="dv">0</span>,</span>
<span id="cb18-8"><a href="#cb18-8"></a>    <span class="at">b_rarely_age =</span> <span class="dv">0</span>,</span>
<span id="cb18-9"><a href="#cb18-9"></a>    <span class="at">b_often_age =</span> <span class="dv">0</span>,</span>
<span id="cb18-10"><a href="#cb18-10"></a>    <span class="at">b_always_age =</span> <span class="dv">0</span>,</span>
<span id="cb18-11"><a href="#cb18-11"></a>    <span class="at">b_rarely_highinc =</span> <span class="dv">0</span>,</span>
<span id="cb18-12"><a href="#cb18-12"></a>    <span class="at">b_often_highinc =</span> <span class="dv">0</span>,</span>
<span id="cb18-13"><a href="#cb18-13"></a>    <span class="at">b_always_highinc =</span> <span class="dv">0</span>,</span>
<span id="cb18-14"><a href="#cb18-14"></a>    <span class="at">b_rarely_service_worker =</span> <span class="dv">0</span>,</span>
<span id="cb18-15"><a href="#cb18-15"></a>    <span class="at">b_often_service_worker =</span> <span class="dv">0</span>,</span>
<span id="cb18-16"><a href="#cb18-16"></a>    <span class="at">b_always_service_worker =</span> <span class="dv">0</span></span>
<span id="cb18-17"><a href="#cb18-17"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-19_4c414ff5c701503ba382873d0627de80">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>apollo_fixed <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>apollo_inputs <span class="ot">=</span> <span class="fu">apollo_validateInputs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>All checks on apollo_control completed.
All checks on database completed.</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-20_e278037bc92e3c3144023ad892f2fb39">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Finally, we define the utility functions in apollo_probabilities</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>apollo_probabilities <span class="ot">=</span> <span class="cf">function</span>(apollo_beta, apollo_inputs,</span>
<span id="cb21-3"><a href="#cb21-3"></a>        <span class="at">functionality=</span><span class="st">"estimate"</span>) {</span>
<span id="cb21-4"><a href="#cb21-4"></a>    <span class="fu">apollo_attach</span>(apollo_beta, apollo_inputs)</span>
<span id="cb21-5"><a href="#cb21-5"></a>    <span class="fu">on.exit</span>(<span class="fu">apollo_detach</span>(apollo_beta, apollo_inputs))</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a>    P <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb21-8"><a href="#cb21-8"></a></span>
<span id="cb21-9"><a href="#cb21-9"></a>    <span class="co"># define utility functions</span></span>
<span id="cb21-10"><a href="#cb21-10"></a>    V <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb21-11"><a href="#cb21-11"></a>    <span class="co"># fix one utility to zero</span></span>
<span id="cb21-12"><a href="#cb21-12"></a>    V[[<span class="st">"Unable"</span>]] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb21-13"><a href="#cb21-13"></a>    V[[<span class="st">"Rarely"</span>]] <span class="ot">=</span> asc_rarely <span class="sc">+</span> b_rarely_age <span class="sc">*</span> age <span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>        b_rarely_highinc <span class="sc">*</span> income_100k_plus <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15"></a>        b_rarely_service_worker <span class="sc">*</span> service_worker</span>
<span id="cb21-16"><a href="#cb21-16"></a>    V[[<span class="st">"Often"</span>]] <span class="ot">=</span> asc_often <span class="sc">+</span> b_often_age <span class="sc">*</span> age <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17"></a>        b_often_highinc <span class="sc">*</span> income_100k_plus <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18"></a>        b_often_service_worker <span class="sc">*</span> service_worker</span>
<span id="cb21-19"><a href="#cb21-19"></a>    V[[<span class="st">"Always"</span>]] <span class="ot">=</span> asc_always <span class="sc">+</span> b_always_age <span class="sc">*</span> age <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20"></a>        b_always_highinc <span class="sc">*</span> income_100k_plus <span class="sc">+</span></span>
<span id="cb21-21"><a href="#cb21-21"></a>        b_always_service_worker <span class="sc">*</span> service_worker</span>
<span id="cb21-22"><a href="#cb21-22"></a>        </span>
<span id="cb21-23"><a href="#cb21-23"></a>    mnl_settings <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb21-24"><a href="#cb21-24"></a>        <span class="at">alternatives =</span> <span class="fu">c</span>(<span class="at">Unable=</span><span class="st">"Unable"</span>, <span class="at">Rarely=</span><span class="st">"Rarely"</span>,</span>
<span id="cb21-25"><a href="#cb21-25"></a>            <span class="at">Often=</span><span class="st">"Often"</span>, <span class="at">Always=</span><span class="st">"Always"</span>),</span>
<span id="cb21-26"><a href="#cb21-26"></a>        <span class="at">avail =</span> <span class="fu">list</span>(<span class="at">Unable=</span>T, <span class="at">Rarely=</span>T, <span class="at">Often=</span>T, <span class="at">Always=</span>T),</span>
<span id="cb21-27"><a href="#cb21-27"></a>        <span class="at">choiceVar =</span> wfh,</span>
<span id="cb21-28"><a href="#cb21-28"></a>        <span class="at">utilities =</span> V</span>
<span id="cb21-29"><a href="#cb21-29"></a>    )</span>
<span id="cb21-30"><a href="#cb21-30"></a></span>
<span id="cb21-31"><a href="#cb21-31"></a>    P[[<span class="st">"model"</span>]] <span class="ot">=</span> <span class="fu">apollo_mnl</span>(mnl_settings, functionality)</span>
<span id="cb21-32"><a href="#cb21-32"></a>    P <span class="ot">=</span> <span class="fu">apollo_prepareProb</span>(P, apollo_inputs, functionality)</span>
<span id="cb21-33"><a href="#cb21-33"></a>    <span class="fu">return</span>(P)</span>
<span id="cb21-34"><a href="#cb21-34"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-21_f1e0c3cc8b8738877068f80533371a6e">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># estimate model</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>model <span class="ot">=</span> <span class="fu">apollo_estimate</span>(apollo_beta, apollo_fixed,</span>
<span id="cb22-3"><a href="#cb22-3"></a>    apollo_probabilities, apollo_inputs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Preparing user-defined functions.

Testing likelihood function...

Overview of choices for MNL model component :
                                  Unable  Rarely  Often  Always
Times available                  4895.00 4895.00 4895.0 4895.00
Times chosen                     2386.00  228.00 1640.0  641.00
Percentage chosen overall          48.74    4.66   33.5   13.09
Percentage chosen when available   48.74    4.66   33.5   13.09

Pre-processing likelihood function...

Testing influence of parameters
Starting main estimation
Initial function value: -6785.911 
Initial gradient value:
             asc_rarely               asc_often              asc_always 
                -995.75                  416.25                 -582.75 
           b_rarely_age             b_often_age            b_always_age 
              -45652.00                16701.00               -23413.00 
       b_rarely_highinc         b_often_highinc        b_always_highinc 
                -361.50                  380.50                 -183.50 
b_rarely_service_worker  b_often_service_worker b_always_service_worker 
                -493.25                  -56.25                 -415.25 
initial  value 6785.910898 
iter   2 value 6028.442633
iter   3 value 5685.432004
iter   4 value 5679.055816
iter   5 value 5394.755990
iter   6 value 5278.692311
iter   7 value 5263.035019
iter   8 value 5258.497397
iter   9 value 5248.299040
iter  10 value 5221.159849
iter  11 value 5173.585242
iter  12 value 5125.560646
iter  13 value 5111.633098
iter  14 value 5106.523896
iter  15 value 5082.704875
iter  16 value 5079.556757
iter  17 value 5078.866308
iter  18 value 5078.706760
iter  19 value 5078.698911
iter  20 value 5078.698753
iter  20 value 5078.698750
iter  20 value 5078.698749
final  value 5078.698749 
converged
Additional convergence test using scaled estimation. Parameters will be
  scaled by their current estimates and additional iterations will be
  performed.
initial  value 5078.698749 
iter   1 value 5078.698749
final  value 5078.698749 
converged
Estimated parameters:
                           Estimate
asc_rarely                 -0.72861
asc_often                   0.50458
asc_always                 -1.36727
b_rarely_age               -0.03318
b_often_age                -0.01467
b_always_age                0.01224
b_rarely_highinc            0.81208
b_often_highinc             1.01227
b_always_highinc            0.53411
b_rarely_service_worker    -0.93900
b_often_service_worker     -1.26770
b_always_service_worker    -1.54383

Computing covariance matrix using analytical gradient.
 0%....25%....50%....75%....100%
Negative definite Hessian with maximum eigenvalue: -16.466841
Computing score matrix...
Calculating LL(0) for applicable models...
Calculating LL(c) for applicable models...
Calculating LL of each model component...</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-22_d3aecc5a1ad16b53352f211be47fda19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Print results</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="fu">apollo_modelOutput</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model run by mwbc using Apollo 0.2.7 on R 4.2.1 for Darwin.
www.ApolloChoiceModelling.com

Model name                       : WFH_Postpandemic
Model description                : No model description provided in apollo_control
Model run at                     : 2022-08-05 11:11:27
Estimation method                : bfgs
Model diagnosis                  : successful convergence 
Number of individuals            : 4895
Number of rows in database       : 4895
Number of modelled outcomes      : 4895

Number of cores used             :  1 
Model without mixing

LL(start)                        : -6785.91
LL(0)                            : -6785.91
LL(C)                            : -5510.24
LL(final)                        : -5078.7
Rho-square (0)                   :  0.2516 
Adj.Rho-square (0)               :  0.2498 
Rho-square (C)                   :  0.0783 
Adj.Rho-square (C)               :  0.0761 
AIC                              :  10181.4 
BIC                              :  10259.35 

Estimated parameters             :  12
Time taken (hh:mm:ss)            :  00:00:0.74 
     pre-estimation              :  00:00:0.24 
     estimation                  :  00:00:0.14 
     post-estimation             :  00:00:0.35 
Iterations                       :  24  
Min abs eigenvalue of Hessian    :  16.46684 

Unconstrained optimisation.

Estimates:
                           Estimate        s.e.   t.rat.(0)    Rob.s.e.
asc_rarely                 -0.72861    0.231197      -3.151    0.234610
asc_often                   0.50458    0.116246       4.341    0.118378
asc_always                 -1.36727    0.163257      -8.375    0.158789
b_rarely_age               -0.03318    0.005224      -6.351    0.005380
b_often_age                -0.01467    0.002391      -6.135    0.002418
b_always_age                0.01224    0.003156       3.880    0.003086
b_rarely_highinc            0.81208    0.147684       5.499    0.144518
b_often_highinc             1.01227    0.072260      14.009    0.071662
b_always_highinc            0.53411    0.096440       5.538    0.095423
b_rarely_service_worker    -0.93900    0.143583      -6.540    0.141024
b_often_service_worker     -1.26770    0.069906     -18.134    0.069960
b_always_service_worker    -1.54383    0.099610     -15.499    0.099288
                        Rob.t.rat.(0)
asc_rarely                     -3.106
asc_often                       4.262
asc_always                     -8.611
b_rarely_age                   -6.168
b_often_age                    -6.066
b_always_age                    3.968
b_rarely_highinc                5.619
b_often_highinc                14.126
b_always_highinc                5.597
b_rarely_service_worker        -6.658
b_often_service_worker        -18.120
b_always_service_worker       -15.549</code></pre>
</div>
</div>
</section>
<section id="interpreting-multinomial-logit-results" class="slide level2">
<h2>Interpreting multinomial logit results</h2>
<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-23_22494bddf8dbaa280eb13cb33a906c17">
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Rarely</th>
<th style="text-align: right;">Often</th>
<th style="text-align: right;">Always</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ASC</td>
<td style="text-align: right;">-0.73</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">-1.37</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">High income</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">1.01</td>
<td style="text-align: right;">0.53</td>
</tr>
<tr class="even">
<td style="text-align: left;">Service worker</td>
<td style="text-align: right;">-0.94</td>
<td style="text-align: right;">-1.27</td>
<td style="text-align: right;">-1.54</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Note: all variables significant at <span class="math inline">\(p &lt; 0.05\)</span></p>
</section>
<section class="slide level2">

<ul>
<li>Relative to being unable to WFH,
<ul>
<li>Older people are less likely to WFH rarely or often, but more likely to always</li>
<li>Higher income people are much more likely to be able to and choose to WFH</li>
<li>Service workers are less likely to be able to WFH</li>
<li>Scale of age variable is different from others</li>
</ul></li>
</ul>
</section></section>
<section>
<section id="questions-1" class="title-slide slide level1 center">
<h1>Questions?</h1>

</section>
<section id="specifying-a-multinomial-logit-model" class="slide level2">
<h2>Specifying a multinomial logit model</h2>
<ul>
<li>Multinomial logit models can have independent variables that vary at the individual level (e.g., income)</li>
<li>Can also have variables at the alternative level (e.g., travel time)</li>
<li>Utilities identified only up to a constant offset
<ul>
<li>Constant changes to all utilities does not change outcome</li>
</ul></li>
</ul>
</section>
<section id="specifying-a-multinomial-logit-model-1" class="slide level2">
<h2>Specifying a multinomial logit model</h2>
<ul>
<li>Variables that vary at <em>individual</em> level must have different coefficients for each alternative, and one must be zero</li>
<li>Variables that vary at <em>alternative</em> level may or may not have different coefficients for each alternative, and there is no need have one zero coefficient
<ul>
<li>But you do have to know values for unchosen alternatives</li>
</ul></li>
</ul>
</section>
<section id="specifying-a-multinomial-logit-model-2" class="slide level2">
<h2>Specifying a multinomial logit model</h2>
<div class="cell" data-fig-width="12" data-fig-height="6">
<div class="cell-output-display">
<div>
<p>
<svg width="1152" height="576" viewbox="0.00 0.00 616.11 169.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style=" display: block; margin: auto auto auto auto">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 165)">
<title>
G
</title>
<polygon fill="transparent" stroke="transparent" points="-4,4 -4,-165 612.11,-165 612.11,4 -4,4"></polygon> <g id="clust1" class="cluster">
<title>
clustertt
</title>
<polygon fill="transparent" stroke="transparent" points="112.35,-101 112.35,-153 527.35,-153 527.35,-101 112.35,-101"></polygon> </g> <!-- inc --> <g id="node1" class="node">
<title>
inc
</title>
<polygon fill="none" stroke="#ffffff" points="100.33,-145 42.37,-145 42.37,-109 100.33,-109 100.33,-145"></polygon> <text text-anchor="middle" x="71.35" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Income</text> </g> <!-- iw --> <g id="node8" class="node">
<title>
iw
</title>
</g> <!-- inc&#45;&gt;iw --> <g id="edge1" class="edge">
<title>
inc-&gt;iw
</title>
<path fill="none" stroke="#ffffff" d="M65.23,-108.94C59.85,-93.93 52.8,-74.27 52.37,-73.06"></path> </g> <!-- ib --> <g id="node9" class="node">
<title>
ib
</title>
</g> <!-- inc&#45;&gt;ib --> <g id="edge2" class="edge">
<title>
inc-&gt;ib
</title>
<path fill="none" stroke="#ffffff" d="M77.46,-108.94C82.84,-93.93 89.89,-74.27 90.33,-73.06"></path> </g> <!-- ic --> <g id="node10" class="node">
<title>
ic
</title>
</g> <!-- inc&#45;&gt;ic --> <g id="edge3" class="edge">
<title>
inc-&gt;ic
</title>
<path fill="none" stroke="#ffffff" d="M71.35,-108.94C71.35,-93.93 71.35,-74.27 71.35,-73.06"></path> </g> <!-- ttw --> <g id="node2" class="node">
<title>
ttw
</title>
<polygon fill="none" stroke="#ffffff" points="246.64,-145 120.06,-145 120.06,-109 246.64,-109 246.64,-145"></polygon> <text text-anchor="middle" x="183.35" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Travel time of walk</text> </g> <!-- tw --> <g id="node11" class="node">
<title>
tw
</title>
</g> <!-- ttw&#45;&gt;tw --> <g id="edge4" class="edge">
<title>
ttw-&gt;tw
</title>
<path fill="none" stroke="#ffffff" d="M184.31,-108.94C185.16,-93.93 186.27,-74.27 186.34,-73.06"></path> </g> <!-- ttb --> <g id="node3" class="node">
<title>
ttb
</title>
<polygon fill="none" stroke="#ffffff" points="518.87,-145 399.82,-145 399.82,-109 518.87,-109 518.87,-145"></polygon> <text text-anchor="middle" x="459.35" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Travel time of bus</text> </g> <!-- tb --> <g id="node12" class="node">
<title>
tb
</title>
</g> <!-- ttb&#45;&gt;tb --> <g id="edge5" class="edge">
<title>
ttb-&gt;tb
</title>
<path fill="none" stroke="#ffffff" d="M464.18,-108.94C468.42,-93.93 473.99,-74.27 474.33,-73.06"></path> </g> <!-- ttc --> <g id="node4" class="node">
<title>
ttc
</title>
<polygon fill="none" stroke="#ffffff" points="381.51,-145 265.18,-145 265.18,-109 381.51,-109 381.51,-145"></polygon> <text text-anchor="middle" x="323.35" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Travel time of car</text> </g> <!-- tc --> <g id="node13" class="node">
<title>
tc
</title>
</g> <!-- ttc&#45;&gt;tc --> <g id="edge6" class="edge">
<title>
ttc-&gt;tc
</title>
<path fill="none" stroke="#ffffff" d="M326.57,-108.94C329.4,-93.93 333.11,-74.27 333.34,-73.06"></path> </g> <!-- uw --> <g id="node5" class="node">
<title>
uw
</title>
<ellipse fill="none" stroke="#ffffff" cx="186.35" cy="-18" rx="67.8" ry="18"></ellipse> <text text-anchor="middle" x="186.35" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Utility of walk</text> </g> <!-- ub --> <g id="node6" class="node">
<title>
ub
</title>
<ellipse fill="none" stroke="#ffffff" cx="474.35" cy="-18" rx="62.58" ry="18"></ellipse> <text text-anchor="middle" x="474.35" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Utility of bus</text> </g> <!-- uc --> <g id="node7" class="node">
<title>
uc
</title>
<ellipse fill="none" stroke="#ffffff" cx="333.35" cy="-18" rx="60.83" ry="18"></ellipse> <text text-anchor="middle" x="333.35" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Utility of car</text> </g> <!-- iw&#45;&gt;uw --> <g id="edge7" class="edge">
<title>
iw-&gt;uw
</title>
<path fill="none" stroke="#ffffff" d="M52.44,-71.96C54.88,-71 102.82,-52.04 140.64,-37.08"></path> <polygon fill="#ffffff" stroke="#ffffff" points="142,-40.31 150.01,-33.37 139.42,-33.8 142,-40.31"></polygon> </g> <!-- md --> <g id="node14" class="node">
<title>
md
</title>
<text text-anchor="middle" x="50.35" y="-22.2" font-family="Times,serif" font-size="14.00" fill="#ff0948">Must be different,</text> <text text-anchor="middle" x="50.35" y="-5.4" font-family="Times,serif" font-size="14.00" fill="#ff0948">one must be zero</text> </g> <!-- iw&#45;&gt;md --> <g id="edge13" class="edge">
<title>
iw-&gt;md
</title>
<path fill="none" stroke="#ff0948" d="M52.34,-71.85C52.27,-69.89 51.5,-49.49 50.94,-34.62"></path> </g> <!-- ib&#45;&gt;ub --> <g id="edge8" class="edge">
<title>
ib-&gt;ub
</title>
<path fill="none" stroke="#ffffff" d="M90.47,-71.99C95.81,-71.63 267.61,-59.97 403.35,-36 408.65,-35.06 414.15,-33.97 419.64,-32.8"></path> <polygon fill="#ffffff" stroke="#ffffff" points="420.44,-36.2 429.45,-30.61 418.92,-29.37 420.44,-36.2"></polygon> </g> <!-- ib&#45;&gt;md --> <g id="edge15" class="edge">
<title>
ib-&gt;md
</title>
<path fill="none" stroke="#ff0948" d="M90.23,-71.85C88.76,-69.89 73.36,-49.49 62.14,-34.62"></path> </g> <!-- ic&#45;&gt;uc --> <g id="edge9" class="edge">
<title>
ic-&gt;uc
</title>
<path fill="none" stroke="#ffffff" d="M71.42,-71.99C74.69,-71.45 179.79,-53.97 263.35,-36 268.34,-34.93 273.52,-33.76 278.7,-32.57"></path> <polygon fill="#ffffff" stroke="#ffffff" points="279.68,-35.93 288.62,-30.24 278.08,-29.12 279.68,-35.93"></polygon> </g> <!-- ic&#45;&gt;md --> <g id="edge14" class="edge">
<title>
ic-&gt;md
</title>
<path fill="none" stroke="#ff0948" d="M71.29,-71.85C70.51,-69.89 62.43,-49.49 56.54,-34.62"></path> </g> <!-- tw&#45;&gt;uw --> <g id="edge10" class="edge">
<title>
tw-&gt;uw
</title>
<path fill="none" stroke="#ffffff" d="M186.35,-71.85C186.35,-70.37 186.35,-58.32 186.35,-46.1"></path> <polygon fill="#ffffff" stroke="#ffffff" points="189.85,-46.02 186.35,-36.02 182.85,-46.02 189.85,-46.02"></polygon> </g> <!-- tb&#45;&gt;ub --> <g id="edge11" class="edge">
<title>
tb-&gt;ub
</title>
<path fill="none" stroke="#ffffff" d="M474.35,-71.85C474.35,-70.37 474.35,-58.32 474.35,-46.1"></path> <polygon fill="#ffffff" stroke="#ffffff" points="477.85,-46.02 474.35,-36.02 470.85,-46.02 477.85,-46.02"></polygon> </g> <!-- tc&#45;&gt;uc --> <g id="edge12" class="edge">
<title>
tc-&gt;uc
</title>
<path fill="none" stroke="#ffffff" d="M333.35,-71.85C333.35,-70.37 333.35,-58.32 333.35,-46.1"></path> <polygon fill="#ffffff" stroke="#ffffff" points="336.85,-46.02 333.35,-36.02 329.85,-46.02 336.85,-46.02"></polygon> </g> <!-- cs --> <g id="node15" class="node">
<title>
cs
</title>
<text text-anchor="middle" x="572.35" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#ff0948">Can be same</text> </g> <!-- cs&#45;&gt;tw --> <g id="edge16" class="edge">
<title>
cs-&gt;tw
</title>
<path fill="none" stroke="#ff0948" d="M563.2,-118.68C555.27,-112.78 543.24,-104.87 531.35,-101 458.77,-77.41 190.58,-73.07 186.4,-73"></path> </g> <!-- cs&#45;&gt;tb --> <g id="edge17" class="edge">
<title>
cs-&gt;tb
</title>
<path fill="none" stroke="#ff0948" d="M560.67,-118.49C552.56,-113.37 541.43,-106.54 531.35,-101 507.38,-87.84 476.36,-73.9 474.44,-73.04"></path> </g> <!-- cs&#45;&gt;tc --> <g id="edge18" class="edge">
<title>
cs-&gt;tc
</title>
<path fill="none" stroke="#ff0948" d="M562.81,-118.63C554.85,-112.87 542.96,-105.16 531.35,-101 451.6,-72.43 344,-72.88 334.09,-72.99"></path> </g> </g>
</svg>
</p>
</div>
</div>
</div>
</section>
<section id="estimating-a-multinomial-logit-model-in-r" class="slide level2">
<h2>Estimating a multinomial logit model in R</h2>
<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-25_2394f05175aa69664b8cfc1472ef1d97">

</div>
<ul>
<li>We’re going to build a multinomial logit mode choice model of intercity mode choice</li>
<li>Data from Apollo examples</li>
</ul>
</section>
<section id="the-data" class="slide level2">
<h2>The data</h2>
<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-26_b0a9cd26cb7b507957fcf2334b27e01b">
<div class="cell-output-display">
<table style="width:100%;">
<colgroup>
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">individual</th>
<th style="text-align: left;">chosen</th>
<th style="text-align: right;">wait_time_air</th>
<th style="text-align: right;">wait_time_train</th>
<th style="text-align: right;">wait_time_bus</th>
<th style="text-align: right;">wait_time_car</th>
<th style="text-align: right;">cost_air</th>
<th style="text-align: right;">cost_train</th>
<th style="text-align: right;">cost_bus</th>
<th style="text-align: right;">cost_car</th>
<th style="text-align: right;">in_vehicle_time_air</th>
<th style="text-align: right;">in_vehicle_time_train</th>
<th style="text-align: right;">in_vehicle_time_bus</th>
<th style="text-align: right;">in_vehicle_time_car</th>
<th style="text-align: right;">hhincome_thousands</th>
<th style="text-align: right;">party_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">car</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">372</td>
<td style="text-align: right;">417</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">car</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">354</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">255</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">car</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">115</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">125</td>
<td style="text-align: right;">892</td>
<td style="text-align: right;">882</td>
<td style="text-align: right;">720</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">car</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">354</td>
<td style="text-align: right;">399</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">car</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">144</td>
<td style="text-align: right;">404</td>
<td style="text-align: right;">449</td>
<td style="text-align: right;">600</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">train</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">345</td>
<td style="text-align: right;">417</td>
<td style="text-align: right;">284</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="estimation-in-r" class="slide level2">
<h2>Estimation in R</h2>
<p><code>mode-choice-mnl.R</code></p>
<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-28_ebfff9d328756b15f8371886811af2da">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">library</span>(apollo)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb26-3"><a href="#cb26-3"></a></span>
<span id="cb26-4"><a href="#cb26-4"></a>database <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/modechoice_apollo.csv"</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="fu">apollo_initialise</span>()</span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a>apollo_control <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb26-9"><a href="#cb26-9"></a>    <span class="at">modelName =</span> <span class="st">"Apollo_Mode_Choice"</span>,</span>
<span id="cb26-10"><a href="#cb26-10"></a>    <span class="at">indivID=</span><span class="st">"ID"</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-29_f9165a440c74cb29d19a42855dc993c3">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">head</span>(database)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 22
     ID av_car av_bus av_air av_rail time_car cost_car time_bus cost_bus acces…¹
  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
1     1      0      0      1       1        0        0        0        0       0
2     1      0      0      1       1        0        0        0        0       0
3     2      1      1      0       1      345       40      345       30      15
4     2      1      1      0       1      345       45      345       25      20
5     3      0      0      1       1        0        0        0        0       0
6     3      0      0      1       1        0        0        0        0       0
# … with 12 more variables: time_air &lt;dbl&gt;, cost_air &lt;dbl&gt;, access_air &lt;dbl&gt;,
#   service_air &lt;dbl&gt;, time_rail &lt;dbl&gt;, cost_rail &lt;dbl&gt;, access_rail &lt;dbl&gt;,
#   service_rail &lt;dbl&gt;, female &lt;dbl&gt;, business &lt;dbl&gt;, income &lt;dbl&gt;,
#   choice &lt;dbl&gt;, and abbreviated variable name ¹​access_bus
# ℹ Use `colnames()` to see all variable names</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-30_efe2359fc8b4c2713589996e7881837c">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>apollo_beta <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb29-2"><a href="#cb29-2"></a>    <span class="at">asc_air =</span> <span class="dv">0</span>,</span>
<span id="cb29-3"><a href="#cb29-3"></a>    <span class="at">asc_bus =</span> <span class="dv">0</span>,</span>
<span id="cb29-4"><a href="#cb29-4"></a>    <span class="at">asc_rail =</span> <span class="dv">0</span>,</span>
<span id="cb29-5"><a href="#cb29-5"></a>    <span class="co"># leaving out an asc_car as base category</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>    <span class="at">b_cost =</span> <span class="dv">0</span>,</span>
<span id="cb29-7"><a href="#cb29-7"></a>    <span class="at">b_access_time =</span> <span class="dv">0</span>,</span>
<span id="cb29-8"><a href="#cb29-8"></a>    <span class="at">b_in_vehicle_time =</span> <span class="dv">0</span>,</span>
<span id="cb29-9"><a href="#cb29-9"></a>    <span class="co"># income and party_size are individual level variable, so</span></span>
<span id="cb29-10"><a href="#cb29-10"></a>    <span class="co"># must be different for different alternatives</span></span>
<span id="cb29-11"><a href="#cb29-11"></a>    <span class="at">b_income_air =</span> <span class="dv">0</span>,</span>
<span id="cb29-12"><a href="#cb29-12"></a>    <span class="at">b_income_bus =</span> <span class="dv">0</span>,</span>
<span id="cb29-13"><a href="#cb29-13"></a>    <span class="at">b_income_rail =</span> <span class="dv">0</span></span>
<span id="cb29-14"><a href="#cb29-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-31_1d461819ab8278daddfc92716458c0b1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>apollo_fixed <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb30-2"><a href="#cb30-2"></a></span>
<span id="cb30-3"><a href="#cb30-3"></a>apollo_inputs <span class="ot">=</span> <span class="fu">apollo_validateInputs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Several observations per individual detected based on the value of ID.
  Setting panelData in apollo_control set to TRUE.
All checks on apollo_control completed.
All checks on database completed.</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-32_2b9a32514be0d30d4bbce487ab326f3e">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>apollo_probabilities <span class="ot">=</span> <span class="cf">function</span>(apollo_beta, apollo_inputs,</span>
<span id="cb32-2"><a href="#cb32-2"></a>        <span class="at">functionality=</span><span class="st">"estimate"</span>) {</span>
<span id="cb32-3"><a href="#cb32-3"></a>    <span class="fu">apollo_attach</span>(apollo_beta, apollo_inputs)</span>
<span id="cb32-4"><a href="#cb32-4"></a>    <span class="fu">on.exit</span>(<span class="fu">apollo_detach</span>(apollo_beta, apollo_inputs))</span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a>    P <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb32-7"><a href="#cb32-7"></a></span>
<span id="cb32-8"><a href="#cb32-8"></a>    <span class="co"># define utility functions</span></span>
<span id="cb32-9"><a href="#cb32-9"></a>    V <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb32-10"><a href="#cb32-10"></a>    <span class="co"># We can include cost and in-vehicle time here because they vary over</span></span>
<span id="cb32-11"><a href="#cb32-11"></a>    <span class="co"># alternatives</span></span>
<span id="cb32-12"><a href="#cb32-12"></a>    V[[<span class="st">"car"</span>]] <span class="ot">=</span> b_cost <span class="sc">*</span> cost_car <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13"></a>        b_in_vehicle_time <span class="sc">*</span> time_car</span>
<span id="cb32-14"><a href="#cb32-14"></a></span>
<span id="cb32-15"><a href="#cb32-15"></a>    V[[<span class="st">"air"</span>]] <span class="ot">=</span> asc_air <span class="sc">+</span></span>
<span id="cb32-16"><a href="#cb32-16"></a>        b_cost <span class="sc">*</span> cost_air <span class="sc">+</span></span>
<span id="cb32-17"><a href="#cb32-17"></a>        b_in_vehicle_time <span class="sc">*</span> time_air <span class="sc">+</span></span>
<span id="cb32-18"><a href="#cb32-18"></a>        b_access_time <span class="sc">*</span> access_air <span class="sc">+</span></span>
<span id="cb32-19"><a href="#cb32-19"></a>        b_income_air <span class="sc">*</span> income</span>
<span id="cb32-20"><a href="#cb32-20"></a></span>
<span id="cb32-21"><a href="#cb32-21"></a>    V[[<span class="st">"rail"</span>]] <span class="ot">=</span> asc_rail <span class="sc">+</span></span>
<span id="cb32-22"><a href="#cb32-22"></a>        b_cost <span class="sc">*</span> cost_rail <span class="sc">+</span></span>
<span id="cb32-23"><a href="#cb32-23"></a>        b_in_vehicle_time <span class="sc">*</span> time_rail <span class="sc">+</span></span>
<span id="cb32-24"><a href="#cb32-24"></a>        b_access_time <span class="sc">*</span> access_rail <span class="sc">+</span></span>
<span id="cb32-25"><a href="#cb32-25"></a>        b_income_rail <span class="sc">*</span> income</span>
<span id="cb32-26"><a href="#cb32-26"></a></span>
<span id="cb32-27"><a href="#cb32-27"></a>    V[[<span class="st">"bus"</span>]] <span class="ot">=</span> asc_bus <span class="sc">+</span></span>
<span id="cb32-28"><a href="#cb32-28"></a>        b_cost <span class="sc">*</span> cost_bus <span class="sc">+</span></span>
<span id="cb32-29"><a href="#cb32-29"></a>        b_in_vehicle_time <span class="sc">*</span> time_bus <span class="sc">+</span></span>
<span id="cb32-30"><a href="#cb32-30"></a>        b_access_time <span class="sc">*</span> access_bus <span class="sc">+</span></span>
<span id="cb32-31"><a href="#cb32-31"></a>        b_income_bus <span class="sc">*</span> income</span>
<span id="cb32-32"><a href="#cb32-32"></a></span>
<span id="cb32-33"><a href="#cb32-33"></a>    mnl_settings <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb32-34"><a href="#cb32-34"></a>        <span class="at">alternatives =</span> <span class="fu">c</span>(<span class="at">car=</span><span class="dv">1</span>, <span class="at">air=</span><span class="dv">3</span>, <span class="at">rail=</span><span class="dv">4</span>, <span class="at">bus=</span><span class="dv">2</span>),</span>
<span id="cb32-35"><a href="#cb32-35"></a>        <span class="at">avail =</span> <span class="fu">list</span>(<span class="at">car=</span>av_car, <span class="at">air=</span>av_air, <span class="at">rail=</span>av_rail, <span class="at">bus=</span>av_bus),</span>
<span id="cb32-36"><a href="#cb32-36"></a>        <span class="at">choiceVar =</span> choice,</span>
<span id="cb32-37"><a href="#cb32-37"></a>        <span class="at">utilities =</span> V</span>
<span id="cb32-38"><a href="#cb32-38"></a>    )</span>
<span id="cb32-39"><a href="#cb32-39"></a></span>
<span id="cb32-40"><a href="#cb32-40"></a>    P[[<span class="st">"model"</span>]] <span class="ot">=</span> <span class="fu">apollo_mnl</span>(mnl_settings, functionality)</span>
<span id="cb32-41"><a href="#cb32-41"></a></span>
<span id="cb32-42"><a href="#cb32-42"></a>    <span class="co"># For panel data, this multiplies observations for single individuals</span></span>
<span id="cb32-43"><a href="#cb32-43"></a>    <span class="co"># together - no effect in multinomial logit but still required.</span></span>
<span id="cb32-44"><a href="#cb32-44"></a>    P <span class="ot">=</span> <span class="fu">apollo_panelProd</span>(P, apollo_inputs, functionality)</span>
<span id="cb32-45"><a href="#cb32-45"></a>    P <span class="ot">=</span> <span class="fu">apollo_prepareProb</span>(P, apollo_inputs, functionality)</span>
<span id="cb32-46"><a href="#cb32-46"></a>    <span class="fu">return</span>(P)</span>
<span id="cb32-47"><a href="#cb32-47"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-33_ffa5a34c2adadaa4f3b17f6196893753">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># estimate model</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>model <span class="ot">=</span> <span class="fu">apollo_estimate</span>(apollo_beta, apollo_fixed,</span>
<span id="cb33-3"><a href="#cb33-3"></a>    apollo_probabilities, apollo_inputs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Preparing user-defined functions.

Testing likelihood function...

Overview of choices for MNL model component :
                                    car    air   rail    bus
Times available                  778.00 752.00 874.00 902.00
Times chosen                     332.00 215.00 327.00 126.00
Percentage chosen overall         33.20  21.50  32.70  12.60
Percentage chosen when available  42.67  28.59  37.41  13.97

Pre-processing likelihood function...
Analytical gradient is different to numerical one. Numerical gradients
  will be used.

Testing influence of parameters.........
Starting main estimation
Initial function value: -1170.86 
Initial gradient value:
          asc_air           asc_bus          asc_rail            b_cost 
    -8.000002e+00     -1.536667e+02      5.966667e+01     -1.329167e+02 
    b_access_time b_in_vehicle_time      b_income_air      b_income_bus 
    -1.810417e+03     -1.898042e+04      3.114006e+05     -7.703172e+06 
    b_income_rail 
     2.710651e+06 
initial  value 1170.860076 
iter   2 value 1112.061643
iter   3 value 1098.117019
iter   4 value 1096.280213
iter   5 value 1088.850808
iter   6 value 1044.655722
iter   7 value 1043.621915
iter   8 value 1037.024630
iter   9 value 1027.797450
iter  10 value 1026.422719
iter  11 value 1021.845626
iter  12 value 1020.058229
iter  13 value 1020.002110
iter  14 value 1019.999301
iter  14 value 1019.999286
iter  14 value 1019.999286
final  value 1019.999286 
converged
Additional convergence test using scaled estimation. Parameters will be
  scaled by their current estimates and additional iterations will be
  performed.
initial  value 1019.999286 
iter   1 value 1019.999286
final  value 1019.999286 
converged
Estimated parameters:
                     Estimate
asc_air             -0.922580
asc_bus             -0.369843
asc_rail            -0.679845
b_cost              -0.032032
b_access_time       -0.006419
b_in_vehicle_time   -0.006126
b_income_air        1.045e-05
b_income_bus       -2.252e-05
b_income_rail       6.963e-07

Computing covariance matrix using numerical methods (numDeriv).
 0%....25%....50%....75%....100%
Negative definite Hessian with maximum eigenvalue: -3.070863
Computing score matrix...
Calculating LL(0) for applicable models...
Calculating LL(c) for applicable models...
Calculating LL of each model component...</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-34_96a32ef44c930ed91abb230fd63261fc">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Print results</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="fu">apollo_modelOutput</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model run by mwbc using Apollo 0.2.7 on R 4.2.1 for Darwin.
www.ApolloChoiceModelling.com

Model name                       : Apollo_Mode_Choice
Model description                : No model description provided in apollo_control
Model run at                     : 2022-08-05 11:11:28
Estimation method                : bfgs
Model diagnosis                  : successful convergence 
Number of individuals            : 500
Number of rows in database       : 1000
Number of modelled outcomes      : 1000

Number of cores used             :  1 
Model without mixing

LL(start)                        : -1170.86
LL(0)                            : -1170.86
LL(C)                            : -1085.14
LL(final)                        : -1020
Rho-square (0)                   :  0.1288 
Adj.Rho-square (0)               :  0.1212 
Rho-square (C)                   :  0.06 
Adj.Rho-square (C)               :  0.0517 
AIC                              :  2058 
BIC                              :  2102.17 

Estimated parameters             :  9
Time taken (hh:mm:ss)            :  00:00:0.65 
     pre-estimation              :  00:00:0.15 
     estimation                  :  00:00:0.27 
     post-estimation             :  00:00:0.24 
Iterations                       :  20  
Min abs eigenvalue of Hessian    :  3.070863 

Unconstrained optimisation.

Estimates:
                     Estimate        s.e.   t.rat.(0)    Rob.s.e. Rob.t.rat.(0)
asc_air             -0.922580    0.502076     -1.8375    0.497421       -1.8547
asc_bus             -0.369843    0.315033     -1.1740    0.306346       -1.2073
asc_rail            -0.679845    0.332292     -2.0459    0.342767       -1.9834
b_cost              -0.032032    0.003242     -9.8796    0.003168      -10.1112
b_access_time       -0.006419    0.005974     -1.0744    0.005835       -1.1001
b_in_vehicle_time   -0.006126    0.001295     -4.7290    0.001368       -4.4792
b_income_air        1.045e-05   5.899e-06      1.7707   6.025e-06        1.7338
b_income_bus       -2.252e-05   6.741e-06     -3.3408   6.534e-06       -3.4463
b_income_rail       6.963e-07   5.090e-06      0.1368   5.216e-06        0.1335</code></pre>
</div>
</div>
</section>
<section id="valuation-using-discrete-choice-models" class="slide level2">
<h2>Valuation using discrete choice models</h2>
<ul>
<li>A common use for discrete choice models is to calculate willingness-to-pay</li>
<li>The linear-in-parameters utility function puts everything in terms of utility</li>
<li>If we have a cost parameter, we can use the model to put everything else in monetary units</li>
</ul>
</section>
<section id="valuation-using-discrete-choice-models-1" class="slide level2">
<h2>Valuation using discrete choice models</h2>
<ul>
<li>The coefficients of the model are how much of <code>x</code> one unit of utility is worth
<ul>
<li>i.e.&nbsp;partial derivatives of utility with respect to <code>x</code></li>
</ul></li>
<li>We want value of time, i.e.&nbsp;dollars / hour</li>
<li>Travel time coefficient is utility / minute</li>
<li>Cost coefficient is utility / dollar</li>
<li>If <span class="math inline">\(u\)</span> is utility, <span class="math inline">\(c\)</span> is cost, and <span class="math inline">\(t\)</span> is in-vehicle time, <span class="math inline">\(\frac{\beta_t}{\beta_{c}} = \frac{\frac{\delta u}{\delta t}}{\frac{\delta u}{\delta c}} = \frac{\delta c}{\delta t}\)</span></li>
</ul>
</section>
<section id="valuation-using-discrete-choice-models-2" class="slide level2">
<h2>Valuation using discrete choice models</h2>
<p><span class="math display">\[\beta_c = -0.032\]</span></p>
<p><span class="math display">\[\beta_t = -0.0061\]</span></p>
<p><span class="math display">\[ \frac{\beta_t}{\beta_c} = \frac{-0.0061}{-0.032} = {£0.191}/\mathrm{minute} = {£11.46}/\mathrm{hour} \]</span></p>
</section>
<section id="confidence-intervals-for-valuation" class="slide level2">
<h2>Confidence intervals for valuation</h2>
<ul>
<li>We can use the Delta method to calculate standard errors for combinations of parameters <span class="citation" data-cites="daly_estimating_2020">(<a href="#/ref-daly_estimating_2020" role="doc-biblioref" onclick="return false;">Daly, Hess, and Ortúzar 2020</a>)</span></li>
<li>Implemented in Apollo using <code>apollo_deltaMethod</code> function</li>
</ul>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-36_cf54228e4a760c2fabfb9ce60ed6ee39">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="fu">apollo_deltaMethod</span>(model, <span class="at">deltaMethod_settings=</span><span class="fu">list</span>(</span>
<span id="cb37-2"><a href="#cb37-2"></a>    <span class="at">operation=</span><span class="st">"ratio"</span>,</span>
<span id="cb37-3"><a href="#cb37-3"></a>    <span class="at">parName1=</span><span class="st">"b_in_vehicle_time"</span>,</span>
<span id="cb37-4"><a href="#cb37-4"></a>    <span class="at">parName2=</span><span class="st">"b_cost"</span>,</span>
<span id="cb37-5"><a href="#cb37-5"></a>    <span class="at">multPar1=</span><span class="dv">60</span></span>
<span id="cb37-6"><a href="#cb37-6"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Running Delta method computations
                                                           Value Robust s.e.
Ratio of b_in_vehicle_time (multiplied by 60) and b_cost:  11.47       2.443
                                                           Rob t-ratio (0)
Ratio of b_in_vehicle_time (multiplied by 60) and b_cost:            4.696</code></pre>
</div>
</div>
</section>
<section id="exercise" class="slide level2">
<h2>Exercise</h2>
<ul>
<li>People may value in-vehicle time differently on the train vs.&nbsp;plane vs.&nbsp;car vs.&nbsp;bus</li>
<li>Modify the model to estimate separate in-vehicle time coefficients for each mode, and calculate willingness-to-pay for each</li>
<li>(One) answer in mode-choice-mnl-in-vehicle-answers.R</li>
</ul>
</section>
<section id="solution" class="slide level2">
<h2>Solution</h2>
<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-39_b1a97eab5759f37741a85c31fa829edf">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>apollo_beta <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb39-2"><a href="#cb39-2"></a>    <span class="at">asc_air =</span> <span class="dv">0</span>,</span>
<span id="cb39-3"><a href="#cb39-3"></a>    <span class="at">asc_bus =</span> <span class="dv">0</span>,</span>
<span id="cb39-4"><a href="#cb39-4"></a>    <span class="at">asc_train =</span> <span class="dv">0</span>,</span>
<span id="cb39-5"><a href="#cb39-5"></a>    <span class="co"># leaving out an asc_car as base category</span></span>
<span id="cb39-6"><a href="#cb39-6"></a>    <span class="at">b_cost =</span> <span class="dv">0</span>,</span>
<span id="cb39-7"><a href="#cb39-7"></a>    <span class="at">b_in_vehicle_time_car =</span> <span class="dv">0</span>,</span>
<span id="cb39-8"><a href="#cb39-8"></a>    <span class="at">b_in_vehicle_time_bus =</span> <span class="dv">0</span>,</span>
<span id="cb39-9"><a href="#cb39-9"></a>    <span class="at">b_in_vehicle_time_train =</span> <span class="dv">0</span>,</span>
<span id="cb39-10"><a href="#cb39-10"></a>    <span class="at">b_in_vehicle_time_air =</span> <span class="dv">0</span>,</span>
<span id="cb39-11"><a href="#cb39-11"></a>    <span class="co"># income and party_size are individual level variable, so</span></span>
<span id="cb39-12"><a href="#cb39-12"></a>    <span class="co"># must be different for different alternatives</span></span>
<span id="cb39-13"><a href="#cb39-13"></a>    <span class="at">b_hhincome_air =</span> <span class="dv">0</span>,</span>
<span id="cb39-14"><a href="#cb39-14"></a>    <span class="at">b_hhincome_bus =</span> <span class="dv">0</span>,</span>
<span id="cb39-15"><a href="#cb39-15"></a>    <span class="at">b_hhincome_train =</span> <span class="dv">0</span>,</span>
<span id="cb39-16"><a href="#cb39-16"></a>    <span class="at">b_party_size_air =</span> <span class="dv">0</span>,</span>
<span id="cb39-17"><a href="#cb39-17"></a>    <span class="at">b_party_size_bus =</span> <span class="dv">0</span>,</span>
<span id="cb39-18"><a href="#cb39-18"></a>    <span class="at">b_party_size_train =</span> <span class="dv">0</span></span>
<span id="cb39-19"><a href="#cb39-19"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-41_9d045aa75fd111b426a373b8ad39fa6b">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>apollo_probabilities <span class="ot">=</span> <span class="cf">function</span>(apollo_beta, apollo_inputs,</span>
<span id="cb40-2"><a href="#cb40-2"></a>        <span class="at">functionality=</span><span class="st">"estimate"</span>) {</span>
<span id="cb40-3"><a href="#cb40-3"></a>    <span class="fu">apollo_attach</span>(apollo_beta, apollo_inputs)</span>
<span id="cb40-4"><a href="#cb40-4"></a>    <span class="fu">on.exit</span>(<span class="fu">apollo_detach</span>(apollo_beta, apollo_inputs))</span>
<span id="cb40-5"><a href="#cb40-5"></a></span>
<span id="cb40-6"><a href="#cb40-6"></a>    P <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb40-7"><a href="#cb40-7"></a></span>
<span id="cb40-8"><a href="#cb40-8"></a>    <span class="co"># define utility functions</span></span>
<span id="cb40-9"><a href="#cb40-9"></a>    V <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb40-10"><a href="#cb40-10"></a></span>
<span id="cb40-11"><a href="#cb40-11"></a>    V[[<span class="st">"car"</span>]] <span class="ot">=</span> b_cost <span class="sc">*</span> cost_car <span class="sc">+</span></span>
<span id="cb40-12"><a href="#cb40-12"></a>        b_in_vehicle_time_car <span class="sc">*</span> in_vehicle_time_car</span>
<span id="cb40-13"><a href="#cb40-13"></a></span>
<span id="cb40-14"><a href="#cb40-14"></a>    V[[<span class="st">"air"</span>]] <span class="ot">=</span> asc_air <span class="sc">+</span></span>
<span id="cb40-15"><a href="#cb40-15"></a>        b_cost <span class="sc">*</span> cost_air <span class="sc">+</span></span>
<span id="cb40-16"><a href="#cb40-16"></a>        b_in_vehicle_time_air <span class="sc">*</span> in_vehicle_time_air <span class="sc">+</span></span>
<span id="cb40-17"><a href="#cb40-17"></a>        b_hhincome_air <span class="sc">*</span> hhincome_thousands <span class="sc">+</span></span>
<span id="cb40-18"><a href="#cb40-18"></a>        b_party_size_air <span class="sc">*</span> party_size</span>
<span id="cb40-19"><a href="#cb40-19"></a></span>
<span id="cb40-20"><a href="#cb40-20"></a>    V[[<span class="st">"train"</span>]] <span class="ot">=</span> asc_train <span class="sc">+</span></span>
<span id="cb40-21"><a href="#cb40-21"></a>        b_cost <span class="sc">*</span> cost_train <span class="sc">+</span></span>
<span id="cb40-22"><a href="#cb40-22"></a>        b_in_vehicle_time_train <span class="sc">*</span> in_vehicle_time_train <span class="sc">+</span></span>
<span id="cb40-23"><a href="#cb40-23"></a>        b_hhincome_train <span class="sc">*</span> hhincome_thousands <span class="sc">+</span></span>
<span id="cb40-24"><a href="#cb40-24"></a>        b_party_size_train <span class="sc">*</span> party_size</span>
<span id="cb40-25"><a href="#cb40-25"></a></span>
<span id="cb40-26"><a href="#cb40-26"></a>    V[[<span class="st">"bus"</span>]] <span class="ot">=</span> asc_bus <span class="sc">+</span></span>
<span id="cb40-27"><a href="#cb40-27"></a>        b_cost <span class="sc">*</span> cost_bus <span class="sc">+</span></span>
<span id="cb40-28"><a href="#cb40-28"></a>        b_in_vehicle_time_bus <span class="sc">*</span> in_vehicle_time_bus <span class="sc">+</span></span>
<span id="cb40-29"><a href="#cb40-29"></a>        b_hhincome_bus <span class="sc">*</span> hhincome_thousands <span class="sc">+</span></span>
<span id="cb40-30"><a href="#cb40-30"></a>        b_party_size_bus <span class="sc">*</span> party_size</span>
<span id="cb40-31"><a href="#cb40-31"></a></span>
<span id="cb40-32"><a href="#cb40-32"></a>    mnl_settings <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb40-33"><a href="#cb40-33"></a>        <span class="at">alternatives =</span> <span class="fu">c</span>(<span class="at">car=</span><span class="st">"car"</span>, <span class="at">air=</span><span class="st">"air"</span>,</span>
<span id="cb40-34"><a href="#cb40-34"></a>            <span class="at">train=</span><span class="st">"train"</span>, <span class="at">bus=</span><span class="st">"bus"</span>),</span>
<span id="cb40-35"><a href="#cb40-35"></a>        <span class="at">avail =</span> <span class="fu">list</span>(<span class="at">car=</span>T, <span class="at">air=</span>T, <span class="at">train=</span>T, <span class="at">bus=</span>T),</span>
<span id="cb40-36"><a href="#cb40-36"></a>        <span class="at">choiceVar =</span> chosen,</span>
<span id="cb40-37"><a href="#cb40-37"></a>        <span class="at">utilities =</span> V</span>
<span id="cb40-38"><a href="#cb40-38"></a>    )</span>
<span id="cb40-39"><a href="#cb40-39"></a></span>
<span id="cb40-40"><a href="#cb40-40"></a>    P[[<span class="st">"model"</span>]] <span class="ot">=</span> <span class="fu">apollo_mnl</span>(mnl_settings, functionality)</span>
<span id="cb40-41"><a href="#cb40-41"></a>    P <span class="ot">=</span> <span class="fu">apollo_prepareProb</span>(P, apollo_inputs, functionality)</span>
<span id="cb40-42"><a href="#cb40-42"></a>    <span class="fu">return</span>(P)</span>
<span id="cb40-43"><a href="#cb40-43"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-43_ef19293c870d63d8d7f1cf4d15272eb9">
<div class="cell-output cell-output-stdout">
<pre><code>Preparing user-defined functions.

Testing likelihood function...

Overview of choices for MNL model component :
                                   car    air train    bus
Times available                  210.0 210.00   210 210.00
Times chosen                      59.0  58.00    63  30.00
Percentage chosen overall         28.1  27.62    30  14.29
Percentage chosen when available  28.1  27.62    30  14.29

Pre-processing likelihood function...

Testing influence of parameters
Starting main estimation
Initial function value: -291.1218 
Initial gradient value:
                asc_air                 asc_bus               asc_train 
                   5.50                  -22.50                   10.50 
                 b_cost   b_in_vehicle_time_car   b_in_vehicle_time_bus 
                 -75.75                 1021.75               -14481.75 
b_in_vehicle_time_train   b_in_vehicle_time_air          b_hhincome_air 
                1623.00                  220.25                  606.25 
         b_hhincome_bus        b_hhincome_train        b_party_size_air 
                -922.75                 -360.75                   -0.50 
       b_party_size_bus      b_party_size_train 
                 -51.50                   13.50 
initial  value 291.121816 
iter   2 value 286.827739
iter   3 value 284.905716
iter   4 value 284.335420
iter   5 value 253.520800
iter   6 value 249.639101
iter   7 value 249.207780
iter   8 value 248.929673
iter   9 value 248.832091
iter  10 value 242.881136
iter  11 value 238.454014
iter  12 value 231.373793
iter  13 value 227.934210
iter  14 value 226.264661
iter  15 value 224.102763
iter  16 value 224.022848
iter  17 value 224.011599
iter  18 value 224.010585
iter  19 value 224.010466
iter  20 value 224.010420
iter  20 value 224.010419
iter  20 value 224.010419
final  value 224.010419 
converged
Additional convergence test using scaled estimation. Parameters will be
  scaled by their current estimates and additional iterations will be
  performed.
initial  value 224.010419 
iter   1 value 224.010419
final  value 224.010419 
converged
Estimated parameters:
                           Estimate
asc_air                    1.828293
asc_bus                    2.084246
asc_train                  2.955379
b_cost                    -0.004399
b_in_vehicle_time_car     -0.006614
b_in_vehicle_time_bus     -0.006695
b_in_vehicle_time_train   -0.007417
b_in_vehicle_time_air     -0.036470
b_hhincome_air             0.018821
b_hhincome_bus            -0.023865
b_hhincome_train          -0.045148
b_party_size_air          -0.777100
b_party_size_bus          -0.853354
b_party_size_train        -0.321296

Computing covariance matrix using analytical gradient.
 0%....25%....50%....75%...100%
Negative definite Hessian with maximum eigenvalue: -0.785733
Computing score matrix...
Calculating LL(0) for applicable models...
Calculating LL(c) for applicable models...
Calculating LL of each model component...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Model run by mwbc using Apollo 0.2.7 on R 4.2.1 for Darwin.
www.ApolloChoiceModelling.com

Model name                       : Australia_Mode_Choice
Model description                : No model description provided in apollo_control
Model run at                     : 2022-08-05 12:46:49
Estimation method                : bfgs
Model diagnosis                  : successful convergence 
Number of individuals            : 210
Number of rows in database       : 210
Number of modelled outcomes      : 210

Number of cores used             :  1 
Model without mixing

LL(start)                        : -291.12
LL(0)                            : -291.12
LL(C)                            : -283.76
LL(final)                        : -224.01
Rho-square (0)                   :  0.2305 
Adj.Rho-square (0)               :  0.1824 
Rho-square (C)                   :  0.2106 
Adj.Rho-square (C)               :  0.1612 
AIC                              :  476.02 
BIC                              :  522.88 

Estimated parameters             :  14
Time taken (hh:mm:ss)            :  00:00:0.33 
     pre-estimation              :  00:00:0.19 
     estimation                  :  00:00:0.06 
     post-estimation             :  00:00:0.08 
Iterations                       :  24  
Min abs eigenvalue of Hessian    :  0.785733 

Unconstrained optimisation.

Estimates:
                           Estimate        s.e.   t.rat.(0)    Rob.s.e.
asc_air                    1.828293    0.890241      2.0537    1.071983
asc_bus                    2.084246    0.895129      2.3284    1.009098
asc_train                  2.955379    0.716501      4.1247    0.715215
b_cost                    -0.004399    0.007031     -0.6257    0.008005
b_in_vehicle_time_car     -0.006614    0.001148     -5.7622    0.001816
b_in_vehicle_time_bus     -0.006695    0.001359     -4.9258    0.001829
b_in_vehicle_time_train   -0.007417    0.001191     -6.2274    0.001548
b_in_vehicle_time_air     -0.036470    0.006805     -5.3590    0.010955
b_hhincome_air             0.018821    0.011653      1.6151    0.012980
b_hhincome_bus            -0.023865    0.013325     -1.7909    0.010639
b_hhincome_train          -0.045148    0.012311     -3.6673    0.012100
b_party_size_air          -0.777100    0.228254     -3.4045    0.278790
b_party_size_bus          -0.853354    0.335632     -2.5425    0.335189
b_party_size_train        -0.321296    0.214387     -1.4987    0.181520
                        Rob.t.rat.(0)
asc_air                        1.7055
asc_bus                        2.0655
asc_train                      4.1322
b_cost                        -0.5496
b_in_vehicle_time_car         -3.6411
b_in_vehicle_time_bus         -3.6599
b_in_vehicle_time_train       -4.7925
b_in_vehicle_time_air         -3.3290
b_hhincome_air                 1.4499
b_hhincome_bus                -2.2432
b_hhincome_train              -3.7311
b_party_size_air              -2.7874
b_party_size_bus              -2.5459
b_party_size_train            -1.7700</code></pre>
</div>
</div>
</section>
<section id="interpretation" class="slide level2">
<h2>Interpretation</h2>
<ul>
<li>People really don’t like being on airplanes
<ul>
<li>Should also consider omitted variable bias, e.g.&nbsp;changes of planes</li>
</ul></li>
</ul>
</section>
<section id="independence-of-irrelevant-alternatives" class="slide level2">
<h2>Independence of irrelevant alternatives</h2>
</section></section>
<section>
<section id="the-probit-model" class="title-slide slide level1 center">
<h1>The probit model</h1>

</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-daly_estimating_2020" class="csl-entry" role="doc-biblioentry">
Daly, Andrew, Stephane Hess, and Juan de Dios Ortúzar. 2020. <span>“Estimating Willingness-to-Pay from Discrete Choice Models: Setting the Record Straight.”</span> <a href="http://www.stephanehess.me.uk/papers/working_papers/Daly_Hess_Ortuzar_2020.pdf">http://www.stephanehess.me.uk/papers/working_papers/Daly_Hess_Ortuzar_2020.pdf</a>.
</div>
</div>


<img src="dm-logo.png" class="slide-logo r-stretch"><div class="footer footer-default">

</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 720,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        function fireSlideChanged(previousSlide, currentSlide) {

          // dispatch for htmlwidgets
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for reveal
        if (window.Reveal) {
          window.Reveal.addEventListener("slidechanged", function(event) {
            fireSlideChanged(event.previousSlide, event.currentSlide);
          });
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        setTimeout(function() {
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          let href = ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const cites = ref.parentNode.getAttribute('data-cites').split(' ');
        tippyHover(ref, function() {
          var popup = window.document.createElement('div');
          cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    });
    </script>
    

</body></html>