<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.0.37">

  <meta name="author" content="Matt Bhagat-Conway">
  <meta name="dcterms.date" content="2022-08-11">
  <title>Data Matters Discrete Choice Models - Introduction to discrete choice models in R</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #f8f8f2;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #f8f8f2; } /* Normal */
    code span.al { color: #f07178; background-color: #2a0f15; font-weight: bold; } /* Alert */
    code span.an { color: #d4d0ab; } /* Annotation */
    code span.at { color: #00e0e0; } /* Attribute */
    code span.bn { color: #d4d0ab; } /* BaseN */
    code span.bu { color: #abe338; } /* BuiltIn */
    code span.cf { color: #ffa07a; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #abe338; } /* Char */
    code span.cn { color: #ffd700; } /* Constant */
    code span.co { color: #f8f8f2; font-style: italic; } /* Comment */
    code span.cv { color: #ffd700; } /* CommentVar */
    code span.do { color: #f8f8f2; } /* Documentation */
    code span.dt { color: #ffa07a; } /* DataType */
    code span.dv { color: #d4d0ab; } /* DecVal */
    code span.er { color: #f07178; text-decoration: underline; } /* Error */
    code span.ex { color: #00e0e0; font-weight: bold; } /* Extension */
    code span.fl { color: #d4d0ab; } /* Float */
    code span.fu { color: #ffa07a; } /* Function */
    code span.im { color: #abe338; } /* Import */
    code span.in { color: #d4d0ab; } /* Information */
    code span.kw { color: #ffa07a; font-weight: bold; } /* Keyword */
    code span.op { color: #ffa07a; } /* Operator */
    code span.ot { color: #00e0e0; } /* Other */
    code span.pp { color: #dcc6e0; } /* Preprocessor */
    code span.re { color: #00e0e0; background-color: #f8f8f2; } /* RegionMarker */
    code span.sc { color: #abe338; } /* SpecialChar */
    code span.ss { color: #abe338; } /* SpecialString */
    code span.st { color: #abe338; } /* String */
    code span.va { color: #00e0e0; } /* Variable */
    code span.vs { color: #abe338; } /* VerbatimString */
    code span.wa { color: #dcc6e0; } /* Warning */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
    }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="site_libs/quarto-diagram/mermaid.min.js"></script>
  <script src="site_libs/quarto-diagram/mermaid-init.js"></script>
  <link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
  <h1 class="title">Introduction to discrete choice models in R</h1>
  <p class="author">Matt Bhagat-Conway</p>
  <p class="institute">Odum Institute<br>University of North Carolina at Chapel Hill</p>
  <p class="date">August 11, 2022</p>
</section>

<section id="about-me" class="slide level2">
<h2>About me</h2>
<div class="cell">

</div>
<ul>
<li>Assistant professor of City and Regional Planning</li>
<li>Research focus: transportation modeling and simulation
<ul>
<li>Heavy use of discrete choice models</li>
</ul></li>
<li>PhD in Geography from Arizona State</li>
<li>Three years experience as transportation modeling software developer</li>
</ul>
</section>
<section id="before-we-go-any-further" class="slide level2">
<h2>Before we go any further</h2>
<ul>
<li>If you haven’t already installed R, RStudio, <code>apollo</code>, and <code>tidyverse</code>, do so now</li>
<li>R: <a href="https://r-project.org">https://r-project.org</a></li>
<li>RStudio: <a href="https://rstudio.com">https://rstudio.com</a></li>
<li><code>apollo</code> and <code>tidyverse</code>: in RStudio console, run:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">install.packages</span>(<span class="st">"apollo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="what-are-discrete-choice-models" class="slide level2">
<h2>What are discrete choice models?</h2>
<ul>
<li>Any model of a variable that takes on discrete values</li>
<li>Could be binary (two values), categorical (more than two values), or quantized (e.g., integers)</li>
</ul>
</section>
<section id="types-of-discrete-choice-models" class="slide level2">
<h2>Types of discrete choice models</h2>
<ul>
<li>Random utility models
<ul>
<li>Logistic regression, multinomial logistic regression, ordered logit, mixed logit</li>
</ul></li>
<li>Count models
<ul>
<li>Poisson and negative binomial regression</li>
</ul></li>
<li>Machine learning
<ul>
<li>Random forests, support vector machines, <em>k</em> nearest neighbors</li>
</ul></li>
</ul>
</section>
<section id="random-utility-theory" class="slide level2">
<h2>Random utility theory</h2>
<ul>
<li>Individuals are maximizing the <em>utility</em> of their choices</li>
<li>Utility is an abstract concept of value</li>
<li>Individuals choose the choice with the highest utility</li>
<li>Utility is random because there is a random component to utility</li>
<li>We won’t know which choice is the highest utility for an individual, only the probabilities that a particular choice will have the highest utility</li>
</ul>
</section>
<section>
<section id="binary-logistic-regression" class="title-slide slide level1 center">
<h1>Binary logistic regression</h1>

</section>
<section id="binary-logistic-regression-1" class="slide level2">
<h2>Binary logistic regression</h2>
<ul>
<li>A very common model for binary (yes/no) outcomes</li>
<li>Probably familiar to many</li>
<li>Usually presented as a generalized linear model</li>
</ul>
</section>
<section id="binary-logistic-regression-intuition" class="slide level2">
<h2>Binary logistic regression: Intuition</h2>
<ul>
<li>Linear functions can take on any value</li>
<li>Probabilities need to be between 0 and 1</li>
<li>The logit function transforms arbitrary linear values to (0, 1)</li>
</ul>
</section>
<section id="binary-logistic-regression-the-math" class="slide level2">
<h2>Binary logistic regression: the math</h2>
<p><span class="math display">\[
y^* = \alpha + \beta_1 x_1 + \beta_2 x_2 \cdots + \epsilon
\]</span></p>
<p><span class="math display">\[
\epsilon \thicksim \mathrm{Logistic}
\]</span></p>
<p><span class="math display">\[
p(y = 1) = p(y^* &gt; 0) = \frac{e^{y^*}}{1 + e^{y^*}}
\]</span></p>
</section>
<section id="the-logit-function" class="slide level2">
<h2>The logit function</h2>
<!-- run logistic regression -->

<img data-src="discrete-choice_files/figure-revealjs/unnamed-chunk-3-1.svg" alt="Logistic regression, showing sigmoid function" width="1200" class="r-stretch quarto-figure-center"></section>
<section id="logistic-regression-in-r" class="slide level2">
<h2>Logistic regression in R</h2>
<p><code>nhts-carpool-glm.R</code></p>
<div class="cell" data-filename="nhts-carpool-glm.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-4_c4ba8bff9388d0f440b2979b54e7f890">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a>data <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/nhts/carpool.csv"</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a></span>
<span id="cb2-5"><a href="#cb2-5"></a>glm_model <span class="ot">=</span> <span class="fu">glm</span>(carpool<span class="sc">~</span>hhsize<span class="sc">+</span>cars_per_driver<span class="sc">+</span>commute<span class="sc">+</span>social,</span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"logit"</span>), data)</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="fu">summary</span>(glm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="logistic-regression-in-r-1" class="slide level2">
<h2>Logistic regression in R</h2>
<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-5_c23b5ba86fb5dd796cc580d79c335a34">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = carpool ~ hhsize + cars_per_driver + commute + 
    social, family = binomial(link = "logit"), data = data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4758  -1.1048  -0.5243   1.0966   2.2147  

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -0.87316    0.10310  -8.469  &lt; 2e-16 ***
hhsize           0.39877    0.02468  16.156  &lt; 2e-16 ***
cars_per_driver -0.09750    0.05659  -1.723   0.0849 .  
commuteTRUE     -1.59549    0.11134 -14.330  &lt; 2e-16 ***
socialTRUE       0.41292    0.10269   4.021 5.79e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 6925.6  on 4999  degrees of freedom
Residual deviance: 6334.1  on 4995  degrees of freedom
AIC: 6344.1

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section>
<section id="binary-logistic-regression-as-a-random-utility-model" class="slide level2">
<h2>Binary logistic regression as a random utility model</h2>
<ul>
<li>We can treat the linear predictor in logistic regression as the utility of the modeled outcome</li>
<li>In this case, the utility of carpooling</li>
<li>We also need a utility of not carpooling</li>
<li>Decisionmakers will choose the highest utility <em>alternative</em></li>
</ul>
</section>
<section id="binary-logistic-regression-as-a-random-utility-model-1" class="slide level2">
<h2>Binary logistic regression as a random utility model</h2>
<ul>
<li>Utilities are only meaningful relative to each other</li>
<li>Usual practice is to set utility of one alternative to 0</li>
</ul>
</section>
<section id="binary-logistic-regression-as-a-random-utility-model-2" class="slide level2">
<h2>Binary logistic regression as a random utility model</h2>
<p><span class="math display">\[
y^* = \alpha + \beta_1 x_1 + \beta_2 x_2 \cdots + \epsilon
\]</span></p>
<p><span class="math display">\[
p(y = 1) = p(y^* &gt; 0)\\= \frac{e^{y^*}}{1 + e^{y^*}}
\]</span></p>
</section>
<section id="binary-logistic-regression-as-a-random-utility-model-3" class="slide level2">
<h2>Binary logistic regression as a random utility model</h2>
<p><span class="math display">\[
U_{y=1} = \alpha + \beta_1 x_1 + \beta_2 x_2 \cdots + \epsilon_1
\]</span></p>
<p><span class="math display">\[
U_{y=0} = 0 + \epsilon_0
\]</span></p>
<p><span class="math display">\[
p(y = 1) = p(U_{y=1} &gt; U_{y=0})\\= \frac{e^{U_{y=1}}}{e^{U_{y=0}} + e^{U_{y=1}}}
\]</span></p>
</section>
<section id="binary-logistic-regression-as-a-random-utility-model-in-r" class="slide level2">
<h2>Binary logistic regression as a random utility model in R</h2>
<p><code>nhts-carpool-apollo.R</code></p>
<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-7_cd7ca6bc75f24a4f58694445c495ea59">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">library</span>(apollo)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># Read data - variable must be called "database"</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>database <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/nhts/carpool.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-8_2d0185790338db8ca615d556e3f847ee">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Initialize Apollo library</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">apollo_initialise</span>()</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># set parameters for overall model</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>apollo_control <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="at">modelName=</span><span class="st">"Carpool_binary"</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="at">indivID=</span><span class="st">"id"</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-9_f28fb68482f9797b5522cdd992d81d6e">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># In Apollo, you specify your utility functions by hand,</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># first telling Apollo what coefficients to estimate</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>apollo_beta <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="at">constant_carpool =</span> <span class="dv">0</span>, <span class="co"># 0 is starting value</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="at">b_hhsize =</span> <span class="dv">0</span>,</span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="at">b_cars_per_driver =</span> <span class="dv">0</span>,</span>
<span id="cb6-7"><a href="#cb6-7"></a>    <span class="at">b_commute =</span> <span class="dv">0</span>,</span>
<span id="cb6-8"><a href="#cb6-8"></a>    <span class="at">b_social =</span> <span class="dv">0</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>)</span>
<span id="cb6-10"><a href="#cb6-10"></a></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co"># any parameters that you want to remain constant go here</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>apollo_fixed <span class="ot">=</span> <span class="fu">c</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-10_b32393a346d8a9c88c6049d4643c3728">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># prepare the inputs to the Apollo estimation code</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>apollo_inputs <span class="ot">=</span> <span class="fu">apollo_validateInputs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>All checks on apollo_control completed.
All checks on database completed.</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-11_2c9669efedb36bc44041eee1003a2817">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># this function calculates probabilities of each alternative</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>apollo_probabilities <span class="ot">=</span> <span class="cf">function</span>(apollo_beta, apollo_inputs,</span>
<span id="cb9-3"><a href="#cb9-3"></a>        <span class="at">functionality=</span><span class="st">"estimate"</span>) {</span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="co"># so we can refer to variables by name</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="fu">apollo_attach</span>(apollo_beta, apollo_inputs)</span>
<span id="cb9-6"><a href="#cb9-6"></a>    <span class="fu">on.exit</span>(<span class="fu">apollo_detach</span>(apollo_beta, apollo_inputs))</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a>    <span class="co"># This is the list of probabilities for the alternatives</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>    <span class="co"># for each observation</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>    P <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb9-11"><a href="#cb9-11"></a></span>
<span id="cb9-12"><a href="#cb9-12"></a>    <span class="co"># Define utility functions</span></span>
<span id="cb9-13"><a href="#cb9-13"></a>    V <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb9-14"><a href="#cb9-14"></a>    V[[<span class="st">"carpool"</span>]] <span class="ot">=</span> constant_carpool <span class="sc">+</span> b_hhsize <span class="sc">*</span> hhsize <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>        b_cars_per_driver <span class="sc">*</span> cars_per_driver <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>        b_commute <span class="sc">*</span> commute <span class="sc">+</span> b_social <span class="sc">*</span> social</span>
<span id="cb9-17"><a href="#cb9-17"></a>    V[[<span class="st">"not_carpool"</span>]] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb9-18"><a href="#cb9-18"></a></span>
<span id="cb9-19"><a href="#cb9-19"></a>    <span class="co"># associate utility functions with data</span></span>
<span id="cb9-20"><a href="#cb9-20"></a>    logit_settings <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb9-21"><a href="#cb9-21"></a>        <span class="at">alternatives =</span> <span class="fu">c</span>(<span class="at">carpool=</span>T, <span class="at">not_carpool=</span>F),</span>
<span id="cb9-22"><a href="#cb9-22"></a>        <span class="at">avail        =</span> <span class="fu">list</span>(<span class="at">carpool=</span>T, <span class="at">not_carpool=</span>T),</span>
<span id="cb9-23"><a href="#cb9-23"></a>        <span class="at">choiceVar    =</span> carpool,</span>
<span id="cb9-24"><a href="#cb9-24"></a>        <span class="at">utilities    =</span> V</span>
<span id="cb9-25"><a href="#cb9-25"></a>    )</span>
<span id="cb9-26"><a href="#cb9-26"></a></span>
<span id="cb9-27"><a href="#cb9-27"></a>    <span class="co"># compute probabilities</span></span>
<span id="cb9-28"><a href="#cb9-28"></a>    P[[<span class="st">"model"</span>]] <span class="ot">=</span> <span class="fu">apollo_mnl</span>(logit_settings, functionality)</span>
<span id="cb9-29"><a href="#cb9-29"></a></span>
<span id="cb9-30"><a href="#cb9-30"></a>    P <span class="ot">=</span> <span class="fu">apollo_prepareProb</span>(P, apollo_inputs, functionality)</span>
<span id="cb9-31"><a href="#cb9-31"></a>    <span class="fu">return</span>(P)</span>
<span id="cb9-32"><a href="#cb9-32"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-12_705bc9d05dee3c9118bb81a54e8e8792">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># finally, estimate the model</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>model <span class="ot">=</span> <span class="fu">apollo_estimate</span>(apollo_beta, apollo_fixed,</span>
<span id="cb10-3"><a href="#cb10-3"></a>    apollo_probabilities, apollo_inputs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Preparing user-defined functions.

Testing likelihood function...

Overview of choices for MNL model component :
                                 carpool not_carpool
Times available                  5000.00     5000.00
Times chosen                     2414.00     2586.00
Percentage chosen overall          48.28       51.72
Percentage chosen when available   48.28       51.72

Pre-processing likelihood function...

Testing influence of parameters
Starting main estimation
Initial function value: -3465.736 
Initial gradient value:
 constant_carpool          b_hhsize b_cars_per_driver         b_commute 
         -86.0000          565.5000         -185.9472         -194.5000 
         b_social 
          54.5000 
initial  value 3465.735903 
iter   2 value 3460.662370
iter   3 value 3439.175219
iter   4 value 3308.930520
iter   5 value 3303.526519
iter   6 value 3286.485451
iter   7 value 3216.110456
iter   8 value 3169.801769
iter   9 value 3167.107884
iter  10 value 3167.067692
iter  11 value 3167.067227
iter  11 value 3167.067189
iter  11 value 3167.067189
final  value 3167.067189 
converged
Additional convergence test using scaled estimation. Parameters will be
  scaled by their current estimates and additional iterations will be
  performed.
initial  value 3167.067189 
iter   1 value 3167.067189
final  value 3167.067189 
converged
Estimated parameters:
                     Estimate
constant_carpool     -0.87316
b_hhsize              0.39878
b_cars_per_driver    -0.09750
b_commute            -1.59551
b_social              0.41290

Computing covariance matrix using analytical gradient.
 0%....25%....50%...100%
Negative definite Hessian with maximum eigenvalue: -73.928565
Computing score matrix...
Calculating LL(0) for applicable models...
Calculating LL(c) for applicable models...
Calculating LL of each model component...</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nhts-carpool-apollo.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-13_1ebb222e7e4ffa6c08217ed33c97e081">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># print results</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">apollo_modelOutput</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model run by mwbc using Apollo 0.2.7 on R 4.2.1 for Darwin.
www.ApolloChoiceModelling.com

Model name                       : Carpool_binary
Model description                : No model description provided in apollo_control
Model run at                     : 2022-08-09 14:02:52
Estimation method                : bfgs
Model diagnosis                  : successful convergence 
Number of individuals            : 5000
Number of rows in database       : 5000
Number of modelled outcomes      : 5000

Number of cores used             :  1 
Model without mixing

LL(start)                        : -3465.74
LL(0)                            : -3465.74
LL(C)                            : -3462.78
LL(final)                        : -3167.07
Rho-square (0)                   :  0.0862 
Adj.Rho-square (0)               :  0.0847 
Rho-square (C)                   :  0.0854 
Adj.Rho-square (C)               :  0.084 
AIC                              :  6344.13 
BIC                              :  6376.72 

Estimated parameters             :  5
Time taken (hh:mm:ss)            :  00:00:0.48 
     pre-estimation              :  00:00:0.26 
     estimation                  :  00:00:0.06 
     post-estimation             :  00:00:0.16 
Iterations                       :  15  
Min abs eigenvalue of Hessian    :  73.92857 

Unconstrained optimisation.

Estimates:
                     Estimate        s.e.   t.rat.(0)    Rob.s.e. Rob.t.rat.(0)
constant_carpool     -0.87316     0.10310      -8.469     0.10141        -8.610
b_hhsize              0.39878     0.02468      16.156     0.02537        15.716
b_cars_per_driver    -0.09750     0.05659      -1.723     0.05417        -1.800
b_commute            -1.59551     0.11134     -14.330     0.11617       -13.734
b_social              0.41290     0.10269       4.021     0.10181         4.056</code></pre>
</div>
</div>
</section>
<section id="but-dont-take-my-word-for-it" class="slide level2">
<h2>But don’t take my word for it…</h2>
<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-14_c5b1daf32d912b389c45ac9f2a3df08c">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = carpool ~ hhsize + cars_per_driver + commute + 
    social, family = binomial(link = "logit"), data = data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4758  -1.1048  -0.5243   1.0966   2.2147  

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -0.87316    0.10310  -8.469  &lt; 2e-16 ***
hhsize           0.39877    0.02468  16.156  &lt; 2e-16 ***
cars_per_driver -0.09750    0.05659  -1.723   0.0849 .  
commuteTRUE     -1.59549    0.11134 -14.330  &lt; 2e-16 ***
socialTRUE       0.41292    0.10269   4.021 5.79e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 6925.6  on 4999  degrees of freedom
Residual deviance: 6334.1  on 4995  degrees of freedom
AIC: 6344.1

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
</section></section>
<section id="questions" class="title-slide slide level1 center">
<h1>Questions?</h1>

</section>

<section>
<section id="the-multinomial-logit-model" class="title-slide slide level1 center">
<h1>The multinomial logit model</h1>

</section>
<section id="what-about-more-than-two-outcomes" class="slide level2">
<h2>What about more than two outcomes?</h2>
<ul>
<li>Random utility theory doesn’t constrain us to two outcomes</li>
<li>We can have many outcomes, and decisionmakers choose the one with the highest utility</li>
<li>This is known as a <em>multinomial</em> model</li>
</ul>
</section>
<section id="extending-logistic-regression-to-the-multinomial-case" class="slide level2">
<h2>Extending logistic regression to the multinomial case</h2>
<ul>
<li>Instead of two utilities <span class="math inline">\(U_{y=1}\)</span> and <span class="math inline">\(U_{y=0}\)</span>, we have arbitrary number of utility functions <span class="math inline">\(U_i\)</span></li>
<li>Decisionmakers choose the option with the highest utility</li>
<li>As with binary logistic regression, utility functions are usually linear combinations of parameters</li>
</ul>
</section>
<section id="multinomial-logistic-regression-the-math" class="slide level2">
<h2>Multinomial logistic regression: the math</h2>
<ul>
<li>Probability then becomes</li>
</ul>
<p><span class="math display">\[
p(y=i)\\= p(U_i &gt; \mathrm{all~other}~U)\\
    =\frac{e^{U_i}}{e^{U_1} + e^{U_2} \cdots}\\
    =\frac{e^{U_i}}{\sum_{j \in I} e^{U_j}}
\]</span></p>
</section>
<section id="multinomial-logistic-regression-in-r" class="slide level2">
<h2>Multinomial logistic regression in R</h2>
<ul>
<li>We will build a model of working from home expectation post-pandemic, using data from the <a href="https://covidfuture.org">COVID Future</a> study.</li>
<li>We will estimate four utility functions, for being unable to, rarely, frequently, and always working from home</li>
<li>Based on age, income, and job type</li>
<li>These utility functions will have the same variables but different coefficients</li>
<li>Each will also have a <em>alternative specific constant</em>—like a constant in logistic regression that represents the base rate, but for each alternative</li>
<li>One utility function will be held at zero</li>
</ul>
</section>
<section id="multinomial-logistic-regression-in-r-1" class="slide level2">
<h2>Multinomial logistic regression in R</h2>
<p><code>covidfuture-wfh-mnl.R</code></p>
<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-16_1975716c4e3657f6d7a731744f183479">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">library</span>(apollo)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a>database <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/covidfuture_wfh.csv"</span>)</span>
<span id="cb15-5"><a href="#cb15-5"></a></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="fu">apollo_initialise</span>()</span>
<span id="cb15-7"><a href="#cb15-7"></a></span>
<span id="cb15-8"><a href="#cb15-8"></a>apollo_control <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb15-9"><a href="#cb15-9"></a>    <span class="at">modelName=</span><span class="st">"WFH_Postpandemic"</span>,</span>
<span id="cb15-10"><a href="#cb15-10"></a>    <span class="at">indivID=</span><span class="st">"resp_id"</span></span>
<span id="cb15-11"><a href="#cb15-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-17_593bb5eea6c6a9be8f5eb8776231798d">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">head</span>(database)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  resp_id wfh      age income_100k_plus service_worker
    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;lgl&gt;            &lt;lgl&gt;         
1    1201 Often     29 TRUE             FALSE         
2    1228 Often     28 TRUE             FALSE         
3    1229 Often     25 FALSE            TRUE          
4    1230 Unable    36 FALSE            FALSE         
5    1231 Unable    33 FALSE            FALSE         
6    1233 Often     30 FALSE            FALSE         </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-18_2481b50b0e0dc83a626018381cae9dc5">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># now, we must define all the coefficients</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># we have separate sets of coefficients for each utility</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co"># function, because the utilities need to be different</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>apollo_beta <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="at">asc_rarely =</span> <span class="dv">0</span>,</span>
<span id="cb18-6"><a href="#cb18-6"></a>    <span class="at">asc_often =</span> <span class="dv">0</span>,</span>
<span id="cb18-7"><a href="#cb18-7"></a>    <span class="at">asc_always =</span> <span class="dv">0</span>,</span>
<span id="cb18-8"><a href="#cb18-8"></a>    <span class="at">b_rarely_age =</span> <span class="dv">0</span>,</span>
<span id="cb18-9"><a href="#cb18-9"></a>    <span class="at">b_often_age =</span> <span class="dv">0</span>,</span>
<span id="cb18-10"><a href="#cb18-10"></a>    <span class="at">b_always_age =</span> <span class="dv">0</span>,</span>
<span id="cb18-11"><a href="#cb18-11"></a>    <span class="at">b_rarely_highinc =</span> <span class="dv">0</span>,</span>
<span id="cb18-12"><a href="#cb18-12"></a>    <span class="at">b_often_highinc =</span> <span class="dv">0</span>,</span>
<span id="cb18-13"><a href="#cb18-13"></a>    <span class="at">b_always_highinc =</span> <span class="dv">0</span>,</span>
<span id="cb18-14"><a href="#cb18-14"></a>    <span class="at">b_rarely_service_worker =</span> <span class="dv">0</span>,</span>
<span id="cb18-15"><a href="#cb18-15"></a>    <span class="at">b_often_service_worker =</span> <span class="dv">0</span>,</span>
<span id="cb18-16"><a href="#cb18-16"></a>    <span class="at">b_always_service_worker =</span> <span class="dv">0</span></span>
<span id="cb18-17"><a href="#cb18-17"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-19_4c414ff5c701503ba382873d0627de80">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>apollo_fixed <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a>apollo_inputs <span class="ot">=</span> <span class="fu">apollo_validateInputs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>All checks on apollo_control completed.
All checks on database completed.</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-20_e278037bc92e3c3144023ad892f2fb39">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Finally, we define the utility functions in apollo_probabilities</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>apollo_probabilities <span class="ot">=</span> <span class="cf">function</span>(apollo_beta, apollo_inputs,</span>
<span id="cb21-3"><a href="#cb21-3"></a>        <span class="at">functionality=</span><span class="st">"estimate"</span>) {</span>
<span id="cb21-4"><a href="#cb21-4"></a>    <span class="fu">apollo_attach</span>(apollo_beta, apollo_inputs)</span>
<span id="cb21-5"><a href="#cb21-5"></a>    <span class="fu">on.exit</span>(<span class="fu">apollo_detach</span>(apollo_beta, apollo_inputs))</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a>    P <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb21-8"><a href="#cb21-8"></a></span>
<span id="cb21-9"><a href="#cb21-9"></a>    <span class="co"># define utility functions</span></span>
<span id="cb21-10"><a href="#cb21-10"></a>    V <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb21-11"><a href="#cb21-11"></a>    <span class="co"># fix one utility to zero</span></span>
<span id="cb21-12"><a href="#cb21-12"></a>    V[[<span class="st">"Unable"</span>]] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb21-13"><a href="#cb21-13"></a>    V[[<span class="st">"Rarely"</span>]] <span class="ot">=</span> asc_rarely <span class="sc">+</span> b_rarely_age <span class="sc">*</span> age <span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>        b_rarely_highinc <span class="sc">*</span> income_100k_plus <span class="sc">+</span></span>
<span id="cb21-15"><a href="#cb21-15"></a>        b_rarely_service_worker <span class="sc">*</span> service_worker</span>
<span id="cb21-16"><a href="#cb21-16"></a>    V[[<span class="st">"Often"</span>]] <span class="ot">=</span> asc_often <span class="sc">+</span> b_often_age <span class="sc">*</span> age <span class="sc">+</span></span>
<span id="cb21-17"><a href="#cb21-17"></a>        b_often_highinc <span class="sc">*</span> income_100k_plus <span class="sc">+</span></span>
<span id="cb21-18"><a href="#cb21-18"></a>        b_often_service_worker <span class="sc">*</span> service_worker</span>
<span id="cb21-19"><a href="#cb21-19"></a>    V[[<span class="st">"Always"</span>]] <span class="ot">=</span> asc_always <span class="sc">+</span> b_always_age <span class="sc">*</span> age <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20"></a>        b_always_highinc <span class="sc">*</span> income_100k_plus <span class="sc">+</span></span>
<span id="cb21-21"><a href="#cb21-21"></a>        b_always_service_worker <span class="sc">*</span> service_worker</span>
<span id="cb21-22"><a href="#cb21-22"></a>        </span>
<span id="cb21-23"><a href="#cb21-23"></a>    mnl_settings <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb21-24"><a href="#cb21-24"></a>        <span class="at">alternatives =</span> <span class="fu">c</span>(<span class="at">Unable=</span><span class="st">"Unable"</span>, <span class="at">Rarely=</span><span class="st">"Rarely"</span>,</span>
<span id="cb21-25"><a href="#cb21-25"></a>            <span class="at">Often=</span><span class="st">"Often"</span>, <span class="at">Always=</span><span class="st">"Always"</span>),</span>
<span id="cb21-26"><a href="#cb21-26"></a>        <span class="at">avail =</span> <span class="fu">list</span>(<span class="at">Unable=</span>T, <span class="at">Rarely=</span>T, <span class="at">Often=</span>T, <span class="at">Always=</span>T),</span>
<span id="cb21-27"><a href="#cb21-27"></a>        <span class="at">choiceVar =</span> wfh,</span>
<span id="cb21-28"><a href="#cb21-28"></a>        <span class="at">utilities =</span> V</span>
<span id="cb21-29"><a href="#cb21-29"></a>    )</span>
<span id="cb21-30"><a href="#cb21-30"></a></span>
<span id="cb21-31"><a href="#cb21-31"></a>    P[[<span class="st">"model"</span>]] <span class="ot">=</span> <span class="fu">apollo_mnl</span>(mnl_settings, functionality)</span>
<span id="cb21-32"><a href="#cb21-32"></a>    P <span class="ot">=</span> <span class="fu">apollo_prepareProb</span>(P, apollo_inputs, functionality)</span>
<span id="cb21-33"><a href="#cb21-33"></a>    <span class="fu">return</span>(P)</span>
<span id="cb21-34"><a href="#cb21-34"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-21_f1e0c3cc8b8738877068f80533371a6e">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># estimate model</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>model <span class="ot">=</span> <span class="fu">apollo_estimate</span>(apollo_beta, apollo_fixed,</span>
<span id="cb22-3"><a href="#cb22-3"></a>    apollo_probabilities, apollo_inputs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Preparing user-defined functions.

Testing likelihood function...

Overview of choices for MNL model component :
                                  Unable  Rarely  Often  Always
Times available                  4895.00 4895.00 4895.0 4895.00
Times chosen                     2386.00  228.00 1640.0  641.00
Percentage chosen overall          48.74    4.66   33.5   13.09
Percentage chosen when available   48.74    4.66   33.5   13.09

Pre-processing likelihood function...

Testing influence of parameters
Starting main estimation
Initial function value: -6785.911 
Initial gradient value:
             asc_rarely               asc_often              asc_always 
                -995.75                  416.25                 -582.75 
           b_rarely_age             b_often_age            b_always_age 
              -45652.00                16701.00               -23413.00 
       b_rarely_highinc         b_often_highinc        b_always_highinc 
                -361.50                  380.50                 -183.50 
b_rarely_service_worker  b_often_service_worker b_always_service_worker 
                -493.25                  -56.25                 -415.25 
initial  value 6785.910898 
iter   2 value 6028.442633
iter   3 value 5685.432004
iter   4 value 5679.055816
iter   5 value 5394.755990
iter   6 value 5278.692311
iter   7 value 5263.035019
iter   8 value 5258.497397
iter   9 value 5248.299040
iter  10 value 5221.159849
iter  11 value 5173.585242
iter  12 value 5125.560646
iter  13 value 5111.633098
iter  14 value 5106.523896
iter  15 value 5082.704875
iter  16 value 5079.556757
iter  17 value 5078.866308
iter  18 value 5078.706760
iter  19 value 5078.698911
iter  20 value 5078.698753
iter  20 value 5078.698750
iter  20 value 5078.698749
final  value 5078.698749 
converged
Additional convergence test using scaled estimation. Parameters will be
  scaled by their current estimates and additional iterations will be
  performed.
initial  value 5078.698749 
iter   1 value 5078.698749
final  value 5078.698749 
converged
Estimated parameters:
                           Estimate
asc_rarely                 -0.72861
asc_often                   0.50458
asc_always                 -1.36727
b_rarely_age               -0.03318
b_often_age                -0.01467
b_always_age                0.01224
b_rarely_highinc            0.81208
b_often_highinc             1.01227
b_always_highinc            0.53411
b_rarely_service_worker    -0.93900
b_often_service_worker     -1.26770
b_always_service_worker    -1.54383

Computing covariance matrix using analytical gradient.
 0%....25%....50%....75%....100%
Negative definite Hessian with maximum eigenvalue: -16.466841
Computing score matrix...
Calculating LL(0) for applicable models...
Calculating LL(c) for applicable models...
Calculating LL of each model component...</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="covidfuture-wfh-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-22_d3aecc5a1ad16b53352f211be47fda19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Print results</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="fu">apollo_modelOutput</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model run by mwbc using Apollo 0.2.7 on R 4.2.1 for Darwin.
www.ApolloChoiceModelling.com

Model name                       : WFH_Postpandemic
Model description                : No model description provided in apollo_control
Model run at                     : 2022-08-09 14:02:53
Estimation method                : bfgs
Model diagnosis                  : successful convergence 
Number of individuals            : 4895
Number of rows in database       : 4895
Number of modelled outcomes      : 4895

Number of cores used             :  1 
Model without mixing

LL(start)                        : -6785.91
LL(0)                            : -6785.91
LL(C)                            : -5510.24
LL(final)                        : -5078.7
Rho-square (0)                   :  0.2516 
Adj.Rho-square (0)               :  0.2498 
Rho-square (C)                   :  0.0783 
Adj.Rho-square (C)               :  0.0761 
AIC                              :  10181.4 
BIC                              :  10259.35 

Estimated parameters             :  12
Time taken (hh:mm:ss)            :  00:00:0.72 
     pre-estimation              :  00:00:0.24 
     estimation                  :  00:00:0.15 
     post-estimation             :  00:00:0.33 
Iterations                       :  24  
Min abs eigenvalue of Hessian    :  16.46684 

Unconstrained optimisation.

Estimates:
                           Estimate        s.e.   t.rat.(0)    Rob.s.e.
asc_rarely                 -0.72861    0.231197      -3.151    0.234610
asc_often                   0.50458    0.116246       4.341    0.118378
asc_always                 -1.36727    0.163257      -8.375    0.158789
b_rarely_age               -0.03318    0.005224      -6.351    0.005380
b_often_age                -0.01467    0.002391      -6.135    0.002418
b_always_age                0.01224    0.003156       3.880    0.003086
b_rarely_highinc            0.81208    0.147684       5.499    0.144518
b_often_highinc             1.01227    0.072260      14.009    0.071662
b_always_highinc            0.53411    0.096440       5.538    0.095423
b_rarely_service_worker    -0.93900    0.143583      -6.540    0.141024
b_often_service_worker     -1.26770    0.069906     -18.134    0.069960
b_always_service_worker    -1.54383    0.099610     -15.499    0.099288
                        Rob.t.rat.(0)
asc_rarely                     -3.106
asc_often                       4.262
asc_always                     -8.611
b_rarely_age                   -6.168
b_often_age                    -6.066
b_always_age                    3.968
b_rarely_highinc                5.619
b_often_highinc                14.126
b_always_highinc                5.597
b_rarely_service_worker        -6.658
b_often_service_worker        -18.120
b_always_service_worker       -15.549</code></pre>
</div>
</div>
</section>
<section id="interpreting-multinomial-logit-results" class="slide level2">
<h2>Interpreting multinomial logit results</h2>
<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-23_22494bddf8dbaa280eb13cb33a906c17">
<div class="cell-output-display">
<table>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Rarely</th>
<th style="text-align: right;">Often</th>
<th style="text-align: right;">Always</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ASC</td>
<td style="text-align: right;">-0.73</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">-1.37</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age</td>
<td style="text-align: right;">-0.03</td>
<td style="text-align: right;">-0.01</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;">High income</td>
<td style="text-align: right;">0.81</td>
<td style="text-align: right;">1.01</td>
<td style="text-align: right;">0.53</td>
</tr>
<tr class="even">
<td style="text-align: left;">Service worker</td>
<td style="text-align: right;">-0.94</td>
<td style="text-align: right;">-1.27</td>
<td style="text-align: right;">-1.54</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Note: all variables significant at <span class="math inline">\(p &lt; 0.05\)</span></p>
</section>
<section class="slide level2">

<ul>
<li>Relative to being unable to WFH,
<ul>
<li>Older people are less likely to WFH rarely or often, but more likely to always</li>
<li>Higher income people are much more likely to be able to and choose to WFH</li>
<li>Service workers are less likely to be able to WFH</li>
<li>Scale of age variable is different from others</li>
</ul></li>
</ul>
</section>
<section id="questions-1" class="slide level2">
<h2>Questions?</h2>
</section>
<section id="specifying-a-multinomial-logit-model" class="slide level2">
<h2>Specifying a multinomial logit model</h2>
<ul>
<li>Multinomial logit models can have independent variables that vary at the individual level (e.g., income)</li>
<li>Can also have variables at the alternative level (e.g., travel time)</li>
<li>Utilities identified only up to a constant offset
<ul>
<li>Constant changes to all utilities does not change outcome</li>
</ul></li>
</ul>
</section>
<section id="specifying-a-multinomial-logit-model-1" class="slide level2">
<h2>Specifying a multinomial logit model</h2>
<ul>
<li>Variables that vary at <em>individual</em> level must have different coefficients for each alternative, and one must be zero</li>
<li>Variables that vary at <em>alternative</em> level may or may not have different coefficients for each alternative, and there is no need have one zero coefficient
<ul>
<li>But you do have to know values for unchosen alternatives</li>
</ul></li>
</ul>
</section>
<section id="specifying-a-multinomial-logit-model-2" class="slide level2">
<h2>Specifying a multinomial logit model</h2>
<div class="cell" data-fig-width="12" data-fig-height="6">
<div class="cell-output-display">
<div>
<p>
<svg width="1152" height="576" viewbox="0.00 0.00 616.11 169.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style=" display: block; margin: auto auto auto auto">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 165)">
<title>
G
</title>
<polygon fill="transparent" stroke="transparent" points="-4,4 -4,-165 612.11,-165 612.11,4 -4,4"></polygon> <g id="clust1" class="cluster">
<title>
clustertt
</title>
<polygon fill="transparent" stroke="transparent" points="112.35,-101 112.35,-153 527.35,-153 527.35,-101 112.35,-101"></polygon> </g> <!-- inc --> <g id="node1" class="node">
<title>
inc
</title>
<polygon fill="none" stroke="#ffffff" points="100.33,-145 42.37,-145 42.37,-109 100.33,-109 100.33,-145"></polygon> <text text-anchor="middle" x="71.35" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Income</text> </g> <!-- iw --> <g id="node8" class="node">
<title>
iw
</title>
</g> <!-- inc&#45;&gt;iw --> <g id="edge1" class="edge">
<title>
inc-&gt;iw
</title>
<path fill="none" stroke="#ffffff" d="M65.23,-108.94C59.85,-93.93 52.8,-74.27 52.37,-73.06"></path> </g> <!-- ib --> <g id="node9" class="node">
<title>
ib
</title>
</g> <!-- inc&#45;&gt;ib --> <g id="edge2" class="edge">
<title>
inc-&gt;ib
</title>
<path fill="none" stroke="#ffffff" d="M77.46,-108.94C82.84,-93.93 89.89,-74.27 90.33,-73.06"></path> </g> <!-- ic --> <g id="node10" class="node">
<title>
ic
</title>
</g> <!-- inc&#45;&gt;ic --> <g id="edge3" class="edge">
<title>
inc-&gt;ic
</title>
<path fill="none" stroke="#ffffff" d="M71.35,-108.94C71.35,-93.93 71.35,-74.27 71.35,-73.06"></path> </g> <!-- ttw --> <g id="node2" class="node">
<title>
ttw
</title>
<polygon fill="none" stroke="#ffffff" points="246.64,-145 120.06,-145 120.06,-109 246.64,-109 246.64,-145"></polygon> <text text-anchor="middle" x="183.35" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Travel time of walk</text> </g> <!-- tw --> <g id="node11" class="node">
<title>
tw
</title>
</g> <!-- ttw&#45;&gt;tw --> <g id="edge4" class="edge">
<title>
ttw-&gt;tw
</title>
<path fill="none" stroke="#ffffff" d="M184.31,-108.94C185.16,-93.93 186.27,-74.27 186.34,-73.06"></path> </g> <!-- ttb --> <g id="node3" class="node">
<title>
ttb
</title>
<polygon fill="none" stroke="#ffffff" points="518.87,-145 399.82,-145 399.82,-109 518.87,-109 518.87,-145"></polygon> <text text-anchor="middle" x="459.35" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Travel time of bus</text> </g> <!-- tb --> <g id="node12" class="node">
<title>
tb
</title>
</g> <!-- ttb&#45;&gt;tb --> <g id="edge5" class="edge">
<title>
ttb-&gt;tb
</title>
<path fill="none" stroke="#ffffff" d="M464.18,-108.94C468.42,-93.93 473.99,-74.27 474.33,-73.06"></path> </g> <!-- ttc --> <g id="node4" class="node">
<title>
ttc
</title>
<polygon fill="none" stroke="#ffffff" points="381.51,-145 265.18,-145 265.18,-109 381.51,-109 381.51,-145"></polygon> <text text-anchor="middle" x="323.35" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Travel time of car</text> </g> <!-- tc --> <g id="node13" class="node">
<title>
tc
</title>
</g> <!-- ttc&#45;&gt;tc --> <g id="edge6" class="edge">
<title>
ttc-&gt;tc
</title>
<path fill="none" stroke="#ffffff" d="M326.57,-108.94C329.4,-93.93 333.11,-74.27 333.34,-73.06"></path> </g> <!-- uw --> <g id="node5" class="node">
<title>
uw
</title>
<ellipse fill="none" stroke="#ffffff" cx="186.35" cy="-18" rx="67.8" ry="18"></ellipse> <text text-anchor="middle" x="186.35" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Utility of walk</text> </g> <!-- ub --> <g id="node6" class="node">
<title>
ub
</title>
<ellipse fill="none" stroke="#ffffff" cx="474.35" cy="-18" rx="62.58" ry="18"></ellipse> <text text-anchor="middle" x="474.35" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Utility of bus</text> </g> <!-- uc --> <g id="node7" class="node">
<title>
uc
</title>
<ellipse fill="none" stroke="#ffffff" cx="333.35" cy="-18" rx="60.83" ry="18"></ellipse> <text text-anchor="middle" x="333.35" y="-13.8" font-family="Times,serif" font-size="14.00" fill="#ffffff">Utility of car</text> </g> <!-- iw&#45;&gt;uw --> <g id="edge7" class="edge">
<title>
iw-&gt;uw
</title>
<path fill="none" stroke="#ffffff" d="M52.44,-71.96C54.88,-71 102.82,-52.04 140.64,-37.08"></path> <polygon fill="#ffffff" stroke="#ffffff" points="142,-40.31 150.01,-33.37 139.42,-33.8 142,-40.31"></polygon> </g> <!-- md --> <g id="node14" class="node">
<title>
md
</title>
<text text-anchor="middle" x="50.35" y="-22.2" font-family="Times,serif" font-size="14.00" fill="#ff0948">Must be different,</text> <text text-anchor="middle" x="50.35" y="-5.4" font-family="Times,serif" font-size="14.00" fill="#ff0948">one must be zero</text> </g> <!-- iw&#45;&gt;md --> <g id="edge13" class="edge">
<title>
iw-&gt;md
</title>
<path fill="none" stroke="#ff0948" d="M52.34,-71.85C52.27,-69.89 51.5,-49.49 50.94,-34.62"></path> </g> <!-- ib&#45;&gt;ub --> <g id="edge8" class="edge">
<title>
ib-&gt;ub
</title>
<path fill="none" stroke="#ffffff" d="M90.47,-71.99C95.81,-71.63 267.61,-59.97 403.35,-36 408.65,-35.06 414.15,-33.97 419.64,-32.8"></path> <polygon fill="#ffffff" stroke="#ffffff" points="420.44,-36.2 429.45,-30.61 418.92,-29.37 420.44,-36.2"></polygon> </g> <!-- ib&#45;&gt;md --> <g id="edge15" class="edge">
<title>
ib-&gt;md
</title>
<path fill="none" stroke="#ff0948" d="M90.23,-71.85C88.76,-69.89 73.36,-49.49 62.14,-34.62"></path> </g> <!-- ic&#45;&gt;uc --> <g id="edge9" class="edge">
<title>
ic-&gt;uc
</title>
<path fill="none" stroke="#ffffff" d="M71.42,-71.99C74.69,-71.45 179.79,-53.97 263.35,-36 268.34,-34.93 273.52,-33.76 278.7,-32.57"></path> <polygon fill="#ffffff" stroke="#ffffff" points="279.68,-35.93 288.62,-30.24 278.08,-29.12 279.68,-35.93"></polygon> </g> <!-- ic&#45;&gt;md --> <g id="edge14" class="edge">
<title>
ic-&gt;md
</title>
<path fill="none" stroke="#ff0948" d="M71.29,-71.85C70.51,-69.89 62.43,-49.49 56.54,-34.62"></path> </g> <!-- tw&#45;&gt;uw --> <g id="edge10" class="edge">
<title>
tw-&gt;uw
</title>
<path fill="none" stroke="#ffffff" d="M186.35,-71.85C186.35,-70.37 186.35,-58.32 186.35,-46.1"></path> <polygon fill="#ffffff" stroke="#ffffff" points="189.85,-46.02 186.35,-36.02 182.85,-46.02 189.85,-46.02"></polygon> </g> <!-- tb&#45;&gt;ub --> <g id="edge11" class="edge">
<title>
tb-&gt;ub
</title>
<path fill="none" stroke="#ffffff" d="M474.35,-71.85C474.35,-70.37 474.35,-58.32 474.35,-46.1"></path> <polygon fill="#ffffff" stroke="#ffffff" points="477.85,-46.02 474.35,-36.02 470.85,-46.02 477.85,-46.02"></polygon> </g> <!-- tc&#45;&gt;uc --> <g id="edge12" class="edge">
<title>
tc-&gt;uc
</title>
<path fill="none" stroke="#ffffff" d="M333.35,-71.85C333.35,-70.37 333.35,-58.32 333.35,-46.1"></path> <polygon fill="#ffffff" stroke="#ffffff" points="336.85,-46.02 333.35,-36.02 329.85,-46.02 336.85,-46.02"></polygon> </g> <!-- cs --> <g id="node15" class="node">
<title>
cs
</title>
<text text-anchor="middle" x="572.35" y="-122.8" font-family="Times,serif" font-size="14.00" fill="#ff0948">Can be same</text> </g> <!-- cs&#45;&gt;tw --> <g id="edge16" class="edge">
<title>
cs-&gt;tw
</title>
<path fill="none" stroke="#ff0948" d="M563.2,-118.68C555.27,-112.78 543.24,-104.87 531.35,-101 458.77,-77.41 190.58,-73.07 186.4,-73"></path> </g> <!-- cs&#45;&gt;tb --> <g id="edge17" class="edge">
<title>
cs-&gt;tb
</title>
<path fill="none" stroke="#ff0948" d="M560.67,-118.49C552.56,-113.37 541.43,-106.54 531.35,-101 507.38,-87.84 476.36,-73.9 474.44,-73.04"></path> </g> <!-- cs&#45;&gt;tc --> <g id="edge18" class="edge">
<title>
cs-&gt;tc
</title>
<path fill="none" stroke="#ff0948" d="M562.81,-118.63C554.85,-112.87 542.96,-105.16 531.35,-101 451.6,-72.43 344,-72.88 334.09,-72.99"></path> </g> </g>
</svg>
</p>
</div>
</div>
</div>
</section>
<section id="estimating-a-multinomial-logit-model-in-r" class="slide level2">
<h2>Estimating a multinomial logit model in R</h2>
<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-25_29098c623adc6ffebfad6c5ce26e4025">

</div>
<ul>
<li>We’re going to build a multinomial logit mode choice model of intercity mode choice</li>
<li>Data from Apollo examples</li>
</ul>
</section>
<section id="the-data" class="slide level2">
<h2>The data</h2>
<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-26_41c7ea0bce2177d681763402086677ac">
<div class="cell-output-display">
<table>
<colgroup>
<col style="width: 1%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">ID</th>
<th style="text-align: right;">av_car</th>
<th style="text-align: right;">av_bus</th>
<th style="text-align: right;">av_air</th>
<th style="text-align: right;">av_rail</th>
<th style="text-align: right;">time_car</th>
<th style="text-align: right;">cost_car</th>
<th style="text-align: right;">time_bus</th>
<th style="text-align: right;">cost_bus</th>
<th style="text-align: right;">access_bus</th>
<th style="text-align: right;">time_air</th>
<th style="text-align: right;">cost_air</th>
<th style="text-align: right;">access_air</th>
<th style="text-align: right;">service_air</th>
<th style="text-align: right;">time_rail</th>
<th style="text-align: right;">cost_rail</th>
<th style="text-align: right;">access_rail</th>
<th style="text-align: right;">service_rail</th>
<th style="text-align: right;">female</th>
<th style="text-align: right;">business</th>
<th style="text-align: right;">income</th>
<th style="text-align: right;">choice</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">140</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">46705</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">46705</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">345</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">345</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">50123</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">345</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">345</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">50123</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">67589</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">67589</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="estimation-in-r" class="slide level2">
<h2>Estimation in R</h2>
<p><code>mode-choice-mnl.R</code></p>
<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-28_ebfff9d328756b15f8371886811af2da">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">library</span>(apollo)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb26-3"><a href="#cb26-3"></a></span>
<span id="cb26-4"><a href="#cb26-4"></a>database <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/modechoice_apollo.csv"</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="fu">apollo_initialise</span>()</span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a>apollo_control <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb26-9"><a href="#cb26-9"></a>    <span class="at">modelName =</span> <span class="st">"Apollo_Mode_Choice"</span>,</span>
<span id="cb26-10"><a href="#cb26-10"></a>    <span class="at">indivID=</span><span class="st">"ID"</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-29_f9165a440c74cb29d19a42855dc993c3">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">head</span>(database)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 22
     ID av_car av_bus av_air av_rail time_car cost_car time_bus cost_bus acces…¹
  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
1     1      0      0      1       1        0        0        0        0       0
2     1      0      0      1       1        0        0        0        0       0
3     2      1      1      0       1      345       40      345       30      15
4     2      1      1      0       1      345       45      345       25      20
5     3      0      0      1       1        0        0        0        0       0
6     3      0      0      1       1        0        0        0        0       0
# … with 12 more variables: time_air &lt;dbl&gt;, cost_air &lt;dbl&gt;, access_air &lt;dbl&gt;,
#   service_air &lt;dbl&gt;, time_rail &lt;dbl&gt;, cost_rail &lt;dbl&gt;, access_rail &lt;dbl&gt;,
#   service_rail &lt;dbl&gt;, female &lt;dbl&gt;, business &lt;dbl&gt;, income &lt;dbl&gt;,
#   choice &lt;dbl&gt;, and abbreviated variable name ¹​access_bus
# ℹ Use `colnames()` to see all variable names</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-30_d6fb1b1521f9105ded9e047e3971e45f">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>apollo_beta <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb29-2"><a href="#cb29-2"></a>    <span class="at">asc_air =</span> <span class="dv">0</span>,</span>
<span id="cb29-3"><a href="#cb29-3"></a>    <span class="at">asc_bus =</span> <span class="dv">0</span>,</span>
<span id="cb29-4"><a href="#cb29-4"></a>    <span class="at">asc_rail =</span> <span class="dv">0</span>,</span>
<span id="cb29-5"><a href="#cb29-5"></a>    <span class="co"># leaving out an asc_car as base category</span></span>
<span id="cb29-6"><a href="#cb29-6"></a>    <span class="at">b_cost =</span> <span class="dv">0</span>,</span>
<span id="cb29-7"><a href="#cb29-7"></a>    <span class="at">b_access_time =</span> <span class="dv">0</span>,</span>
<span id="cb29-8"><a href="#cb29-8"></a>    <span class="at">b_in_vehicle_time =</span> <span class="dv">0</span>,</span>
<span id="cb29-9"><a href="#cb29-9"></a>    <span class="co"># income is an individual level variable, so</span></span>
<span id="cb29-10"><a href="#cb29-10"></a>    <span class="co"># must be different for different alternatives</span></span>
<span id="cb29-11"><a href="#cb29-11"></a>    <span class="at">b_income_air =</span> <span class="dv">0</span>,</span>
<span id="cb29-12"><a href="#cb29-12"></a>    <span class="at">b_income_bus =</span> <span class="dv">0</span>,</span>
<span id="cb29-13"><a href="#cb29-13"></a>    <span class="at">b_income_rail =</span> <span class="dv">0</span></span>
<span id="cb29-14"><a href="#cb29-14"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-31_1d461819ab8278daddfc92716458c0b1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>apollo_fixed <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb30-2"><a href="#cb30-2"></a></span>
<span id="cb30-3"><a href="#cb30-3"></a>apollo_inputs <span class="ot">=</span> <span class="fu">apollo_validateInputs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Several observations per individual detected based on the value of ID.
  Setting panelData in apollo_control set to TRUE.
All checks on apollo_control completed.
All checks on database completed.</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-32_2b9a32514be0d30d4bbce487ab326f3e">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>apollo_probabilities <span class="ot">=</span> <span class="cf">function</span>(apollo_beta, apollo_inputs,</span>
<span id="cb32-2"><a href="#cb32-2"></a>        <span class="at">functionality=</span><span class="st">"estimate"</span>) {</span>
<span id="cb32-3"><a href="#cb32-3"></a>    <span class="fu">apollo_attach</span>(apollo_beta, apollo_inputs)</span>
<span id="cb32-4"><a href="#cb32-4"></a>    <span class="fu">on.exit</span>(<span class="fu">apollo_detach</span>(apollo_beta, apollo_inputs))</span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a>    P <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb32-7"><a href="#cb32-7"></a></span>
<span id="cb32-8"><a href="#cb32-8"></a>    <span class="co"># define utility functions</span></span>
<span id="cb32-9"><a href="#cb32-9"></a>    V <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb32-10"><a href="#cb32-10"></a>    <span class="co"># We can include cost and in-vehicle time here because they vary over</span></span>
<span id="cb32-11"><a href="#cb32-11"></a>    <span class="co"># alternatives</span></span>
<span id="cb32-12"><a href="#cb32-12"></a>    V[[<span class="st">"car"</span>]] <span class="ot">=</span> b_cost <span class="sc">*</span> cost_car <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13"></a>        b_in_vehicle_time <span class="sc">*</span> time_car</span>
<span id="cb32-14"><a href="#cb32-14"></a></span>
<span id="cb32-15"><a href="#cb32-15"></a>    V[[<span class="st">"air"</span>]] <span class="ot">=</span> asc_air <span class="sc">+</span></span>
<span id="cb32-16"><a href="#cb32-16"></a>        b_cost <span class="sc">*</span> cost_air <span class="sc">+</span></span>
<span id="cb32-17"><a href="#cb32-17"></a>        b_in_vehicle_time <span class="sc">*</span> time_air <span class="sc">+</span></span>
<span id="cb32-18"><a href="#cb32-18"></a>        b_access_time <span class="sc">*</span> access_air <span class="sc">+</span></span>
<span id="cb32-19"><a href="#cb32-19"></a>        b_income_air <span class="sc">*</span> income</span>
<span id="cb32-20"><a href="#cb32-20"></a></span>
<span id="cb32-21"><a href="#cb32-21"></a>    V[[<span class="st">"rail"</span>]] <span class="ot">=</span> asc_rail <span class="sc">+</span></span>
<span id="cb32-22"><a href="#cb32-22"></a>        b_cost <span class="sc">*</span> cost_rail <span class="sc">+</span></span>
<span id="cb32-23"><a href="#cb32-23"></a>        b_in_vehicle_time <span class="sc">*</span> time_rail <span class="sc">+</span></span>
<span id="cb32-24"><a href="#cb32-24"></a>        b_access_time <span class="sc">*</span> access_rail <span class="sc">+</span></span>
<span id="cb32-25"><a href="#cb32-25"></a>        b_income_rail <span class="sc">*</span> income</span>
<span id="cb32-26"><a href="#cb32-26"></a></span>
<span id="cb32-27"><a href="#cb32-27"></a>    V[[<span class="st">"bus"</span>]] <span class="ot">=</span> asc_bus <span class="sc">+</span></span>
<span id="cb32-28"><a href="#cb32-28"></a>        b_cost <span class="sc">*</span> cost_bus <span class="sc">+</span></span>
<span id="cb32-29"><a href="#cb32-29"></a>        b_in_vehicle_time <span class="sc">*</span> time_bus <span class="sc">+</span></span>
<span id="cb32-30"><a href="#cb32-30"></a>        b_access_time <span class="sc">*</span> access_bus <span class="sc">+</span></span>
<span id="cb32-31"><a href="#cb32-31"></a>        b_income_bus <span class="sc">*</span> income</span>
<span id="cb32-32"><a href="#cb32-32"></a></span>
<span id="cb32-33"><a href="#cb32-33"></a>    mnl_settings <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb32-34"><a href="#cb32-34"></a>        <span class="at">alternatives =</span> <span class="fu">c</span>(<span class="at">car=</span><span class="dv">1</span>, <span class="at">air=</span><span class="dv">3</span>, <span class="at">rail=</span><span class="dv">4</span>, <span class="at">bus=</span><span class="dv">2</span>),</span>
<span id="cb32-35"><a href="#cb32-35"></a>        <span class="at">avail =</span> <span class="fu">list</span>(<span class="at">car=</span>av_car, <span class="at">air=</span>av_air, <span class="at">rail=</span>av_rail, <span class="at">bus=</span>av_bus),</span>
<span id="cb32-36"><a href="#cb32-36"></a>        <span class="at">choiceVar =</span> choice,</span>
<span id="cb32-37"><a href="#cb32-37"></a>        <span class="at">utilities =</span> V</span>
<span id="cb32-38"><a href="#cb32-38"></a>    )</span>
<span id="cb32-39"><a href="#cb32-39"></a></span>
<span id="cb32-40"><a href="#cb32-40"></a>    P[[<span class="st">"model"</span>]] <span class="ot">=</span> <span class="fu">apollo_mnl</span>(mnl_settings, functionality)</span>
<span id="cb32-41"><a href="#cb32-41"></a></span>
<span id="cb32-42"><a href="#cb32-42"></a>    <span class="co"># For panel data, this multiplies observations for single individuals</span></span>
<span id="cb32-43"><a href="#cb32-43"></a>    <span class="co"># together - no effect in multinomial logit but still required.</span></span>
<span id="cb32-44"><a href="#cb32-44"></a>    P <span class="ot">=</span> <span class="fu">apollo_panelProd</span>(P, apollo_inputs, functionality)</span>
<span id="cb32-45"><a href="#cb32-45"></a>    P <span class="ot">=</span> <span class="fu">apollo_prepareProb</span>(P, apollo_inputs, functionality)</span>
<span id="cb32-46"><a href="#cb32-46"></a>    <span class="fu">return</span>(P)</span>
<span id="cb32-47"><a href="#cb32-47"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-33_ffa5a34c2adadaa4f3b17f6196893753">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># estimate model</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>model <span class="ot">=</span> <span class="fu">apollo_estimate</span>(apollo_beta, apollo_fixed,</span>
<span id="cb33-3"><a href="#cb33-3"></a>    apollo_probabilities, apollo_inputs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Preparing user-defined functions.

Testing likelihood function...

Overview of choices for MNL model component :
                                    car    air   rail    bus
Times available                  778.00 752.00 874.00 902.00
Times chosen                     332.00 215.00 327.00 126.00
Percentage chosen overall         33.20  21.50  32.70  12.60
Percentage chosen when available  42.67  28.59  37.41  13.97

Pre-processing likelihood function...
Analytical gradient is different to numerical one. Numerical gradients
  will be used.

Testing influence of parameters.........
Starting main estimation
Initial function value: -1170.86 
Initial gradient value:
          asc_air           asc_bus          asc_rail            b_cost 
    -8.000002e+00     -1.536667e+02      5.966667e+01     -1.329167e+02 
    b_access_time b_in_vehicle_time      b_income_air      b_income_bus 
    -1.810417e+03     -1.898042e+04      3.114006e+05     -7.703172e+06 
    b_income_rail 
     2.710651e+06 
initial  value 1170.860076 
iter   2 value 1112.061643
iter   3 value 1098.117019
iter   4 value 1096.280213
iter   5 value 1088.850808
iter   6 value 1044.655722
iter   7 value 1043.621915
iter   8 value 1037.024630
iter   9 value 1027.797450
iter  10 value 1026.422719
iter  11 value 1021.845626
iter  12 value 1020.058229
iter  13 value 1020.002110
iter  14 value 1019.999301
iter  14 value 1019.999286
iter  14 value 1019.999286
final  value 1019.999286 
converged
Additional convergence test using scaled estimation. Parameters will be
  scaled by their current estimates and additional iterations will be
  performed.
initial  value 1019.999286 
iter   1 value 1019.999286
final  value 1019.999286 
converged
Estimated parameters:
                     Estimate
asc_air             -0.922580
asc_bus             -0.369843
asc_rail            -0.679845
b_cost              -0.032032
b_access_time       -0.006419
b_in_vehicle_time   -0.006126
b_income_air        1.045e-05
b_income_bus       -2.252e-05
b_income_rail       6.963e-07

Computing covariance matrix using numerical methods (numDeriv).
 0%....25%....50%....75%....100%
Negative definite Hessian with maximum eigenvalue: -3.070863
Computing score matrix...
Calculating LL(0) for applicable models...
Calculating LL(c) for applicable models...
Calculating LL of each model component...</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-34_96a32ef44c930ed91abb230fd63261fc">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Print results</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="fu">apollo_modelOutput</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model run by mwbc using Apollo 0.2.7 on R 4.2.1 for Darwin.
www.ApolloChoiceModelling.com

Model name                       : Apollo_Mode_Choice
Model description                : No model description provided in apollo_control
Model run at                     : 2022-08-09 14:02:54
Estimation method                : bfgs
Model diagnosis                  : successful convergence 
Number of individuals            : 500
Number of rows in database       : 1000
Number of modelled outcomes      : 1000

Number of cores used             :  1 
Model without mixing

LL(start)                        : -1170.86
LL(0)                            : -1170.86
LL(C)                            : -1085.14
LL(final)                        : -1020
Rho-square (0)                   :  0.1288 
Adj.Rho-square (0)               :  0.1212 
Rho-square (C)                   :  0.06 
Adj.Rho-square (C)               :  0.0517 
AIC                              :  2058 
BIC                              :  2102.17 

Estimated parameters             :  9
Time taken (hh:mm:ss)            :  00:00:0.67 
     pre-estimation              :  00:00:0.15 
     estimation                  :  00:00:0.28 
     post-estimation             :  00:00:0.24 
Iterations                       :  20  
Min abs eigenvalue of Hessian    :  3.070863 

Unconstrained optimisation.

Estimates:
                     Estimate        s.e.   t.rat.(0)    Rob.s.e. Rob.t.rat.(0)
asc_air             -0.922580    0.502076     -1.8375    0.497421       -1.8547
asc_bus             -0.369843    0.315033     -1.1740    0.306346       -1.2073
asc_rail            -0.679845    0.332292     -2.0459    0.342767       -1.9834
b_cost              -0.032032    0.003242     -9.8796    0.003168      -10.1112
b_access_time       -0.006419    0.005974     -1.0744    0.005835       -1.1001
b_in_vehicle_time   -0.006126    0.001295     -4.7290    0.001368       -4.4792
b_income_air        1.045e-05   5.899e-06      1.7707   6.025e-06        1.7338
b_income_bus       -2.252e-05   6.741e-06     -3.3408   6.534e-06       -3.4463
b_income_rail       6.963e-07   5.090e-06      0.1368   5.216e-06        0.1335</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-35_6baccdec02c8646763a7c2acb878a7a7">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># save results in current directory, using model name specified above</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="fu">apollo_saveOutput</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model output saved to /Users/mwbc/Library/CloudStorage/OneDrive-UniversityofNorthCarolinaatChapelHill/teaching/odum-discrete/Apollo_Mode_Choice_output.txt 
Estimates saved to /Users/mwbc/Library/CloudStorage/OneDrive-UniversityofNorthCarolinaatChapelHill/teaching/odum-discrete/Apollo_Mode_Choice_estimates.csv 
Model object saved to /Users/mwbc/Library/CloudStorage/OneDrive-UniversityofNorthCarolinaatChapelHill/teaching/odum-discrete/Apollo_Mode_Choice.rds </code></pre>
</div>
</div>
</section>
<section id="valuation-using-discrete-choice-models" class="slide level2">
<h2>Valuation using discrete choice models</h2>
<ul>
<li>A common use for discrete choice models is to calculate willingness-to-pay</li>
<li>The linear-in-parameters utility function puts everything in terms of utility</li>
<li>If we have a cost parameter, we can use the model to put everything else in monetary units</li>
</ul>
</section>
<section id="valuation-using-discrete-choice-models-1" class="slide level2">
<h2>Valuation using discrete choice models</h2>
<ul>
<li>The coefficients of the model are how much of <code>x</code> one unit of utility is worth
<ul>
<li>i.e.&nbsp;partial derivatives of utility with respect to <code>x</code></li>
</ul></li>
<li>We want value of time, i.e.&nbsp;dollars / hour</li>
<li>Travel time coefficient is utility / minute</li>
<li>Cost coefficient is utility / dollar</li>
<li>If <span class="math inline">\(u\)</span> is utility, <span class="math inline">\(c\)</span> is cost, and <span class="math inline">\(t\)</span> is in-vehicle time, <span class="math inline">\(\frac{\beta_t}{\beta_{c}} = \frac{\frac{\delta u}{\delta t}}{\frac{\delta u}{\delta c}} = \frac{\delta c}{\delta t}\)</span></li>
</ul>
</section>
<section id="valuation-using-discrete-choice-models-2" class="slide level2">
<h2>Valuation using discrete choice models</h2>
<p><span class="math display">\[\beta_c = -0.032\]</span></p>
<p><span class="math display">\[\beta_t = -0.0061\]</span></p>
<p><span class="math display">\[ \frac{\beta_t}{\beta_c} = \frac{-0.0061}{-0.032} = {£0.191}/\mathrm{minute} = {£11.46}/\mathrm{hour} \]</span></p>
</section>
<section id="confidence-intervals-for-valuation" class="slide level2">
<h2>Confidence intervals for valuation</h2>
<ul>
<li>We can use the Delta method to calculate standard errors for combinations of parameters <span class="citation" data-cites="daly_estimating_2020">(<a href="#/ref-daly_estimating_2020" role="doc-biblioref" onclick="return false;">Daly, Hess, and Ortúzar 2020</a>)</span></li>
<li>Implemented in Apollo using <code>apollo_deltaMethod</code> function</li>
</ul>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-37_8ffe9ad08e0dd0a11000d8f41cf0e773">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">apollo_deltaMethod</span>(model, <span class="at">deltaMethod_settings=</span><span class="fu">list</span>(</span>
<span id="cb39-2"><a href="#cb39-2"></a>    <span class="at">expression=</span><span class="st">"b_in_vehicle_time * 60 / b_cost"</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running Delta method computation for user-defined function:

                      Expression   Value Robust s.e. Rob t-ratio (0)
 b_in_vehicle_time * 60 / b_cost 11.4745      2.4434             4.7</code></pre>
</div>
</div>
</section>
<section id="exercise" class="slide level2">
<h2>Exercise</h2>
<ul>
<li>People may value in-vehicle time differently on the train vs.&nbsp;plane vs.&nbsp;car vs.&nbsp;bus</li>
<li>Modify the model to estimate separate in-vehicle time coefficients for each mode, and calculate willingness-to-pay for each</li>
<li>(One) answer in mode-choice-mnl-in-vehicle-answers.R</li>
</ul>
</section>
<section id="solution" class="slide level2">
<h2>Solution</h2>
<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-40_3890b06d7da389b4f8cacde73ac4e6e8">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>apollo_beta <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb41-2"><a href="#cb41-2"></a>    <span class="at">asc_air =</span> <span class="dv">0</span>,</span>
<span id="cb41-3"><a href="#cb41-3"></a>    <span class="at">asc_bus =</span> <span class="dv">0</span>,</span>
<span id="cb41-4"><a href="#cb41-4"></a>    <span class="at">asc_rail =</span> <span class="dv">0</span>,</span>
<span id="cb41-5"><a href="#cb41-5"></a>    <span class="co"># leaving out an asc_car as base category</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>    <span class="at">b_cost =</span> <span class="dv">0</span>,</span>
<span id="cb41-7"><a href="#cb41-7"></a>    <span class="at">b_access_time =</span> <span class="dv">0</span>,</span>
<span id="cb41-8"><a href="#cb41-8"></a>    <span class="at">b_in_vehicle_time_air =</span> <span class="dv">0</span>,</span>
<span id="cb41-9"><a href="#cb41-9"></a>    <span class="at">b_in_vehicle_time_bus =</span> <span class="dv">0</span>,</span>
<span id="cb41-10"><a href="#cb41-10"></a>    <span class="at">b_in_vehicle_time_car =</span> <span class="dv">0</span>,</span>
<span id="cb41-11"><a href="#cb41-11"></a>    <span class="at">b_in_vehicle_time_rail =</span> <span class="dv">0</span>,</span>
<span id="cb41-12"><a href="#cb41-12"></a>    <span class="co"># income and party_size are individual level variable, so</span></span>
<span id="cb41-13"><a href="#cb41-13"></a>    <span class="co"># must be different for different alternatives</span></span>
<span id="cb41-14"><a href="#cb41-14"></a>    <span class="at">b_income_air =</span> <span class="dv">0</span>,</span>
<span id="cb41-15"><a href="#cb41-15"></a>    <span class="at">b_income_bus =</span> <span class="dv">0</span>,</span>
<span id="cb41-16"><a href="#cb41-16"></a>    <span class="at">b_income_rail =</span> <span class="dv">0</span></span>
<span id="cb41-17"><a href="#cb41-17"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-42_63ef7216601f774a45a33bd77e6514ee">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>apollo_probabilities <span class="ot">=</span> <span class="cf">function</span>(apollo_beta, apollo_inputs,</span>
<span id="cb42-2"><a href="#cb42-2"></a>        <span class="at">functionality=</span><span class="st">"estimate"</span>) {</span>
<span id="cb42-3"><a href="#cb42-3"></a>    <span class="fu">apollo_attach</span>(apollo_beta, apollo_inputs)</span>
<span id="cb42-4"><a href="#cb42-4"></a>    <span class="fu">on.exit</span>(<span class="fu">apollo_detach</span>(apollo_beta, apollo_inputs))</span>
<span id="cb42-5"><a href="#cb42-5"></a></span>
<span id="cb42-6"><a href="#cb42-6"></a>    P <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb42-7"><a href="#cb42-7"></a></span>
<span id="cb42-8"><a href="#cb42-8"></a>    <span class="co"># define utility functions</span></span>
<span id="cb42-9"><a href="#cb42-9"></a>    V <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb42-10"><a href="#cb42-10"></a>    <span class="co"># We can include cost and in-vehicle time here because they vary over</span></span>
<span id="cb42-11"><a href="#cb42-11"></a>    <span class="co"># alternatives</span></span>
<span id="cb42-12"><a href="#cb42-12"></a>    V[[<span class="st">"car"</span>]] <span class="ot">=</span> b_cost <span class="sc">*</span> cost_car <span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13"></a>        b_in_vehicle_time_car <span class="sc">*</span> time_car</span>
<span id="cb42-14"><a href="#cb42-14"></a></span>
<span id="cb42-15"><a href="#cb42-15"></a>    V[[<span class="st">"air"</span>]] <span class="ot">=</span> asc_air <span class="sc">+</span></span>
<span id="cb42-16"><a href="#cb42-16"></a>        b_cost <span class="sc">*</span> cost_air <span class="sc">+</span></span>
<span id="cb42-17"><a href="#cb42-17"></a>        b_in_vehicle_time_air <span class="sc">*</span> time_air <span class="sc">+</span></span>
<span id="cb42-18"><a href="#cb42-18"></a>        b_access_time <span class="sc">*</span> access_air <span class="sc">+</span></span>
<span id="cb42-19"><a href="#cb42-19"></a>        b_income_air <span class="sc">*</span> income</span>
<span id="cb42-20"><a href="#cb42-20"></a></span>
<span id="cb42-21"><a href="#cb42-21"></a>    V[[<span class="st">"rail"</span>]] <span class="ot">=</span> asc_rail <span class="sc">+</span></span>
<span id="cb42-22"><a href="#cb42-22"></a>        b_cost <span class="sc">*</span> cost_rail <span class="sc">+</span></span>
<span id="cb42-23"><a href="#cb42-23"></a>        b_in_vehicle_time_rail <span class="sc">*</span> time_rail <span class="sc">+</span></span>
<span id="cb42-24"><a href="#cb42-24"></a>        b_access_time <span class="sc">*</span> access_rail <span class="sc">+</span></span>
<span id="cb42-25"><a href="#cb42-25"></a>        b_income_rail <span class="sc">*</span> income</span>
<span id="cb42-26"><a href="#cb42-26"></a></span>
<span id="cb42-27"><a href="#cb42-27"></a>    V[[<span class="st">"bus"</span>]] <span class="ot">=</span> asc_bus <span class="sc">+</span></span>
<span id="cb42-28"><a href="#cb42-28"></a>        b_cost <span class="sc">*</span> cost_bus <span class="sc">+</span></span>
<span id="cb42-29"><a href="#cb42-29"></a>        b_in_vehicle_time_bus <span class="sc">*</span> time_bus <span class="sc">+</span></span>
<span id="cb42-30"><a href="#cb42-30"></a>        b_access_time <span class="sc">*</span> access_bus <span class="sc">+</span></span>
<span id="cb42-31"><a href="#cb42-31"></a>        b_income_bus <span class="sc">*</span> income</span>
<span id="cb42-32"><a href="#cb42-32"></a></span>
<span id="cb42-33"><a href="#cb42-33"></a>    mnl_settings <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb42-34"><a href="#cb42-34"></a>        <span class="at">alternatives =</span> <span class="fu">c</span>(<span class="at">car=</span><span class="dv">1</span>, <span class="at">air=</span><span class="dv">3</span>, <span class="at">rail=</span><span class="dv">4</span>, <span class="at">bus=</span><span class="dv">2</span>),</span>
<span id="cb42-35"><a href="#cb42-35"></a>        <span class="at">avail =</span> <span class="fu">list</span>(<span class="at">car=</span>av_car, <span class="at">air=</span>av_air, <span class="at">rail=</span>av_rail, <span class="at">bus=</span>av_bus),</span>
<span id="cb42-36"><a href="#cb42-36"></a>        <span class="at">choiceVar =</span> choice,</span>
<span id="cb42-37"><a href="#cb42-37"></a>        <span class="at">utilities =</span> V</span>
<span id="cb42-38"><a href="#cb42-38"></a>    )</span>
<span id="cb42-39"><a href="#cb42-39"></a></span>
<span id="cb42-40"><a href="#cb42-40"></a>    P[[<span class="st">"model"</span>]] <span class="ot">=</span> <span class="fu">apollo_mnl</span>(mnl_settings, functionality)</span>
<span id="cb42-41"><a href="#cb42-41"></a></span>
<span id="cb42-42"><a href="#cb42-42"></a>    <span class="co"># For panel data, this multiplies observations for single individuals</span></span>
<span id="cb42-43"><a href="#cb42-43"></a>    <span class="co"># together - no effect in multinomial logit but still required.</span></span>
<span id="cb42-44"><a href="#cb42-44"></a>    P <span class="ot">=</span> <span class="fu">apollo_panelProd</span>(P, apollo_inputs, functionality)</span>
<span id="cb42-45"><a href="#cb42-45"></a>    P <span class="ot">=</span> <span class="fu">apollo_prepareProb</span>(P, apollo_inputs, functionality)</span>
<span id="cb42-46"><a href="#cb42-46"></a>    <span class="fu">return</span>(P)</span>
<span id="cb42-47"><a href="#cb42-47"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-43_50a846a6d6255842b75a7fb8602c7f47">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># estimate model</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>model <span class="ot">=</span> <span class="fu">apollo_estimate</span>(apollo_beta, apollo_fixed,</span>
<span id="cb43-3"><a href="#cb43-3"></a>    apollo_probabilities, apollo_inputs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Preparing user-defined functions.

Testing likelihood function...

Overview of choices for MNL model component :
                                    car    air   rail    bus
Times available                  778.00 752.00 874.00 902.00
Times chosen                     332.00 215.00 327.00 126.00
Percentage chosen overall         33.20  21.50  32.70  12.60
Percentage chosen when available  42.67  28.59  37.41  13.97

Pre-processing likelihood function...
Analytical gradient is different to numerical one. Numerical gradients
  will be used.

Testing influence of parameters............
Starting main estimation
Initial function value: -1170.86 
Initial gradient value:
               asc_air                asc_bus               asc_rail 
         -8.000002e+00          -1.536667e+02           5.966667e+01 
                b_cost          b_access_time  b_in_vehicle_time_air 
         -1.329167e+02          -1.810417e+03          -6.925000e+02 
 b_in_vehicle_time_bus  b_in_vehicle_time_car b_in_vehicle_time_rail 
         -5.759500e+04           3.107750e+04           8.229583e+03 
          b_income_air           b_income_bus          b_income_rail 
          3.114006e+05          -7.703172e+06           2.710651e+06 
initial  value 1170.860076 
iter   2 value 1112.058599
iter   3 value 1098.115876
iter   4 value 1096.279422
iter   5 value 1088.042268
iter   6 value 1063.689936
iter   7 value 1054.903518
iter   8 value 1040.329195
iter   9 value 1037.028717
iter  10 value 1037.022155
iter  11 value 1016.930614
iter  12 value 1014.940892
iter  13 value 1014.780724
iter  14 value 1014.752777
iter  15 value 1014.741682
iter  16 value 1014.741571
iter  16 value 1014.741570
iter  16 value 1014.741570
final  value 1014.741570 
converged
Additional convergence test using scaled estimation. Parameters will be
  scaled by their current estimates and additional iterations will be
  performed.
initial  value 1014.741570 
iter   1 value 1014.741570
final  value 1014.741570 
converged
Estimated parameters:
                          Estimate
asc_air                   1.190584
asc_bus                   1.340214
asc_rail                  1.013686
b_cost                   -0.034030
b_access_time            -0.010182
b_in_vehicle_time_air    -0.020861
b_in_vehicle_time_bus    -0.008454
b_in_vehicle_time_car    -0.003488
b_in_vehicle_time_rail   -0.011478
b_income_air             9.912e-06
b_income_bus            -2.320e-05
b_income_rail           -8.098e-08

Computing covariance matrix using numerical methods (numDeriv).
 0%....25%....50%....75%....100%
Negative definite Hessian with maximum eigenvalue: -0.691575
Computing score matrix...
Calculating LL(0) for applicable models...
Calculating LL(c) for applicable models...
Calculating LL of each model component...</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-44_ccc5994d3b17dc39ea7994cda56b867f">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># Print results</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="fu">apollo_modelOutput</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model run by mwbc using Apollo 0.2.7 on R 4.2.1 for Darwin.
www.ApolloChoiceModelling.com

Model name                       : Apollo_Mode_Choice
Model description                : No model description provided in apollo_control
Model run at                     : 2022-08-09 22:22:24
Estimation method                : bfgs
Model diagnosis                  : successful convergence 
Number of individuals            : 500
Number of rows in database       : 1000
Number of modelled outcomes      : 1000

Number of cores used             :  1 
Model without mixing

LL(start)                        : -1170.86
LL(0)                            : -1170.86
LL(C)                            : -1085.14
LL(final)                        : -1014.74
Rho-square (0)                   :  0.1333 
Adj.Rho-square (0)               :  0.1231 
Rho-square (C)                   :  0.0649 
Adj.Rho-square (C)               :  0.0538 
AIC                              :  2053.48 
BIC                              :  2112.38 

Estimated parameters             :  12
Time taken (hh:mm:ss)            :  00:00:1.19 
     pre-estimation              :  00:00:0.24 
     estimation                  :  00:00:0.52 
     post-estimation             :  00:00:0.42 
Iterations                       :  22  
Min abs eigenvalue of Hessian    :  0.691575 

Unconstrained optimisation.

Estimates:
                          Estimate        s.e.   t.rat.(0)    Rob.s.e.
asc_air                   1.190584    0.883949     1.34689    0.877652
asc_bus                   1.340214    1.076607     1.24485    1.029324
asc_rail                  1.013686    0.847802     1.19566    0.848597
b_cost                   -0.034030    0.003328   -10.22497    0.003236
b_access_time            -0.010182    0.006467    -1.57448    0.006328
b_in_vehicle_time_air    -0.020861    0.006648    -3.13816    0.006544
b_in_vehicle_time_bus    -0.008454    0.002667    -3.16962    0.002636
b_in_vehicle_time_car    -0.003488    0.001560    -2.23642    0.001579
b_in_vehicle_time_rail   -0.011478    0.004394    -2.61200    0.004489
b_income_air             9.912e-06   5.908e-06     1.67774   5.970e-06
b_income_bus            -2.320e-05   6.763e-06    -3.43125   6.570e-06
b_income_rail           -8.098e-08   5.111e-06    -0.01585   5.241e-06
                       Rob.t.rat.(0)
asc_air                      1.35656
asc_bus                      1.30203
asc_rail                     1.19454
b_cost                     -10.51496
b_access_time               -1.60911
b_in_vehicle_time_air       -3.18763
b_in_vehicle_time_bus       -3.20651
b_in_vehicle_time_car       -2.20888
b_in_vehicle_time_rail      -2.55681
b_income_air                 1.66049
b_income_bus                -3.53201
b_income_rail               -0.01545</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-45_9fb89bf39f8c026ca0b02bdec99e7205">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># save results in current directory, using model name specified above</span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="fu">apollo_saveOutput</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Old result file "/Users/mwbc/Library/CloudStorage/OneDrive-UniversityofNorthCarolinaatChapelHill/teaching/odum-discrete/Apollo_Mode_Choice_output.txt" 
 renamed to: "/Users/mwbc/Library/CloudStorage/OneDrive-UniversityofNorthCarolinaatChapelHill/teaching/odum-discrete/Apollo_Mode_Choice_OLD1_output.txt"
Old result file "/Users/mwbc/Library/CloudStorage/OneDrive-UniversityofNorthCarolinaatChapelHill/teaching/odum-discrete/Apollo_Mode_Choice_estimates.csv" 
 renamed to: "/Users/mwbc/Library/CloudStorage/OneDrive-UniversityofNorthCarolinaatChapelHill/teaching/odum-discrete/Apollo_Mode_Choice_OLD1_estimates.csv"
Old result file "/Users/mwbc/Library/CloudStorage/OneDrive-UniversityofNorthCarolinaatChapelHill/teaching/odum-discrete/Apollo_Mode_Choice_model.rds" 
 renamed to: "/Users/mwbc/Library/CloudStorage/OneDrive-UniversityofNorthCarolinaatChapelHill/teaching/odum-discrete/Apollo_Mode_Choice_OLD1_model.rds"
Model output saved to /Users/mwbc/Library/CloudStorage/OneDrive-UniversityofNorthCarolinaatChapelHill/teaching/odum-discrete/Apollo_Mode_Choice_output.txt 
Estimates saved to /Users/mwbc/Library/CloudStorage/OneDrive-UniversityofNorthCarolinaatChapelHill/teaching/odum-discrete/Apollo_Mode_Choice_estimates.csv 
Model object saved to /Users/mwbc/Library/CloudStorage/OneDrive-UniversityofNorthCarolinaatChapelHill/teaching/odum-discrete/Apollo_Mode_Choice.rds </code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-46_c0387171f32429ab1a53d60ef7dde668">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="fu">apollo_deltaMethod</span>(model, <span class="at">deltaMethod_settings=</span><span class="fu">list</span>(</span>
<span id="cb49-2"><a href="#cb49-2"></a>    <span class="at">expression=</span><span class="st">"b_in_vehicle_time_car * 60 / b_cost"</span></span>
<span id="cb49-3"><a href="#cb49-3"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running Delta method computation for user-defined function:

                          Expression  Value Robust s.e. Rob t-ratio (0)
 b_in_vehicle_time_car * 60 / b_cost 6.1495      2.7232            2.26</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-47_1b3eb675427afa86b4b0f296dab337c2">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="fu">apollo_deltaMethod</span>(model, <span class="at">deltaMethod_settings=</span><span class="fu">list</span>(</span>
<span id="cb51-2"><a href="#cb51-2"></a>    <span class="at">expression=</span><span class="st">"b_in_vehicle_time_air * 60 / b_cost"</span></span>
<span id="cb51-3"><a href="#cb51-3"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running Delta method computation for user-defined function:

                          Expression   Value Robust s.e. Rob t-ratio (0)
 b_in_vehicle_time_air * 60 / b_cost 36.7817     11.2664            3.26</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-48_3b49f6bb1b78146ca68b5c41001af876">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="fu">apollo_deltaMethod</span>(model, <span class="at">deltaMethod_settings=</span><span class="fu">list</span>(</span>
<span id="cb53-2"><a href="#cb53-2"></a>    <span class="at">expression=</span><span class="st">"b_in_vehicle_time_bus * 60 / b_cost"</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running Delta method computation for user-defined function:

                          Expression   Value Robust s.e. Rob t-ratio (0)
 b_in_vehicle_time_bus * 60 / b_cost 14.9048      4.6234            3.22</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="mode-choice-mnl-in-vehicle-answers.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-49_2860926437350c709dd50d5a6c1c1ec9">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>dm <span class="ot">=</span> <span class="fu">apollo_deltaMethod</span>(model, <span class="at">deltaMethod_settings=</span><span class="fu">list</span>(</span>
<span id="cb55-2"><a href="#cb55-2"></a>    <span class="at">expression=</span><span class="st">"b_in_vehicle_time_rail * 60 / b_cost"</span></span>
<span id="cb55-3"><a href="#cb55-3"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running Delta method computation for user-defined function:

                           Expression   Value Robust s.e. Rob t-ratio (0)
 b_in_vehicle_time_rail * 60 / b_cost 20.2374      7.8836            2.57</code></pre>
</div>
</div>
</section>
<section id="interpretation" class="slide level2">
<h2>Interpretation</h2>

<img data-src="discrete-choice_files/figure-revealjs/unnamed-chunk-51-1.svg" alt="Bar plot of values of travel time for car, air, bus, and rail" width="1200" class="r-stretch quarto-figure-center"><ul>
<li>People really don’t like being on airplanes</li>
</ul>
</section>
<section id="correlation-does-not-imply-causation" class="slide level2">
<h2>Correlation does not imply causation</h2>

<img data-src="correlation_2x.png" class="r-stretch quarto-figure-center"><p class="caption">XKCD cartoon demonstrating that correlation does not imply causation</p></section>
<section id="correlation-does-not-imply-causation-1" class="slide level2">
<h2>Correlation does not imply causation</h2>
<ul>
<li>Of course we can’t interpret model coefficients as causal</li>
<li>Valuation estimates are derived from coefficients</li>
<li>Any bias in coefficients may affect valuation</li>
</ul>
</section>
<section id="correlation-does-not-imply-causation-2" class="slide level2">
<h2>Correlation does not imply causation</h2>
<ul>
<li>Often, prices will be correlated with unobserved positive aspects, biasing the value of time down
<ul>
<li>For example, legroom or class of service in the air travel case</li>
</ul></li>
<li>Other variable may be biased too
<ul>
<li>We don’t have number of connections in our model. How might this bias the value of time for air travel?</li>
</ul></li>
</ul>
</section>
<section id="questions-2" class="slide level2">
<h2>Questions?</h2>
</section>
<section id="how-logit-models-are-estimated" class="slide level2">
<h2>How logit models are estimated</h2>
<ul>
<li>Unlike linear regression, there is no closed-form solution
<ul>
<li>i.e.&nbsp;one you can just calculate</li>
</ul></li>
<li>Instead, we use <em>maximum likelihood</em></li>
<li>We define a <em>likelihood function</em> which tells us how likely we are to observe the data we have, given a set of coefficients</li>
<li>We then choose a set of coefficients, the <em>starting values</em>, and adjust them until we find the best fit—the maximum of the likelihood function</li>
</ul>
</section>
<section id="likelihood-function-for-a-discrete-choice-model" class="slide level2">
<h2>Likelihood function for a discrete choice model</h2>
<ul>
<li>The likelihood function for a discrete choice model is the joint probability of all the chosen values</li>
<li>If you had three people, who chose car, car, and bus to get to work, likelihood is the probability that the first person chose car multiplied by the probability the second person chose car multiplied by the probability the third person chose bus</li>
</ul>
</section>
<section id="likelihood-function-for-a-discrete-choice-model-the-math" class="slide level2">
<h2>Likelihood function for a discrete choice model: the math</h2>
<ul>
<li>In math:</li>
</ul>
<p><span class="math display">\[
\prod_n P(y_n | x_n)\\
= \prod_n \frac{e^{U_{y_n}}}{\sum_j e^{U_{j_n}}}
\]</span></p>
</section>
<section id="likelihood-function-for-a-discrete-choice-model-the-math-1" class="slide level2">
<h2>Likelihood function for a discrete choice model: the math</h2>
<ul>
<li>This is a vanishingly small number
<ul>
<li>In our mode choice example, something like <span class="math inline">\(10^{-440}\)</span></li>
</ul></li>
<li>Generally too small to be represented in a computer</li>
</ul>
<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-52_7d9b606e9feca9aa2ecd9a00e03a6805">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="dv">10</span><span class="sc">^-</span><span class="dv">440</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
<section id="likelihood-function-for-a-discrete-choice-model-the-math-2" class="slide level2">
<h2>Likelihood function for a discrete choice model: the math</h2>
<ul>
<li>Instead, computers use the logarithm of likelihood (log-likelihood)</li>
</ul>
<p><span class="math display">\[
\mathrm{ln} \prod_n P(y_n | x_n)\\
= \sum_n \mathrm{ln} \frac{e^{U_{y_n}}}{\sum_j e^{U_{j_n}}}
\]</span></p>
<ul>
<li>In our example above, this is -1014</li>
</ul>
</section>
<section id="comparing-logistic-models-to-each-other" class="slide level2">
<h2>Comparing logistic models to each other</h2>
<ul>
<li>We can use the log-likelihood to compare two models using a likelihood-ratio test</li>
<li>This only works if the two models are <em>nested</em>
<ul>
<li>That is, one is a subset of the other, or you can make one into the other by constraining parameters</li>
<li>Not to be confused with <em>nested logit models</em> which use a different error structure</li>
</ul></li>
</ul>
</section>
<section id="comparing-logistic-models-to-each-other-1" class="slide level2">
<h2>Comparing logistic models to each other</h2>
<ul>
<li>Likelihood ratio test statistic is</li>
</ul>
<p><span class="math display">\[
-2(\ell_1 - \ell_2)
\]</span></p>
<p>where <span class="math inline">\(\ell_1\)</span> is the likelihood of the less flexible model and <span class="math inline">\(\ell_2\)</span> the more flexible model - This is <span class="math inline">\(\chi^2\)</span>-distributed with degrees of freedom equal to the number of additional parameters in the more flexible model - Don’t need to remember order, just put them in the order that makes test statistic positive</p>
</section>
<section id="comparing-logistic-models-to-each-other-2" class="slide level2">
<h2>Comparing logistic models to each other</h2>
<table>
<thead>
<tr class="header">
<th>Model</th>
<th>Log-likelihood</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Same in-vehicle time coefficient</td>
<td>-1020</td>
</tr>
<tr class="even">
<td>Different in-vehicle time coefficients</td>
<td>-1014.74</td>
</tr>
<tr class="odd">
<td>Test statistic</td>
<td>10.52</td>
</tr>
<tr class="even">
<td>Degrees of freedom</td>
<td>3</td>
</tr>
</tbody>
</table>
</section>
<section id="comparing-logistic-regression-models-to-each-other" class="slide level2">
<h2>Comparing logistic regression models to each other</h2>
<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-53_5fc00056dfff8363d22a90c284c1bdc5">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(<span class="fl">10.52</span>, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01462584</code></pre>
</div>
</div>
</section>
<section id="comparing-logistic-regreession-models-to-each-other" class="slide level2">
<h2>Comparing logistic regreession models to each other</h2>
</section>
<section id="goodness-of-fit-metrics-for-logistic-regression-models" class="slide level2">
<h2>Goodness of fit metrics for logistic regression models</h2>
<ul>
<li>Unlike linear regression, there is no <span class="math inline">\(R^2\)</span> for a logistic regression</li>
<li></li>
</ul>
</section>
<section id="marginal-effects" class="slide level2">
<h2>Marginal effects</h2>
</section>
<section id="independence-of-irrelevant-alternatives" class="slide level2">
<h2>Independence of irrelevant alternatives</h2>
<ul>
<li>When the utility of one alternative is increased, the probabilities of the other alternatives decrease in proportion to their probabilities
<ul>
<li>And vice-versa</li>
<li>Similarly when an alternative is added or removed</li>
</ul></li>
</ul>
</section>
<section id="independence-of-irrelevant-alternatives-the-red-busblue-bus-problem" class="slide level2">
<h2>Independence of irrelevant alternatives: the red bus/blue bus problem</h2>
<ul>
<li>Suppose you have a model of mode choice, with two alternatives: driving and a red bus</li>
<li>One individual has a 50% probability of choosing each alternative</li>
<li>Suppose you paint half the buses red but don’t change anything about the service</li>
</ul>
</section>
<section id="independence-of-irrelevant-alternatives-the-red-busblue-bus-problem-1" class="slide level2">
<h2>Independence of irrelevant alternatives: the red bus/blue bus problem</h2>
<ul>
<li>You’d expect this individual to now have probabilities 25% red bus, 25% blue bus, and 50% drive</li>
<li>But, half of the probability has to come from each other alternative</li>
<li>So, if blue bus has 25% probability, existing choices must all reduce by the same factor</li>
<li>Red bus: 50% * .75 = 37.5%</li>
<li>Same for car</li>
</ul>
</section>
<section id="independence-of-irrelevant-alternatives-the-red-busblue-bus-problem-2" class="slide level2">
<h2>Independence of irrelevant alternatives: the red bus/blue bus problem</h2>
<ul>
<li>This is true at the individual level, not the level of market shares <span class="citation" data-cites="ben-akiva_discrete_1985">(<a href="#/ref-ben-akiva_discrete_1985" role="doc-biblioref" onclick="return false;">Ben-Akiva and Lerman 1985, 109–11</a>)</span></li>
</ul>
</section>
<section id="independence-of-irrelevant-alternatives-the-math" class="slide level2">
<h2>Independence of irrelevant alternatives: the math</h2>
<p><span class="math display">\[ \frac{\delta p(b)}{\delta U_r}\]</span></p>
<p><span class="math display">\[
= \frac{
    e^{U_b}}{
        e^{U_r} + e^{U_b} + e^{U_c}}
    \frac{\delta}{\delta U_r}
\]</span></p>
<p><span class="math display">\[
    = e^{U_b} ( e^{U_r} + e^{U_b} + e^{U_c} \big)^{-2}
        \big[(e^{U_r} + e^{U_b} + e^{U_c}) \frac{\delta}{\delta U_r}\big]
\]</span></p>
<p><span class="math display">\[
    = e^{U_b} \big[ ( e^{U_r} + e^{U_b} + e^{U_c} \big)^{-2} e^{U_r} \big]
\]</span></p>
</section>
<section id="questions-3" class="slide level2">
<h2>Questions?</h2>
<!--
## Prediction and market shares


::: {.cell hash='discrete-choice_cache/revealjs/unnamed-chunk-54_92376a672ce36ad00f8eeae4abbad505'}
::: {.cell-output .cell-output-stdout}
```
Running predictions from model using parameter estimates...
Prediction at model estimates
             car    air   rail    bus
Aggregate 332.00 215.00 327.00 126.00
Average     0.33   0.21   0.33   0.13

The output from apollo_prediction is a matrix containing the
  predictions at the estimated values.
```
:::

::: {.cell-output .cell-output-stdout}
```
      ID Observation       car        air      rail        bus     chosen
1      1           1 0.0000000 0.46197899 0.5380210 0.00000000 0.53802101
2      1           2 0.0000000 0.42286793 0.5771321 0.00000000 0.57713207
3      2           1 0.4412356 0.00000000 0.4441996 0.11456474 0.11456474
4      2           2 0.3121298 0.00000000 0.5796283 0.10824196 0.10824196
5      3           1 0.0000000 0.31916895 0.6808310 0.00000000 0.68083105
6      3           2 0.0000000 0.22185384 0.7781462 0.00000000 0.77814616
7      4           1 0.0000000 0.24534260 0.5052356 0.24942179 0.24534260
8      4           2 0.0000000 0.67659079 0.2361904 0.08721877 0.67659079
9      5           1 0.0000000 0.31009646 0.4224533 0.26745026 0.31009646
10     5           2 0.0000000 0.23050058 0.5499790 0.21952045 0.23050058
11     6           1 0.0000000 0.35982761 0.4207879 0.21938449 0.21938449
12     6           2 0.0000000 0.43013642 0.3617859 0.20807768 0.36178590
13     7           1 0.2918705 0.30906219 0.3286546 0.07041269 0.30906219
14     7           2 0.3294146 0.25104661 0.3414016 0.07813712 0.25104661
15     8           1 0.0000000 0.00000000 0.5363809 0.46361910 0.46361910
16     8           2 0.0000000 0.00000000 0.7612245 0.23877548 0.76122452
17     9           1 0.3267418 0.43398300 0.1573004 0.08197488 0.32674176
18     9           2 0.4585079 0.17247544 0.2572498 0.11176690 0.17247544
19    10           1 0.1797648 0.27963079 0.4930110 0.04759345 0.17976480
20    10           2 0.2896376 0.14449459 0.5317493 0.03411857 0.28963758
21    11           1 0.6117775 0.07580391 0.1355372 0.17688137 0.61177750
22    11           2 0.3498614 0.16003091 0.2666979 0.22340974 0.22340974
23    12           1 0.3460255 0.43533442 0.1625974 0.05604270 0.43533442
24    12           2 0.4094527 0.10537993 0.3724603 0.11270707 0.40945267
25    13           1 0.4778442 0.22317416 0.2161003 0.08288132 0.22317416
26    13           2 0.4455986 0.13233345 0.2949952 0.12707278 0.44559862
27    14           1 0.0000000 0.36485850 0.6351415 0.00000000 0.63514150
28    14           2 0.0000000 0.29253139 0.7074686 0.00000000 0.70746861
29    15           1 0.5385121 0.00000000 0.3258102 0.13567769 0.13567769
30    15           2 0.4938453 0.00000000 0.3158087 0.19034602 0.31580870
31    16           1 0.6419623 0.00000000 0.2704905 0.08754717 0.27049049
32    16           2 0.6113665 0.00000000 0.3259138 0.06271967 0.32591378
33    17           1 0.0000000 0.24019855 0.6380032 0.12179830 0.63800315
34    17           2 0.0000000 0.23152748 0.4993366 0.26913592 0.49933660
35    18           1 0.2441576 0.10995185 0.6101904 0.03570019 0.24415757
36    18           2 0.3751925 0.25506884 0.3212513 0.04848730 0.37519254
37    19           1 0.5409697 0.21783511 0.2411952 0.00000000 0.54096972
38    19           2 0.5004918 0.21905018 0.2804580 0.00000000 0.21905018
39    20           1 0.0000000 0.41070137 0.4376855 0.15161313 0.15161313
40    20           2 0.0000000 0.54527854 0.3392157 0.11550574 0.54527854
41    21           1 0.4193862 0.00000000 0.2783471 0.30226673 0.27834709
42    21           2 0.4086472 0.00000000 0.3115858 0.27976708 0.40864717
43    22           1 0.0000000 0.37112368 0.5173671 0.11150925 0.51736707
44    22           2 0.0000000 0.36625424 0.4140558 0.21968998 0.41405578
45    23           1 0.4633634 0.15753602 0.2100958 0.16900486 0.46336336
46    23           2 0.4032909 0.08718561 0.2676801 0.24184344 0.08718561
47    24           1 0.3188728 0.38306888 0.2561370 0.04192134 0.25613702
48    24           2 0.2002714 0.56331943 0.1788335 0.05757564 0.56331943
49    25           1 0.4822686 0.11003812 0.2599026 0.14779073 0.48226856
50    25           2 0.4693849 0.10178243 0.2138122 0.21502050 0.21502050
51    26           1 0.3780154 0.26971212 0.3043457 0.04792686 0.26971212
52    26           2 0.3765902 0.37123403 0.2009544 0.05122135 0.37123403
53    27           1 0.3087637 0.00000000 0.6279169 0.06331939 0.06331939
54    27           2 0.4580168 0.00000000 0.4739097 0.06807348 0.47390971
55    28           1 0.0000000 0.51471726 0.4852827 0.00000000 0.48528274
56    28           2 0.0000000 0.67931280 0.3206872 0.00000000 0.32068720
57    29           1 0.5128076 0.42862050 0.0000000 0.05857194 0.51280757
58    29           2 0.4663741 0.47246558 0.0000000 0.06116033 0.46637409
59    30           1 0.3680103 0.34327762 0.2887120 0.00000000 0.36801035
60    30           2 0.3167346 0.42983262 0.2534328 0.00000000 0.42983262
61    31           1 0.4898485 0.00000000 0.4198732 0.09027833 0.48984845
62    31           2 0.4609931 0.00000000 0.4641710 0.07483585 0.46099311
63    32           1 0.2714356 0.11506151 0.5284115 0.08509138 0.52841150
64    32           2 0.3423586 0.36603145 0.1611553 0.13045465 0.13045465
65    33           1 0.4775915 0.20311468 0.2161513 0.10314248 0.47759152
66    33           2 0.3586820 0.35410784 0.2135929 0.07361732 0.35410784
67    34           1 0.4923272 0.00000000 0.3341017 0.17357112 0.33410173
68    34           2 0.2928582 0.00000000 0.6106186 0.09652329 0.61061855
69    35           1 0.3242402 0.20443727 0.3295285 0.14179410 0.20443727
70    35           2 0.4514232 0.13526325 0.2883470 0.12496653 0.12496653
71    36           1 0.0000000 0.37676350 0.6232365 0.00000000 0.62323650
72    36           2 0.0000000 0.58769151 0.4123085 0.00000000 0.41230849
73    37           1 0.4295427 0.00000000 0.4833837 0.08707369 0.48338366
74    37           2 0.3551332 0.00000000 0.5144242 0.13044267 0.35513317
75    38           1 0.4814682 0.16835598 0.2321407 0.11803505 0.48146825
76    38           2 0.5245648 0.25890695 0.1368655 0.07966275 0.13686550
77    39           1 0.5662306 0.00000000 0.3209778 0.11279154 0.32097782
78    39           2 0.5795732 0.00000000 0.3440664 0.07636045 0.34406638
79    40           1 0.3300485 0.47128943 0.1577155 0.04094664 0.33004847
80    40           2 0.2274581 0.49541485 0.2346241 0.04250299 0.22745806
81    41           1 0.5217239 0.38367440 0.0000000 0.09460168 0.38367440
82    41           2 0.5086624 0.27899403 0.0000000 0.21234356 0.50866241
83    42           1 0.4522611 0.00000000 0.4608325 0.08690638 0.45226111
84    42           2 0.6526028 0.00000000 0.2981756 0.04922157 0.65260278
85    43           1 0.3572298 0.38938818 0.1921812 0.06120080 0.38938818
86    43           2 0.3391095 0.41790311 0.2015721 0.04141526 0.04141526
87    44           1 0.3107911 0.06999440 0.4881971 0.13101744 0.31079106
88    44           2 0.4229753 0.06436989 0.2696189 0.24303590 0.42297534
89    45           1 0.5674753 0.12664757 0.3058772 0.00000000 0.56747526
90    45           2 0.3249344 0.44269341 0.2323722 0.00000000 0.23237223
91    46           1 0.5830337 0.25099948 0.0000000 0.16596680 0.58303372
92    46           2 0.5646543 0.21798984 0.0000000 0.21735588 0.21735588
93    47           1 0.2892413 0.14189628 0.4675695 0.10129293 0.28924126
94    47           2 0.5472474 0.20607538 0.1560524 0.09062484 0.54724736
95    48           1 0.2439587 0.11334566 0.6095380 0.03315761 0.11334566
96    48           2 0.5180963 0.28660740 0.1350519 0.06024442 0.51809628
97    49           1 0.3396529 0.20183172 0.3075339 0.15098143 0.33965294
98    49           2 0.4739124 0.07628557 0.2914047 0.15839738 0.47391239
99    50           1 0.0000000 0.12850607 0.4583692 0.41312473 0.45836921
100   50           2 0.0000000 0.34696082 0.4530891 0.19995012 0.19995012
101   51           1 0.3688554 0.00000000 0.4769233 0.15422130 0.36885539
102   51           2 0.5040568 0.00000000 0.3148722 0.18107104 0.31487220
103   52           1 0.0000000 0.20183883 0.7303946 0.06776657 0.73039460
104   52           2 0.0000000 0.18362646 0.6343285 0.18204501 0.63432853
105   53           1 0.0000000 0.30013028 0.3940809 0.30578882 0.39408090
106   53           2 0.0000000 0.43897267 0.2094481 0.35157918 0.20944815
107   54           1 0.4203090 0.21871513 0.2845704 0.07640553 0.28457036
108   54           2 0.1678005 0.58595937 0.2169187 0.02932141 0.58595937
109   55           1 0.0000000 0.42950933 0.4334457 0.13704494 0.13704494
110   55           2 0.0000000 0.38689283 0.5352191 0.07788808 0.38689283
111   56           1 0.7443379 0.00000000 0.2556621 0.00000000 0.74433790
112   56           2 0.5322206 0.00000000 0.4677794 0.00000000 0.53222061
113   57           1 0.2728565 0.38753041 0.3065081 0.03310505 0.27285646
114   57           2 0.3149231 0.32190810 0.3256008 0.03756802 0.32190810
115   58           1 0.6620281 0.17622510 0.0000000 0.16174682 0.66202808
116   58           2 0.6596379 0.20987285 0.0000000 0.13048925 0.65963791
117   59           1 0.0000000 0.64682657 0.2331760 0.11999743 0.64682657
118   59           2 0.0000000 0.20494087 0.6094553 0.18560383 0.60945530
119   60           1 0.3925233 0.29902383 0.3084529 0.00000000 0.29902383
120   60           2 0.3242425 0.10843197 0.5673255 0.00000000 0.56732553
121   61           1 0.6036074 0.19105496 0.1628010 0.04253661 0.19105496
122   61           2 0.3851370 0.33658066 0.2081858 0.07009653 0.38513698
123   62           1 0.4118946 0.13841520 0.2903200 0.15937020 0.13841520
124   62           2 0.2271130 0.47782622 0.1669438 0.12811700 0.47782622
125   63           1 0.3304223 0.32630368 0.2412491 0.10202494 0.33042230
126   63           2 0.4202473 0.10007505 0.2787145 0.20096317 0.27871446
127   64           1 0.3369654 0.30733135 0.2712799 0.08442329 0.30733135
128   64           2 0.2274540 0.21625419 0.4703759 0.08591588 0.47037595
129   65           1 0.2458022 0.19948951 0.5046355 0.05007277 0.50463550
130   65           2 0.2339049 0.52596833 0.2054298 0.03469691 0.52596833
131   66           1 0.8859859 0.00000000 0.0000000 0.11401409 0.88598591
132   66           2 0.7970207 0.00000000 0.0000000 0.20297925 0.79702075
133   67           1 0.4044639 0.00000000 0.2205921 0.37494405 0.37494405
134   67           2 0.4228892 0.00000000 0.4467629 0.13034790 0.44676285
135   68           1 0.0000000 0.35816861 0.4901309 0.15170044 0.35816861
136   68           2 0.0000000 0.66353503 0.2630724 0.07339257 0.66353503
137   69           1 0.0000000 0.36045657 0.4345684 0.20497499 0.43456844
138   69           2 0.0000000 0.41813545 0.5091313 0.07273330 0.50913126
139   70           1 0.3105768 0.51390183 0.1482322 0.02728914 0.31057679
140   70           2 0.2821019 0.45974992 0.2253843 0.03276386 0.28210192
141   71           1 0.7525545 0.00000000 0.1661540 0.08129153 0.16615401
142   71           2 0.4735277 0.00000000 0.4760895 0.05038284 0.47608951
143   72           1 0.4197972 0.16656917 0.3608189 0.05281473 0.41979721
144   72           2 0.4813993 0.19756360 0.2156069 0.10543024 0.21560689
145   73           1 0.5863597 0.00000000 0.3154229 0.09821741 0.58635971
146   73           2 0.2969118 0.00000000 0.6497390 0.05334916 0.64973901
147   74           1 0.4202759 0.21914929 0.2845432 0.07603167 0.42027589
148   74           2 0.4025097 0.19352223 0.2590445 0.14492360 0.25904449
149   75           1 0.4058594 0.00000000 0.4125121 0.18162844 0.40585942
150   75           2 0.4979593 0.00000000 0.4287474 0.07329333 0.42874738
151   76           1 0.5812511 0.17569703 0.1992577 0.04379411 0.04379411
152   76           2 0.2563466 0.38544506 0.3166646 0.04154380 0.31666458
153   77           1 0.4219203 0.16215210 0.2295184 0.18640920 0.42192034
154   77           2 0.4994103 0.24870761 0.1627024 0.08917967 0.24870761
155   78           1 0.2877141 0.25879875 0.2824056 0.17108152 0.28771411
156   78           2 0.3775850 0.17001546 0.3243898 0.12800968 0.32438984
157   79           1 0.4569969 0.00000000 0.4131357 0.12986744 0.12986744
158   79           2 0.5756956 0.00000000 0.3418638 0.08244054 0.34186385
159   80           1 0.3111020 0.19097438 0.4979236 0.00000000 0.49792362
160   80           2 0.3155208 0.13347304 0.5510062 0.00000000 0.31552081
161   81           1 0.3602204 0.20159971 0.3143981 0.12378184 0.20159971
162   81           2 0.3365424 0.14047682 0.2567368 0.26624398 0.25673677
163   82           1 0.2721238 0.15968708 0.5283456 0.03984355 0.52834558
164   82           2 0.2858134 0.41277467 0.2542408 0.04717115 0.41277467
165   83           1 0.5602755 0.00000000 0.4397245 0.00000000 0.56027552
166   83           2 0.6272624 0.00000000 0.3727376 0.00000000 0.62726242
167   84           1 0.4137600 0.16474204 0.2807497 0.14074826 0.14074826
168   84           2 0.2701375 0.08078031 0.5631749 0.08590737 0.27013745
169   85           1 0.4448839 0.44535216 0.0000000 0.10976397 0.44535216
170   85           2 0.6338464 0.15865992 0.0000000 0.20749370 0.63384638
171   86           1 0.3778696 0.27027705 0.3042221 0.04763127 0.30422212
172   86           2 0.2745335 0.43248301 0.2401435 0.05283999 0.05283999
173   87           1 0.4644937 0.37780674 0.0000000 0.15769955 0.46449372
174   87           2 0.2758699 0.64335818 0.0000000 0.08077192 0.64335818
175   88           1 0.0000000 0.44293470 0.4546466 0.10241874 0.44293470
176   88           2 0.0000000 0.28751880 0.6170617 0.09541953 0.09541953
177   89           1 0.0000000 0.25784637 0.4010628 0.34109081 0.34109081
178   89           2 0.0000000 0.19118173 0.6931662 0.11565207 0.69316620
179   90           1 0.3457236 0.14745492 0.4599249 0.04689664 0.45992489
180   90           2 0.5766994 0.14954123 0.2168242 0.05693512 0.14954123
181   91           1 0.0000000 0.38552318 0.4284316 0.18604521 0.42843161
182   91           2 0.0000000 0.28028165 0.6908315 0.02888681 0.69083154
183   92           1 0.2821954 0.30585255 0.2846394 0.12731268 0.28463937
184   92           2 0.3888557 0.08095333 0.3543376 0.17585332 0.17585332
185   93           1 0.4008973 0.51834574 0.0000000 0.08075691 0.40089735
186   93           2 0.4145837 0.53604174 0.0000000 0.04937453 0.53604174
187   94           1 0.5854719 0.11805392 0.2964741 0.00000000 0.58547194
188   94           2 0.2991076 0.07652623 0.6243661 0.00000000 0.29910763
189   95           1 0.6977191 0.00000000 0.0000000 0.30228095 0.30228095
190   95           2 0.7847746 0.00000000 0.0000000 0.21522543 0.21522543
191   96           1 0.0000000 0.08153945 0.8464233 0.07203730 0.84642325
192   96           2 0.0000000 0.52869882 0.3731071 0.09819409 0.52869882
193   97           1 0.5274054 0.00000000 0.2956602 0.17693442 0.52740537
194   97           2 0.5531247 0.00000000 0.3887335 0.05814182 0.38873352
195   98           1 0.7689561 0.23104390 0.0000000 0.00000000 0.76895610
196   98           2 0.6850314 0.31496859 0.0000000 0.00000000 0.31496859
197   99           1 0.4467681 0.00000000 0.4041155 0.14911638 0.44676813
198   99           2 0.5361249 0.00000000 0.3293291 0.13454603 0.53612487
199  100           1 0.3800013 0.00000000 0.5069134 0.11308532 0.50691342
200  100           2 0.3276513 0.00000000 0.6027772 0.06957150 0.60277724
201  101           1 0.5983322 0.00000000 0.4016678 0.00000000 0.59833218
202  101           2 0.6159887 0.00000000 0.3840113 0.00000000 0.38401127
203  102           1 0.2727036 0.38762318 0.2744567 0.06521646 0.38762318
204  102           2 0.3011562 0.07535744 0.4946455 0.12884087 0.30115618
205  103           1 0.0000000 0.69655612 0.2727656 0.03067828 0.27276559
206  103           2 0.0000000 0.65678305 0.2982771 0.04493981 0.65678305
207  104           1 0.6934729 0.00000000 0.0000000 0.30652707 0.69347293
208  104           2 0.6371002 0.00000000 0.0000000 0.36289977 0.63710023
209  105           1 0.5857358 0.00000000 0.3150108 0.09925340 0.58573581
210  105           2 0.4765310 0.00000000 0.3400191 0.18344991 0.34001907
211  106           1 0.2992534 0.35617341 0.2837247 0.06084852 0.29925336
212  106           2 0.3996695 0.15588843 0.3951570 0.04928510 0.39966951
213  107           1 0.4223845 0.16298347 0.2297633 0.18486875 0.42238448
214  107           2 0.4993300 0.24966787 0.1626709 0.08833131 0.49932996
215  108           1 0.2440497 0.11193063 0.6098299 0.03418977 0.11193063
216  108           2 0.3081127 0.50217626 0.1131360 0.07657502 0.30811268
217  109           1 0.3617797 0.35768432 0.2051138 0.07542218 0.36177970
218  109           2 0.4956283 0.09815585 0.3042420 0.10197389 0.30424198
219  110           1 0.0000000 0.34907680 0.4687560 0.18216716 0.18216716
220  110           2 0.0000000 0.23465669 0.4819975 0.28334582 0.48199749
221  111           1 0.0000000 0.39935107 0.6006489 0.00000000 0.60064893
222  111           2 0.0000000 0.52216337 0.4778366 0.00000000 0.47783663
223  112           1 0.0000000 0.72044226 0.2268707 0.05268706 0.05268706
224  112           2 0.0000000 0.21798173 0.6495774 0.13244088 0.21798173
225  113           1 0.2675431 0.49656537 0.2358916 0.00000000 0.26754306
226  113           2 0.5103774 0.15174578 0.3378768 0.00000000 0.51037740
227  114           1 0.5105428 0.16265267 0.2575669 0.06923761 0.51054285
228  114           2 0.2183021 0.29547852 0.4501489 0.03607050 0.45014892
229  115           1 0.5097109 0.00000000 0.3200608 0.17022831 0.50971093
230  115           2 0.4817993 0.00000000 0.4235610 0.09463973 0.42356097
231  116           1 0.2821707 0.07113913 0.6128149 0.03387523 0.61281490
232  116           2 0.3522758 0.21821087 0.3160813 0.11343206 0.31608128
233  117           1 0.2910348 0.18061209 0.4695663 0.05878681 0.46956627
234  117           2 0.1964700 0.56045142 0.2071830 0.03589556 0.20718298
235  118           1 0.2619681 0.08133823 0.6566937 0.00000000 0.26196809
236  118           2 0.5007171 0.14279624 0.3564867 0.00000000 0.50071707
237  119           1 0.3684529 0.31195780 0.2091620 0.11042733 0.31195780
238  119           2 0.4807672 0.08153670 0.2954936 0.14220256 0.48076718
239  120           1 0.5180764 0.32933734 0.0000000 0.15258623 0.32933734
240  120           2 0.2922418 0.65706347 0.0000000 0.05069471 0.65706347
241  121           1 0.3447761 0.31902566 0.2996848 0.03651346 0.34477606
242  121           2 0.3822442 0.34797398 0.2065532 0.06322862 0.38224418
243  122           1 0.3504330 0.10961443 0.4371280 0.10282457 0.43712799
244  122           2 0.2726538 0.05132160 0.4488736 0.22715100 0.22715100
245  123           1 0.3408125 0.37155476 0.1852863 0.10234644 0.34081247
246  123           2 0.4500157 0.11025097 0.3261059 0.11362743 0.32610589
247  124           1 0.2854399 0.14968663 0.5017090 0.06316443 0.50170901
248  124           2 0.4992649 0.12337532 0.2569807 0.12037911 0.12337532
249  125           1 0.4532146 0.17827201 0.2840070 0.08450634 0.17827201
250  125           2 0.5889864 0.17734806 0.1911411 0.04252446 0.19114109
251  126           1 0.3849165 0.19343915 0.3107905 0.11085377 0.38491655
252  126           2 0.3943252 0.11147518 0.3908996 0.10330001 0.11147518
253  127           1 0.3267230 0.00000000 0.5285929 0.14468407 0.52859294
254  127           2 0.6689872 0.00000000 0.1909239 0.14008885 0.19092392
255  128           1 0.2854045 0.24497220 0.2802459 0.18937744 0.24497220
256  128           2 0.4372173 0.11429656 0.3114992 0.13698690 0.31149923
257  129           1 0.4721647 0.00000000 0.4264308 0.10140451 0.42643080
258  129           2 0.4442444 0.00000000 0.4806620 0.07509368 0.48066197
259  130           1 0.3172272 0.00000000 0.5086859 0.17408689 0.50868586
260  130           2 0.4097774 0.00000000 0.3405470 0.24967553 0.34054703
261  131           1 0.4563751 0.00000000 0.3919870 0.15163797 0.45637506
262  131           2 0.4344732 0.00000000 0.4383691 0.12715767 0.43447324
263  132           1 0.0000000 0.76718498 0.0000000 0.23281502 0.76718498
264  132           2 0.0000000 0.93164553 0.0000000 0.06835447 0.06835447
265  133           1 0.3375673 0.39106828 0.1834310 0.08793337 0.39106828
266  133           2 0.4603668 0.13917747 0.2507155 0.14974017 0.46036683
267  134           1 0.3717569 0.00000000 0.5198777 0.10836544 0.51987769
268  134           2 0.5466300 0.00000000 0.2816204 0.17174966 0.54662995
269  135           1 0.0000000 0.82187786 0.0000000 0.17812214 0.17812214
270  135           2 0.0000000 0.94611073 0.0000000 0.05388927 0.94611073
271  136           1 0.5213544 0.00000000 0.4195851 0.05906052 0.52135440
272  136           2 0.6042537 0.00000000 0.3223125 0.07343381 0.32231250
273  137           1 0.4957288 0.00000000 0.4014942 0.10277698 0.40149417
274  137           2 0.6524818 0.00000000 0.2126798 0.13483840 0.65248183
275  138           1 0.4374467 0.00000000 0.4283847 0.13416855 0.42838470
276  138           2 0.5818602 0.00000000 0.2139111 0.20422867 0.21391110
277  139           1 0.0000000 0.66702698 0.2284893 0.10448371 0.10448371
278  139           2 0.0000000 0.41466079 0.5105170 0.07482219 0.41466079
279  140           1 0.3307285 0.08646968 0.4417391 0.14106275 0.44173911
280  140           2 0.2846035 0.08951179 0.4982191 0.12766560 0.28460353
281  141           1 0.6514112 0.10678207 0.1439884 0.09781836 0.09781836
282  141           2 0.3609204 0.20836780 0.3538264 0.07688538 0.36092044
283  142           1 0.3558775 0.14341434 0.4430015 0.05770665 0.35587749
284  142           2 0.4111803 0.10879744 0.3739472 0.10607513 0.10879744
285  143           1 0.0000000 0.60120399 0.0000000 0.39879601 0.60120399
286  143           2 0.0000000 0.30596954 0.0000000 0.69403046 0.69403046
287  144           1 0.3448014 0.00000000 0.5411628 0.11403573 0.34480145
288  144           2 0.2846488 0.00000000 0.5940344 0.12131676 0.59403444
289  145           1 0.8046669 0.00000000 0.0000000 0.19533308 0.80466692
290  145           2 0.9260629 0.00000000 0.0000000 0.07393712 0.92606288
291  146           1 0.4513993 0.20243467 0.2293911 0.11677495 0.45139931
292  146           2 0.3451076 0.18120409 0.3100680 0.16362025 0.18120409
293  147           1 0.5187244 0.10616080 0.0000000 0.37511479 0.51872441
294  147           2 0.5723941 0.20404711 0.0000000 0.22355880 0.22355880
295  148           1 0.8046025 0.00000000 0.0000000 0.19539745 0.80460255
296  148           2 0.8818138 0.00000000 0.0000000 0.11818617 0.88181383
297  149           1 0.5703471 0.00000000 0.3232375 0.10641537 0.57034712
298  149           2 0.3310579 0.00000000 0.5754201 0.09352200 0.33105787
299  150           1 0.3548136 0.29146033 0.2786481 0.07507798 0.27864811
300  150           2 0.2347284 0.29388713 0.3484296 0.12295479 0.29388713
301  151           1 0.2964376 0.12471425 0.3838947 0.19495348 0.38389472
302  151           2 0.4087562 0.06749818 0.4073064 0.11643924 0.40875615
303  152           1 0.5991072 0.32573710 0.0000000 0.07515567 0.32573710
304  152           2 0.2180112 0.74211575 0.0000000 0.03987307 0.74211575
305  153           1 0.3409571 0.25044670 0.3188708 0.08972535 0.25044670
306  153           2 0.2514493 0.42090481 0.1620536 0.16559232 0.25144928
307  154           1 0.3228054 0.09136345 0.5061238 0.07970741 0.09136345
308  154           2 0.1888944 0.50458159 0.2447222 0.06180178 0.50458159
309  155           1 0.3522734 0.31830046 0.3294262 0.00000000 0.35227337
310  155           2 0.6303451 0.16485618 0.2047987 0.00000000 0.16485618
311  156           1 0.3429283 0.33138446 0.3256872 0.00000000 0.32568725
312  156           2 0.5374962 0.20763485 0.2548689 0.00000000 0.53749621
313  157           1 0.2905898 0.18628073 0.4687240 0.05440543 0.46872404
314  157           2 0.4998854 0.23427491 0.1629380 0.10290172 0.49988540
315  158           1 0.3815987 0.40760597 0.0000000 0.21079529 0.21079529
316  158           2 0.4779462 0.23521468 0.0000000 0.28683915 0.47794618
317  159           1 0.0000000 0.51559879 0.0000000 0.48440121 0.48440121
318  159           2 0.0000000 0.83394707 0.0000000 0.16605293 0.83394707
319  160           1 0.3441741 0.33797508 0.2698987 0.04795213 0.26989866
320  160           2 0.2312748 0.34615491 0.3428028 0.07976740 0.34615491
321  161           1 0.3821784 0.26159457 0.2570336 0.09919334 0.38217844
322  161           2 0.1902270 0.17022319 0.5863583 0.05319156 0.58635827
323  162           1 0.2805420 0.33778774 0.2827286 0.09894162 0.28054203
324  162           2 0.4007613 0.09268636 0.3648727 0.14167957 0.40076135
325  163           1 0.5371447 0.00000000 0.3910381 0.07181725 0.39103806
326  163           2 0.5627973 0.00000000 0.3061419 0.13106077 0.56279732
327  164           1 0.6256337 0.12596716 0.0000000 0.24839912 0.62563372
328  164           2 0.2760164 0.53031992 0.0000000 0.19366370 0.19366370
329  165           1 0.0000000 0.45919757 0.0000000 0.54080243 0.45919757
330  165           2 0.0000000 0.65412391 0.0000000 0.34587609 0.34587609
331  166           1 0.4421018 0.00000000 0.5000218 0.05787638 0.05787638
332  166           2 0.4887280 0.00000000 0.4273366 0.08393535 0.08393535
333  167           1 0.3799309 0.29593272 0.2619578 0.06217856 0.37993091
334  167           2 0.2854515 0.20587868 0.4133500 0.09531981 0.09531981
335  168           1 0.0000000 0.44460635 0.4092081 0.14618553 0.40920812
336  168           2 0.0000000 0.57202939 0.2881209 0.13984967 0.57202939
337  169           1 0.4008495 0.12843151 0.2400078 0.23071121 0.12843151
338  169           2 0.4404844 0.13331743 0.2475769 0.17862126 0.24757692
339  170           1 0.0000000 0.53132535 0.4043903 0.06428433 0.40439033
340  170           2 0.0000000 0.46721426 0.4409752 0.09181052 0.44097523
341  171           1 0.6069295 0.14156746 0.1641058 0.08739732 0.08739732
342  171           2 0.4184648 0.07970906 0.4164945 0.08533160 0.41846485
343  172           1 0.3783301 0.35486834 0.2668015 0.00000000 0.26680155
344  172           2 0.4708970 0.10007914 0.4290238 0.00000000 0.47089701
345  173           1 0.3628700 0.36836375 0.1953291 0.07343715 0.36836375
346  173           2 0.3464132 0.39757653 0.2060333 0.04997699 0.39757653
347  174           1 0.0000000 0.00000000 0.7530524 0.24694757 0.75305243
348  174           2 0.0000000 0.00000000 0.5203984 0.47960160 0.52039840
349  175           1 0.2440419 0.21357717 0.5007130 0.04166792 0.50071298
350  175           2 0.5108872 0.16484284 0.2319628 0.09230712 0.23196280
351  176           1 0.3550966 0.14206690 0.4026951 0.10014132 0.35509664
352  176           2 0.3012155 0.35345777 0.2650506 0.08027618 0.30121550
353  177           1 0.2943654 0.00000000 0.5998096 0.10582495 0.59980965
354  177           2 0.4225637 0.00000000 0.4464280 0.13100835 0.13100835
355  178           1 0.2438105 0.09186909 0.6102109 0.05410949 0.61021095
356  178           2 0.4505777 0.15594259 0.3202829 0.07319683 0.45057767
357  179           1 0.0000000 0.00000000 0.7316279 0.26837207 0.26837207
358  179           2 0.0000000 0.00000000 0.9128644 0.08713557 0.91286443
359  180           1 0.3620321 0.35896955 0.1735152 0.10548315 0.10548315
360  180           2 0.5296095 0.07887383 0.2000237 0.19149297 0.52960948
361  181           1 0.3026291 0.13645355 0.3916911 0.16922629 0.39169110
362  181           2 0.3908431 0.06661055 0.3960038 0.14654253 0.39600384
363  182           1 0.2732053 0.14681161 0.5308270 0.04915610 0.27320528
364  182           2 0.5241126 0.17455263 0.2398378 0.06149700 0.52411258
365  183           1 0.2444697 0.23565753 0.4852608 0.03461201 0.24446967
366  183           2 0.2729884 0.08310714 0.5972810 0.04662352 0.59728096
367  184           1 0.4868239 0.10604394 0.2463648 0.16076735 0.48682392
368  184           2 0.2194234 0.45610278 0.1964201 0.12805376 0.45610278
369  185           1 0.0000000 0.23226890 0.4566360 0.31109514 0.31109514
370  185           2 0.0000000 0.53823667 0.2551416 0.20662175 0.53823667
371  186           1 0.4881674 0.11227860 0.2064549 0.19309915 0.19309915
372  186           2 0.3036722 0.33634156 0.2673384 0.09264779 0.30367222
373  187           1 0.5983338 0.22501961 0.0000000 0.17664655 0.22501961
374  187           2 0.5452996 0.17232170 0.0000000 0.28237868 0.54529963
375  188           1 0.2607346 0.37376062 0.2931650 0.07233983 0.37376062
376  188           2 0.3456809 0.41592697 0.1785351 0.05985707 0.17853506
377  189           1 0.0000000 0.00000000 0.7313133 0.26868671 0.73131329
378  189           2 0.0000000 0.00000000 0.7491227 0.25087726 0.74912274
379  190           1 0.3928982 0.00000000 0.5235043 0.08359746 0.52350433
380  190           2 0.3518227 0.00000000 0.5215601 0.12661720 0.52156010
381  191           1 0.6074087 0.17602364 0.1639444 0.05262324 0.60740873
382  191           2 0.3855517 0.28010646 0.2405178 0.09382406 0.38555169
383  192           1 0.0000000 0.56546913 0.2700848 0.16444602 0.16444602
384  192           2 0.0000000 0.20140833 0.3404446 0.45814711 0.45814711
385  193           1 0.0000000 0.30743505 0.4784069 0.21415805 0.30743505
386  193           2 0.0000000 0.14579909 0.5391885 0.31501238 0.31501238
387  194           1 0.4523177 0.00000000 0.4423519 0.10533043 0.44235191
388  194           2 0.6137249 0.00000000 0.2574889 0.12878621 0.12878621
389  195           1 0.3202950 0.45089865 0.1932315 0.03557487 0.45089865
390  195           2 0.2824095 0.26243484 0.3990139 0.05614171 0.28240950
391  196           1 0.3752071 0.35403153 0.2126511 0.05811027 0.21265111
392  196           2 0.3835522 0.34851122 0.2048057 0.06313092 0.34851122
393  197           1 0.2333693 0.25115332 0.4743406 0.04113674 0.04113674
394  197           2 0.5321452 0.27420530 0.1513576 0.04229188 0.53214521
395  198           1 0.2660163 0.27381860 0.2999140 0.16025110 0.27381860
396  198           2 0.5107692 0.17622308 0.1336565 0.17935124 0.51076921
397  199           1 0.4174831 0.15052075 0.2497262 0.18227003 0.41748306
398  199           2 0.4525498 0.15413101 0.2541132 0.13920602 0.25411317
399  200           1 0.4343908 0.45333312 0.0000000 0.11227611 0.45333312
400  200           2 0.6536160 0.16454808 0.0000000 0.18183588 0.65361603
401  201           1 0.0000000 0.54512970 0.3854154 0.06945492 0.54512970
402  201           2 0.0000000 0.19472057 0.7174991 0.08778037 0.71749907
403  202           1 0.4117619 0.11468512 0.3549372 0.11861581 0.41176189
404  202           2 0.5218163 0.14409323 0.2391528 0.09493771 0.52181626
405  203           1 0.0000000 0.44755127 0.4119429 0.14050584 0.44755127
406  203           2 0.0000000 0.63240739 0.2115215 0.15607107 0.63240739
407  204           1 0.4570340 0.00000000 0.3684845 0.17448144 0.36848453
408  204           2 0.3661498 0.00000000 0.3281742 0.30567606 0.30567606
409  205           1 0.6142871 0.19383438 0.0000000 0.19187849 0.19383438
410  205           2 0.5813104 0.32571260 0.0000000 0.09297703 0.32571260
411  206           1 0.5207341 0.17544268 0.2195422 0.08428095 0.52073414
412  206           2 0.2706153 0.44585872 0.2366295 0.04689646 0.44585872
413  207           1 0.0000000 0.47314580 0.0000000 0.52685420 0.47314580
414  207           2 0.0000000 0.78305249 0.0000000 0.21694751 0.78305249
415  208           1 0.6309505 0.23322584 0.0000000 0.13582363 0.13582363
416  208           2 0.3528904 0.54953134 0.0000000 0.09757824 0.35289042
417  209           1 0.0000000 0.17705802 0.3684969 0.45444512 0.45444512
418  209           2 0.0000000 0.12706363 0.5268117 0.34612467 0.34612467
419  210           1 0.2833413 0.18685027 0.4532268 0.07658170 0.07658170
420  210           2 0.5756458 0.13221050 0.2166427 0.07550101 0.57564576
421  211           1 0.0000000 0.00000000 0.4899845 0.51001552 0.51001552
422  211           2 0.0000000 0.00000000 0.6107644 0.38923558 0.38923558
423  212           1 0.2733983 0.14180168 0.5313558 0.05344420 0.53135581
424  212           2 0.4683107 0.15704767 0.2100911 0.16455054 0.46831065
425  213           1 0.4593659 0.15100562 0.2083405 0.18128796 0.18128796
426  213           2 0.3656445 0.27901959 0.2181976 0.13713831 0.27901959
427  214           1 0.3922335 0.12778182 0.2665798 0.21340490 0.26657979
428  214           2 0.3794623 0.35782860 0.1593488 0.10336028 0.35782860
429  215           1 0.0000000 0.00000000 0.8402521 0.15974791 0.84025209
430  215           2 0.0000000 0.00000000 0.8422723 0.15772772 0.84227228
431  216           1 0.0000000 0.48005910 0.5199409 0.00000000 0.48005910
432  216           2 0.0000000 0.65176599 0.3482340 0.00000000 0.34823401
433  217           1 0.4411465 0.25393579 0.3049177 0.00000000 0.44114652
434  217           2 0.3350482 0.17858258 0.4863692 0.00000000 0.48636921
435  218           1 0.7920500 0.00000000 0.2079500 0.00000000 0.79204997
436  218           2 0.5385621 0.00000000 0.4614379 0.00000000 0.46143787
437  219           1 0.2952631 0.00000000 0.6467167 0.05802021 0.29526306
438  219           2 0.5146064 0.00000000 0.3937552 0.09163840 0.51460635
439  220           1 0.2774175 0.14181718 0.4446754 0.13608985 0.44467542
440  220           2 0.2901747 0.10809765 0.5340081 0.06771955 0.53400807
441  221           1 0.1735038 0.48356276 0.2972906 0.04564282 0.29729062
442  221           2 0.3601480 0.18309327 0.3534361 0.10332261 0.36014800
443  222           1 0.4253752 0.20452041 0.2989456 0.07115880 0.29894560
444  222           2 0.2882510 0.40435028 0.2564701 0.05092862 0.28825097
445  223           1 0.3427260 0.30459404 0.1866379 0.16604211 0.16604211
446  223           2 0.4118867 0.09327661 0.2732818 0.22155491 0.41188672
447  224           1 0.5393242 0.00000000 0.3651170 0.09555878 0.36511700
448  224           2 0.4060225 0.00000000 0.5248253 0.06915222 0.52482533
449  225           1 0.0000000 0.37173530 0.4841770 0.14408767 0.37173530
450  225           2 0.0000000 0.22155385 0.4269014 0.35154472 0.22155385
451  226           1 0.3037415 0.00000000 0.6596699 0.03658859 0.65966987
452  226           2 0.4503781 0.00000000 0.4041089 0.14551294 0.40410891
453  227           1 0.4194734 0.12880140 0.3400312 0.11169405 0.12880140
454  227           2 0.3257978 0.27706983 0.3373508 0.05978153 0.05978153
455  228           1 0.4396118 0.15834194 0.2498402 0.15220606 0.43961179
456  228           2 0.4350715 0.11120057 0.3100275 0.14370046 0.31002750
457  229           1 0.3919084 0.11936137 0.2347515 0.25397872 0.25397872
458  229           2 0.2322072 0.23697989 0.4045289 0.12628404 0.40452889
459  230           1 0.0000000 0.56002490 0.0000000 0.43997510 0.56002490
460  230           2 0.0000000 0.27369919 0.0000000 0.72630081 0.72630081
461  231           1 0.3620082 0.22586665 0.3156780 0.09644706 0.22586665
462  231           2 0.4157316 0.07547747 0.4139364 0.09485459 0.07547747
463  232           1 0.4283075 0.00000000 0.5321179 0.03957460 0.53211793
464  232           2 0.3445862 0.00000000 0.5650136 0.09040029 0.34458615
465  233           1 0.0000000 0.20609901 0.6618843 0.13201670 0.66188429
466  233           2 0.0000000 0.45151370 0.2109895 0.33749677 0.21098953
467  234           1 0.0000000 0.79025254 0.0000000 0.20974746 0.79025254
468  234           2 0.0000000 0.75166349 0.0000000 0.24833651 0.24833651
469  235           1 0.4194403 0.10858478 0.2637421 0.20823283 0.41944027
470  235           2 0.2791730 0.16512081 0.3958997 0.15980653 0.27917299
471  236           1 0.3576508 0.16571154 0.4051056 0.07153207 0.40510559
472  236           2 0.4002707 0.14108439 0.3960789 0.06256603 0.39607892
473  237           1 0.5272841 0.23027221 0.0000000 0.24244373 0.23027221
474  237           2 0.6568340 0.13306009 0.0000000 0.21010595 0.65683396
475  238           1 0.2898348 0.27988464 0.2843223 0.14595827 0.27988464
476  238           2 0.5206576 0.19850477 0.1361329 0.14470470 0.14470470
477  239           1 0.0000000 0.00000000 0.5773980 0.42260200 0.42260200
478  239           2 0.0000000 0.00000000 0.7498406 0.25015937 0.74984063
479  240           1 0.6307974 0.00000000 0.3012810 0.06792166 0.63079736
480  240           2 0.3581369 0.00000000 0.5306474 0.11121576 0.53064736
481  241           1 0.7162245 0.14903129 0.0000000 0.13474419 0.71622452
482  241           2 0.4647431 0.20241246 0.0000000 0.33284445 0.46474309
483  242           1 0.5575135 0.00000000 0.2626064 0.17988015 0.55751345
484  242           2 0.5177640 0.00000000 0.2438832 0.23835283 0.23835283
485  243           1 0.0000000 0.49683020 0.4019366 0.10123316 0.49683020
486  243           2 0.0000000 0.57387220 0.3354758 0.09065205 0.57387220
487  244           1 0.0000000 0.39068246 0.5383922 0.07092537 0.53839217
488  244           2 0.0000000 0.66989702 0.2799878 0.05011516 0.27998783
489  245           1 0.0000000 0.47621763 0.0000000 0.52378237 0.52378237
490  245           2 0.0000000 0.64305251 0.0000000 0.35694749 0.35694749
491  246           1 0.0000000 0.25862693 0.6306604 0.11071271 0.63066036
492  246           2 0.0000000 0.39274966 0.4952191 0.11203120 0.39274966
493  247           1 0.4897171 0.00000000 0.3967796 0.11350330 0.39677957
494  247           2 0.4454887 0.00000000 0.4698446 0.08466669 0.46984459
495  248           1 0.4910160 0.11253485 0.2261500 0.17029920 0.22615000
496  248           2 0.3861031 0.07458876 0.4315013 0.10780687 0.38610307
497  249           1 0.3234547 0.44687393 0.1556678 0.07400352 0.32345473
498  249           2 0.4598865 0.17994284 0.2579403 0.10223035 0.25794029
499  250           1 0.0000000 0.67775639 0.2455930 0.07665062 0.07665062
500  250           2 0.0000000 0.61557784 0.3156766 0.06874560 0.61557784
501  251           1 0.1864422 0.40612863 0.3201038 0.08732535 0.40612863
502  251           2 0.4073502 0.06619053 0.4059589 0.12050045 0.40595886
503  252           1 0.2708409 0.39601808 0.2725191 0.06062196 0.39601808
504  252           2 0.3223156 0.46562613 0.1513481 0.06071018 0.46562613
505  253           1 0.0000000 0.43428269 0.3625807 0.20313661 0.20313661
506  253           2 0.0000000 0.06290555 0.7490372 0.18805724 0.18805724
507  254           1 0.3975833 0.12464944 0.3887699 0.08899729 0.39758335
508  254           2 0.1934565 0.48083813 0.2507802 0.07492512 0.48083813
509  255           1 0.3067467 0.15470826 0.3123188 0.22622626 0.22622626
510  255           2 0.5843884 0.11815243 0.1902671 0.10719206 0.58438845
511  256           1 0.7037219 0.00000000 0.2412727 0.05500541 0.24127266
512  256           2 0.4160458 0.00000000 0.5140067 0.06994751 0.51400671
513  257           1 0.4030668 0.10238081 0.3272384 0.16731404 0.40306675
514  257           2 0.4788563 0.16654765 0.1564643 0.19813176 0.19813176
515  258           1 0.4423985 0.16491698 0.2513533 0.14133122 0.44239845
516  258           2 0.5099948 0.17488305 0.1334605 0.18166162 0.50999484
517  259           1 0.4616718 0.17140570 0.2509243 0.11599827 0.11599827
518  259           2 0.2302337 0.29721455 0.4003216 0.07223011 0.23023374
519  260           1 0.3557763 0.28476176 0.2794634 0.07999851 0.28476176
520  260           2 0.2422988 0.43694577 0.2503182 0.07043723 0.43694577
521  261           1 0.5517387 0.00000000 0.3702848 0.07797653 0.55173865
522  261           2 0.4671958 0.00000000 0.4575659 0.07523828 0.45756591
523  262           1 0.2962715 0.12702171 0.5767068 0.00000000 0.29627149
524  262           2 0.5792006 0.16055690 0.2602425 0.00000000 0.57920056
525  263           1 0.3614420 0.23433423 0.1952743 0.20894949 0.36144195
526  263           2 0.4092372 0.07246472 0.2973432 0.22095487 0.40923721
527  264           1 0.0000000 0.27872480 0.4780442 0.24323096 0.27872480
528  264           2 0.0000000 0.10985791 0.7708090 0.11933309 0.11933309
529  265           1 0.3990616 0.19451440 0.4064240 0.00000000 0.39906163
530  265           2 0.3190897 0.45279375 0.2281166 0.00000000 0.31908966
531  266           1 0.5939621 0.00000000 0.3363067 0.06973123 0.59396211
532  266           2 0.3685079 0.00000000 0.5471172 0.08437489 0.36850789
533  267           1 0.5082909 0.00000000 0.2764617 0.21524739 0.27646173
534  267           2 0.7363957 0.00000000 0.2093964 0.05420792 0.05420792
535  268           1 0.5351360 0.00000000 0.3039787 0.16088527 0.53513599
536  268           2 0.6262326 0.00000000 0.1638440 0.20992333 0.20992333
537  269           1 0.4232011 0.16112862 0.2530338 0.16263648 0.42320107
538  269           2 0.4177324 0.27536865 0.2480469 0.05885207 0.27536865
539  270           1 0.2464134 0.00000000 0.6761999 0.07738664 0.24641344
540  270           2 0.5124234 0.00000000 0.4097817 0.07779483 0.40978173
541  271           1 0.0000000 0.38165583 0.4153299 0.20301431 0.38165583
542  271           2 0.0000000 0.40063032 0.3463403 0.25302938 0.25302938
543  272           1 0.2687789 0.10453290 0.5236079 0.10308035 0.52360787
544  272           2 0.5128305 0.12361245 0.2352957 0.12826128 0.51283054
545  273           1 0.0000000 0.59305518 0.3263198 0.08062504 0.59305518
546  273           2 0.0000000 0.18063880 0.5779114 0.24144979 0.18063880
547  274           1 0.4666600 0.08954063 0.2364054 0.20739401 0.46665997
548  274           2 0.2216086 0.40576274 0.1985819 0.17404670 0.19858193
549  275           1 0.3131574 0.00000000 0.6421202 0.04472236 0.31315740
550  275           2 0.5127985 0.00000000 0.4407759 0.04642562 0.44077587
551  276           1 0.5087353 0.13679896 0.2148790 0.13958681 0.50873526
552  276           2 0.2869621 0.37734727 0.2513860 0.08430462 0.37734727
553  277           1 0.3842822 0.21805084 0.2656446 0.13202244 0.21805084
554  277           2 0.4943480 0.09658745 0.2369658 0.17209874 0.23696578
555  278           1 0.6333551 0.25425860 0.0000000 0.11238629 0.63335510
556  278           2 0.7133825 0.21990926 0.0000000 0.06670829 0.21990926
557  279           1 0.6911619 0.00000000 0.3088381 0.00000000 0.69116193
558  279           2 0.5661771 0.00000000 0.4338229 0.00000000 0.43382293
559  280           1 0.5182483 0.33853715 0.0000000 0.14321452 0.51824832
560  280           2 0.7344258 0.16708715 0.0000000 0.09848709 0.73442576
561  281           1 0.7322435 0.00000000 0.1618345 0.10592199 0.73224354
562  281           2 0.4575766 0.00000000 0.4485242 0.09389912 0.44852424
563  282           1 0.2706557 0.17066990 0.5251865 0.03348788 0.52518652
564  282           2 0.2882492 0.10836239 0.5345844 0.06880400 0.53458444
565  283           1 0.2489481 0.20575211 0.4947719 0.05052789 0.49477186
566  283           2 0.4543870 0.11967110 0.3290791 0.09686283 0.45438700
567  284           1 0.0000000 0.25025259 0.6515422 0.09820524 0.09820524
568  284           2 0.0000000 0.32387837 0.6003730 0.07574865 0.32387837
569  285           1 0.4497339 0.15658802 0.2821068 0.11157134 0.44973388
570  285           2 0.2331737 0.52802718 0.2047759 0.03402327 0.52802718
571  286           1 0.0000000 0.00000000 0.6043068 0.39569323 0.39569323
572  286           2 0.0000000 0.00000000 0.5613548 0.43864519 0.43864519
573  287           1 0.2914659 0.16755933 0.4705558 0.07041894 0.07041894
574  287           2 0.3258139 0.27698187 0.3373684 0.05983583 0.32581386
575  288           1 0.0000000 0.00000000 0.7971041 0.20289589 0.79710411
576  288           2 0.0000000 0.00000000 0.8509861 0.14901388 0.14901388
577  289           1 0.4145601 0.35009893 0.2353409 0.00000000 0.35009893
578  289           2 0.2603593 0.28634495 0.4532957 0.00000000 0.28634495
579  290           1 0.0000000 0.14331763 0.6766411 0.18004131 0.67664106
580  290           2 0.0000000 0.21283022 0.4671014 0.32006833 0.46710145
581  291           1 0.6071303 0.14236307 0.1641530 0.08635364 0.60713029
582  291           2 0.3828084 0.22503364 0.2392200 0.15293796 0.38280841
583  292           1 0.5116131 0.30022677 0.0000000 0.18816011 0.51161312
584  292           2 0.6900444 0.21034472 0.0000000 0.09961093 0.69004435
585  293           1 0.5007569 0.36545647 0.0000000 0.13378663 0.36545647
586  293           2 0.5960636 0.16473309 0.0000000 0.23920327 0.23920327
587  294           1 0.0000000 0.00000000 0.8827293 0.11727068 0.88272932
588  294           2 0.0000000 0.00000000 0.8999241 0.10007588 0.89992412
589  295           1 0.4232530 0.00000000 0.4298097 0.14693728 0.42980974
590  295           2 0.4799440 0.00000000 0.3989627 0.12109328 0.39896270
591  296           1 0.6130066 0.00000000 0.3107215 0.07627188 0.61300659
592  296           2 0.5041785 0.00000000 0.4422244 0.05359702 0.50417854
593  297           1 0.0000000 0.00000000 0.8801863 0.11981365 0.88018635
594  297           2 0.0000000 0.00000000 0.7223770 0.27762300 0.27762300
595  298           1 0.0000000 0.00000000 0.6084462 0.39155376 0.39155376
596  298           2 0.0000000 0.00000000 0.8119999 0.18800014 0.18800014
597  299           1 0.7058420 0.00000000 0.0000000 0.29415800 0.29415800
598  299           2 0.8264414 0.00000000 0.0000000 0.17355857 0.82644143
599  300           1 0.0000000 0.40865906 0.4163334 0.17500758 0.17500758
600  300           2 0.0000000 0.16886830 0.4441869 0.38694481 0.16886830
601  301           1 0.6042926 0.18880605 0.1630031 0.04389821 0.60429264
602  301           2 0.4140569 0.10173573 0.4182722 0.06593519 0.41827222
603  302           1 0.0000000 0.83461558 0.0000000 0.16538442 0.83461558
604  302           2 0.0000000 0.95589073 0.0000000 0.04410927 0.95589073
605  303           1 0.3226745 0.44690841 0.1750828 0.05533433 0.32267451
606  303           2 0.3196582 0.44273071 0.2052026 0.03240858 0.31965815
607  304           1 0.4636103 0.08753235 0.2348914 0.21396591 0.46361032
608  304           2 0.2215574 0.39917904 0.1985622 0.18070130 0.22155744
609  305           1 0.0000000 0.23055537 0.4810481 0.28839650 0.48104813
610  305           2 0.0000000 0.59501903 0.2506059 0.15437509 0.15437509
611  306           1 0.5841565 0.00000000 0.3310004 0.08484318 0.58415646
612  306           2 0.4910149 0.00000000 0.4312769 0.07770825 0.49101488
613  307           1 0.3848578 0.26679648 0.2656076 0.08273809 0.38485784
614  307           2 0.3960653 0.24584926 0.2789772 0.07910825 0.27897720
615  308           1 0.4949426 0.07578204 0.3301661 0.09910931 0.33016608
616  308           2 0.2978229 0.13345563 0.4160701 0.15265136 0.41607011
617  309           1 0.3356293 0.38087174 0.1617869 0.12171211 0.38087174
618  309           2 0.4225244 0.24888989 0.2511230 0.07746277 0.24888989
619  310           1 0.4957389 0.13261768 0.2238867 0.14775670 0.22388671
620  310           2 0.2289184 0.23004484 0.3404161 0.20062067 0.22891838
621  311           1 0.5950593 0.11765012 0.1611137 0.12617690 0.59505931
622  311           2 0.4067749 0.06567646 0.4054067 0.12214192 0.40677490
623  312           1 0.8789916 0.00000000 0.0000000 0.12100841 0.87899159
624  312           2 0.9217267 0.00000000 0.0000000 0.07827335 0.92172665
625  313           1 0.0000000 0.52653849 0.3453502 0.12811128 0.52653849
626  313           2 0.0000000 0.13877762 0.5292380 0.33198438 0.52923800
627  314           1 0.3967926 0.12177716 0.3880643 0.09336595 0.38806429
628  314           2 0.4819283 0.10175313 0.2483763 0.16794228 0.10175313
629  315           1 0.2413136 0.23027200 0.4947653 0.03364916 0.49476528
630  315           2 0.5873833 0.18278272 0.1905696 0.03926435 0.58738332
631  316           1 0.3081231 0.26539079 0.2929071 0.13357908 0.26539079
632  316           2 0.2920784 0.32278411 0.2562317 0.12890584 0.25623167
633  317           1 0.4240379 0.14553275 0.3434188 0.08701055 0.14553275
634  317           2 0.4998948 0.23492346 0.1629374 0.10224436 0.10224436
635  318           1 0.3859120 0.00000000 0.4346943 0.17939370 0.38591199
636  318           2 0.5181093 0.00000000 0.1907872 0.29110351 0.51810933
637  319           1 0.0000000 0.56565846 0.2440388 0.19030269 0.24403885
638  319           2 0.0000000 0.32321476 0.4852115 0.19157377 0.48521148
639  320           1 0.5729870 0.06531841 0.2108503 0.15084428 0.21085033
640  320           2 0.2912385 0.10535333 0.5092516 0.09415661 0.29123845
641  321           1 0.3059791 0.14442482 0.3958790 0.15371702 0.30597912
642  321           2 0.2873601 0.34785013 0.2898205 0.07496921 0.28736012
643  322           1 0.3342672 0.34758517 0.2355296 0.08261805 0.34758517
644  322           2 0.2780721 0.07965519 0.5168565 0.12541621 0.27807205
645  323           1 0.3212720 0.63587051 0.0000000 0.04285750 0.63587051
646  323           2 0.4349894 0.50348895 0.0000000 0.06152167 0.43498938
647  324           1 0.0000000 0.17947879 0.6304735 0.19004776 0.17947879
648  324           2 0.0000000 0.52926012 0.2550510 0.21568892 0.25505096
649  325           1 0.0000000 0.00000000 0.6708002 0.32919984 0.67080016
650  325           2 0.0000000 0.00000000 0.8159236 0.18407637 0.81592363
651  326           1 0.4450492 0.00000000 0.5031489 0.05180187 0.44504920
652  326           2 0.3730262 0.00000000 0.5535338 0.07343999 0.55353377
653  327           1 0.3860456 0.23738341 0.2666884 0.10988264 0.26668839
654  327           2 0.2207346 0.46313443 0.2333555 0.08277541 0.46313443
655  328           1 0.2779539 0.39283405 0.2718203 0.05739177 0.27795392
656  328           2 0.3977793 0.12074739 0.4429122 0.03856112 0.39777930
657  329           1 0.4647336 0.19224456 0.2523654 0.09065645 0.46473359
658  329           2 0.3862926 0.25272869 0.2955237 0.06545505 0.38629259
659  330           1 0.1834691 0.19927187 0.5046488 0.11261021 0.50464883
660  330           2 0.2338305 0.26743658 0.3473535 0.15137943 0.34735346
661  331           1 0.5127295 0.00000000 0.3449167 0.14235384 0.51272947
662  331           2 0.4351487 0.00000000 0.4271849 0.13766642 0.43514871
663  332           1 0.0000000 0.23387404 0.7201392 0.04598680 0.72013916
664  332           2 0.0000000 0.78248896 0.1721789 0.04533210 0.78248896
665  333           1 0.6015959 0.22767556 0.0000000 0.17072853 0.17072853
666  333           2 0.4654998 0.40895202 0.0000000 0.12554814 0.40895202
667  334           1 0.3984452 0.12840734 0.3895251 0.08362236 0.38952506
668  334           2 0.3689292 0.40657023 0.1547284 0.06977215 0.40657023
669  335           1 0.5384146 0.00000000 0.3257527 0.13583266 0.13583266
670  335           2 0.4393655 0.00000000 0.3659496 0.19468491 0.36594957
671  336           1 0.0000000 0.57025587 0.3771505 0.05259358 0.37715055
672  336           2 0.0000000 0.53500796 0.4166811 0.04831091 0.53500796
673  337           1 0.4481835 0.24849244 0.2499919 0.05333215 0.24849244
674  337           2 0.3891895 0.14340149 0.4064827 0.06092623 0.38918953
675  338           1 0.5788936 0.00000000 0.3846136 0.03649274 0.57889365
676  338           2 0.5553773 0.00000000 0.3939825 0.05064027 0.39398245
677  339           1 0.4632209 0.22040608 0.2512565 0.06511648 0.46322093
678  339           2 0.3961905 0.33867435 0.2347564 0.03037876 0.23475643
679  340           1 0.5824071 0.15454759 0.2630454 0.00000000 0.58240706
680  340           2 0.3290583 0.09447203 0.5764697 0.00000000 0.32905828
681  341           1 0.6868924 0.00000000 0.1858899 0.12721766 0.68689243
682  341           2 0.4133125 0.00000000 0.4188863 0.16780118 0.41888628
683  342           1 0.4372550 0.45466725 0.0000000 0.10807771 0.43725504
684  342           2 0.5777317 0.17947979 0.0000000 0.24278847 0.24278847
685  343           1 0.2863972 0.00000000 0.5709856 0.14261727 0.28639716
686  343           2 0.2632780 0.00000000 0.5785692 0.15815285 0.57856916
687  344           1 0.2832124 0.20259842 0.3965439 0.11764529 0.28321238
688  344           2 0.4644085 0.08809754 0.2395563 0.20793763 0.23955634
689  345           1 0.5148381 0.00000000 0.3232127 0.16194926 0.51483806
690  345           2 0.6911228 0.00000000 0.2246967 0.08418054 0.22469668
691  346           1 0.2814909 0.06461865 0.6118066 0.04208388 0.61180661
692  346           2 0.4002847 0.14175523 0.3960776 0.06188240 0.40028474
693  347           1 0.2383469 0.18190680 0.4858200 0.09392623 0.48582003
694  347           2 0.4789525 0.16669344 0.1564949 0.19785914 0.16669344
695  348           1 0.5933010 0.00000000 0.2858759 0.12082313 0.59330096
696  348           2 0.3871117 0.00000000 0.5389501 0.07393821 0.53895009
697  349           1 0.5216158 0.00000000 0.2838954 0.19448875 0.28389543
698  349           2 0.3178132 0.00000000 0.5789732 0.10321355 0.57897321
699  350           1 0.0000000 0.13864283 0.6716596 0.18969757 0.67165960
700  350           2 0.0000000 0.20450041 0.4605377 0.33496190 0.20450041
701  351           1 0.3399462 0.33325690 0.2953473 0.03144963 0.33325690
702  351           2 0.4243581 0.12105203 0.4209688 0.03362116 0.42096876
703  352           1 0.3358048 0.19567430 0.3429649 0.12555607 0.34296485
704  352           2 0.4039593 0.09673947 0.3676796 0.13162159 0.36767962
705  353           1 0.3344460 0.00000000 0.6655540 0.00000000 0.33444603
706  353           2 0.5796555 0.00000000 0.4203445 0.00000000 0.57965545
707  354           1 0.8605665 0.00000000 0.0000000 0.13943348 0.86056652
708  354           2 0.8619131 0.00000000 0.0000000 0.13808687 0.86191313
709  355           1 0.3520054 0.31882541 0.3291691 0.00000000 0.32916915
710  355           2 0.2764668 0.52636173 0.1971715 0.00000000 0.52636173
711  356           1 0.5013394 0.12617412 0.2118697 0.16061678 0.50133942
712  356           2 0.2727297 0.28975267 0.3378599 0.09965770 0.33785995
713  357           1 0.3728967 0.06835852 0.2097933 0.34895152 0.37289666
714  357           2 0.2747157 0.14966954 0.3987168 0.17689800 0.27471570
715  358           1 0.4519439 0.29243367 0.2556225 0.00000000 0.45194386
716  358           2 0.5388722 0.32074422 0.1403836 0.00000000 0.53887222
717  359           1 0.5427470 0.00000000 0.2616204 0.19563257 0.19563257
718  359           2 0.5230172 0.00000000 0.2938146 0.18316817 0.52301721
719  360           1 0.6077660 0.09777200 0.2230200 0.07144196 0.60776601
720  360           2 0.2879775 0.15545827 0.5283610 0.02820325 0.52836095
721  361           1 0.4183041 0.13350674 0.3587352 0.08945396 0.35873518
722  361           2 0.3861502 0.25240992 0.2410992 0.12034063 0.38615024
723  362           1 0.3661485 0.56012390 0.0000000 0.07372765 0.56012390
724  362           2 0.6136760 0.16526524 0.0000000 0.22105879 0.16526524
725  363           1 0.0000000 0.61663380 0.3222815 0.06108472 0.61663380
726  363           2 0.0000000 0.63553810 0.3095981 0.05486375 0.63553810
727  364           1 0.4706011 0.09228395 0.2383596 0.19875535 0.47060114
728  364           2 0.3786847 0.36314219 0.1590004 0.09917262 0.15900045
729  365           1 0.2782581 0.27886804 0.3485684 0.09430547 0.27825810
730  365           2 0.3092417 0.29371571 0.2575847 0.13945788 0.29371571
731  366           1 0.5206273 0.19096619 0.2193448 0.06906170 0.19096619
732  366           2 0.3625757 0.40797648 0.1932670 0.03618083 0.40797648
733  367           1 0.4038899 0.10331753 0.3278878 0.16490479 0.40388991
734  367           2 0.3303753 0.23406876 0.3426013 0.09295464 0.33037528
735  368           1 0.4961502 0.11818299 0.2284427 0.15722414 0.15722414
736  368           2 0.3234427 0.35628407 0.1191458 0.20112746 0.32344267
737  369           1 0.3689520 0.29219512 0.2095597 0.12929319 0.12929319
738  369           2 0.3575012 0.11337226 0.4419357 0.08719082 0.44193571
739  370           1 0.3348685 0.45944248 0.1600710 0.04561804 0.45944248
740  370           2 0.3802510 0.15716409 0.3155082 0.14707668 0.38025101
741  371           1 0.0000000 0.27639619 0.0000000 0.72360381 0.27639619
742  371           2 0.0000000 0.38966519 0.0000000 0.61033481 0.38966519
743  372           1 0.2939545 0.13414025 0.5719052 0.00000000 0.57190521
744  372           2 0.3814788 0.43905934 0.1794619 0.00000000 0.17946188
745  373           1 0.0000000 0.61557787 0.2958377 0.08858444 0.61557787
746  373           2 0.0000000 0.31630000 0.4846499 0.19905011 0.48464988
747  374           1 0.1860340 0.66828710 0.1456789 0.00000000 0.18603401
748  374           2 0.3267149 0.53670750 0.1365776 0.00000000 0.53670750
749  375           1 0.0000000 0.45321671 0.0000000 0.54678329 0.54678329
750  375           2 0.0000000 0.73381896 0.0000000 0.26618104 0.73381896
751  376           1 0.4734830 0.00000000 0.4485823 0.07793473 0.44858232
752  376           2 0.6009374 0.00000000 0.2842570 0.11480563 0.60093740
753  377           1 0.3964666 0.09559106 0.3220170 0.18592533 0.32201699
754  377           2 0.5039511 0.10556459 0.2414316 0.14905274 0.50395106
755  378           1 0.5429165 0.09531967 0.3617638 0.00000000 0.36176381
756  378           2 0.4282541 0.09362056 0.4781253 0.00000000 0.42825415
757  379           1 0.3978515 0.31266875 0.2369885 0.05249124 0.31266875
758  379           2 0.3846321 0.26180472 0.2941582 0.05940505 0.38463205
759  380           1 0.0000000 0.68612355 0.0000000 0.31387645 0.31387645
760  380           2 0.0000000 0.79580492 0.0000000 0.20419508 0.79580492
761  381           1 0.6024325 0.07151841 0.1335136 0.19253554 0.19253554
762  381           2 0.3440361 0.15077286 0.2623490 0.24284208 0.24284208
763  382           1 0.3929904 0.45543681 0.0000000 0.15157278 0.45543681
764  382           2 0.5279853 0.10771682 0.0000000 0.36429786 0.36429786
765  383           1 0.2451485 0.23189144 0.4866833 0.03627676 0.48668330
766  383           2 0.3233393 0.43370511 0.2076200 0.03533561 0.32333929
767  384           1 0.0000000 0.37826292 0.6217371 0.00000000 0.37826292
768  384           2 0.0000000 0.15773044 0.8422696 0.00000000 0.84226956
769  385           1 0.5184734 0.00000000 0.3139592 0.16756736 0.16756736
770  385           2 0.5307218 0.00000000 0.2416964 0.22758183 0.53072177
771  386           1 0.2957863 0.37054397 0.2803203 0.05334941 0.37054397
772  386           2 0.2618323 0.36330129 0.3236535 0.05121284 0.36330129
773  387           1 0.4479898 0.00000000 0.2440759 0.30793427 0.24407594
774  387           2 0.3568481 0.00000000 0.5168416 0.12631024 0.35684815
775  388           1 0.6727972 0.15040472 0.1767981 0.00000000 0.67279718
776  388           2 0.5866487 0.26015343 0.1531979 0.00000000 0.15319789
777  389           1 0.5658374 0.00000000 0.3373585 0.09680401 0.33735855
778  389           2 0.5551537 0.00000000 0.3406723 0.10417399 0.34067227
779  390           1 0.3398507 0.44636088 0.1625105 0.05127799 0.16251046
780  390           2 0.2345869 0.46995840 0.2421428 0.05331189 0.46995840
781  391           1 0.4590197 0.00000000 0.4004679 0.14051241 0.40046790
782  391           2 0.4660958 0.00000000 0.2915350 0.24236921 0.46609581
783  392           1 0.3367819 0.20294011 0.3438686 0.11640936 0.33678194
784  392           2 0.2969031 0.36904337 0.2644295 0.06962406 0.26442947
785  393           1 0.3331465 0.30242131 0.3110276 0.05340459 0.31102762
786  393           2 0.4697977 0.16149815 0.2555832 0.11312093 0.11312093
787  394           1 0.0000000 0.21805161 0.6487745 0.13317389 0.21805161
788  394           2 0.0000000 0.21768255 0.4961152 0.28620222 0.49611523
789  395           1 0.2426855 0.22234937 0.4977436 0.03722149 0.49774361
790  395           2 0.5117810 0.17287447 0.2322816 0.08306285 0.23228165
791  396           1 0.3012586 0.34681459 0.2857036 0.06622322 0.34681459
792  396           2 0.2861923 0.41628286 0.2513897 0.04613514 0.41628286
793  397           1 0.5594698 0.00000000 0.3127769 0.12775329 0.55946983
794  397           2 0.5162349 0.00000000 0.3638133 0.11995176 0.51623491
795  398           1 0.0000000 0.11745453 0.8056024 0.07694309 0.80560238
796  398           2 0.0000000 0.59657744 0.2833542 0.12006837 0.28335419
797  399           1 0.3348825 0.38813330 0.1613991 0.11558507 0.33488255
798  399           2 0.4868994 0.08720105 0.2991294 0.12677008 0.08720105
799  400           1 0.3344679 0.09186513 0.4465538 0.12711320 0.44655382
800  400           2 0.3572787 0.11965863 0.2969570 0.22610567 0.29695704
801  401           1 0.3047476 0.14131097 0.3943429 0.15959857 0.30474758
802  401           2 0.3796708 0.21213622 0.2373578 0.17083518 0.23735776
803  402           1 0.3445722 0.43948542 0.1618963 0.05404609 0.34457218
804  402           2 0.3294124 0.44209412 0.1547736 0.07371988 0.32941244
805  403           1 0.0000000 0.00000000 0.9246486 0.07535140 0.92464860
806  403           2 0.0000000 0.00000000 0.6831058 0.31689424 0.68310576
807  404           1 0.4166475 0.00000000 0.5833525 0.00000000 0.58335249
808  404           2 0.4352323 0.00000000 0.5647677 0.00000000 0.56476767
809  405           1 0.4995071 0.14570407 0.2686531 0.08613578 0.14570407
810  405           2 0.5026160 0.13933359 0.2284905 0.12955994 0.50261596
811  406           1 0.5533720 0.00000000 0.4466280 0.00000000 0.44662797
812  406           2 0.5327904 0.00000000 0.4672096 0.00000000 0.53279036
813  407           1 0.4161951 0.00000000 0.2340653 0.34973969 0.23406526
814  407           2 0.4114332 0.00000000 0.4349510 0.15361573 0.43495103
815  408           1 0.5611723 0.16791282 0.2709148 0.00000000 0.27091484
816  408           2 0.3804439 0.47956720 0.1399889 0.00000000 0.47956720
817  409           1 0.4933187 0.18199403 0.2201070 0.10458029 0.22010700
818  409           2 0.3866969 0.25018512 0.2958599 0.06725809 0.38669686
819  410           1 0.2741539 0.13231071 0.4396508 0.15388463 0.27415390
820  410           2 0.2456339 0.41928252 0.2538776 0.08120596 0.41928252
821  411           1 0.3817815 0.28579285 0.3324257 0.00000000 0.38178149
822  411           2 0.4390251 0.32332789 0.2376470 0.00000000 0.43902506
823  412           1 0.3761682 0.15567382 0.4681580 0.00000000 0.46815801
824  412           2 0.3073371 0.41914800 0.2735149 0.00000000 0.27351489
825  413           1 0.3407122 0.28789698 0.1856178 0.18577307 0.18577307
826  413           2 0.4086072 0.09010072 0.2231017 0.27819041 0.22310166
827  414           1 0.3259797 0.12331577 0.5098909 0.04081362 0.32597974
828  414           2 0.1944062 0.58422045 0.1735023 0.04787113 0.04787113
829  415           1 0.3176359 0.26332645 0.2972441 0.12179355 0.31763586
830  415           2 0.3875427 0.21571433 0.3337925 0.06295043 0.21571433
831  416           1 0.0000000 0.00000000 0.8088401 0.19115986 0.19115986
832  416           2 0.0000000 0.00000000 0.8422797 0.15772029 0.84227971
833  417           1 0.4037804 0.08338627 0.2269476 0.28588564 0.08338627
834  417           2 0.3968285 0.23552093 0.2796172 0.08803344 0.27961718
835  418           1 0.3796053 0.47711429 0.0000000 0.14328045 0.14328045
836  418           2 0.6608419 0.21476362 0.0000000 0.12439450 0.21476362
837  419           1 0.0000000 0.00000000 0.7024973 0.29750267 0.70249733
838  419           2 0.0000000 0.00000000 0.9212206 0.07877935 0.92122065
839  420           1 0.0000000 0.35313981 0.4690886 0.17777156 0.46908863
840  420           2 0.0000000 0.15121901 0.7201442 0.12863675 0.72014424
841  421           1 0.3147967 0.19230467 0.4064301 0.08646856 0.31479671
842  421           2 0.3893233 0.31561796 0.2105780 0.08448076 0.21057795
843  422           1 0.0000000 0.65319186 0.2525327 0.09427548 0.65319186
844  422           2 0.0000000 0.11822752 0.7264103 0.15536222 0.15536222
845  423           1 0.0000000 0.42085267 0.2795134 0.29963394 0.42085267
846  423           2 0.0000000 0.43993591 0.3439713 0.21609277 0.34397132
847  424           1 0.5710780 0.32321392 0.0000000 0.10570809 0.32321392
848  424           2 0.2540268 0.65713040 0.0000000 0.08884284 0.65713040
849  425           1 0.2743740 0.31428541 0.3433279 0.06801264 0.34332790
850  425           2 0.3079330 0.33428394 0.2562147 0.10156841 0.33428394
851  426           1 0.5800340 0.17520456 0.2447614 0.00000000 0.58003402
852  426           2 0.4002651 0.24050563 0.3592293 0.00000000 0.40026512
853  427           1 0.4112866 0.08774242 0.2311051 0.26986589 0.26986589
854  427           2 0.3837229 0.11277110 0.4015143 0.10199177 0.40151428
855  428           1 0.2710333 0.00000000 0.6779544 0.05101225 0.27103331
856  428           2 0.4035315 0.00000000 0.4753564 0.12111207 0.47535641
857  429           1 0.2465036 0.10843143 0.5413550 0.10371001 0.54135496
858  429           2 0.2473076 0.20735683 0.4507868 0.09454877 0.45078681
859  430           1 0.2421145 0.00000000 0.6648703 0.09301523 0.24211446
860  430           2 0.3323106 0.00000000 0.6108864 0.05680295 0.61088644
861  431           1 0.4111065 0.13639114 0.2723783 0.18012407 0.27237831
862  431           2 0.3606979 0.18899014 0.3538885 0.09642343 0.35388852
863  432           1 0.0000000 0.00000000 0.7650120 0.23498796 0.76501204
864  432           2 0.0000000 0.00000000 0.7104243 0.28957572 0.28957572
865  433           1 0.4556870 0.00000000 0.4261469 0.11816611 0.42614690
866  433           2 0.5569048 0.00000000 0.3316045 0.11149066 0.11149066
867  434           1 0.3165719 0.38993975 0.2542369 0.03925139 0.31657195
868  434           2 0.2205609 0.28320639 0.4550026 0.04123007 0.28320639
869  435           1 0.0000000 0.25593154 0.5265367 0.21753177 0.52653670
870  435           2 0.0000000 0.20314559 0.4982153 0.29863914 0.49821528
871  436           1 0.8792294 0.00000000 0.0000000 0.12077059 0.87922941
872  436           2 0.8599051 0.00000000 0.0000000 0.14009492 0.85990508
873  437           1 0.0000000 0.28047259 0.0000000 0.71952741 0.71952741
874  437           2 0.0000000 0.61038859 0.0000000 0.38961141 0.61038859
875  438           1 0.0000000 0.38247161 0.4096647 0.20786365 0.40966474
876  438           2 0.0000000 0.21433520 0.5609929 0.22467193 0.22467193
877  439           1 0.5702482 0.00000000 0.3398908 0.08986108 0.33989076
878  439           2 0.3330105 0.00000000 0.5786862 0.08830328 0.33301051
879  440           1 0.0000000 0.64891898 0.0000000 0.35108102 0.64891898
880  440           2 0.0000000 0.90481217 0.0000000 0.09518783 0.90481217
881  441           1 0.3485814 0.30679522 0.3031164 0.04150694 0.30679522
882  441           2 0.4141422 0.10213768 0.4183457 0.06537439 0.41414224
883  442           1 0.4448838 0.00000000 0.5551162 0.00000000 0.55511618
884  442           2 0.5284678 0.00000000 0.4715322 0.00000000 0.47153220
885  443           1 0.4761246 0.19239609 0.2155775 0.11590189 0.21557745
886  443           2 0.4310383 0.11075409 0.2856937 0.17251393 0.43103831
887  444           1 0.3276747 0.35345821 0.2634389 0.05542820 0.26343890
888  444           2 0.3887048 0.16025739 0.2504744 0.20056348 0.16025739
889  445           1 0.2741530 0.31568007 0.3430366 0.06713033 0.27415298
890  445           2 0.4506386 0.13360224 0.2878708 0.12788837 0.45063860
891  446           1 0.0000000 0.24303149 0.4498420 0.30712655 0.44984196
892  446           2 0.0000000 0.30290272 0.4941751 0.20292217 0.20292217
893  447           1 0.3460140 0.09069194 0.1888159 0.37447814 0.18881590
894  447           2 0.3969659 0.22245246 0.2798453 0.10073634 0.39696590
895  448           1 0.6240737 0.21173709 0.0000000 0.16418918 0.21173709
896  448           2 0.5378927 0.32937948 0.0000000 0.13272781 0.53789271
897  449           1 0.3885204 0.34055503 0.2312239 0.03970068 0.23122391
898  449           2 0.3783737 0.28725199 0.2891140 0.04526028 0.37837374
899  450           1 0.0000000 0.31817732 0.4638380 0.21798471 0.31817732
900  450           2 0.0000000 0.13542609 0.7077897 0.15678417 0.70778975
901  451           1 0.0000000 0.43805605 0.5619440 0.00000000 0.56194395
902  451           2 0.0000000 0.54980044 0.4501996 0.00000000 0.45019956
903  452           1 0.3348076 0.19001269 0.3420202 0.13315948 0.34202019
904  452           2 0.2774504 0.07867915 0.5157436 0.12812691 0.27745038
905  453           1 0.0000000 0.49562084 0.4022827 0.10209642 0.10209642
906  453           2 0.0000000 0.23829718 0.4537022 0.30800060 0.23829718
907  454           1 0.4001406 0.14226558 0.3908686 0.06672521 0.14226558
908  454           2 0.3803211 0.14729091 0.2451973 0.22719067 0.38032107
909  455           1 0.4036711 0.52047624 0.0000000 0.07585270 0.40367106
910  455           2 0.4783348 0.39978712 0.0000000 0.12187805 0.39978712
911  456           1 0.5774176 0.12052233 0.1985433 0.10351682 0.19854328
912  456           2 0.2905774 0.34949646 0.2547386 0.10518758 0.25473861
913  457           1 0.3928124 0.33655888 0.2706287 0.00000000 0.33655888
914  457           2 0.3361214 0.31612432 0.3477543 0.00000000 0.34775432
915  458           1 0.6050226 0.00000000 0.0000000 0.39497742 0.60502258
916  458           2 0.7243601 0.00000000 0.0000000 0.27563990 0.72436010
917  459           1 0.3689577 0.29907423 0.2095231 0.12244497 0.20952310
918  459           2 0.4382919 0.13043334 0.2463786 0.18489612 0.43829193
919  460           1 0.5925557 0.00000000 0.2836713 0.12377303 0.28367126
920  460           2 0.4125331 0.00000000 0.3428048 0.24466213 0.34280481
921  461           1 0.0000000 0.49218276 0.5078172 0.00000000 0.49218276
922  461           2 0.0000000 0.58101822 0.4189818 0.00000000 0.41898178
923  462           1 0.3639960 0.36323193 0.1713657 0.10140635 0.10140635
924  462           2 0.5181766 0.13370029 0.2376164 0.11050665 0.23761642
925  463           1 0.2498400 0.15884601 0.4976095 0.09370453 0.24983995
926  463           2 0.4205781 0.07693305 0.3962788 0.10621011 0.39627877
927  464           1 0.2847092 0.13574278 0.5008140 0.07873398 0.50081405
928  464           2 0.3663366 0.13031663 0.2363454 0.26700133 0.26700133
929  465           1 0.0000000 0.27396500 0.5024829 0.22355213 0.27396500
930  465           2 0.0000000 0.38348501 0.5364223 0.08009271 0.38348501
931  466           1 0.6484399 0.17489177 0.0000000 0.17666835 0.17666835
932  466           2 0.5735510 0.23569063 0.0000000 0.19075840 0.57355097
933  467           1 0.4253686 0.16106952 0.3442200 0.06934191 0.42536860
934  467           2 0.1835871 0.59848574 0.1933866 0.02454060 0.59848574
935  468           1 0.3106890 0.33920022 0.3501108 0.00000000 0.31068900
936  468           2 0.4108452 0.37649155 0.2126633 0.00000000 0.41084518
937  469           1 0.2959308 0.00000000 0.6480930 0.05597618 0.64809303
938  469           2 0.5657362 0.00000000 0.3172294 0.11703438 0.31722943
939  470           1 0.0000000 0.22137631 0.6269877 0.15163601 0.62698768
940  470           2 0.0000000 0.16922393 0.7551043 0.07567177 0.75510430
941  471           1 0.6073362 0.14322677 0.1642010 0.08523606 0.14322677
942  471           2 0.3991049 0.07401624 0.4040957 0.12278322 0.40409566
943  472           1 0.0000000 0.00000000 0.8665025 0.13349747 0.86650253
944  472           2 0.0000000 0.00000000 0.8736310 0.12636897 0.87363103
945  473           1 0.4853522 0.00000000 0.3820491 0.13259865 0.48535221
946  473           2 0.2788691 0.00000000 0.6119172 0.10921370 0.27886906
947  474           1 0.8615520 0.00000000 0.0000000 0.13844799 0.86155201
948  474           2 0.7576781 0.00000000 0.0000000 0.24232190 0.75767810
949  475           1 0.0000000 0.17223916 0.4318159 0.39594499 0.39594499
950  475           2 0.0000000 0.28567864 0.5462315 0.16808989 0.54623146
951  476           1 0.3508892 0.21683315 0.3965129 0.03576473 0.21683315
952  476           2 0.3595225 0.41510250 0.1915992 0.03377574 0.35952252
953  477           1 0.4905170 0.00000000 0.3974078 0.11207522 0.39740780
954  477           2 0.7232821 0.00000000 0.2058726 0.07084532 0.20587262
955  478           1 0.5328226 0.21053238 0.2566450 0.00000000 0.53282265
956  478           2 0.3433498 0.47953486 0.1771153 0.00000000 0.47953486
957  479           1 0.6441390 0.00000000 0.0000000 0.35586103 0.35586103
958  479           2 0.7596839 0.00000000 0.0000000 0.24031615 0.75968385
959  480           1 0.0000000 0.44841016 0.4325804 0.11900943 0.11900943
960  480           2 0.0000000 0.22925612 0.4786140 0.29212987 0.29212987
961  481           1 0.1847509 0.41974407 0.3170909 0.07841412 0.18475090
962  481           2 0.4108839 0.06963471 0.4093398 0.11014164 0.41088389
963  482           1 0.5817685 0.31663723 0.0000000 0.10159423 0.58176854
964  482           2 0.3942701 0.52812031 0.0000000 0.07760954 0.52812031
965  483           1 0.0000000 0.95007333 0.0000000 0.04992667 0.95007333
966  483           2 0.0000000 0.62548268 0.0000000 0.37451732 0.62548268
967  484           1 0.3392885 0.26489942 0.2734973 0.12231476 0.26489942
968  484           2 0.4275054 0.06647585 0.2724585 0.23356024 0.27245852
969  485           1 0.3163262 0.24428351 0.2961902 0.14320011 0.31632622
970  485           2 0.5903667 0.13196239 0.1920559 0.08561499 0.59036668
971  486           1 0.5188432 0.16214943 0.2188793 0.10012806 0.21887934
972  486           2 0.2648301 0.34938421 0.3274940 0.05829166 0.34938421
973  487           1 0.0000000 0.00000000 0.8022389 0.19776106 0.80223894
974  487           2 0.0000000 0.00000000 0.7423857 0.25761429 0.74238571
975  488           1 0.2423733 0.08273602 0.6071037 0.06778702 0.60710369
976  488           2 0.3582718 0.36464853 0.1852911 0.09178851 0.35827185
977  489           1 0.5766050 0.00000000 0.2775973 0.14579767 0.57660499
978  489           2 0.4222753 0.00000000 0.5209251 0.05679965 0.42227526
979  490           1 0.0000000 0.35661746 0.4693165 0.17406599 0.35661746
980  490           2 0.0000000 0.24140474 0.4859538 0.27264146 0.24140474
981  491           1 0.4205466 0.15340761 0.3602649 0.06578082 0.15340761
982  491           2 0.3886209 0.31975521 0.2101726 0.08145127 0.38862094
983  492           1 0.3123412 0.42749727 0.2195867 0.04057483 0.31234121
984  492           2 0.2790179 0.43429209 0.2480442 0.03864576 0.43429209
985  493           1 0.3377988 0.27211837 0.1841024 0.20598042 0.27211837
986  493           2 0.3557628 0.28658956 0.2293931 0.12825450 0.35576285
987  494           1 0.6634010 0.20869044 0.0000000 0.12790856 0.66340100
988  494           2 0.6777986 0.14407880 0.0000000 0.17812256 0.67779863
989  495           1 0.4061575 0.00000000 0.5079487 0.08589379 0.50794869
990  495           2 0.5309039 0.00000000 0.3389713 0.13012479 0.53090389
991  496           1 0.2769938 0.05122704 0.6030964 0.06868275 0.60309641
992  496           2 0.3947974 0.11263671 0.3913384 0.10122751 0.11263671
993  497           1 0.3705308 0.32994202 0.2551973 0.04432984 0.37053079
994  497           2 0.5335482 0.27070960 0.1517758 0.04396642 0.53354817
995  498           1 0.2903863 0.30170572 0.2846930 0.12321495 0.12321495
996  498           2 0.3939128 0.08790362 0.4397109 0.07847261 0.43971093
997  499           1 0.4527000 0.11504242 0.2025999 0.22965761 0.45270002
998  499           2 0.3207987 0.20007372 0.3481664 0.13096119 0.20007372
999  500           1 0.4725141 0.00000000 0.3716577 0.15582818 0.47251407
1000 500           2 0.3068478 0.00000000 0.5373912 0.15576101 0.53739118
```
:::
:::


### TODO
-->
</section></section>
<section>
<section id="nested-logit-model" class="title-slide slide level1 center">
<h1>Nested logit model</h1>

</section>
<section id="motivation" class="slide level2">
<h2>Motivation</h2>
<ul>
<li>The independence of irrelevant alternatives property of MNL derives from the assumed error distribution
<ul>
<li>Which is also how the probability function is derived</li>
</ul></li>
<li>Nested logit allows correlation within “nests” of alternatives</li>
<li>Often used in mode choice or joint choice</li>
</ul>
</section>
<section id="model-form" class="slide level2">
<h2>Model form</h2>
<div class="cell" data-reveal="true">
<div class="cell-output-display">
<div>
<p>
</p><pre class="mermaid" data-tooltip-selector="#mermaid-tooltip-1">flowchart LR
    mc[Mode choice]
    car[Car]
    air[Air]
    bus[Bus]
    train[Train]

    mc --&gt; car
    mc --&gt; air
    mc --&gt; bus
    mc --&gt; train

</pre>
<div id="mermaid-tooltip-1" class="mermaidTooltip">

</div>
<p></p>
</div>
</div>
</div>
</section>
<section id="model-form-1" class="slide level2">
<h2>Model form</h2>
<div class="cell" data-reveal="true">
<div class="cell-output-display">
<div>
<p>
</p><pre class="mermaid" data-tooltip-selector="#mermaid-tooltip-2">flowchart LR
    mc[Mode choice]
    car[Car]
    air[Air]
    transit[Transit]
    bus[Bus]
    train[Train]

    mc --&gt; car
    mc --&gt; air
    mc --&gt; transit
    transit --&gt; bus
    transit --&gt; train
</pre>
<div id="mermaid-tooltip-2" class="mermaidTooltip">

</div>
<p></p>
</div>
</div>
</div>
</section>
<section id="model-form-2" class="slide level2">
<h2>Model form</h2>
<ul>
<li>Often used to represent hierarchical or joint choice</li>
<li>Used when there are <em>shared unobserved attributes</em> between alternatives
<ul>
<li>In the red bus/blue bus problem, attributes of the bus</li>
</ul></li>
<li>Does not have to, just represents correlation in error term between alternatives</li>
</ul>
</section>
<section id="nested-logit-the-math" class="slide level2">
<h2>Nested logit: the math</h2>
<p><span class="math display">\[
U_i = \alpha_i + \beta_{ix} x_i + \cdots + \epsilon_{nest} + \epsilon_{i}
\]</span></p>
<ul>
<li><span class="math inline">\(\epsilon_{nest}\)</span> allows correlation of error terms at the nest level</li>
</ul>
</section>
<section id="why-do-correlated-error-terms-solve-the-red-busblue-bus-problem" class="slide level2">
<h2>Why do correlated error terms solve the red bus/blue bus problem?</h2>
<ul>
<li>Easier to reason through than to do the math</li>
<li>Definition of a random-utility model is that whatever alternative has the highest utility is chosen</li>
<li>Utility has a random component <span class="math inline">\(\epsilon\)</span>, so whether an alternative has highest utility is probabilistic</li>
</ul>
</section>
<section id="why-do-correlated-error-terms-solve-the-red-busblue-bus-problem-1" class="slide level2">
<h2>Why do correlated error terms solve the red bus/blue bus problem?</h2>
<ul>
<li>Suppose we are modeling the probability of auto vs.&nbsp;red bus vs.&nbsp;blue bus, and the systematic utilities are all 0</li>
<li>So whichever alternative has the highest random error will be chosen</li>
<li>Suppose we draw the error terms at random from a hat containing numbers 1–10</li>
<li>The probability that any one error term is the largest is 1/3</li>
</ul>
</section>
<section id="why-do-correlated-error-terms-solve-the-red-busblue-bus-problem-2" class="slide level2">
<h2>Why do correlated error terms solve the red bus/blue bus problem?</h2>
<ul>
<li>But suppose we think that the unobserved attributes of the red bus and blue bus are the same</li>
<li>Then we will draw one number for cars, and the <em>same number twice</em> for the red and blue buses</li>
<li>Since the error terms for the buses are the same, there is now a 50% chance that car will have highest utility, and 50% that the buses will</li>
</ul>
</section>
<section id="nested-logit-additional-parameters" class="slide level2">
<h2>Nested logit: additional parameters</h2>
<ul>
<li>The nested logit adds one additional parameter per nest, the <em>inclusive value</em> parameter</li>
<li>Also called <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\frac{\mu_m}{\mu_d}\)</span>, <span class="math inline">\(\frac{1}{\mu_d}\)</span>, logsum parameter</li>
<li>Inclusive value parameters define how much correlation there is in the alternatives within a nest</li>
</ul>
</section>
<section id="nested-logit-interpreting-the-inclusive-value-parameter" class="slide level2">
<h2>Nested logit: interpreting the inclusive value parameter</h2>
<ul>
<li>Inclusive value parameters <em>should</em> be between 0 and 1 to align with utility theory</li>
<li>Larger inclusive value parameters mean <em>less</em> correlation between alternatives in that nest</li>
<li>Inclusive value parameters of 1—same as multinomial logit</li>
</ul>
</section>
<section id="nested-logit-caution" class="slide level2">
<h2>Nested logit: caution</h2>
<ul>
<li>In order to interpret coefficients from different nests relative to each other, you must use a random utility nested logit model (RUMNL)</li>
<li>These normalize the coefficients in each nest to be comparable to each other, by dividing by the inclusive value parameter</li>
<li>Non-normalized nested logit (NNNL) does not perform this normalization</li>
<li>RUMNL is default in Apollo, NNNL is default in Stata</li>
</ul>
</section>
<section id="nested-logit-caution-1" class="slide level2">
<h2>Nested logit: caution</h2>
<ul>
<li>Nested logit inclusive value parameters should be tested with a null hypothesis that they are 1, not 0</li>
<li>Many statistical packages (including Apollo) don’t do this</li>
<li>Thus, t-values and p-values will be incorrect</li>
</ul>
</section>
<section id="nested-logit-in-r" class="slide level2">
<h2>Nested logit in R</h2>
<div class="cell" data-filename="nested-logit-mode-choice.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-58_18d777832d2a2477f65b235131b545c3">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="fu">library</span>(apollo)</span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb61-3"><a href="#cb61-3"></a></span>
<span id="cb61-4"><a href="#cb61-4"></a>database <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"data/modechoice_apollo.csv"</span>)</span>
<span id="cb61-5"><a href="#cb61-5"></a></span>
<span id="cb61-6"><a href="#cb61-6"></a><span class="fu">apollo_initialise</span>()</span>
<span id="cb61-7"><a href="#cb61-7"></a></span>
<span id="cb61-8"><a href="#cb61-8"></a>apollo_control <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb61-9"><a href="#cb61-9"></a>    <span class="at">modelName =</span> <span class="st">"Nested_Mode_Choice"</span>,</span>
<span id="cb61-10"><a href="#cb61-10"></a>    <span class="at">indivID=</span><span class="st">"ID"</span></span>
<span id="cb61-11"><a href="#cb61-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nested-logit-mode-choice.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-59_a8eddb70fb82aac7ad0d42b97705b1ef">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>apollo_beta <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb62-2"><a href="#cb62-2"></a>    <span class="at">asc_air =</span> <span class="dv">0</span>,</span>
<span id="cb62-3"><a href="#cb62-3"></a>    <span class="at">asc_bus =</span> <span class="dv">0</span>,</span>
<span id="cb62-4"><a href="#cb62-4"></a>    <span class="at">asc_rail =</span> <span class="dv">0</span>,</span>
<span id="cb62-5"><a href="#cb62-5"></a>    <span class="co"># leaving out an asc_car as base category</span></span>
<span id="cb62-6"><a href="#cb62-6"></a>    <span class="at">b_cost =</span> <span class="dv">0</span>,</span>
<span id="cb62-7"><a href="#cb62-7"></a>    <span class="at">b_access_time =</span> <span class="dv">0</span>,</span>
<span id="cb62-8"><a href="#cb62-8"></a>    <span class="at">b_in_vehicle_time =</span> <span class="dv">0</span>,</span>
<span id="cb62-9"><a href="#cb62-9"></a>    <span class="co"># income and party_size are individual level variable, so</span></span>
<span id="cb62-10"><a href="#cb62-10"></a>    <span class="co"># must be different for different alternatives</span></span>
<span id="cb62-11"><a href="#cb62-11"></a>    <span class="at">b_income_air =</span> <span class="dv">0</span>,</span>
<span id="cb62-12"><a href="#cb62-12"></a>    <span class="at">b_income_bus =</span> <span class="dv">0</span>,</span>
<span id="cb62-13"><a href="#cb62-13"></a>    <span class="at">b_income_rail =</span> <span class="dv">0</span>,</span>
<span id="cb62-14"><a href="#cb62-14"></a>    <span class="co"># This is the "nesting parameter" which captures how much variation</span></span>
<span id="cb62-15"><a href="#cb62-15"></a>    <span class="co"># occurs at each level</span></span>
<span id="cb62-16"><a href="#cb62-16"></a>    <span class="at">lambda_transit =</span> <span class="dv">1</span></span>
<span id="cb62-17"><a href="#cb62-17"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nested-logit-mode-choice.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-60_56e5146bbd0f1f282609b26f0a22f072">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>apollo_fixed <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb63-2"><a href="#cb63-2"></a>apollo_inputs <span class="ot">=</span> <span class="fu">apollo_validateInputs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Several observations per individual detected based on the value of ID.
  Setting panelData in apollo_control set to TRUE.
All checks on apollo_control completed.
All checks on database completed.</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nested-logit-mode-choice.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-61_7ff5f5c240cdc6ea2887f7889b334a7a">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>apollo_probabilities <span class="ot">=</span> <span class="cf">function</span>(apollo_beta, apollo_inputs,</span>
<span id="cb65-2"><a href="#cb65-2"></a>        <span class="at">functionality=</span><span class="st">"estimate"</span>) {</span>
<span id="cb65-3"><a href="#cb65-3"></a>    <span class="fu">apollo_attach</span>(apollo_beta, apollo_inputs)</span>
<span id="cb65-4"><a href="#cb65-4"></a>    <span class="fu">on.exit</span>(<span class="fu">apollo_detach</span>(apollo_beta, apollo_inputs))</span>
<span id="cb65-5"><a href="#cb65-5"></a></span>
<span id="cb65-6"><a href="#cb65-6"></a>    P <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb65-7"><a href="#cb65-7"></a></span>
<span id="cb65-8"><a href="#cb65-8"></a>    <span class="co"># define utility functions</span></span>
<span id="cb65-9"><a href="#cb65-9"></a>    V <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb65-10"><a href="#cb65-10"></a>    <span class="co"># We can include cost and in-vehicle time here because they vary over</span></span>
<span id="cb65-11"><a href="#cb65-11"></a>    <span class="co"># alternatives</span></span>
<span id="cb65-12"><a href="#cb65-12"></a>    V[[<span class="st">"car"</span>]] <span class="ot">=</span> b_cost <span class="sc">*</span> cost_car <span class="sc">+</span></span>
<span id="cb65-13"><a href="#cb65-13"></a>        b_in_vehicle_time <span class="sc">*</span> time_car</span>
<span id="cb65-14"><a href="#cb65-14"></a></span>
<span id="cb65-15"><a href="#cb65-15"></a>    V[[<span class="st">"air"</span>]] <span class="ot">=</span> asc_air <span class="sc">+</span></span>
<span id="cb65-16"><a href="#cb65-16"></a>        b_cost <span class="sc">*</span> cost_air <span class="sc">+</span></span>
<span id="cb65-17"><a href="#cb65-17"></a>        b_in_vehicle_time <span class="sc">*</span> time_air <span class="sc">+</span></span>
<span id="cb65-18"><a href="#cb65-18"></a>        b_access_time <span class="sc">*</span> access_air <span class="sc">+</span></span>
<span id="cb65-19"><a href="#cb65-19"></a>        b_income_air <span class="sc">*</span> income</span>
<span id="cb65-20"><a href="#cb65-20"></a></span>
<span id="cb65-21"><a href="#cb65-21"></a>    V[[<span class="st">"rail"</span>]] <span class="ot">=</span> asc_rail <span class="sc">+</span></span>
<span id="cb65-22"><a href="#cb65-22"></a>        b_cost <span class="sc">*</span> cost_rail <span class="sc">+</span></span>
<span id="cb65-23"><a href="#cb65-23"></a>        b_in_vehicle_time <span class="sc">*</span> time_rail <span class="sc">+</span></span>
<span id="cb65-24"><a href="#cb65-24"></a>        b_access_time <span class="sc">*</span> access_rail <span class="sc">+</span></span>
<span id="cb65-25"><a href="#cb65-25"></a>        b_income_rail <span class="sc">*</span> income</span>
<span id="cb65-26"><a href="#cb65-26"></a></span>
<span id="cb65-27"><a href="#cb65-27"></a>    V[[<span class="st">"bus"</span>]] <span class="ot">=</span> asc_bus <span class="sc">+</span></span>
<span id="cb65-28"><a href="#cb65-28"></a>        b_cost <span class="sc">*</span> cost_bus <span class="sc">+</span></span>
<span id="cb65-29"><a href="#cb65-29"></a>        b_in_vehicle_time <span class="sc">*</span> time_bus <span class="sc">+</span></span>
<span id="cb65-30"><a href="#cb65-30"></a>        b_access_time <span class="sc">*</span> access_bus <span class="sc">+</span></span>
<span id="cb65-31"><a href="#cb65-31"></a>        b_income_bus <span class="sc">*</span> income</span>
<span id="cb65-32"><a href="#cb65-32"></a></span>
<span id="cb65-33"><a href="#cb65-33"></a>    <span class="do">## Now, we specify the nesting structure. First, we tell Apollo what</span></span>
<span id="cb65-34"><a href="#cb65-34"></a>    <span class="do">## nests we are using and their inclusive value parameters.</span></span>
<span id="cb65-35"><a href="#cb65-35"></a>    nlNests <span class="ot">=</span> <span class="fu">c</span>(<span class="at">root=</span><span class="dv">1</span>, <span class="at">transit=</span>lambda_transit)</span>
<span id="cb65-36"><a href="#cb65-36"></a></span>
<span id="cb65-37"><a href="#cb65-37"></a>    nlStructure <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb65-38"><a href="#cb65-38"></a>        <span class="at">root=</span><span class="fu">c</span>(<span class="st">"car"</span>, <span class="st">"transit"</span>),</span>
<span id="cb65-39"><a href="#cb65-39"></a>        <span class="at">transit=</span><span class="fu">c</span>(<span class="st">"rail"</span>, <span class="st">"bus"</span>, <span class="st">"air"</span>)</span>
<span id="cb65-40"><a href="#cb65-40"></a>    )</span>
<span id="cb65-41"><a href="#cb65-41"></a></span>
<span id="cb65-42"><a href="#cb65-42"></a>    nl_settings <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb65-43"><a href="#cb65-43"></a>        <span class="at">alternatives =</span> <span class="fu">c</span>(<span class="at">car=</span><span class="dv">1</span>, <span class="at">air=</span><span class="dv">3</span>, <span class="at">rail=</span><span class="dv">4</span>, <span class="at">bus=</span><span class="dv">2</span>),</span>
<span id="cb65-44"><a href="#cb65-44"></a>        <span class="at">avail =</span> <span class="fu">list</span>(<span class="at">car=</span>av_car, <span class="at">air=</span>av_air, <span class="at">rail=</span>av_rail, <span class="at">bus=</span>av_bus),</span>
<span id="cb65-45"><a href="#cb65-45"></a>        <span class="at">choiceVar =</span> choice,</span>
<span id="cb65-46"><a href="#cb65-46"></a>        <span class="at">utilities =</span> V,</span>
<span id="cb65-47"><a href="#cb65-47"></a>        <span class="at">nlNests =</span> nlNests,</span>
<span id="cb65-48"><a href="#cb65-48"></a>        <span class="at">nlStructure =</span> nlStructure</span>
<span id="cb65-49"><a href="#cb65-49"></a>    )</span>
<span id="cb65-50"><a href="#cb65-50"></a></span>
<span id="cb65-51"><a href="#cb65-51"></a>    P[[<span class="st">"model"</span>]] <span class="ot">=</span> <span class="fu">apollo_nl</span>(nl_settings, functionality)</span>
<span id="cb65-52"><a href="#cb65-52"></a></span>
<span id="cb65-53"><a href="#cb65-53"></a>    <span class="co"># For panel data, this multiplies observations for single individuals</span></span>
<span id="cb65-54"><a href="#cb65-54"></a>    <span class="co"># together - no effect in multinomial logit but still required.</span></span>
<span id="cb65-55"><a href="#cb65-55"></a>    P <span class="ot">=</span> <span class="fu">apollo_panelProd</span>(P, apollo_inputs, functionality)</span>
<span id="cb65-56"><a href="#cb65-56"></a>    P <span class="ot">=</span> <span class="fu">apollo_prepareProb</span>(P, apollo_inputs, functionality)</span>
<span id="cb65-57"><a href="#cb65-57"></a>    <span class="fu">return</span>(P)</span>
<span id="cb65-58"><a href="#cb65-58"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-filename="nested-logit-mode-choice.R" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-62_555d7408c539e9f60c93c976375a3dc6">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>model <span class="ot">=</span> <span class="fu">apollo_estimate</span>(apollo_beta, apollo_fixed, apollo_probabilities, apollo_inputs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Preparing user-defined functions.
###############################################################################
The output of 'apollo_probabilities' has changed after the optimisation
  of the code carried out by Apollo. This indicates a problem, and the
  unoptimised and unscaled version will be used instead. Please contact
  the developers for assistance!
###############################################################################

Testing likelihood function...
Apollo found a model component of type NL without a componentName. The
  name was set to "NL" by default.

Overview of choices for NL model component NL:
                                    car    air   rail    bus
Times available                  778.00 752.00 874.00 902.00
Times chosen                     332.00 215.00 327.00 126.00
Percentage chosen overall         33.20  21.50  32.70  12.60
Percentage chosen when available  42.67  28.59  37.41  13.97

Nesting structure for NL model component NL:
Nest: root (1)
|----Alternative: car
'-Nest: transit (1)
   |-Alternative: rail
   |-Alternative: bus
   '-Alternative: air

Pre-processing likelihood function...

Testing influence of parameters..........
Starting main estimation
Initial function value: -1170.86 
Initial gradient value:
          asc_air           asc_bus          asc_rail            b_cost 
    -8.000001e+00     -1.536667e+02      5.966667e+01     -1.329167e+02 
    b_access_time b_in_vehicle_time      b_income_air      b_income_bus 
    -1.810417e+03     -1.898042e+04      3.114006e+05     -7.703172e+06 
    b_income_rail    lambda_transit 
     2.710651e+06     -9.000699e+01 
initial  value 1170.860076 
iter   2 value 1112.061643
iter   3 value 1098.117019
iter   4 value 1096.280213
iter   5 value 1088.844016
iter   6 value 1044.621361
iter   7 value 1043.544045
iter   8 value 1038.482398
iter   9 value 1027.377779
iter  10 value 1021.969637
iter  11 value 1020.575941
iter  12 value 1018.183515
iter  13 value 1017.447080
iter  14 value 1017.026693
iter  15 value 1016.519699
iter  16 value 1016.490275
iter  17 value 1016.454694
iter  18 value 1016.410877
iter  19 value 1016.401194
iter  20 value 1016.400942
iter  21 value 1016.400663
iter  21 value 1016.400660
iter  21 value 1016.400659
final  value 1016.400659 
converged
Estimated parameters:
                     Estimate
asc_air             -0.624118
asc_bus             -0.004930
asc_rail            -0.417880
b_cost              -0.022139
b_access_time       -0.004658
b_in_vehicle_time   -0.005133
b_income_air        6.077e-06
b_income_bus       -1.531e-05
b_income_rail      -8.683e-07
lambda_transit       0.600917

Computing covariance matrix using numerical methods (numDeriv).
 0%....25%....50%....75%....100%
Negative definite Hessian with maximum eigenvalue: -3.682404
Computing score matrix...
Nesting structure for NL model component NL:
Nest: root (1)
|----Alternative: car
'-Nest: transit (0.6009)
   |-Alternative: rail
   |-Alternative: bus
   '-Alternative: air

Calculating LL(0) for applicable models...
Calculating LL(c) for applicable models...
Calculating LL of each model component...</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="cell" data-hash="discrete-choice_cache/revealjs/unnamed-chunk-63_7d8ca275a560ec269151df8e8682d91c">
<div class="cell-output cell-output-stdout">
<pre><code>Model run by mwbc using Apollo 0.2.7 on R 4.2.1 for Darwin.
www.ApolloChoiceModelling.com

Model name                       : Nested_Mode_Choice
Model description                : No model description provided in apollo_control
Model run at                     : 2022-08-09 22:22:25
Estimation method                : bfgs
Model diagnosis                  : successful convergence 
Number of individuals            : 500
Number of rows in database       : 1000
Number of modelled outcomes      : 1000

Number of cores used             :  1 
Model without mixing

LL(start)                        : -1170.86
LL(0)                            : -1170.86
LL(C)                            : -1085.14
LL(final)                        : -1016.4
Rho-square (0)                   :  0.1319 
Adj.Rho-square (0)               :  0.1234 
Rho-square (C)                   :  0.0634 
Adj.Rho-square (C)               :  0.0541 
AIC                              :  2052.8 
BIC                              :  2101.88 

Estimated parameters             :  10
Time taken (hh:mm:ss)            :  00:00:6.04 
     pre-estimation              :  00:00:5.12 
     estimation                  :  00:00:0.56 
     post-estimation             :  00:00:0.36 
Iterations                       :  24  
Min abs eigenvalue of Hessian    :  3.682404 

Unconstrained optimisation.

Estimates:
                     Estimate        s.e.   t.rat.(0)    Rob.s.e. Rob.t.rat.(0)
asc_air             -0.624118    0.405016    -1.54097    0.404818      -1.54172
asc_bus             -0.004930    0.295593    -0.01668    0.318353      -0.01548
asc_rail            -0.417880    0.307746    -1.35787    0.313907      -1.33122
b_cost              -0.022139    0.004683    -4.72802    0.004964      -4.46024
b_access_time       -0.004658    0.003872    -1.20290    0.003809      -1.22276
b_in_vehicle_time   -0.005133    0.001176    -4.36651    0.001178      -4.35697
b_income_air        6.077e-06   5.341e-06     1.13786   5.527e-06       1.09947
b_income_bus       -1.531e-05   6.178e-06    -2.47771   6.325e-06      -2.42027
b_income_rail      -8.683e-07   4.677e-06    -0.18563   4.773e-06      -0.18190
lambda_transit       0.600917    0.134525     4.46695    0.143280       4.19400

Nesting structure for NL model component NL:
Nest: root (1)
|----Alternative: car
'-Nest: transit (0.6009)
   |-Alternative: rail
   |-Alternative: bus
   '-Alternative: air</code></pre>
</div>
</div>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-ben-akiva_discrete_1985" class="csl-entry" role="doc-biblioentry">
Ben-Akiva, Moshe, and Stephen R Lerman. 1985. <em>Discrete <span>Choice Analysis</span>: <span>Theory</span> and <span>Application</span> to <span>Travel Demand</span></em>. <span>MIT Press</span>.
</div>
<div id="ref-daly_estimating_2020" class="csl-entry" role="doc-biblioentry">
Daly, Andrew, Stephane Hess, and Juan de Dios Ortúzar. 2020. <span>“Estimating Willingness-to-Pay from Discrete Choice Models: Setting the Record Straight.”</span> <a href="http://www.stephanehess.me.uk/papers/working_papers/Daly_Hess_Ortuzar_2020.pdf">http://www.stephanehess.me.uk/papers/working_papers/Daly_Hess_Ortuzar_2020.pdf</a>.
</div>
</div>


<img src="dm-logo.png" class="slide-logo r-stretch"><div class="footer footer-default">

</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 720,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        function fireSlideChanged(previousSlide, currentSlide) {

          // dispatch for htmlwidgets
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for reveal
        if (window.Reveal) {
          window.Reveal.addEventListener("slidechanged", function(event) {
            fireSlideChanged(event.previousSlide, event.currentSlide);
          });
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        setTimeout(function() {
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          let href = ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const cites = ref.parentNode.getAttribute('data-cites').split(' ');
        tippyHover(ref, function() {
          var popup = window.document.createElement('div');
          cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    });
    </script>
    

</body></html>