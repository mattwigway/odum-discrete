<!DOCTYPE html>
<html lang="en"><head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.40">

  <meta name="author" content="Matt Bhagat-Conway">
  <title>Odum Discrete Choice Models – Introduction to Discrete Choice Models</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto.css">
  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Introduction to Discrete Choice Models</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Matt Bhagat-Conway 
</div>
        <p class="quarto-title-affiliation">
            Odum Institute<br>University of North Carolina at Chapel Hill
          </p>
    </div>
</div>

</section>
<section id="about-me" class="slide level2">
<h2>About me</h2>
<ul>
<li>Assistant professor of City and Regional Planning</li>
<li>Research focus: transportation modeling and simulation
<ul>
<li>Heavy use of discrete choice models</li>
</ul></li>
<li>PhD in Geography from Arizona State</li>
<li>Three years experience as transportation modeling software developer</li>
</ul>
</section>
<section id="before-we-go-any-further" class="slide level2">
<h2>Before we go any further</h2>
<ul>
<li>Install <a href="https://python.org/">Python</a></li>
<li>Install necessary Python packages using <code>pip</code>: <code>biogeme</code>, <code>statsmodels</code>, <code>pandas</code>, <code>numpy</code>, <code>scipy</code></li>
<li>Slides, code, and data at <a href="https://projects.indicatrix.org/odum-discrete/">https://projects.indicatrix.org/odum-discrete/</a></li>
</ul>
</section>
<section id="what-are-discrete-choice-models" class="slide level2">
<h2>What are discrete choice models?</h2>
<ul>
<li>Regression models of discrete outcomes</li>
<li>Most are consistent with <em>random utility theory</em>, an theory of economically rational decisionmaking</li>
</ul>
</section>
<section id="what-are-discrete-choice-models-used-for" class="slide level2">
<h2>What are discrete choice models used for?</h2>
<ul>
<li>Economic analysis
<ul>
<li>Particularly willingness-to-pay/valuation</li>
</ul></li>
<li>Marketing</li>
<li>Healthcare</li>
<li>Transportation planning</li>
</ul>
</section>
<section id="the-simplest-discrete-choice-model-binary-logistic-regression" class="slide level2">
<h2>The simplest discrete choice model: binary logistic regression</h2>
<ul>
<li>You may have also just heard this called “logistic regression”</li>
<li>If you’ve taken regression you’re probably familiar with this model</li>
<li>It is used for binary (two outcome) variables, e.g.
<ul>
<li>fraudulent or not</li>
<li>work in person or work at home</li>
<li>in foreclosure or not</li>
<li>etc.</li>
</ul></li>
</ul>
</section>
<section id="the-binary-logistic-regression-model-conceptually" class="slide level2">
<h2>The binary logistic regression model: conceptually</h2>
<ul>
<li>We are never going to be 100% sure of one outcome or the other, so we want to model the <em>probability</em> of the outcomes</li>
<li>We could just assign 1 to one outcome and 0 to the other, and run a linear regression model</li>
<li>This is the <em>linear probability model</em></li>
</ul>
</section>
<section id="the-problem-with-the-linear-probability-model" class="slide level2">
<h2>The problem with the linear probability model</h2>
<ul>
<li>Predicted values are not constrained between 0 and 1</li>
</ul>
<div id="6a089c1a" class="cell" data-execution_count="3">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="discrete-choice_files/figure-revealjs/cell-3-output-1.png" alt="A plot of a simple linear regression showing a predictor on the x axis and a predicted probability on the y axis, and a positive linear relationship with the predicted probability ranging from -0.25 to 1.25." width="1942" height="662"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="binary-logistic-regression" class="slide level2">
<h2>Binary logistic regression</h2>
<ul>
<li>Instead of predicting the probability, we predict the log-odds (aka logit)</li>
</ul>
<div id="e169a40e" class="cell" data-execution_count="4">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="discrete-choice_files/figure-revealjs/cell-4-output-1.png" alt="A plot of a simple linear regression showing a predictor on the x axis and a predicted probability on the y axis, and a positive linear relationship with the predicted probability ranging from -0.25 to 1.25." width="1942" height="662"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="binary-logistic-regression-the-math" class="slide level2">
<h2>Binary logistic regression: the math</h2>
<p><span class="math display">
y^* = \alpha + \beta_1 x_1 + \beta_2 x_2 \cdots + \epsilon
</span></p>
<p><span class="math display">
\epsilon \thicksim \mathrm{Logistic}
</span> <span class="math display">
p(y = 1) = p(y^* &gt; 0) = \frac{e^{y^*}}{1 + e^{y^*}}
</span></p>
</section>
<section id="interpreting-a-binary-logistic-regression-model" class="slide level2">
<h2>Interpreting a binary logistic regression model</h2>
<div id="6e4d215e" class="cell" data-execution_count="6">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="174">
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">Coefficient</th>
<th style="text-align: left;">Std. Err.</th>
<th style="text-align: left;"><span class="math inline">t</span></th>
<th style="text-align: right;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Intercept</td>
<td style="text-align: left;">0.726</td>
<td style="text-align: left;">0.247</td>
<td style="text-align: left;">2.944</td>
<td style="text-align: right;">0.003</td>
</tr>
<tr class="even">
<td>Age</td>
<td style="text-align: left;">-0.023</td>
<td style="text-align: left;">0.005</td>
<td style="text-align: left;">-5.065</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td>College degree</td>
<td style="text-align: left;">0.927</td>
<td style="text-align: left;">0.131</td>
<td style="text-align: left;">7.102</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>Male</td>
<td style="text-align: left;">0.252</td>
<td style="text-align: left;">0.128</td>
<td style="text-align: left;">1.967</td>
<td style="text-align: right;">0.049</td>
</tr>
<tr class="odd">
<td>n</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">1171</td>
</tr>
<tr class="even">
<td>Log-likelihood</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">-755.397</td>
</tr>
<tr class="odd">
<td>Log-likelihood at constants</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">-798.247</td>
</tr>
<tr class="even">
<td>Pseudo-R²</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0536795</td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<ul>
<li class="fragment">Are older people more likely to be able to WFH?</li>
<li class="fragment">Are college-educated people?</li>
<li class="fragment">Are men?</li>
</ul>
</div>
</section>
<section id="statistical-significance-and-p-values" class="slide level2">
<h2>Statistical significance and p-values</h2>
<ul>
<li>Coefficients are approximations to population-level parameters, and contain sampling error because we haven’t sampled the entire population</li>
<li>The standard error (<span class="math inline">\sigma</span>) is a measure of how precise the coefficient is</li>
<li>We assume coefficient estimates are asymtotically normal</li>
<li>Based on a normal distribution, there is a 95% chance the population parameter is within <span class="math inline">1.96 \times \sigma</span> of the estimate</li>
</ul>
</section>
<section id="statistical-significance-and-p-values-1" class="slide level2">
<h2>Statistical significance and p-values</h2>
<ul>
<li>We can also perform a hypothesis test that the coefficient is different from 0</li>
<li>To do this, we compute a <span class="math inline">z</span>-value, which is just the coefficient divided by the standard error</li>
<li>Put another way, the <span class="math inline">z</span>-value is the number of standard errors between the coefficient and zero</li>
<li>Large coefficients lead to large <span class="math inline">z</span>-values</li>
<li>Large standard errors (i.e.&nbsp;high uncertainty) lead to small <span class="math inline">z</span>-values</li>
</ul>
</section>
<section id="statistical-significance-and-p-values-2" class="slide level2">
<h2>Statistical significance and p-values</h2>
<ul>
<li><span class="math inline">z</span> values larger in magnitude than 1.96 indicate that there is less than a 5% chance of observing a coefficient as larger or larger than the estimated coefficient if the true coefficient were zero</li>
</ul>
</section>
<section id="statistical-significance-and-p-values-3" class="slide level2">
<h2>Statistical significance and p-values</h2>
<ul>
<li>The <span class="math inline">p</span>-value is the probability of observing a coefficient as large or larger in magnitude, if the true coefficient were zero</li>
<li>Computed using the normal cumulative distribution function</li>
<li>Usual rule is that <span class="math inline">p &lt; 0.05</span> is statistically significant, but in larger datasets <span class="math inline">p &lt; 0.01</span> or even <span class="math inline">p &lt; 0.001</span> may be used</li>
<li>For more information about the math, see the hypothesis testing section of any statistics textbook</li>
<li>Logistic regression hypothesis tests are computed just like linear regression, except using the normal instead of <span class="math inline">t</span> distribution</li>
</ul>
</section>
<section id="odds-ratios" class="slide level2">
<h2>Odds ratios</h2>
<div id="e9260833" class="cell" data-execution_count="7">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="175">
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">Coefficient</th>
<th style="text-align: left;">Std. Err.</th>
<th style="text-align: left;"><span class="math inline">t</span></th>
<th style="text-align: right;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Intercept</td>
<td style="text-align: left;">0.726</td>
<td style="text-align: left;">0.247</td>
<td style="text-align: left;">2.944</td>
<td style="text-align: right;">0.003</td>
</tr>
<tr class="even">
<td>Age</td>
<td style="text-align: left;">-0.023</td>
<td style="text-align: left;">0.005</td>
<td style="text-align: left;">-5.065</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td>College degree</td>
<td style="text-align: left;">0.927</td>
<td style="text-align: left;">0.131</td>
<td style="text-align: left;">7.102</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>Male</td>
<td style="text-align: left;">0.252</td>
<td style="text-align: left;">0.128</td>
<td style="text-align: left;">1.967</td>
<td style="text-align: right;">0.049</td>
</tr>
<tr class="odd">
<td>n</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">1171</td>
</tr>
<tr class="even">
<td>Log-likelihood</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">-755.397</td>
</tr>
<tr class="odd">
<td>Log-likelihood at constants</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">-798.247</td>
</tr>
<tr class="even">
<td>Pseudo-R²</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0536795</td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<ul>
<li class="fragment">What does a “0.93 increase in log-odds” mean anyways?</li>
<li class="fragment">Because this is hard to interpret, we often use an <em>odds ratio</em> instead</li>
<li class="fragment">This is just the exponentiation of the coefficient</li>
</ul>
</div>
</section>
<section id="interpreting-odds-ratios-i" class="slide level2">
<h2>Interpreting odds ratios I</h2>
<div id="6643f8a9" class="cell" data-execution_count="8">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="176">
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">Odds ratio</th>
<th style="text-align: left;"><span class="math inline">t</span></th>
<th style="text-align: right;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Intercept</td>
<td style="text-align: left;">2.067</td>
<td style="text-align: left;">2.944</td>
<td style="text-align: right;">0.003</td>
</tr>
<tr class="even">
<td>Age</td>
<td style="text-align: left;">0.977</td>
<td style="text-align: left;">-5.065</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td>College degree</td>
<td style="text-align: left;">2.527</td>
<td style="text-align: left;">7.102</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>Male</td>
<td style="text-align: left;">1.287</td>
<td style="text-align: left;">1.967</td>
<td style="text-align: right;">0.049</td>
</tr>
<tr class="odd">
<td>n</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">1171</td>
</tr>
<tr class="even">
<td>Log-likelihood</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">-755.397</td>
</tr>
<tr class="odd">
<td>Log-likelihood at constants</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">-798.247</td>
</tr>
<tr class="even">
<td>Pseudo-R²</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0536795</td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<ul>
<li class="fragment">Odds ratios measure the change in the <em>odds</em> of an event happening
<ul>
<li class="fragment">Odds is the probability of something happening divided by the probability of it not happening</li>
<li class="fragment">e.g.&nbsp;5 to 1 odds means that out of 6 trials something will happen 5 times on average</li>
</ul></li>
<li class="fragment">They are multiplicative, so an odds ratio of 1.287 means that men have 28.7% higher odds of being able to work from home</li>
</ul>
</div>
</section>
<section id="interpreting-odds-ratios-ii" class="slide level2">
<h2>Interpreting odds ratios II</h2>
<div id="9ce7f799" class="cell" data-execution_count="9">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="177">
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">Odds ratio</th>
<th style="text-align: left;"><span class="math inline">t</span></th>
<th style="text-align: right;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Intercept</td>
<td style="text-align: left;">2.067</td>
<td style="text-align: left;">2.944</td>
<td style="text-align: right;">0.003</td>
</tr>
<tr class="even">
<td>Age</td>
<td style="text-align: left;">0.977</td>
<td style="text-align: left;">-5.065</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td>College degree</td>
<td style="text-align: left;">2.527</td>
<td style="text-align: left;">7.102</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>Male</td>
<td style="text-align: left;">1.287</td>
<td style="text-align: left;">1.967</td>
<td style="text-align: right;">0.049</td>
</tr>
<tr class="odd">
<td>n</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">1171</td>
</tr>
<tr class="even">
<td>Log-likelihood</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">-755.397</td>
</tr>
<tr class="odd">
<td>Log-likelihood at constants</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">-798.247</td>
</tr>
<tr class="even">
<td>Pseudo-R²</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0536795</td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<ul>
<li class="fragment">What does an odds ratio of 0.977 mean?
<ul>
<li class="fragment">Each additional year of age is associated with 2.3% <em>lower</em> odds of being able to work from home</li>
</ul></li>
</ul>
</div>
</section>
<section id="odds-ratios-are-not-risk-ratios" class="slide level2">
<h2>Odds ratios are not risk ratios</h2>
<ul>
<li>Odds ratios are often misinterpreted as <em>risk ratios</em>, the percent change in the probability</li>
<li>Men have 28.7% higher <em>odds</em> of being able to work from home, not 28.7% higher probability
<ul>
<li>Many people say something like 28.7% more likely, but this is unclear that it refers to odds rather than probability</li>
</ul></li>
</ul>
</section>
<section id="running-a-logistic-regression-in-python" class="slide level2">
<h2>Running a logistic regression in Python</h2>
<div id="a407df71" class="cell" data-execution_count="10">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>logistic_basic.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd, statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-2"><a></a></span>
<span id="cb1-3"><a></a>data <span class="op">=</span> pd.read_csv(<span class="st">"data/wfh_prediction_covidfuture.csv"</span>)</span>
<span id="cb1-4"><a></a></span>
<span id="cb1-5"><a></a>model <span class="op">=</span> sm.Logit(</span>
<span id="cb1-6"><a></a>    data.wfh_expectation, <span class="co"># dependent variables</span></span>
<span id="cb1-7"><a></a>    sm.add_constant( <span class="co"># add an intercept to the dataframe</span></span>
<span id="cb1-8"><a></a>        pd.get_dummies( <span class="co"># convert gender to a dummy variable</span></span>
<span id="cb1-9"><a></a>            data[[<span class="st">"age"</span>, <span class="st">"gender"</span>, <span class="st">"college"</span>]],</span>
<span id="cb1-10"><a></a>        )</span>
<span id="cb1-11"><a></a>        .drop(columns<span class="op">=</span>[<span class="st">"gender_Female"</span>]) <span class="co"># drop one category from dummy variable</span></span>
<span id="cb1-12"><a></a>        .astype(<span class="st">"float64"</span>) <span class="co"># convert everything to numeric</span></span>
<span id="cb1-13"><a></a>    )</span>
<span id="cb1-14"><a></a>)</span>
<span id="cb1-15"><a></a></span>
<span id="cb1-16"><a></a>result <span class="op">=</span> model.fit()</span>
<span id="cb1-17"><a></a><span class="bu">print</span>(result.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="running-a-logistic-regression-in-python-results" class="slide level2">
<h2>Running a logistic regression in Python: results</h2>
<div id="19e96136" class="cell" data-execution_count="11">
<div class="cell-output cell-output-display" data-execution_count="179">
<table class="simpletable caption-top" data-quarto-postprocess="true">
<caption>Logit Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>wfh_expectation</td>
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>1171</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>Logit</td>
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>1167</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>MLE</td>
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Sun, 14 Jul 2024</td>
<td data-quarto-table-cell-role="th">Pseudo R-squ.:</td>
<td>0.05368</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>17:33:17</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-755.40</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">converged:</td>
<td>True</td>
<td data-quarto-table-cell-role="th">LL-Null:</td>
<td>-798.25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th">LLR p-value:</td>
<td>1.837e-18</td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">z</td>
<td data-quarto-table-cell-role="th">P&gt;|z|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">const</td>
<td>0.7258</td>
<td>0.247</td>
<td>2.944</td>
<td>0.003</td>
<td>0.243</td>
<td>1.209</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">age</td>
<td>-0.0230</td>
<td>0.005</td>
<td>-5.065</td>
<td>0.000</td>
<td>-0.032</td>
<td>-0.014</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">college</td>
<td>0.9273</td>
<td>0.131</td>
<td>7.102</td>
<td>0.000</td>
<td>0.671</td>
<td>1.183</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">gender_Male</td>
<td>0.2520</td>
<td>0.128</td>
<td>1.967</td>
<td>0.049</td>
<td>0.001</td>
<td>0.503</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="exercise-add-the-black-and-hispanic-variables-to-the-model" class="slide level2">
<h2>Exercise: add the <code>black</code> and <code>hispanic</code> variables to the model</h2>
<div id="bf7f1087" class="cell" data-execution_count="12">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>logistic_black_hispanic.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd, statsmodels.api <span class="im">as</span> sm</span>
<span id="cb2-2"><a></a></span>
<span id="cb2-3"><a></a>data <span class="op">=</span> pd.read_csv(<span class="st">"data/wfh_prediction_covidfuture.csv"</span>)</span>
<span id="cb2-4"><a></a></span>
<span id="cb2-5"><a></a>model <span class="op">=</span> sm.Logit(</span>
<span id="cb2-6"><a></a>    data.wfh_expectation, <span class="co"># dependent variables</span></span>
<span id="cb2-7"><a></a>    sm.add_constant( <span class="co"># add an intercept to the dataframe</span></span>
<span id="cb2-8"><a></a>        pd.get_dummies( <span class="co"># convert gender to a dummy variable</span></span>
<span id="cb2-9"><a></a>            data[[<span class="st">"age"</span>, <span class="st">"gender"</span>, <span class="st">"college"</span>, <span class="st">"black"</span>, <span class="st">"hispanic"</span>]],</span>
<span id="cb2-10"><a></a>        )</span>
<span id="cb2-11"><a></a>        .drop(columns<span class="op">=</span>[<span class="st">"gender_Female"</span>]) <span class="co"># drop one category from dummy variable</span></span>
<span id="cb2-12"><a></a>        .astype(<span class="st">"float64"</span>) <span class="co"># convert everything to numeric</span></span>
<span id="cb2-13"><a></a>    )</span>
<span id="cb2-14"><a></a>)</span>
<span id="cb2-15"><a></a></span>
<span id="cb2-16"><a></a>result <span class="op">=</span> model.fit()</span>
<span id="cb2-17"><a></a><span class="bu">print</span>(result.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="exercise-add-the-black-and-hispanic-variables-to-the-model-result" class="slide level2">
<h2>Exercise: add the <code>black</code> and <code>hispanic</code> variables to the model: result</h2>
<div id="9c7d8ea3" class="cell" data-execution_count="13">
<div class="cell-output cell-output-display" data-execution_count="181">
<table class="simpletable caption-top" data-quarto-postprocess="true">
<caption>Logit Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>wfh_expectation</td>
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>1171</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>Logit</td>
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>1165</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>MLE</td>
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Sun, 14 Jul 2024</td>
<td data-quarto-table-cell-role="th">Pseudo R-squ.:</td>
<td>0.05437</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>17:33:18</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-754.85</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">converged:</td>
<td>True</td>
<td data-quarto-table-cell-role="th">LL-Null:</td>
<td>-798.25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th">LLR p-value:</td>
<td>3.164e-17</td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">z</td>
<td data-quarto-table-cell-role="th">P&gt;|z|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">const</td>
<td>0.7721</td>
<td>0.261</td>
<td>2.962</td>
<td>0.003</td>
<td>0.261</td>
<td>1.283</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">age</td>
<td>-0.0237</td>
<td>0.005</td>
<td>-5.072</td>
<td>0.000</td>
<td>-0.033</td>
<td>-0.015</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">college</td>
<td>0.9245</td>
<td>0.131</td>
<td>7.056</td>
<td>0.000</td>
<td>0.668</td>
<td>1.181</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">black</td>
<td>0.0801</td>
<td>0.232</td>
<td>0.346</td>
<td>0.729</td>
<td>-0.374</td>
<td>0.534</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">hispanic</td>
<td>-0.1971</td>
<td>0.201</td>
<td>-0.979</td>
<td>0.327</td>
<td>-0.592</td>
<td>0.197</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">gender_Male</td>
<td>0.2546</td>
<td>0.128</td>
<td>1.986</td>
<td>0.047</td>
<td>0.003</td>
<td>0.506</td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<ul>
<li class="fragment">Is either statistically significant?</li>
</ul>
</div>
</section>
<section id="an-alternate-conceptualization-of-the-logistic-regression-model-random-utility-theory" class="slide level2">
<h2>An alternate conceptualization of the logistic regression model: random utility theory</h2>
<ul>
<li>Random utility theory posits that choices have “utility” or value</li>
<li>When faced with a set of options, individuals will choose the option with the highest utility</li>
<li>We don’t observe everything that goes into utility, so there is random error</li>
</ul>
</section>
<section id="logistic-regression-as-a-random-utility-model" class="slide level2">
<h2>Logistic regression as a random utility model</h2>
<ul>
<li>We define the systematic utility (i.e.&nbsp;no random error) of one alternative (e.g.&nbsp;working from home) as V: <span class="math display">
V_{wfh} = \alpha + \beta_1 x_1 + \beta_2 x_2 \cdots
</span></li>
</ul>
<p>The full utility U has an error term:</p>
<p><span class="math display">
U_{wfh} = V_{wfh} + \epsilon_{wfh}
</span></p>
<ul>
<li>Only differences in utility are meaningful, so we can arbitrarily define the systematic portion of the utility of the other option as zero</li>
</ul>
<p><span class="math display">
U_{notwfh} = 0 + \epsilon_{notwfh}
</span></p>
<p>The probability of working from home then becomes</p>
<p><span class="math display">
P\left(U_{wfh} &gt; U_{notwfh}\right)
</span></p>
</section>
<section id="error-term-distribution" class="slide level2">
<h2>Error term distribution</h2>
<div>
<ul>
<li class="fragment">We assume the <span class="math inline">\epsilon</span>’s are Gumbel-distributed</li>
<li class="fragment">The Gumbel distribution is an approximation of the normal distribution with some attractive properties
<ul>
<li class="fragment">More on this later</li>
</ul></li>
<li class="fragment">The important property at the moment is that the difference of two Gumbel-distributed variables is Logistic-distributed
<ul>
<li class="fragment">Just like the error term in our logistic regression model</li>
</ul></li>
</ul>
</div>
</section>
<section id="showing-the-equivalence-to-the-binary-logistic-regression-model-i" class="slide level2">
<h2>Showing the equivalence to the binary logistic regression model I</h2>
<p>We have</p>
<p><span class="math display">
P\left(U_{wfh} &gt; U_{notwfh}\right)
</span></p>
<div class="fragment">
<p>which we can re-write as</p>
<p><span class="math display">
P\left(V_{wfh} + \epsilon_{wfh} - (0 + \epsilon_{notwfh}) &gt; 0\right)
</span></p>
</div>
</section>
<section id="showing-the-equivalence-to-the-binary-logistic-regression-model-ii" class="slide level2">
<h2>Showing the equivalence to the binary logistic regression model II</h2>
<ul>
<li>Since the difference of our Gumbel-distributed error terms is Logistic-distributed, we have</li>
</ul>
<p><span class="math display">
P\left(V_{wfh} + \epsilon_{\Delta} &gt; 0\right)
</span></p>
<p>with <span class="math inline">\epsilon_\Delta</span> Logistic-distributed, which is the same as our formula for logistic regression.</p>
</section>
<section id="estimating-our-binary-logistic-regression-as-a-random-utility-model" class="slide level2">
<h2>Estimating our binary logistic regression as a random utility model</h2>
<ul>
<li>We’re going to specify our logistic regression model as a random utility model</li>
<li>We’re going to use the <a href="https://biogeme.epfl.ch">Biogeme</a> package to do so</li>
</ul>
</section>
<section id="estimation-code" class="slide level2">
<h2>Estimation code</h2>
<div id="1212e1b4" class="cell" data-execution_count="14">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>biogeme_binary.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a><span class="im">import</span> biogeme.database <span class="im">as</span> db, biogeme.biogeme <span class="im">as</span> bio</span>
<span id="cb3-2"><a></a><span class="im">from</span> biogeme <span class="im">import</span> models</span>
<span id="cb3-3"><a></a><span class="im">from</span> biogeme.expressions <span class="im">import</span> Beta, Variable</span>
<span id="cb3-4"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-5"><a></a></span>
<span id="cb3-6"><a></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/wfh_prediction_covidfuture.csv"</span>) <span class="co"># read data</span></span>
<span id="cb3-7"><a></a>data <span class="op">=</span> db.Database(<span class="st">"WFH"</span>, </span>
<span id="cb3-8"><a></a>    pd.get_dummies(df)</span>
<span id="cb3-9"><a></a>        .drop(columns<span class="op">=</span><span class="st">"gender_Female"</span>)</span>
<span id="cb3-10"><a></a>        .astype(<span class="st">"float64"</span>)</span>
<span id="cb3-11"><a></a>) <span class="co"># convert to Biogeme format</span></span>
<span id="cb3-12"><a></a></span>
<span id="cb3-13"><a></a><span class="co"># specify coefficients - all start at zero, have no bounds (None, None), and are</span></span>
<span id="cb3-14"><a></a><span class="co"># estimated rather than fixed (0)</span></span>
<span id="cb3-15"><a></a>alpha <span class="op">=</span> Beta(<span class="st">"Intercept"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb3-16"><a></a>b_age <span class="op">=</span> Beta(<span class="st">"b_age"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb3-17"><a></a>b_college <span class="op">=</span> Beta(<span class="st">"b_college"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb3-18"><a></a>b_male <span class="op">=</span> Beta(<span class="st">"b_male"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb3-19"><a></a></span>
<span id="cb3-20"><a></a><span class="co"># and specify the variables we want to use</span></span>
<span id="cb3-21"><a></a>age <span class="op">=</span> Variable(<span class="st">"age"</span>)</span>
<span id="cb3-22"><a></a>college <span class="op">=</span> Variable(<span class="st">"college"</span>)</span>
<span id="cb3-23"><a></a>male <span class="op">=</span> Variable(<span class="st">"gender_Male"</span>)</span>
<span id="cb3-24"><a></a></span>
<span id="cb3-25"><a></a><span class="co"># specify utility functions</span></span>
<span id="cb3-26"><a></a>V <span class="op">=</span> {</span>
<span id="cb3-27"><a></a>    <span class="co"># outcome 1 is WFH</span></span>
<span id="cb3-28"><a></a>    <span class="dv">1</span>: (alpha <span class="op">+</span> b_age <span class="op">*</span> age <span class="op">+</span> b_college <span class="op">*</span> college <span class="op">+</span> b_male <span class="op">*</span> male),</span>
<span id="cb3-29"><a></a>    <span class="co"># outcome 0 is non-WFH</span></span>
<span id="cb3-30"><a></a>    <span class="dv">0</span>: <span class="dv">0</span></span>
<span id="cb3-31"><a></a>}</span>
<span id="cb3-32"><a></a></span>
<span id="cb3-33"><a></a><span class="co"># we also need to define the availability (more on this later)</span></span>
<span id="cb3-34"><a></a>av <span class="op">=</span> {<span class="dv">0</span>: <span class="dv">1</span>, <span class="dv">1</span>: <span class="dv">1</span>}</span>
<span id="cb3-35"><a></a></span>
<span id="cb3-36"><a></a><span class="co"># now, set up what type of model we want (logit), what the utility functions are,</span></span>
<span id="cb3-37"><a></a><span class="co"># what the availability variables are, and what the dependent variable is</span></span>
<span id="cb3-38"><a></a>logprob <span class="op">=</span> models.loglogit(V, av, Variable(<span class="st">"wfh_expectation"</span>))</span>
<span id="cb3-39"><a></a></span>
<span id="cb3-40"><a></a>model <span class="op">=</span> bio.BIOGEME(data, logprob)</span>
<span id="cb3-41"><a></a>model.modelName <span class="op">=</span> <span class="st">"biogeme_binary"</span></span>
<span id="cb3-42"><a></a>model.calculateNullLoglikelihood(av)</span>
<span id="cb3-43"><a></a>result <span class="op">=</span> model.estimate()</span>
<span id="cb3-44"><a></a></span>
<span id="cb3-45"><a></a><span class="cf">assert</span> result.algorithm_has_converged()</span>
<span id="cb3-46"><a></a><span class="bu">print</span>(result.shortSummary())</span>
<span id="cb3-47"><a></a><span class="bu">print</span>(result.getEstimatedParameters())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="result" class="slide level2">
<h2>Result</h2>
<div id="910fb99d" class="cell" data-execution_count="15">
<div class="cell-output cell-output-stdout">
<pre><code>Results for model biogeme_binary
Nbr of parameters:      4
Sample size:            1171
Excluded data:          0
Null log likelihood:        -811.6753
Final log likelihood:       -755.3974
Likelihood ratio test (null):       112.5559
Rho square (null):          0.0693
Rho bar square (null):          0.0644
Akaike Information Criterion:   1518.795
Bayesian Information Criterion: 1539.057

              Value  Rob. Std err  Rob. t-test  Rob. p-value
Intercept  0.725756      0.246210     2.947712  3.201357e-03
b_age     -0.023037      0.004531    -5.084153  3.692710e-07
b_college  0.927291      0.130311     7.115971  1.111333e-12
b_male     0.251951      0.127537     1.975508  4.821053e-02</code></pre>
</div>
</div>
</section>
<section id="numpy-error" class="slide level2">
<h2>Numpy error</h2>
<ul>
<li><code>numpy</code> 2.0 was released a few weeks ago, and <code>biogeme</code> is not yet compatible, you may get this message</li>
</ul>
<pre><code>A module that was compiled using NumPy 1.x cannot be run in
NumPy 2.0.0 as it may crash. To support both 1.x and 2.x
versions of NumPy, modules must be compiled with NumPy 2.0.
Some module may need to rebuild instead e.g. with 'pybind11&gt;=2.12'.

If you are a user of the module, the easiest solution will be to
downgrade to 'numpy&lt;2' or try to upgrade the affected module.
We expect that some modules will need time to support NumPy 2.</code></pre>
<ul>
<li>If so, run <code>python3 -m pip install numpy==1.26.4</code> (macOS) or <code>py -m pip install numpy==1.26.4</code> (Windows) to downgrade to the most recent release of <code>numpy</code> 1</li>
</ul>
</section>
<section id="how-does-the-result-compare-to-the-original-model-we-estimated" class="slide level2">
<h2>How does the result compare to the original model we estimated?</h2>
<div id="ed4d6a7b" class="cell" data-execution_count="16">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="184">
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">Coefficient</th>
<th style="text-align: left;">Std. Err.</th>
<th style="text-align: left;"><span class="math inline">t</span></th>
<th style="text-align: right;">p</th>
<th style="text-align: left;">Odds ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Intercept</td>
<td style="text-align: left;">0.726</td>
<td style="text-align: left;">0.247</td>
<td style="text-align: left;">2.944</td>
<td style="text-align: right;">0.003</td>
<td style="text-align: left;">2.067</td>
</tr>
<tr class="even">
<td>Age</td>
<td style="text-align: left;">-0.023</td>
<td style="text-align: left;">0.005</td>
<td style="text-align: left;">-5.065</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">0.977</td>
</tr>
<tr class="odd">
<td>College degree</td>
<td style="text-align: left;">0.927</td>
<td style="text-align: left;">0.131</td>
<td style="text-align: left;">7.102</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">2.527</td>
</tr>
<tr class="even">
<td>Male</td>
<td style="text-align: left;">0.252</td>
<td style="text-align: left;">0.128</td>
<td style="text-align: left;">1.967</td>
<td style="text-align: right;">0.049</td>
<td style="text-align: left;">1.287</td>
</tr>
<tr class="odd">
<td>n</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">1171</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td>Log-likelihood</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">-755.397</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td>Log-likelihood at constants</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">-798.247</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td>Pseudo-R²</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: right;">0.0536795</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<ul>
<li class="fragment">It should be the same</li>
</ul>
</div>
</section>
<section id="detailed-result" class="slide level2">
<h2>Detailed result</h2>
<p>Stored in “biogeme_binary.html”, or some variation—look for most recent.</p>
<div id="bcefe935" class="cell" data-execution_count="17">
<div class="cell-output cell-output-display" data-execution_count="185">
<iframe width="1850" height="800px" src="biogeme_binary~05.html" data-external="1"></iframe>
</div>
</div>
</section>
<section id="exercise" class="slide level2">
<h2>Exercise</h2>
<ul>
<li>Add the <code>black</code> and <code>hispanic</code> variables to the model, confirm you get the same results you did before</li>
</ul>
</section>
<section id="exercise-result" class="slide level2">
<h2>Exercise: result</h2>
<div id="4e62d487" class="cell" data-execution_count="18">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>biogeme_binary_race.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a><span class="im">import</span> biogeme.database <span class="im">as</span> db, biogeme.biogeme <span class="im">as</span> bio</span>
<span id="cb6-2"><a></a><span class="im">from</span> biogeme <span class="im">import</span> models</span>
<span id="cb6-3"><a></a><span class="im">from</span> biogeme.expressions <span class="im">import</span> Beta, Variable</span>
<span id="cb6-4"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-5"><a></a></span>
<span id="cb6-6"><a></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/wfh_prediction_covidfuture.csv"</span>) <span class="co"># read data</span></span>
<span id="cb6-7"><a></a>data <span class="op">=</span> db.Database(<span class="st">"WFH"</span>, </span>
<span id="cb6-8"><a></a>    pd.get_dummies(df)</span>
<span id="cb6-9"><a></a>        .drop(columns<span class="op">=</span><span class="st">"gender_Female"</span>)</span>
<span id="cb6-10"><a></a>        .astype(<span class="st">"float64"</span>)</span>
<span id="cb6-11"><a></a>) <span class="co"># convert to Biogeme format</span></span>
<span id="cb6-12"><a></a></span>
<span id="cb6-13"><a></a><span class="co"># specify coefficients - all start at zero, have no bounds (None, None), and are</span></span>
<span id="cb6-14"><a></a><span class="co"># estimated rather than fixed (0)</span></span>
<span id="cb6-15"><a></a>alpha <span class="op">=</span> Beta(<span class="st">"Intercept"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb6-16"><a></a>b_age <span class="op">=</span> Beta(<span class="st">"b_age"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb6-17"><a></a>b_college <span class="op">=</span> Beta(<span class="st">"b_college"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb6-18"><a></a>b_male <span class="op">=</span> Beta(<span class="st">"b_male"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb6-19"><a></a>b_black <span class="op">=</span> Beta(<span class="st">"b_black"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb6-20"><a></a>b_hispanic <span class="op">=</span> Beta(<span class="st">"b_hispanic"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb6-21"><a></a></span>
<span id="cb6-22"><a></a><span class="co"># and specify the variables we want to use</span></span>
<span id="cb6-23"><a></a>age <span class="op">=</span> Variable(<span class="st">"age"</span>)</span>
<span id="cb6-24"><a></a>college <span class="op">=</span> Variable(<span class="st">"college"</span>)</span>
<span id="cb6-25"><a></a>male <span class="op">=</span> Variable(<span class="st">"gender_Male"</span>)</span>
<span id="cb6-26"><a></a>black <span class="op">=</span> Variable(<span class="st">"black"</span>)</span>
<span id="cb6-27"><a></a>hispanic <span class="op">=</span> Variable(<span class="st">"hispanic"</span>)</span>
<span id="cb6-28"><a></a></span>
<span id="cb6-29"><a></a><span class="co"># specify utility functions</span></span>
<span id="cb6-30"><a></a>V <span class="op">=</span> {</span>
<span id="cb6-31"><a></a>    <span class="co"># outcome 1 is WFH</span></span>
<span id="cb6-32"><a></a>    <span class="dv">1</span>: (alpha <span class="op">+</span> b_age <span class="op">*</span> age <span class="op">+</span> b_college <span class="op">*</span> college <span class="op">+</span> b_male <span class="op">*</span> male <span class="op">+</span></span>
<span id="cb6-33"><a></a>        b_black <span class="op">*</span> black <span class="op">+</span> b_hispanic <span class="op">*</span> hispanic),</span>
<span id="cb6-34"><a></a>    <span class="co"># outcome 0 is non-WFH</span></span>
<span id="cb6-35"><a></a>    <span class="dv">0</span>: <span class="dv">0</span></span>
<span id="cb6-36"><a></a>}</span>
<span id="cb6-37"><a></a></span>
<span id="cb6-38"><a></a><span class="co"># we also need to define the availability (more on this later)</span></span>
<span id="cb6-39"><a></a>av <span class="op">=</span> {<span class="dv">0</span>: <span class="dv">1</span>, <span class="dv">1</span>: <span class="dv">1</span>}</span>
<span id="cb6-40"><a></a></span>
<span id="cb6-41"><a></a><span class="co"># now, set up what type of model we want (logit), what the utility functions are,</span></span>
<span id="cb6-42"><a></a><span class="co"># what the availability variables are, and what the dependent variable is</span></span>
<span id="cb6-43"><a></a>logprob <span class="op">=</span> models.loglogit(V, av, Variable(<span class="st">"wfh_expectation"</span>))</span>
<span id="cb6-44"><a></a></span>
<span id="cb6-45"><a></a>model <span class="op">=</span> bio.BIOGEME(data, logprob)</span>
<span id="cb6-46"><a></a>model.modelName <span class="op">=</span> <span class="st">"biogeme_binary_race"</span></span>
<span id="cb6-47"><a></a>model.calculateNullLoglikelihood(av)</span>
<span id="cb6-48"><a></a>result <span class="op">=</span> model.estimate()</span>
<span id="cb6-49"><a></a></span>
<span id="cb6-50"><a></a><span class="cf">assert</span> result.algorithm_has_converged()</span>
<span id="cb6-51"><a></a><span class="bu">print</span>(result.shortSummary())</span>
<span id="cb6-52"><a></a><span class="bu">print</span>(result.getEstimatedParameters())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Results for model biogeme_binary_race
Nbr of parameters:      6
Sample size:            1171
Excluded data:          0
Null log likelihood:        -811.6753
Final log likelihood:       -754.8494
Likelihood ratio test (null):       113.6518
Rho square (null):          0.07
Rho bar square (null):          0.0626
Akaike Information Criterion:   1521.699
Bayesian Information Criterion: 1552.093

               Value  Rob. Std err  Rob. t-test  Rob. p-value
Intercept   0.772054      0.258984     2.981089  2.872257e-03
b_age      -0.023654      0.004630    -5.108776  3.242527e-07
b_black     0.080118      0.232280     0.344920  7.301544e-01
b_college   0.924482      0.130676     7.074599  1.498801e-12
b_hispanic -0.197129      0.197385    -0.998704  3.179383e-01
b_male      0.254622      0.127658     1.994570  4.608975e-02</code></pre>
</div>
</div>
</section>
<section id="results" class="slide level2">
<h2>Results</h2>
<div id="b22d3ff6" class="cell" data-execution_count="19">
<div class="cell-output cell-output-stdout">
<pre><code>Results for model biogeme_binary_race
Nbr of parameters:      6
Sample size:            1171
Excluded data:          0
Null log likelihood:        -811.6753
Final log likelihood:       -754.8494
Likelihood ratio test (null):       113.6518
Rho square (null):          0.07
Rho bar square (null):          0.0626
Akaike Information Criterion:   1521.699
Bayesian Information Criterion: 1552.093

               Value  Rob. Std err  Rob. t-test  Rob. p-value
Intercept   0.772054      0.258984     2.981089  2.872257e-03
b_age      -0.023654      0.004630    -5.108776  3.242527e-07
b_black     0.080118      0.232280     0.344920  7.301544e-01
b_college   0.924482      0.130676     7.074599  1.498801e-12
b_hispanic -0.197129      0.197385    -0.998704  3.179383e-01
b_male      0.254622      0.127658     1.994570  4.608975e-02</code></pre>
</div>
</div>
</section>
<section id="moving-beyond-binary-outcomes-the-multinomial-logit-model" class="slide level2">
<h2>Moving beyond binary outcomes: the multinomial logit model</h2>
<ul>
<li>Often, we have more than two outcomes
<ul>
<li>Choice of travel mode might be drive alone, carpool, transit, walk, or bike.</li>
<li>Choice of Internet service might be DSL, cable, satellite, or fiber</li>
<li>Choice of vacation destination might be beach, mountains, or theme park</li>
<li>Choice of treatment for pain might be surgery, physical therapy, non-opioid medication, opioid medication, or accupuncture</li>
</ul></li>
<li>We refer to these outcomes as “alternatives”</li>
</ul>
</section>
<section id="the-multinomial-logit-model-conceptually" class="slide level2">
<h2>The multinomial logit model: conceptually</h2>
<ul>
<li>Each alternative has a <em>utility</em> or value</li>
<li>The decisionmaker will choose the alternative with the highest utility</li>
<li>Like binary logistic regression, each alternative has an error term—there is some random/unobserved variation in utility</li>
</ul>
</section>
<section id="the-multinomial-logit-model-in-math-i" class="slide level2">
<h2>The multinomial logit model, in math I</h2>
<ul>
<li>Each alternative gets a utility function, with systematic and random components</li>
</ul>
<p><span class="math display">
U_{car} = V_{car} + \epsilon_{car} \\
U_{transit} = V_{transit} + \epsilon_{transit} \\
U_{bike} = V_{bike} + \epsilon_{bike} \\
U_{walk} = V_{walk} + \epsilon_{walk} \\
</span></p>
</section>
<section id="the-multinomial-logit-model-in-math-ii" class="slide level2">
<h2>The multinomial logit model, in math II</h2>
<ul>
<li>Like in a logistic regression, the systematic portion of utility is usually a linear combination of predictors</li>
</ul>
<p><span class="math display">
V_{car} = \alpha_{car} + \beta_{car,income} x_{income} \cdots \\
V_{transit} = \alpha_{transit} + \beta_{transit,income} x_{income} \cdots \\
V_{bike} = \alpha_{bike} + \beta_{bike,income} x_{income} \cdots \\
V_{walk} = \alpha_{walk} + \beta_{walk,income} x_{income} \cdots \\
</span></p>
</section>
<section id="alternative-specific-constants" class="slide level2">
<h2>Alternative specific constants</h2>
<ul>
<li>Unlike the binary logit model, there is now an <span class="math inline">\alpha</span> for each mode</li>
<li>This is known as an <em>alternative specific constant</em></li>
<li>It measures the relative popularity of each option with all other coefficients held at zero
<ul>
<li>Just like in a binary logit model</li>
</ul></li>
<li>Interpretation is a little tricky, just like constants in other regression models—because all the other coefficients being zero doesn’t always make sense</li>
</ul>
</section>
<section id="only-utility-differences-matter" class="slide level2">
<h2>Only utility differences matter</h2>
<ul>
<li>The option with the highest utility is chosen</li>
<li>This means only <em>differences</em> in utility matter, not their actual values</li>
<li>It is very easy to create models that are not identified (i.e.&nbsp;there is not a unique best set of coefficients) because of this</li>
</ul>
</section>
<section id="identification-issues" class="slide level2">
<h2>Identification issues</h2>
<ul>
<li>Looking again at our mode choice model, how do the differences between utilities change if we add 1 to all of the <span class="math inline">\alpha</span>’s or <span class="math inline">\beta</span>’s?</li>
</ul>
<p><span class="math display">
V_{car} = \alpha_{car} + \beta_{car,income} x_{income} \cdots \\
V_{transit} = \alpha_{transit} + \beta_{transit,income} x_{income} \cdots \\
V_{bike} = \alpha_{bike} + \beta_{bike,income} x_{income} \cdots \\
V_{walk} = \alpha_{walk} + \beta_{walk,income} x_{income} \cdots \\
</span></p>
</section>
<section id="an-identified-model" class="slide level2">
<h2>An identified model</h2>
<ul>
<li>We can solve this by setting one utility to zero
<ul>
<li>Which one does not affect predictions from the model, but will affect interpretations</li>
</ul></li>
<li>For instance, we might do</li>
</ul>
<p><span class="math display">
V_{car} = 0 \\
V_{transit} = \alpha_{transit} + \beta_{transit,income} x_{income} \cdots \\
V_{bike} = \alpha_{bike} + \beta_{bike,income} x_{income} \cdots \\
V_{walk} = \alpha_{walk} + \beta_{walk,income} x_{income} \cdots \\
</span></p>
<ul>
<li>This is exactly what a binary logistic regression does—you have coefficients for one outcome, and the utility of the other outcome is zero</li>
</ul>
</section>
<section id="interpreting-the-model" class="slide level2">
<h2>Interpreting the model</h2>
<ul>
<li>All of the other coefficients are relative to the alternative that has its utility set to zero</li>
<li>For instance, <span class="math inline">\beta_{bike,income}</span> represents how income changes the <em>relative</em> attractiveness of biking and driving</li>
</ul>
</section>
<section id="an-example-multinomial-logit-model-seattle-mode-choice" class="slide level2">
<h2>An example multinomial logit model: Seattle mode choice</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>We have data on 8,883 trips taken in the Seattle region, based on a survey from the Puget Sound Regional Council</li>
<li>We have demographic information on the tripmakers, as well as attributes of the trip itself
<ul>
<li>How long it would have taken by car, bike, walk, and transit</li>
<li>How much it would have cost by car and transit
<ul>
<li>For car, based on distance traveled</li>
</ul></li>
<li>How many transit transfers are required</li>
<li>Whether the trip took place at rush hour</li>
</ul></li>
</ul>
</div><div class="column" style="width:40%;">
<p><img data-src="img/seattle.jpg" alt="Image of the Space Needle, Seattle"></p>
</div>
</div>
</section>
<section id="interpreting-a-multinomial-logit-model" class="slide level2">
<h2>Interpreting a multinomial logit model</h2>
<ul>
<li>We’re going to start with a very simple multinomial logit model, modeling the relationship between income and mode choice</li>
</ul>
<div id="5b19a5d5" class="cell" data-execution_count="20">
<div class="cell-output cell-output-stdout">
<pre><code>Results for model seattle_mode_choice
Nbr of parameters:      6
Sample size:            8883
Excluded data:          0
Null log likelihood:        -12314.45
Final log likelihood:       -6209.072
Likelihood ratio test (null):       12210.76
Rho square (null):          0.496
Rho bar square (null):          0.495
Akaike Information Criterion:   12430.14
Bayesian Information Criterion: 12472.7

                               Value  Rob. Std err  Rob. t-test  Rob. p-value
asc_bike                   -4.005311      0.127131   -31.505433      0.000000
asc_transit                -2.510074      0.062031   -40.465119      0.000000
asc_walk                   -1.527039      0.040258   -37.930883      0.000000
b_income_over_100k_bike     0.122232      0.176553     0.692327      0.488732
b_income_over_100k_transit -1.465351      0.142403   -10.290145      0.000000
b_income_over_100k_walk     0.223509      0.055121     4.054884      0.000050</code></pre>
</div>
</div>
</section>
<section id="interpreting-a-multinomial-logit-model-alternative-specific-constants" class="slide level2">
<h2>Interpreting a multinomial logit model: alternative-specific constants</h2>
<div id="5a585d6a" class="cell" data-execution_count="21">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="189">
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Value</th>
<th style="text-align: right;">Rob. Std err</th>
<th style="text-align: right;">Rob. t-test</th>
<th style="text-align: right;">Rob. p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>asc_bike</td>
<td style="text-align: right;">-4.00531</td>
<td style="text-align: right;">0.127131</td>
<td style="text-align: right;">-31.5054</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>asc_transit</td>
<td style="text-align: right;">-2.51007</td>
<td style="text-align: right;">0.0620306</td>
<td style="text-align: right;">-40.4651</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td>asc_walk</td>
<td style="text-align: right;">-1.52704</td>
<td style="text-align: right;">0.0402585</td>
<td style="text-align: right;">-37.9309</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<ul>
<li class="fragment">For households making less than $100,000/year
<ul>
<li class="fragment">Biking is least prevalent</li>
<li class="fragment">Transit is second least</li>
<li class="fragment">Walking is third least</li>
<li class="fragment">Driving is most prevalent</li>
</ul></li>
</ul>
</div>
</section>
<section id="interpreting-a-multinomial-logit-model-coefficients" class="slide level2">
<h2>Interpreting a multinomial logit model: coefficients</h2>
<div id="c775c5cb" class="cell" data-execution_count="22">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="190">
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Value</th>
<th style="text-align: right;">Rob. Std err</th>
<th style="text-align: right;">Rob. t-test</th>
<th style="text-align: right;">Rob. p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>asc_bike</td>
<td style="text-align: right;">-4.00531</td>
<td style="text-align: right;">0.127131</td>
<td style="text-align: right;">-31.5054</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>asc_transit</td>
<td style="text-align: right;">-2.51007</td>
<td style="text-align: right;">0.0620306</td>
<td style="text-align: right;">-40.4651</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td>asc_walk</td>
<td style="text-align: right;">-1.52704</td>
<td style="text-align: right;">0.0402585</td>
<td style="text-align: right;">-37.9309</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<ul>
<li class="fragment">In higher income households, relative to lower income households and relative to driving
<ul>
<li class="fragment">Is walking more prevalent than driving, or just relatively more prevalent <span class="emoji" data-emoji="thinking">🤔</span>
<ul>
<li class="fragment">This is probably because this is Seattle which has an affluent, walkable downtown</li>
</ul></li>
<li class="fragment">Biking is not really affected much by income (not statistically significant)</li>
<li class="fragment">Transit is relatively less prevalent</li>
<li class="fragment">Walking is relatively more prevalent</li>
</ul></li>
</ul>
</div>
</section>
<section id="estimating-a-multinomial-logit-model-yourself" class="slide level2">
<h2>Estimating a multinomial logit model yourself</h2>
<div id="dfc9eaeb" class="cell" data-execution_count="23">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>seattle_mnl_income.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a><span class="im">import</span> biogeme.database <span class="im">as</span> db, biogeme.biogeme <span class="im">as</span> bio</span>
<span id="cb10-2"><a></a><span class="im">from</span> biogeme <span class="im">import</span> models</span>
<span id="cb10-3"><a></a><span class="im">from</span> biogeme.expressions <span class="im">import</span> Beta, Variable</span>
<span id="cb10-4"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-5"><a></a></span>
<span id="cb10-6"><a></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/seattle_trips.csv"</span>) <span class="co"># read data</span></span>
<span id="cb10-7"><a></a></span>
<span id="cb10-8"><a></a><span class="co"># create our choice variable - it is coded as text in the data but Biogeme requires</span></span>
<span id="cb10-9"><a></a><span class="co"># it to be numeric</span></span>
<span id="cb10-10"><a></a>df[<span class="st">"numeric_mode"</span>] <span class="op">=</span> df.mode_choice.replace({</span>
<span id="cb10-11"><a></a>    <span class="st">"Car"</span>: <span class="dv">1</span>,</span>
<span id="cb10-12"><a></a>    <span class="st">"Transit"</span>: <span class="dv">2</span>,</span>
<span id="cb10-13"><a></a>    <span class="st">"Walk"</span>: <span class="dv">3</span>,</span>
<span id="cb10-14"><a></a>    <span class="st">"Bike"</span>: <span class="dv">4</span></span>
<span id="cb10-15"><a></a>})</span>
<span id="cb10-16"><a></a></span>
<span id="cb10-17"><a></a>data <span class="op">=</span> db.Database(<span class="st">"Seattle"</span>, pd.get_dummies(df).astype(<span class="st">"float64"</span>))</span>
<span id="cb10-18"><a></a></span>
<span id="cb10-19"><a></a><span class="co"># specify coefficients - all start at zero, have no bounds (None, None), and are</span></span>
<span id="cb10-20"><a></a><span class="co"># estimated rather than fixed (0)</span></span>
<span id="cb10-21"><a></a>asc_bike <span class="op">=</span> Beta(<span class="st">"asc_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb10-22"><a></a>b_income_over_100k_bike <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb10-23"><a></a></span>
<span id="cb10-24"><a></a>asc_walk <span class="op">=</span> Beta(<span class="st">"asc_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb10-25"><a></a>b_income_over_100k_walk <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb10-26"><a></a></span>
<span id="cb10-27"><a></a>asc_transit <span class="op">=</span> Beta(<span class="st">"asc_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb10-28"><a></a>b_income_over_100k_transit <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb10-29"><a></a></span>
<span id="cb10-30"><a></a><span class="co"># and specify the variables we want to use</span></span>
<span id="cb10-31"><a></a>income_over_100k <span class="op">=</span> Variable(<span class="st">"income_over_100k"</span>)</span>
<span id="cb10-32"><a></a></span>
<span id="cb10-33"><a></a>V <span class="op">=</span> {</span>
<span id="cb10-34"><a></a>    <span class="co"># Car</span></span>
<span id="cb10-35"><a></a>    <span class="dv">1</span>: <span class="dv">0</span>,</span>
<span id="cb10-36"><a></a></span>
<span id="cb10-37"><a></a>    <span class="co"># Transit</span></span>
<span id="cb10-38"><a></a>    <span class="dv">2</span>: asc_transit <span class="op">+</span> b_income_over_100k_transit <span class="op">*</span> income_over_100k,</span>
<span id="cb10-39"><a></a></span>
<span id="cb10-40"><a></a>    <span class="co"># Walk</span></span>
<span id="cb10-41"><a></a>    <span class="dv">3</span>: asc_walk <span class="op">+</span> b_income_over_100k_walk <span class="op">*</span> income_over_100k,</span>
<span id="cb10-42"><a></a></span>
<span id="cb10-43"><a></a>    <span class="co"># Bike</span></span>
<span id="cb10-44"><a></a>    <span class="dv">4</span>: asc_bike <span class="op">+</span> b_income_over_100k_bike <span class="op">*</span> income_over_100k</span>
<span id="cb10-45"><a></a>}</span>
<span id="cb10-46"><a></a></span>
<span id="cb10-47"><a></a>av <span class="op">=</span> {<span class="dv">1</span>: <span class="dv">1</span>, <span class="dv">2</span>: <span class="dv">1</span>, <span class="dv">3</span>: <span class="dv">1</span>, <span class="dv">4</span>: <span class="dv">1</span>}</span>
<span id="cb10-48"><a></a></span>
<span id="cb10-49"><a></a>logprob <span class="op">=</span> models.loglogit(V, av, Variable(<span class="st">"numeric_mode"</span>))</span>
<span id="cb10-50"><a></a></span>
<span id="cb10-51"><a></a>model <span class="op">=</span> bio.BIOGEME(data, logprob)</span>
<span id="cb10-52"><a></a>model.modelName <span class="op">=</span> <span class="st">"seattle_mnl_income"</span></span>
<span id="cb10-53"><a></a>model.calculateNullLoglikelihood(av)</span>
<span id="cb10-54"><a></a>result <span class="op">=</span> model.estimate()</span>
<span id="cb10-55"><a></a></span>
<span id="cb10-56"><a></a><span class="cf">assert</span> result.algorithm_has_converged()</span>
<span id="cb10-57"><a></a><span class="bu">print</span>(result.shortSummary())</span>
<span id="cb10-58"><a></a><span class="bu">print</span>(result.getEstimatedParameters())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Results for model seattle_mnl_income
Nbr of parameters:      6
Sample size:            8883
Excluded data:          0
Null log likelihood:        -12314.45
Final log likelihood:       -6209.072
Likelihood ratio test (null):       12210.76
Rho square (null):          0.496
Rho bar square (null):          0.495
Akaike Information Criterion:   12430.14
Bayesian Information Criterion: 12472.7

                               Value  Rob. Std err  Rob. t-test  Rob. p-value
asc_bike                   -4.005212      0.127118   -31.507711      0.000000
asc_transit                -2.510091      0.062032   -40.464744      0.000000
asc_walk                   -1.527040      0.040259   -37.930872      0.000000
b_income_over_100k_bike     0.122133      0.176544     0.691802      0.489062
b_income_over_100k_transit -1.465361      0.142407   -10.289965      0.000000
b_income_over_100k_walk     0.223509      0.055121     4.054884      0.000050</code></pre>
</div>
</div>
</section>
<section id="exercise-add-a-variable" class="slide level2">
<h2>Exercise: add a variable</h2>
<div>
<ul>
<li class="fragment">Add the <code>rush_hour</code> variable to the model - this is a binary variable for trips that occur during the AM or PM rush hours
<ul>
<li class="fragment">Hint: you need to add it to the bike, walk, and transit utility function, with different betas</li>
</ul></li>
</ul>
</div>
</section>
<section id="exercise-add-a-variable-answer" class="slide level2">
<h2>Exercise: add a variable: answer</h2>
<div id="b6e89fe3" class="cell" data-execution_count="24">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>seattle_mnl_income_rush.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a><span class="im">import</span> biogeme.database <span class="im">as</span> db, biogeme.biogeme <span class="im">as</span> bio</span>
<span id="cb12-2"><a></a><span class="im">from</span> biogeme <span class="im">import</span> models</span>
<span id="cb12-3"><a></a><span class="im">from</span> biogeme.expressions <span class="im">import</span> Beta, Variable</span>
<span id="cb12-4"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-5"><a></a></span>
<span id="cb12-6"><a></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/seattle_trips.csv"</span>) <span class="co"># read data</span></span>
<span id="cb12-7"><a></a></span>
<span id="cb12-8"><a></a><span class="co"># create our choice variable - it is coded as text in the data but Biogeme requires</span></span>
<span id="cb12-9"><a></a><span class="co"># it to be numeric</span></span>
<span id="cb12-10"><a></a>df[<span class="st">"numeric_mode"</span>] <span class="op">=</span> df.mode_choice.replace({</span>
<span id="cb12-11"><a></a>    <span class="st">"Car"</span>: <span class="dv">1</span>,</span>
<span id="cb12-12"><a></a>    <span class="st">"Transit"</span>: <span class="dv">2</span>,</span>
<span id="cb12-13"><a></a>    <span class="st">"Walk"</span>: <span class="dv">3</span>,</span>
<span id="cb12-14"><a></a>    <span class="st">"Bike"</span>: <span class="dv">4</span></span>
<span id="cb12-15"><a></a>})</span>
<span id="cb12-16"><a></a></span>
<span id="cb12-17"><a></a>data <span class="op">=</span> db.Database(<span class="st">"Seattle"</span>, pd.get_dummies(df).astype(<span class="st">"float64"</span>))</span>
<span id="cb12-18"><a></a></span>
<span id="cb12-19"><a></a><span class="co"># specify coefficients - all start at zero, have no bounds (None, None), and are</span></span>
<span id="cb12-20"><a></a><span class="co"># estimated rather than fixed (0)</span></span>
<span id="cb12-21"><a></a>asc_bike <span class="op">=</span> Beta(<span class="st">"asc_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb12-22"><a></a>b_income_over_100k_bike <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb12-23"><a></a>b_rush_hour_bike <span class="op">=</span> Beta(<span class="st">"b_rush_hour_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb12-24"><a></a></span>
<span id="cb12-25"><a></a>asc_walk <span class="op">=</span> Beta(<span class="st">"asc_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb12-26"><a></a>b_income_over_100k_walk <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb12-27"><a></a>b_rush_hour_walk <span class="op">=</span> Beta(<span class="st">"b_rush_hour_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb12-28"><a></a></span>
<span id="cb12-29"><a></a>asc_transit <span class="op">=</span> Beta(<span class="st">"asc_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb12-30"><a></a>b_income_over_100k_transit <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb12-31"><a></a>b_rush_hour_transit <span class="op">=</span> Beta(<span class="st">"b_rush_hour_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb12-32"><a></a></span>
<span id="cb12-33"><a></a><span class="co"># and specify the variables we want to use</span></span>
<span id="cb12-34"><a></a>income_over_100k <span class="op">=</span> Variable(<span class="st">"income_over_100k"</span>)</span>
<span id="cb12-35"><a></a>rush_hour <span class="op">=</span> Variable(<span class="st">"rush_hour"</span>)</span>
<span id="cb12-36"><a></a></span>
<span id="cb12-37"><a></a>V <span class="op">=</span> {</span>
<span id="cb12-38"><a></a>    <span class="co"># Car</span></span>
<span id="cb12-39"><a></a>    <span class="dv">1</span>: <span class="dv">0</span>,</span>
<span id="cb12-40"><a></a></span>
<span id="cb12-41"><a></a>    <span class="co"># Transit</span></span>
<span id="cb12-42"><a></a>    <span class="dv">2</span>: asc_transit <span class="op">+</span> b_income_over_100k_transit <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_transit <span class="op">*</span> rush_hour,</span>
<span id="cb12-43"><a></a></span>
<span id="cb12-44"><a></a>    <span class="co"># Walk</span></span>
<span id="cb12-45"><a></a>    <span class="dv">3</span>: asc_walk <span class="op">+</span> b_income_over_100k_walk <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_walk <span class="op">*</span> rush_hour,</span>
<span id="cb12-46"><a></a></span>
<span id="cb12-47"><a></a>    <span class="co"># Bike</span></span>
<span id="cb12-48"><a></a>    <span class="dv">4</span>: asc_bike <span class="op">+</span> b_income_over_100k_bike <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_bike <span class="op">*</span> rush_hour</span>
<span id="cb12-49"><a></a>}</span>
<span id="cb12-50"><a></a></span>
<span id="cb12-51"><a></a>av <span class="op">=</span> {<span class="dv">1</span>: <span class="dv">1</span>, <span class="dv">2</span>: <span class="dv">1</span>, <span class="dv">3</span>: <span class="dv">1</span>, <span class="dv">4</span>: <span class="dv">1</span>}</span>
<span id="cb12-52"><a></a></span>
<span id="cb12-53"><a></a>logprob <span class="op">=</span> models.loglogit(V, av, Variable(<span class="st">"numeric_mode"</span>))</span>
<span id="cb12-54"><a></a></span>
<span id="cb12-55"><a></a>model <span class="op">=</span> bio.BIOGEME(data, logprob)</span>
<span id="cb12-56"><a></a>model.modelName <span class="op">=</span> <span class="st">"seattle_mnl_income_rush"</span></span>
<span id="cb12-57"><a></a>model.calculateNullLoglikelihood(av)</span>
<span id="cb12-58"><a></a>result <span class="op">=</span> model.estimate()</span>
<span id="cb12-59"><a></a></span>
<span id="cb12-60"><a></a><span class="cf">assert</span> result.algorithm_has_converged()</span>
<span id="cb12-61"><a></a><span class="bu">print</span>(result.shortSummary())</span>
<span id="cb12-62"><a></a><span class="bu">print</span>(result.getEstimatedParameters())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Results for model seattle_mnl_income_rush
Nbr of parameters:      9
Sample size:            8883
Excluded data:          0
Null log likelihood:        -12314.45
Final log likelihood:       -6184.064
Likelihood ratio test (null):       12260.78
Rho square (null):          0.498
Rho bar square (null):          0.497
Akaike Information Criterion:   12386.13
Bayesian Information Criterion: 12449.96

                               Value  Rob. Std err  Rob. t-test  Rob. p-value
asc_bike                   -4.008837      0.134121   -29.889667  0.000000e+00
asc_transit                -2.617443      0.071685   -36.513098  0.000000e+00
asc_walk                   -1.449042      0.041688   -34.759410  0.000000e+00
b_income_over_100k_bike     0.122119      0.176574     0.691606  4.891848e-01
b_income_over_100k_transit -1.466734      0.142462   -10.295601  0.000000e+00
b_income_over_100k_walk     0.224605      0.055248     4.065401  4.794995e-05
b_rush_hour_bike            0.016448      0.212542     0.077387  9.383157e-01
b_rush_hour_transit         0.420138      0.122775     3.422028  6.215582e-04
b_rush_hour_walk           -0.424242      0.074428    -5.700050  1.197720e-08</code></pre>
</div>
</div>
</section>
<section id="interpreting-the-coefficient-changes-i" class="slide level2">
<h2>Interpreting the coefficient changes I</h2>
<div id="dc133fa3" class="cell" data-execution_count="25">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="193">
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Value</th>
<th style="text-align: right;">Rob. Std err</th>
<th style="text-align: right;">Rob. t-test</th>
<th style="text-align: right;">Rob. p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>asc_bike</td>
<td style="text-align: right;">-4.00884</td>
<td style="text-align: right;">0.134121</td>
<td style="text-align: right;">-29.8897</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>asc_transit</td>
<td style="text-align: right;">-2.61744</td>
<td style="text-align: right;">0.071685</td>
<td style="text-align: right;">-36.5131</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td>asc_walk</td>
<td style="text-align: right;">-1.44904</td>
<td style="text-align: right;">0.0416878</td>
<td style="text-align: right;">-34.7594</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>b_income_over_100k_bike</td>
<td style="text-align: right;">0.122119</td>
<td style="text-align: right;">0.176574</td>
<td style="text-align: right;">0.691606</td>
<td style="text-align: right;">0.489185</td>
</tr>
<tr class="odd">
<td>b_income_over_100k_transit</td>
<td style="text-align: right;">-1.46673</td>
<td style="text-align: right;">0.142462</td>
<td style="text-align: right;">-10.2956</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>b_income_over_100k_walk</td>
<td style="text-align: right;">0.224605</td>
<td style="text-align: right;">0.0552479</td>
<td style="text-align: right;">4.0654</td>
<td style="text-align: right;">4.795e-05</td>
</tr>
<tr class="odd">
<td>b_rush_hour_bike</td>
<td style="text-align: right;">0.016448</td>
<td style="text-align: right;">0.212542</td>
<td style="text-align: right;">0.0773869</td>
<td style="text-align: right;">0.938316</td>
</tr>
<tr class="even">
<td>b_rush_hour_transit</td>
<td style="text-align: right;">0.420138</td>
<td style="text-align: right;">0.122775</td>
<td style="text-align: right;">3.42203</td>
<td style="text-align: right;">0.000621558</td>
</tr>
<tr class="odd">
<td>b_rush_hour_walk</td>
<td style="text-align: right;">-0.424242</td>
<td style="text-align: right;">0.0744278</td>
<td style="text-align: right;">-5.70005</td>
<td style="text-align: right;">1.19772e-08</td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<ul>
<li class="fragment">Biking is about the same at rush hour vs.&nbsp;not</li>
<li class="fragment">Transit ridership is relatively higher during rush hour</li>
<li class="fragment">Walking is relatively lower during during rush hour</li>
</ul>
</div>
</section>
<section id="interpreting-the-coefficient-changes-ii" class="slide level2">
<h2>Interpreting the coefficient changes II</h2>
<div id="5d42d0cb" class="cell" data-execution_count="26">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="194">
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Value</th>
<th style="text-align: right;">Rob. Std err</th>
<th style="text-align: right;">Rob. t-test</th>
<th style="text-align: right;">Rob. p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>asc_bike</td>
<td style="text-align: right;">-4.00884</td>
<td style="text-align: right;">0.134121</td>
<td style="text-align: right;">-29.8897</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>asc_transit</td>
<td style="text-align: right;">-2.61744</td>
<td style="text-align: right;">0.071685</td>
<td style="text-align: right;">-36.5131</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td>asc_walk</td>
<td style="text-align: right;">-1.44904</td>
<td style="text-align: right;">0.0416878</td>
<td style="text-align: right;">-34.7594</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>b_income_over_100k_bike</td>
<td style="text-align: right;">0.122119</td>
<td style="text-align: right;">0.176574</td>
<td style="text-align: right;">0.691606</td>
<td style="text-align: right;">0.489185</td>
</tr>
<tr class="odd">
<td>b_income_over_100k_transit</td>
<td style="text-align: right;">-1.46673</td>
<td style="text-align: right;">0.142462</td>
<td style="text-align: right;">-10.2956</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>b_income_over_100k_walk</td>
<td style="text-align: right;">0.224605</td>
<td style="text-align: right;">0.0552479</td>
<td style="text-align: right;">4.0654</td>
<td style="text-align: right;">4.795e-05</td>
</tr>
<tr class="odd">
<td>b_rush_hour_bike</td>
<td style="text-align: right;">0.016448</td>
<td style="text-align: right;">0.212542</td>
<td style="text-align: right;">0.0773869</td>
<td style="text-align: right;">0.938316</td>
</tr>
<tr class="even">
<td>b_rush_hour_transit</td>
<td style="text-align: right;">0.420138</td>
<td style="text-align: right;">0.122775</td>
<td style="text-align: right;">3.42203</td>
<td style="text-align: right;">0.000621558</td>
</tr>
<tr class="odd">
<td>b_rush_hour_walk</td>
<td style="text-align: right;">-0.424242</td>
<td style="text-align: right;">0.0744278</td>
<td style="text-align: right;">-5.70005</td>
<td style="text-align: right;">1.19772e-08</td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<ul>
<li class="fragment">What happens to driving?
<ul>
<li class="fragment">We have set driving as the reference level, so all of these other changes are relative to the change in driving</li>
</ul></li>
</ul>
</div>
</section>
<section id="availability" class="slide level2">
<h2>Availability</h2>
<ul>
<li>Sometimes, not all options will be available to all decisionmakers</li>
<li>For example,
<ul>
<li>In Internet choice, some types of Internet service are not available to certain homes</li>
<li>In mode choice, transit may not be available in some areas
<ul>
<li>Sometimes modelers assume people without cars cannot choose driving, but a significant percentage of trips in zero-vehicle households do occur by car</li>
</ul></li>
</ul></li>
<li>We can add an availability constraint to our model to indicate which alternatives are available to which decisionmakers</li>
<li>This effectively sets <span class="math inline">V_{mode} = -\infty</span>, so it will always be worse than every other option</li>
</ul>
</section>
<section id="adding-a-transit-availability-constraint" class="slide level2">
<h2>Adding a transit availability constraint</h2>
<ul>
<li>We constrain choices in the model to indicate that transit is unavailable for some trips</li>
</ul>
<div id="cb1196c2" class="cell" data-execution_count="27">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>seattle_mnl_availability.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a><span class="im">import</span> biogeme.database <span class="im">as</span> db, biogeme.biogeme <span class="im">as</span> bio</span>
<span id="cb14-2"><a></a><span class="im">from</span> biogeme <span class="im">import</span> models</span>
<span id="cb14-3"><a></a><span class="im">from</span> biogeme.expressions <span class="im">import</span> Beta, Variable</span>
<span id="cb14-4"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb14-5"><a></a></span>
<span id="cb14-6"><a></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/seattle_trips.csv"</span>) <span class="co"># read data</span></span>
<span id="cb14-7"><a></a></span>
<span id="cb14-8"><a></a><span class="co"># create our choice variable - it is coded as text in the data but Biogeme requires</span></span>
<span id="cb14-9"><a></a><span class="co"># it to be numeric</span></span>
<span id="cb14-10"><a></a>df[<span class="st">"numeric_mode"</span>] <span class="op">=</span> df.mode_choice.replace({</span>
<span id="cb14-11"><a></a>    <span class="st">"Car"</span>: <span class="dv">1</span>,</span>
<span id="cb14-12"><a></a>    <span class="st">"Transit"</span>: <span class="dv">2</span>,</span>
<span id="cb14-13"><a></a>    <span class="st">"Walk"</span>: <span class="dv">3</span>,</span>
<span id="cb14-14"><a></a>    <span class="st">"Bike"</span>: <span class="dv">4</span></span>
<span id="cb14-15"><a></a>})</span>
<span id="cb14-16"><a></a></span>
<span id="cb14-17"><a></a>data <span class="op">=</span> db.Database(<span class="st">"Seattle"</span>, pd.get_dummies(df).astype(<span class="st">"float64"</span>))</span>
<span id="cb14-18"><a></a></span>
<span id="cb14-19"><a></a><span class="co"># specify coefficients - all start at zero, have no bounds (None, None), and are</span></span>
<span id="cb14-20"><a></a><span class="co"># estimated rather than fixed (0)</span></span>
<span id="cb14-21"><a></a>asc_bike <span class="op">=</span> Beta(<span class="st">"asc_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb14-22"><a></a>b_income_over_100k_bike <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb14-23"><a></a>b_rush_hour_bike <span class="op">=</span> Beta(<span class="st">"b_rush_hour_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb14-24"><a></a></span>
<span id="cb14-25"><a></a>asc_walk <span class="op">=</span> Beta(<span class="st">"asc_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb14-26"><a></a>b_income_over_100k_walk <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb14-27"><a></a>b_rush_hour_walk <span class="op">=</span> Beta(<span class="st">"b_rush_hour_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb14-28"><a></a></span>
<span id="cb14-29"><a></a>asc_transit <span class="op">=</span> Beta(<span class="st">"asc_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb14-30"><a></a>b_income_over_100k_transit <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb14-31"><a></a>b_rush_hour_transit <span class="op">=</span> Beta(<span class="st">"b_rush_hour_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb14-32"><a></a></span>
<span id="cb14-33"><a></a><span class="co"># and specify the variables we want to use</span></span>
<span id="cb14-34"><a></a>income_over_100k <span class="op">=</span> Variable(<span class="st">"income_over_100k"</span>)</span>
<span id="cb14-35"><a></a>rush_hour <span class="op">=</span> Variable(<span class="st">"rush_hour"</span>)</span>
<span id="cb14-36"><a></a></span>
<span id="cb14-37"><a></a>V <span class="op">=</span> {</span>
<span id="cb14-38"><a></a>    <span class="co"># Car</span></span>
<span id="cb14-39"><a></a>    <span class="dv">1</span>: <span class="dv">0</span>,</span>
<span id="cb14-40"><a></a></span>
<span id="cb14-41"><a></a>    <span class="co"># Transit</span></span>
<span id="cb14-42"><a></a>    <span class="dv">2</span>: asc_transit <span class="op">+</span> b_income_over_100k_transit <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_transit <span class="op">*</span> rush_hour,</span>
<span id="cb14-43"><a></a></span>
<span id="cb14-44"><a></a>    <span class="co"># Walk</span></span>
<span id="cb14-45"><a></a>    <span class="dv">3</span>: asc_walk <span class="op">+</span> b_income_over_100k_walk <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_walk <span class="op">*</span> rush_hour,</span>
<span id="cb14-46"><a></a></span>
<span id="cb14-47"><a></a>    <span class="co"># Bike</span></span>
<span id="cb14-48"><a></a>    <span class="dv">4</span>: asc_bike <span class="op">+</span> b_income_over_100k_bike <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_bike <span class="op">*</span> rush_hour</span>
<span id="cb14-49"><a></a>}</span>
<span id="cb14-50"><a></a></span>
<span id="cb14-51"><a></a><span class="co"># here we set the transit availability variable. We leave the other modes set to 1 - available</span></span>
<span id="cb14-52"><a></a><span class="co"># to all decisionmakers.</span></span>
<span id="cb14-53"><a></a>av <span class="op">=</span> {<span class="dv">1</span>: <span class="dv">1</span>, <span class="dv">2</span>: Variable(<span class="st">"transit_available"</span>), <span class="dv">3</span>: <span class="dv">1</span>, <span class="dv">4</span>: <span class="dv">1</span>}</span>
<span id="cb14-54"><a></a></span>
<span id="cb14-55"><a></a>logprob <span class="op">=</span> models.loglogit(V, av, Variable(<span class="st">"numeric_mode"</span>))</span>
<span id="cb14-56"><a></a></span>
<span id="cb14-57"><a></a>model <span class="op">=</span> bio.BIOGEME(data, logprob)</span>
<span id="cb14-58"><a></a>model.modelName <span class="op">=</span> <span class="st">"seattle_mnl_availability"</span></span>
<span id="cb14-59"><a></a>model.calculateNullLoglikelihood(av)</span>
<span id="cb14-60"><a></a>result <span class="op">=</span> model.estimate()</span>
<span id="cb14-61"><a></a></span>
<span id="cb14-62"><a></a><span class="cf">assert</span> result.algorithm_has_converged()</span>
<span id="cb14-63"><a></a><span class="bu">print</span>(result.shortSummary())</span>
<span id="cb14-64"><a></a><span class="bu">print</span>(result.getEstimatedParameters())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Results for model seattle_mnl_availability
Nbr of parameters:      9
Sample size:            8883
Excluded data:          0
Null log likelihood:        -11985.34
Final log likelihood:       -1.797693e+308
Likelihood ratio test (null):       -inf
Rho square (null):          -1.5e+304
Rho bar square (null):          -1.5e+304
Akaike Information Criterion:   inf
Bayesian Information Criterion: inf

                            Value  Rob. Std err  Rob. t-test  Rob. p-value
asc_bike                      0.0      0.053661          0.0           1.0
asc_transit                   0.0      0.056451          0.0           1.0
asc_walk                      0.0      0.058790          0.0           1.0
b_income_over_100k_bike       0.0      0.071824          0.0           1.0
b_income_over_100k_transit    0.0      0.074577          0.0           1.0
b_income_over_100k_walk       0.0      0.079367          0.0           1.0
b_rush_hour_bike              0.0      0.089161          0.0           1.0
b_rush_hour_transit           0.0      0.094065          0.0           1.0
b_rush_hour_walk              0.0      0.096364          0.0           1.0</code></pre>
</div>
</div>
</section>
<section id="what-went-wrong" class="slide level2">
<h2>What went wrong?</h2>
<ul>
<li>Some people in our dataset chose transit even though (we thought) it was not available to them</li>
<li>This is fairly common
<ul>
<li>Since we need attributes of all the mode options for each trip, I generated the <code>travel_time</code> variable with a trip planner (like Google Maps)</li>
<li>I assumed that transit was only available if it was within 2.5km</li>
<li>Some people might walk further than that, or drive to the bus, or bike (like me!)</li>
<li>Some of the trips are also using transit systems that I did not have schedules for</li>
</ul></li>
<li>For now, we’ll just remove them</li>
<li>In practice, you should look at these trips to see if they indicate errors or if removing them might bias results</li>
</ul>
</section>
<section id="fixing-the-issue" class="slide level2">
<h2>Fixing the issue</h2>
<div id="7c19b43e" class="cell" data-execution_count="28">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>seattle_mnl_availability_fixed.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a></a><span class="im">import</span> biogeme.database <span class="im">as</span> db, biogeme.biogeme <span class="im">as</span> bio</span>
<span id="cb16-2"><a></a><span class="im">from</span> biogeme <span class="im">import</span> models</span>
<span id="cb16-3"><a></a><span class="im">from</span> biogeme.expressions <span class="im">import</span> Beta, Variable</span>
<span id="cb16-4"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb16-5"><a></a></span>
<span id="cb16-6"><a></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/seattle_trips.csv"</span>) <span class="co"># read data</span></span>
<span id="cb16-7"><a></a></span>
<span id="cb16-8"><a></a><span class="co"># Remove people who chose transit despite transit not being available</span></span>
<span id="cb16-9"><a></a>df <span class="op">=</span> df.loc[(df.mode_choice <span class="op">!=</span> <span class="st">"Transit"</span>) <span class="op">|</span> df.transit_available, :]</span>
<span id="cb16-10"><a></a></span>
<span id="cb16-11"><a></a><span class="co"># create our choice variable - it is coded as text in the data but Biogeme requires</span></span>
<span id="cb16-12"><a></a><span class="co"># it to be numeric</span></span>
<span id="cb16-13"><a></a>df[<span class="st">"numeric_mode"</span>] <span class="op">=</span> df.mode_choice.replace({</span>
<span id="cb16-14"><a></a>    <span class="st">"Car"</span>: <span class="dv">1</span>,</span>
<span id="cb16-15"><a></a>    <span class="st">"Transit"</span>: <span class="dv">2</span>,</span>
<span id="cb16-16"><a></a>    <span class="st">"Walk"</span>: <span class="dv">3</span>,</span>
<span id="cb16-17"><a></a>    <span class="st">"Bike"</span>: <span class="dv">4</span></span>
<span id="cb16-18"><a></a>})</span>
<span id="cb16-19"><a></a></span>
<span id="cb16-20"><a></a>data <span class="op">=</span> db.Database(<span class="st">"Seattle"</span>, pd.get_dummies(df).astype(<span class="st">"float64"</span>))</span>
<span id="cb16-21"><a></a></span>
<span id="cb16-22"><a></a><span class="co"># specify coefficients - all start at zero, have no bounds (None, None), and are</span></span>
<span id="cb16-23"><a></a><span class="co"># estimated rather than fixed (0)</span></span>
<span id="cb16-24"><a></a>asc_bike <span class="op">=</span> Beta(<span class="st">"asc_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb16-25"><a></a>b_income_over_100k_bike <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb16-26"><a></a>b_rush_hour_bike <span class="op">=</span> Beta(<span class="st">"b_rush_hour_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb16-27"><a></a></span>
<span id="cb16-28"><a></a>asc_walk <span class="op">=</span> Beta(<span class="st">"asc_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb16-29"><a></a>b_income_over_100k_walk <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb16-30"><a></a>b_rush_hour_walk <span class="op">=</span> Beta(<span class="st">"b_rush_hour_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb16-31"><a></a></span>
<span id="cb16-32"><a></a>asc_transit <span class="op">=</span> Beta(<span class="st">"asc_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb16-33"><a></a>b_income_over_100k_transit <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb16-34"><a></a>b_rush_hour_transit <span class="op">=</span> Beta(<span class="st">"b_rush_hour_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb16-35"><a></a></span>
<span id="cb16-36"><a></a><span class="co"># and specify the variables we want to use</span></span>
<span id="cb16-37"><a></a>income_over_100k <span class="op">=</span> Variable(<span class="st">"income_over_100k"</span>)</span>
<span id="cb16-38"><a></a>rush_hour <span class="op">=</span> Variable(<span class="st">"rush_hour"</span>)</span>
<span id="cb16-39"><a></a></span>
<span id="cb16-40"><a></a>V <span class="op">=</span> {</span>
<span id="cb16-41"><a></a>    <span class="co"># Car</span></span>
<span id="cb16-42"><a></a>    <span class="dv">1</span>: <span class="dv">0</span>,</span>
<span id="cb16-43"><a></a></span>
<span id="cb16-44"><a></a>    <span class="co"># Transit</span></span>
<span id="cb16-45"><a></a>    <span class="dv">2</span>: asc_transit <span class="op">+</span> b_income_over_100k_transit <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_transit <span class="op">*</span> rush_hour,</span>
<span id="cb16-46"><a></a></span>
<span id="cb16-47"><a></a>    <span class="co"># Walk</span></span>
<span id="cb16-48"><a></a>    <span class="dv">3</span>: asc_walk <span class="op">+</span> b_income_over_100k_walk <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_walk <span class="op">*</span> rush_hour,</span>
<span id="cb16-49"><a></a></span>
<span id="cb16-50"><a></a>    <span class="co"># Bike</span></span>
<span id="cb16-51"><a></a>    <span class="dv">4</span>: asc_bike <span class="op">+</span> b_income_over_100k_bike <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_bike <span class="op">*</span> rush_hour</span>
<span id="cb16-52"><a></a>}</span>
<span id="cb16-53"><a></a></span>
<span id="cb16-54"><a></a><span class="co"># here we set the transit availability variable. We leave the other modes set to 1 - available</span></span>
<span id="cb16-55"><a></a><span class="co"># to all decisionmakers.</span></span>
<span id="cb16-56"><a></a>av <span class="op">=</span> {<span class="dv">1</span>: <span class="dv">1</span>, <span class="dv">2</span>: Variable(<span class="st">"transit_available"</span>), <span class="dv">3</span>: <span class="dv">1</span>, <span class="dv">4</span>: <span class="dv">1</span>}</span>
<span id="cb16-57"><a></a></span>
<span id="cb16-58"><a></a>logprob <span class="op">=</span> models.loglogit(V, av, Variable(<span class="st">"numeric_mode"</span>))</span>
<span id="cb16-59"><a></a></span>
<span id="cb16-60"><a></a>model <span class="op">=</span> bio.BIOGEME(data, logprob)</span>
<span id="cb16-61"><a></a>model.modelName <span class="op">=</span> <span class="st">"seattle_mnl_availability_fixed"</span></span>
<span id="cb16-62"><a></a>model.calculateNullLoglikelihood(av)</span>
<span id="cb16-63"><a></a>result <span class="op">=</span> model.estimate()</span>
<span id="cb16-64"><a></a></span>
<span id="cb16-65"><a></a><span class="cf">assert</span> result.algorithm_has_converged()</span>
<span id="cb16-66"><a></a><span class="bu">print</span>(result.shortSummary())</span>
<span id="cb16-67"><a></a><span class="bu">print</span>(result.getEstimatedParameters())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Results for model seattle_mnl_availability_fixed
Nbr of parameters:      9
Sample size:            8873
Excluded data:          0
Null log likelihood:        -11974.36
Final log likelihood:       -6102.726
Likelihood ratio test (null):       11743.26
Rho square (null):          0.49
Rho bar square (null):          0.49
Akaike Information Criterion:   12223.45
Bayesian Information Criterion: 12287.27

                               Value  Rob. Std err  Rob. t-test  Rob. p-value
asc_bike                   -4.008824      0.134137   -29.886108  0.000000e+00
asc_transit                -2.499443      0.072314   -34.563646  0.000000e+00
asc_walk                   -1.449008      0.041692   -34.754804  0.000000e+00
b_income_over_100k_bike     0.122101      0.176569     0.691521  4.892380e-01
b_income_over_100k_transit -1.529168      0.147781   -10.347520  0.000000e+00
b_income_over_100k_walk     0.224511      0.055248     4.063663  4.830857e-05
b_rush_hour_bike            0.016484      0.212537     0.077560  9.381783e-01
b_rush_hour_transit         0.446924      0.125502     3.561087  3.693233e-04
b_rush_hour_walk           -0.424159      0.074426    -5.699037  1.204861e-08</code></pre>
</div>
</div>
</section>
<section id="generic-variables" class="slide level2">
<h2>Generic variables</h2>
<ul>
<li>The variables we’ve discussed so far are “alternative-specific” — they need to have a separate coefficient for each alternative
<ul>
<li>they do not vary across alternatives for a single individual</li>
</ul></li>
<li>“Generic” variables vary across alternatives—for instance, travel time or cost
<ul>
<li>We can have a single coefficient across all alternatives if we want</li>
<li>This is the “generic” part—they can affect all alternatives the same way</li>
</ul></li>
</ul>
</section>
<section id="adding-a-generic-variable" class="slide level2">
<h2>Adding a generic variable</h2>
<ul>
<li>Let’s add travel time to the model</li>
<li>We can use just a single coefficient</li>
<li>Do we expect the coefficient to be negative or positive?</li>
</ul>
</section>
<section id="adding-a-generic-variable-in-biogeme" class="slide level2">
<h2>Adding a generic variable in Biogeme</h2>
<div id="165166e5" class="cell" data-execution_count="29">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>seattle_mnl_generic.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a></a><span class="im">import</span> biogeme.database <span class="im">as</span> db, biogeme.biogeme <span class="im">as</span> bio</span>
<span id="cb18-2"><a></a><span class="im">from</span> biogeme <span class="im">import</span> models</span>
<span id="cb18-3"><a></a><span class="im">from</span> biogeme.expressions <span class="im">import</span> Beta, Variable</span>
<span id="cb18-4"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb18-5"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb18-6"><a></a></span>
<span id="cb18-7"><a></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/seattle_trips.csv"</span>) <span class="co"># read data</span></span>
<span id="cb18-8"><a></a></span>
<span id="cb18-9"><a></a><span class="co"># Remove people who chose transit despite transit not being available</span></span>
<span id="cb18-10"><a></a>df <span class="op">=</span> df.loc[(df.mode_choice <span class="op">!=</span> <span class="st">"Transit"</span>) <span class="op">|</span> df.transit_available, :]</span>
<span id="cb18-11"><a></a></span>
<span id="cb18-12"><a></a><span class="co"># create our choice variable - it is coded as text in the data but Biogeme requires</span></span>
<span id="cb18-13"><a></a><span class="co"># it to be numeric</span></span>
<span id="cb18-14"><a></a>df[<span class="st">"numeric_mode"</span>] <span class="op">=</span> df.mode_choice.replace({</span>
<span id="cb18-15"><a></a>    <span class="st">"Car"</span>: <span class="dv">1</span>,</span>
<span id="cb18-16"><a></a>    <span class="st">"Transit"</span>: <span class="dv">2</span>,</span>
<span id="cb18-17"><a></a>    <span class="st">"Walk"</span>: <span class="dv">3</span>,</span>
<span id="cb18-18"><a></a>    <span class="st">"Bike"</span>: <span class="dv">4</span></span>
<span id="cb18-19"><a></a>})</span>
<span id="cb18-20"><a></a></span>
<span id="cb18-21"><a></a>data <span class="op">=</span> db.Database(<span class="st">"Seattle"</span>, pd.get_dummies(df).astype(<span class="st">"float64"</span>))</span>
<span id="cb18-22"><a></a></span>
<span id="cb18-23"><a></a><span class="co"># specify coefficients - all start at zero, have no bounds (None, None), and are</span></span>
<span id="cb18-24"><a></a><span class="co"># estimated rather than fixed (0)</span></span>
<span id="cb18-25"><a></a>asc_bike <span class="op">=</span> Beta(<span class="st">"asc_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb18-26"><a></a>b_income_over_100k_bike <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb18-27"><a></a>b_rush_hour_bike <span class="op">=</span> Beta(<span class="st">"b_rush_hour_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb18-28"><a></a></span>
<span id="cb18-29"><a></a>asc_walk <span class="op">=</span> Beta(<span class="st">"asc_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb18-30"><a></a>b_income_over_100k_walk <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb18-31"><a></a>b_rush_hour_walk <span class="op">=</span> Beta(<span class="st">"b_rush_hour_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb18-32"><a></a></span>
<span id="cb18-33"><a></a>asc_transit <span class="op">=</span> Beta(<span class="st">"asc_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb18-34"><a></a>b_income_over_100k_transit <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb18-35"><a></a>b_rush_hour_transit <span class="op">=</span> Beta(<span class="st">"b_rush_hour_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb18-36"><a></a></span>
<span id="cb18-37"><a></a><span class="co"># we only need one coefficient for travel time</span></span>
<span id="cb18-38"><a></a>b_travel_time <span class="op">=</span> Beta(<span class="st">"b_travel_time"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb18-39"><a></a></span>
<span id="cb18-40"><a></a><span class="co"># and specify the variables we want to use</span></span>
<span id="cb18-41"><a></a>income_over_100k <span class="op">=</span> Variable(<span class="st">"income_over_100k"</span>)</span>
<span id="cb18-42"><a></a>rush_hour <span class="op">=</span> Variable(<span class="st">"rush_hour"</span>)</span>
<span id="cb18-43"><a></a></span>
<span id="cb18-44"><a></a><span class="co"># but we need the travel time variables for each mode</span></span>
<span id="cb18-45"><a></a>car_travel_time_mins <span class="op">=</span> Variable(<span class="st">"car_travel_time_mins"</span>)</span>
<span id="cb18-46"><a></a>bike_travel_time_mins <span class="op">=</span> Variable(<span class="st">"bike_travel_time_mins"</span>)</span>
<span id="cb18-47"><a></a>walk_travel_time_mins <span class="op">=</span> Variable(<span class="st">"walk_travel_time_mins"</span>)</span>
<span id="cb18-48"><a></a>transit_travel_time_mins <span class="op">=</span> Variable(<span class="st">"transit_travel_time_mins"</span>)</span>
<span id="cb18-49"><a></a></span>
<span id="cb18-50"><a></a>V <span class="op">=</span> {</span>
<span id="cb18-51"><a></a>    <span class="co"># Car</span></span>
<span id="cb18-52"><a></a>    <span class="dv">1</span>: b_travel_time <span class="op">*</span> car_travel_time_mins,</span>
<span id="cb18-53"><a></a></span>
<span id="cb18-54"><a></a>    <span class="co"># Transit</span></span>
<span id="cb18-55"><a></a>    <span class="dv">2</span>: asc_transit <span class="op">+</span> b_income_over_100k_transit <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_transit <span class="op">*</span> rush_hour <span class="op">+</span> b_travel_time <span class="op">*</span> transit_travel_time_mins,</span>
<span id="cb18-56"><a></a></span>
<span id="cb18-57"><a></a>    <span class="co"># Walk</span></span>
<span id="cb18-58"><a></a>    <span class="dv">3</span>: asc_walk <span class="op">+</span> b_income_over_100k_walk <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_walk <span class="op">*</span> rush_hour <span class="op">+</span> b_travel_time <span class="op">*</span> walk_travel_time_mins,</span>
<span id="cb18-59"><a></a></span>
<span id="cb18-60"><a></a>    <span class="co"># Bike</span></span>
<span id="cb18-61"><a></a>    <span class="dv">4</span>: asc_bike <span class="op">+</span> b_income_over_100k_bike <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_bike <span class="op">*</span> rush_hour <span class="op">+</span> b_travel_time <span class="op">*</span> bike_travel_time_mins</span>
<span id="cb18-62"><a></a>}</span>
<span id="cb18-63"><a></a></span>
<span id="cb18-64"><a></a>av <span class="op">=</span> {<span class="dv">1</span>: <span class="dv">1</span>, <span class="dv">2</span>: Variable(<span class="st">"transit_available"</span>), <span class="dv">3</span>: <span class="dv">1</span>, <span class="dv">4</span>: <span class="dv">1</span>}</span>
<span id="cb18-65"><a></a></span>
<span id="cb18-66"><a></a>logprob <span class="op">=</span> models.loglogit(V, av, Variable(<span class="st">"numeric_mode"</span>))</span>
<span id="cb18-67"><a></a></span>
<span id="cb18-68"><a></a>model <span class="op">=</span> bio.BIOGEME(data, logprob)</span>
<span id="cb18-69"><a></a>model.modelName <span class="op">=</span> <span class="st">"seattle_mnl_generic"</span></span>
<span id="cb18-70"><a></a>model.calculateNullLoglikelihood(av)</span>
<span id="cb18-71"><a></a>result <span class="op">=</span> model.estimate()</span>
<span id="cb18-72"><a></a></span>
<span id="cb18-73"><a></a><span class="cf">assert</span> result.algorithm_has_converged()</span>
<span id="cb18-74"><a></a><span class="bu">print</span>(result.shortSummary())</span>
<span id="cb18-75"><a></a><span class="bu">print</span>(result.getEstimatedParameters())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Results for model seattle_mnl_generic
Nbr of parameters:      10
Sample size:            8873
Excluded data:          0
Null log likelihood:        -11974.36
Final log likelihood:       -4622.165
Likelihood ratio test (null):       14704.39
Rho square (null):          0.614
Rho bar square (null):          0.613
Akaike Information Criterion:   9264.329
Bayesian Information Criterion: 9335.237

                               Value  Rob. Std err  Rob. t-test  Rob. p-value
asc_bike                   -3.218041      0.135727   -23.709736  0.000000e+00
asc_transit                -1.170366      0.079567   -14.709193  0.000000e+00
asc_walk                    0.156171      0.057446     2.718556  6.556752e-03
b_income_over_100k_bike     0.190055      0.178026     1.067567  2.857157e-01
b_income_over_100k_transit -1.462927      0.148960    -9.820969  0.000000e+00
b_income_over_100k_walk     0.384590      0.064497     5.962942  2.477358e-09
b_rush_hour_bike            0.118855      0.214430     0.554284  5.793848e-01
b_rush_hour_transit         0.417214      0.130249     3.203190  1.359144e-03
b_rush_hour_walk           -0.160472      0.088025    -1.823024  6.829975e-02
b_travel_time              -0.049626      0.001703   -29.139448  0.000000e+00</code></pre>
</div>
</div>
</section>
<section id="exercise-add-the-cost-variable" class="slide level2">
<h2>Exercise: add the cost variable</h2>
<div id="7b9f4499" class="cell" data-execution_count="30">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>seattle_mnl_generic_cost.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a></a><span class="im">import</span> biogeme.database <span class="im">as</span> db, biogeme.biogeme <span class="im">as</span> bio</span>
<span id="cb20-2"><a></a><span class="im">from</span> biogeme <span class="im">import</span> models</span>
<span id="cb20-3"><a></a><span class="im">from</span> biogeme.expressions <span class="im">import</span> Beta, Variable</span>
<span id="cb20-4"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb20-5"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb20-6"><a></a></span>
<span id="cb20-7"><a></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/seattle_trips.csv"</span>) <span class="co"># read data</span></span>
<span id="cb20-8"><a></a></span>
<span id="cb20-9"><a></a><span class="co"># Remove people who chose transit despite transit not being available</span></span>
<span id="cb20-10"><a></a>df <span class="op">=</span> df.loc[(df.mode_choice <span class="op">!=</span> <span class="st">"Transit"</span>) <span class="op">|</span> df.transit_available, :]</span>
<span id="cb20-11"><a></a></span>
<span id="cb20-12"><a></a><span class="co"># create our choice variable - it is coded as text in the data but Biogeme requires</span></span>
<span id="cb20-13"><a></a><span class="co"># it to be numeric</span></span>
<span id="cb20-14"><a></a>df[<span class="st">"numeric_mode"</span>] <span class="op">=</span> df.mode_choice.replace({</span>
<span id="cb20-15"><a></a>    <span class="st">"Car"</span>: <span class="dv">1</span>,</span>
<span id="cb20-16"><a></a>    <span class="st">"Transit"</span>: <span class="dv">2</span>,</span>
<span id="cb20-17"><a></a>    <span class="st">"Walk"</span>: <span class="dv">3</span>,</span>
<span id="cb20-18"><a></a>    <span class="st">"Bike"</span>: <span class="dv">4</span></span>
<span id="cb20-19"><a></a>})</span>
<span id="cb20-20"><a></a></span>
<span id="cb20-21"><a></a>data <span class="op">=</span> db.Database(<span class="st">"Seattle"</span>, pd.get_dummies(df).astype(<span class="st">"float64"</span>))</span>
<span id="cb20-22"><a></a></span>
<span id="cb20-23"><a></a><span class="co"># specify coefficients - all start at zero, have no bounds (None, None), and are</span></span>
<span id="cb20-24"><a></a><span class="co"># estimated rather than fixed (0)</span></span>
<span id="cb20-25"><a></a>asc_bike <span class="op">=</span> Beta(<span class="st">"asc_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb20-26"><a></a>b_income_over_100k_bike <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb20-27"><a></a>b_rush_hour_bike <span class="op">=</span> Beta(<span class="st">"b_rush_hour_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb20-28"><a></a></span>
<span id="cb20-29"><a></a>asc_walk <span class="op">=</span> Beta(<span class="st">"asc_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb20-30"><a></a>b_income_over_100k_walk <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb20-31"><a></a>b_rush_hour_walk <span class="op">=</span> Beta(<span class="st">"b_rush_hour_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb20-32"><a></a></span>
<span id="cb20-33"><a></a>asc_transit <span class="op">=</span> Beta(<span class="st">"asc_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb20-34"><a></a>b_income_over_100k_transit <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb20-35"><a></a>b_rush_hour_transit <span class="op">=</span> Beta(<span class="st">"b_rush_hour_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb20-36"><a></a></span>
<span id="cb20-37"><a></a><span class="co"># we only need one coefficient for travel time</span></span>
<span id="cb20-38"><a></a>b_travel_time <span class="op">=</span> Beta(<span class="st">"b_travel_time"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb20-39"><a></a>b_travel_cost <span class="op">=</span> Beta(<span class="st">"b_travel_cost"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb20-40"><a></a></span>
<span id="cb20-41"><a></a><span class="co"># and specify the variables we want to use</span></span>
<span id="cb20-42"><a></a>income_over_100k <span class="op">=</span> Variable(<span class="st">"income_over_100k"</span>)</span>
<span id="cb20-43"><a></a>rush_hour <span class="op">=</span> Variable(<span class="st">"rush_hour"</span>)</span>
<span id="cb20-44"><a></a></span>
<span id="cb20-45"><a></a><span class="co"># but we need the travel time variables for each mode</span></span>
<span id="cb20-46"><a></a>car_travel_time_mins <span class="op">=</span> Variable(<span class="st">"car_travel_time_mins"</span>)</span>
<span id="cb20-47"><a></a>bike_travel_time_mins <span class="op">=</span> Variable(<span class="st">"bike_travel_time_mins"</span>)</span>
<span id="cb20-48"><a></a>walk_travel_time_mins <span class="op">=</span> Variable(<span class="st">"walk_travel_time_mins"</span>)</span>
<span id="cb20-49"><a></a>transit_travel_time_mins <span class="op">=</span> Variable(<span class="st">"transit_travel_time_mins"</span>)</span>
<span id="cb20-50"><a></a></span>
<span id="cb20-51"><a></a>car_travel_cost <span class="op">=</span> Variable(<span class="st">"car_travel_cost"</span>)</span>
<span id="cb20-52"><a></a>bike_travel_cost <span class="op">=</span> Variable(<span class="st">"bike_travel_cost"</span>)</span>
<span id="cb20-53"><a></a>walk_travel_cost <span class="op">=</span> Variable(<span class="st">"walk_travel_cost"</span>)</span>
<span id="cb20-54"><a></a>transit_travel_cost <span class="op">=</span> Variable(<span class="st">"transit_travel_cost"</span>)</span>
<span id="cb20-55"><a></a></span>
<span id="cb20-56"><a></a>V <span class="op">=</span> {</span>
<span id="cb20-57"><a></a>    <span class="co"># Car</span></span>
<span id="cb20-58"><a></a>    <span class="dv">1</span>: b_travel_time <span class="op">*</span> car_travel_time_mins <span class="op">+</span> b_travel_cost <span class="op">*</span> car_travel_cost,</span>
<span id="cb20-59"><a></a></span>
<span id="cb20-60"><a></a>    <span class="co"># Transit</span></span>
<span id="cb20-61"><a></a>    <span class="dv">2</span>: asc_transit <span class="op">+</span> b_income_over_100k_transit <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_transit <span class="op">*</span> rush_hour <span class="op">+</span> b_travel_time <span class="op">*</span> transit_travel_time_mins <span class="op">+</span> b_travel_cost <span class="op">*</span> transit_travel_cost,</span>
<span id="cb20-62"><a></a></span>
<span id="cb20-63"><a></a>    <span class="co"># Walk</span></span>
<span id="cb20-64"><a></a>    <span class="dv">3</span>: asc_walk <span class="op">+</span> b_income_over_100k_walk <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_walk <span class="op">*</span> rush_hour <span class="op">+</span> b_travel_time <span class="op">*</span> walk_travel_time_mins <span class="op">+</span> b_travel_cost <span class="op">*</span> walk_travel_cost,</span>
<span id="cb20-65"><a></a></span>
<span id="cb20-66"><a></a>    <span class="co"># Bike</span></span>
<span id="cb20-67"><a></a>    <span class="dv">4</span>: asc_bike <span class="op">+</span> b_income_over_100k_bike <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_bike <span class="op">*</span> rush_hour <span class="op">+</span> b_travel_time <span class="op">*</span> bike_travel_time_mins <span class="op">+</span> b_travel_cost <span class="op">*</span> bike_travel_cost</span>
<span id="cb20-68"><a></a>}</span>
<span id="cb20-69"><a></a></span>
<span id="cb20-70"><a></a>av <span class="op">=</span> {<span class="dv">1</span>: <span class="dv">1</span>, <span class="dv">2</span>: Variable(<span class="st">"transit_available"</span>), <span class="dv">3</span>: <span class="dv">1</span>, <span class="dv">4</span>: <span class="dv">1</span>}</span>
<span id="cb20-71"><a></a></span>
<span id="cb20-72"><a></a>logprob <span class="op">=</span> models.loglogit(V, av, Variable(<span class="st">"numeric_mode"</span>))</span>
<span id="cb20-73"><a></a></span>
<span id="cb20-74"><a></a>model <span class="op">=</span> bio.BIOGEME(data, logprob)</span>
<span id="cb20-75"><a></a>model.modelName <span class="op">=</span> <span class="st">"seattle_mnl_generic_cost"</span></span>
<span id="cb20-76"><a></a>model.calculateNullLoglikelihood(av)</span>
<span id="cb20-77"><a></a>result <span class="op">=</span> model.estimate()</span>
<span id="cb20-78"><a></a></span>
<span id="cb20-79"><a></a><span class="cf">assert</span> result.algorithm_has_converged()</span>
<span id="cb20-80"><a></a><span class="bu">print</span>(result.shortSummary())</span>
<span id="cb20-81"><a></a><span class="bu">print</span>(result.getEstimatedParameters())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Results for model seattle_mnl_generic_cost
Nbr of parameters:      11
Sample size:            8873
Excluded data:          0
Null log likelihood:        -11974.36
Final log likelihood:       -4515.951
Likelihood ratio test (null):       14916.81
Rho square (null):          0.623
Rho bar square (null):          0.622
Akaike Information Criterion:   9053.902
Bayesian Information Criterion: 9131.9

                               Value  Rob. Std err  Rob. t-test  Rob. p-value
asc_bike                   -3.432102      0.141657   -24.228342  0.000000e+00
asc_transit                -1.207818      0.081015   -14.908553  0.000000e+00
asc_walk                    0.044614      0.057455     0.776501  4.374533e-01
b_income_over_100k_bike     0.200002      0.184747     1.082572  2.789984e-01
b_income_over_100k_transit -1.511828      0.153046    -9.878265  0.000000e+00
b_income_over_100k_walk     0.423144      0.065608     6.449539  1.121911e-10
b_rush_hour_bike            0.058074      0.221673     0.261979  7.933377e-01
b_rush_hour_transit         0.145843      0.140794     1.035859  3.002678e-01
b_rush_hour_walk           -0.197598      0.088647    -2.229054  2.581031e-02
b_travel_cost              -0.102266      0.010528    -9.713612  0.000000e+00
b_travel_time              -0.055375      0.001872   -29.577801  0.000000e+00</code></pre>
</div>
</div>
</section>
<section id="willingness-to-pay" class="slide level2">
<h2>Willingness to pay</h2>
<ul>
<li>A common use of choice models is to evaluate willingness-to-pay for some attribute</li>
<li>If you have a cost coefficient, we can do this with a ratio of coefficients</li>
<li>For instance, let’s calculate value of time, in $/hour</li>
</ul>
</section>
<section id="willingness-to-pay-calculation" class="slide level2">
<h2>Willingness to pay: calculation</h2>
<ul>
<li>The units of utility are arbitrarily defined as <em>utils</em></li>
<li>The units of <span class="math inline">\beta_{cost}</span> are utils per dollar</li>
<li>The units of <span class="math inline">\beta_{time}</span> are utils per minute</li>
<li>Thus, the units of <span class="math inline">\frac{\beta_{time}}{\beta_{cost}}</span> are dollars per minute</li>
</ul>
</section>
<section id="willingness-to-pay-calculation-1" class="slide level2">
<h2>Willingness to pay: calculation</h2>
<p><span class="math display">
\frac{\beta_{time}}{\beta_{cost}} \times 60 = \frac{-0.055}{-0.102} \times 60 = \$32.35 / \mathrm{hour}
</span></p>
<div>
<ul>
<li class="fragment">In theory, this is how much people are willing to spend to avoid an hour of travel time</li>
<li class="fragment">This is in the ballpark of what I would expect, but is rather high
<ul>
<li class="fragment">Seattle is relatively affluent</li>
<li class="fragment">Estimated costs (esp.&nbsp;for driving) may be too high, because they represent total rather than marginal costs, and much of the cost of car ownership is fixed</li>
<li class="fragment">Costs of driving, walking, and biking are not very salient, so may be underestimated</li>
</ul></li>
<li class="fragment">Driving costs are 0.39/mile plus $10 for parking downtown, bike costs are 0.17/mile, and walk costs are 0.10/mile</li>
<li class="fragment">Transit costs are loosely based on actual fares, but many transit users have monthly passes</li>
</ul>
</div>
</section>
<section id="digging-more-into-the-math-of-the-multinomial-logit-model" class="slide level2">
<h2>Digging more into the math of the multinomial logit model</h2>
<p><img data-src="https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExNWh6ZDUzcnZjZDZ2aHcwb3JrcnRsYWw2ZjVsaTA2djFxcWxuMXhjOCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/APqEbxBsVlkWSuFpth/giphy.gif" style="width:35.0%" alt="GIF of young child looking confused by math"> <img data-src="https://i.giphy.com/media/v1.Y2lkPTc5MGI3NjExbHE5MWR3aXB4bDFsODlsa3lwY3htYmJlZzVocW00ZDZuZHNiZ3Z0byZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/WRQBXSCnEFJIuxktnw/giphy.gif" style="width:60.7%" alt="GIF of a woman looking confused by math"></p>
</section>
<section id="predicted-probabilities-with-the-multinomial-logit-model" class="slide level2">
<h2>Predicted probabilities with the multinomial logit model</h2>
<ul>
<li>The outcome variable of a multinomial logit model is predicted probabilities of each individual choosing each alternative</li>
<li>How do we calculate those probabilities?</li>
</ul>
</section>
<section id="calculating-predicted-probabilities-with-the-multinomial-logit-model" class="slide level2">
<h2>Calculating predicted probabilities with the multinomial logit model</h2>
<p>We want to calculate the probability that decisionmaker <span class="math inline">n</span> chooses alternative <span class="math inline">i</span></p>
<p><span class="math display">
P_{ni} = P\left[U_{ni}~~\geq~~\max_{\forall j\neq i}~~U_{nj}\right]
</span></p>
<div class="fragment">
<p>Which is probabilistic because of the error terms</p>
<p><span class="math display">
P_{ni} = P\left[\left(V_{ni} + \epsilon_{ni}\right)~~\geq~~\max_{\forall j\neq i}~~\left(V_{nj} + \epsilon_{nj}\right)\right]
</span></p>
</div>
<div class="fragment">
<p>which still isn’t something we can directly calculate without accounting for (integrating over) the error terms</p>
</div>
</section>
<section id="enter-the-gumbel-distribution" class="slide level2">
<h2>Enter the Gumbel distribution</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>The <span class="math inline">\epsilon</span>’s in the multinomial logit model are Gumbel-distributed
<ul>
<li>aka Type I Extreme Value</li>
</ul></li>
<li>The Gumbel distribution is an approximation of the normal with attractive statistical properties</li>
<li>Notably, the maximum of a set of Gumbel-distributed variables is also Gumbel-distributed</li>
<li>This gives us a <em>closed-form</em> solution to find <span class="math inline">\displaystyle\max_{\forall j\neq i} \left(V_{nj} + \epsilon_{nj}\right)</span></li>
</ul>
</div><div class="column" style="width:50%;">
<div id="c3feda10" class="cell" data-execution_count="31">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="discrete-choice_files/figure-revealjs/cell-31-output-1.png" alt="Probability density function of a Gumbel distribution: similar to a normal distribution, but slightly right-skewed" width="849" height="445"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="using-the-gumbel-distribution" class="slide level2">
<h2>Using the Gumbel distribution</h2>
<p>Because of the properties of the Gumbel distribution,</p>
<p><span class="math display">
\max_{\forall j\neq i} \left(V_{nj} + \epsilon_{nj}\right) = \ln \sum_{\forall j\neq i} e^{V_{nj}}
</span></p>
</section>
<section id="calculating-the-choice-probability" class="slide level2">
<h2>Calculating the choice probability</h2>
<p>Again because of the properties of the Gumbel distribution, namely that the difference of two Gumbel distributions is a Logistic distribution, we have</p>
<p><span class="math display">
\begin{align*}
P_{ni} =&amp;~P\left[\left(V_{ni} + \epsilon_{ni}\right)~~\geq~~\max_{\forall j\neq i}~~\left(V_{nj} + \epsilon_{nj}\right)\right]\\
=&amp;~P\left[\left(V_{ni} + \epsilon_{ni}\right)~~\geq~~\ln \sum_{\forall j\neq i} e^{V_{nj}}\right]\\
=&amp;~\frac{e^{V_{ni}}}{e^{V_{ni}} + e^{\ln \sum_{\forall j\neq i} e^{V_{nj}}}}\\
=&amp;~\frac{e^{V_{ni}}}{\displaystyle\sum_{\forall j} e^{V_{nj}}}
\end{align*}
</span></p>
<p>which is also known as the softmax function. More detail: see Section 5.2 of <span class="citation" data-cites="ben-akiva_discrete_1985">Ben-Akiva &amp; Lerman <a href="#/questions" role="doc-biblioref" onclick="">(1985) <em>Discrete <span>Choice Analysis</span>: <span>Theory</span> and <span>Application</span> to <span>Travel Demand</span></em></a></span></p>
</section>
<section id="only-utility-differences-matter-1" class="slide level2">
<h2>Only utility differences matter</h2>
<p>What happens if we add 1.5 to all utilities?</p>
<p><span class="math display">
\begin{align*}
P_{ni} &amp;= \frac{e^{V_{ni} + 1.5}}{\displaystyle\sum_{\forall j} e^{V_{nj} + 1.5}} \\
&amp;= \frac{e^{V_{ni}}e^{1.5}}{\displaystyle\sum_{\forall j} e^{V_{nj}}e^{1.5}} \\
&amp;= \frac{e^{V_{ni}}e^{1.5}}{e^{1.5}\displaystyle\sum_{\forall j} e^{V_{nj}}} \\
&amp;= \frac{e^{V_{ni}}}{\displaystyle\sum_{\forall j} e^{V_{nj}}} \\
\end{align*}
</span></p>
</section>
<section id="the-binary-and-multinomial-logit-are-the-same-model" class="slide level2">
<h2>The binary and multinomial logit are the same model</h2>
<ul>
<li>The binary logit model is just a multinomial logit model with two outcome and no generic variables</li>
<li>If we had two outcomes, 0 and 1, with systematic utilities <span class="math inline">V_0</span> and <span class="math inline">V_1</span>, the choice probability would be, with <span class="math inline">V_0 = 0</span></li>
</ul>
<p><span class="math display">
\begin{align}
P(y = 1) &amp;= \frac{e^{V_1}}{e^{V_0} + e^{V_1}}\\
&amp;= \frac{e^{V_1}}{e^0 + e^{V_1}}\\
&amp;= \frac{e^{V_1}}{1 + e^{V_1}}
\end{align}
</span></p>
<p>Which is the same as the predicted probability in binary logistic regression</p>
</section>
<section id="calculating-choice-probabilities-in-biogeme" class="slide level2">
<h2>Calculating choice probabilities in Biogeme</h2>
<p>Add to the end of your most recent model, and run</p>
<div id="d7a2d3f1" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a></a><span class="co"># models.loglogit(V, av, Variable("mode_choice")) represents the log-probability of the chosen alternative</span></span>
<span id="cb22-2"><a></a><span class="co"># models.logit(V, av, 1) represents the probability (not logged) of alternative 1</span></span>
<span id="cb22-3"><a></a>sim_model <span class="op">=</span> bio.BIOGEME(data, {</span>
<span id="cb22-4"><a></a>    <span class="st">"Car"</span>: models.logit(V, av, <span class="dv">1</span>),</span>
<span id="cb22-5"><a></a>    <span class="st">"Transit"</span>: models.logit(V, av, <span class="dv">2</span>),</span>
<span id="cb22-6"><a></a>    <span class="st">"Walk"</span>: models.logit(V, av, <span class="dv">3</span>),</span>
<span id="cb22-7"><a></a>    <span class="st">"Bike"</span>: models.logit(V, av, <span class="dv">4</span>)</span>
<span id="cb22-8"><a></a>})</span>
<span id="cb22-9"><a></a></span>
<span id="cb22-10"><a></a>choice_probabilities <span class="op">=</span> sim_model.simulate(result.getBetaValues())</span>
<span id="cb22-11"><a></a><span class="bu">print</span>(choice_probabilities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Car   Transit          Walk      Bike
0     0.998260  0.000000  4.856587e-06  0.001736
1     0.998383  0.000000  4.638831e-06  0.001613
2     0.976720  0.000000  9.568541e-03  0.013712
3     0.980815  0.007713  9.379385e-04  0.010534
4     0.618457  0.020161  3.409855e-01  0.020396
...        ...       ...           ...       ...
8878  0.999776  0.000000  7.370046e-10  0.000224
8879  0.998289  0.000000  1.323592e-06  0.001710
8880  0.999972  0.000000  1.219600e-13  0.000028
8881  0.999776  0.000000  7.370046e-10  0.000224
8882  0.850032  0.144231  1.193345e-05  0.005725

[8873 rows x 4 columns]</code></pre>
</div>
</div>
</section>
<section id="calculating-market-shares" class="slide level2">
<h2>Calculating market shares</h2>
<ul>
<li>Market shares are just the mean probability across all individuals</li>
</ul>
<div id="5566be4d" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a></a>choice_probabilities.<span class="bu">apply</span>(np.mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="201">
<pre><code>Car        0.761975
Transit    0.037530
Walk       0.185732
Bike       0.014764
dtype: float64</code></pre>
</div>
</div>
<p>This is exactly the same as the market shares in the original data. This will always be the case when we have ASCs.</p>
<div id="716dbfd6" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a></a>df.mode_choice.value_counts() <span class="op">/</span> <span class="bu">len</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="202">
<pre><code>mode_choice
Car        0.761975
Walk       0.185732
Transit    0.037530
Bike       0.014764
Name: count, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="simulation" class="slide level2">
<h2>Simulation</h2>
<ul>
<li>Washington State is considering a $0.025/mile road usage tax</li>
<li>Let’s model what this might do to market shares</li>
<li>We’ll increase the cost of driving by $0.025/mile
<ul>
<li>The actual proposal would also get rid of gas taxes, but that is complicated to model because it depends on the fuel economy of the vehicle</li>
</ul></li>
</ul>
</section>
<section id="simulation-1" class="slide level2">
<h2>Simulation</h2>
<div id="ac285adb" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a></a>df_road_cost <span class="op">=</span> df.copy() <span class="co"># create a copy of the data to modify</span></span>
<span id="cb28-2"><a></a>df_road_cost[<span class="st">"car_travel_cost"</span>] <span class="op">+=</span> df_road_cost.car_distance_km <span class="op">*</span> <span class="fl">0.025</span> <span class="op">*</span> <span class="fl">1.609</span></span>
<span id="cb28-3"><a></a>data_road_cost <span class="op">=</span> db.Database(<span class="st">"Seattle road cost"</span>, pd.get_dummies(df_road_cost).astype(<span class="st">"float64"</span>))</span>
<span id="cb28-4"><a></a></span>
<span id="cb28-5"><a></a>road_cost_model <span class="op">=</span> bio.BIOGEME(data_road_cost, {</span>
<span id="cb28-6"><a></a>    <span class="st">"Car"</span>: models.logit(V, av, <span class="dv">1</span>),</span>
<span id="cb28-7"><a></a>    <span class="st">"Transit"</span>: models.logit(V, av, <span class="dv">2</span>),</span>
<span id="cb28-8"><a></a>    <span class="st">"Walk"</span>: models.logit(V, av, <span class="dv">3</span>),</span>
<span id="cb28-9"><a></a>    <span class="st">"Bike"</span>: models.logit(V, av, <span class="dv">4</span>)</span>
<span id="cb28-10"><a></a>})</span>
<span id="cb28-11"><a></a></span>
<span id="cb28-12"><a></a>choice_probabilities <span class="op">=</span> road_cost_model.simulate(result.getBetaValues())</span>
<span id="cb28-13"><a></a><span class="bu">print</span>(choice_probabilities.<span class="bu">apply</span>(np.mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Car        0.759342
Transit    0.038709
Walk       0.186860
Bike       0.015088
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="how-much-do-we-forecast-driving-will-decrease" class="slide level2">
<h2>How much do we forecast driving will decrease?</h2>
<ul>
<li>76.2% -&gt; 75.9%</li>
</ul>
</section>
<section id="exercise-make-transit-faster" class="slide level2">
<h2>Exercise: make transit faster</h2>
<ul>
<li>Improve transit travel times by 25% and see how choice probabilities change</li>
<li>Don’t keep the road cost scenario</li>
<li>Hint: <code>df_transit_time["transit_travel_time_mins"] *= 0.75</code> scales the variable <code>transit_travel_time</code> by 75%</li>
</ul>
</section>
<section id="exercise-answers" class="slide level2">
<h2>Exercise answers</h2>
<div id="6e4c4e39" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a></a>df_transit_time <span class="op">=</span> df.copy() <span class="co"># create a copy of the data to modify</span></span>
<span id="cb30-2"><a></a>df_transit_time[<span class="st">"transit_travel_time_mins"</span>] <span class="op">*=</span> <span class="fl">0.75</span></span>
<span id="cb30-3"><a></a>data_transit_time <span class="op">=</span> db.Database(<span class="st">"Seattle transit time"</span>, pd.get_dummies(df_transit_time).astype(<span class="st">"float64"</span>))</span>
<span id="cb30-4"><a></a></span>
<span id="cb30-5"><a></a>transit_time_model <span class="op">=</span> bio.BIOGEME(data_transit_time, {</span>
<span id="cb30-6"><a></a>    <span class="st">"Car"</span>: models.logit(V, av, <span class="dv">1</span>),</span>
<span id="cb30-7"><a></a>    <span class="st">"Transit"</span>: models.logit(V, av, <span class="dv">2</span>),</span>
<span id="cb30-8"><a></a>    <span class="st">"Walk"</span>: models.logit(V, av, <span class="dv">3</span>),</span>
<span id="cb30-9"><a></a>    <span class="st">"Bike"</span>: models.logit(V, av, <span class="dv">4</span>)</span>
<span id="cb30-10"><a></a>})</span>
<span id="cb30-11"><a></a></span>
<span id="cb30-12"><a></a>choice_probabilities <span class="op">=</span> transit_time_model.simulate(result.getBetaValues())</span>
<span id="cb30-13"><a></a><span class="bu">print</span>(choice_probabilities.<span class="bu">apply</span>(np.mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Car        0.741875
Transit    0.059872
Walk       0.183807
Bike       0.014446
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="result-1" class="slide level2">
<h2>Result</h2>
<ul>
<li>Transit mode share increase from 3.8% to 6.0%</li>
</ul>
</section>
<section id="partial-and-general-equilibrium-results" class="slide level2">
<h2>Partial and general equilibrium results</h2>
<ul>
<li>The results above are <em>partial equilibrium</em> or <em>marginal</em> results</li>
<li>They represent forecasted changes <em>if everything else stays the same</em></li>
<li>They do not account for <em>general equilibrium</em> changes, which is how the rest of the market adjusts in response to a change
<ul>
<li>For instance, if road pricing or better transit decrease auto usage, we might see auto travel times drop and see auto usage somewhat rebound</li>
</ul></li>
</ul>
</section>
<section id="how-the-coefficients-are-estimated" class="slide level2">
<h2>How the coefficients are estimated</h2>
<ul>
<li>A multinomial logit model is estimated using <em>maximum likelihood</em></li>
<li>We want to find the set of coefficients that is most likely given the data we have observed</li>
<li>We then turn this idea on its head, and find the set of coefficients that makes the data we observed most likely</li>
<li>We do this by defining a <em>likelihood function</em>, which is the probability of observing the data we observed given a set of coefficients</li>
<li>We then use an iterative process to find the set of coefficients that maximizes this probability</li>
</ul>
</section>
<section id="the-likelihood-function-for-discrete-choice-models" class="slide level2">
<h2>The likelihood function for discrete choice models</h2>
<ul>
<li>The likelihood function for a discrete choice model is just the product of the choice probabilities of the chosen outcome for each decisionmaker</li>
</ul>
<p><span class="math display">
\begin{align*}
L =&amp;~\prod_n P_{n,i=\mathrm{chosen}(n)}\\
  =&amp;~\prod_n \frac{e^{V_{n,i=\mathrm{chosen}(n)}}}{\sum_j e^{V_{nj}}}
\end{align*}
</span></p>
<div class="fragment">
<ul>
<li>Is this likely to be a large number?</li>
</ul>
</div>
</section>
<section id="the-log-likelihood" class="slide level2">
<h2>The log-likelihood</h2>
<ul>
<li>The likelihood is too small to comptue with
<ul>
<li>The smallest non-zero number than can be represented varies by machine, but is in the neighborhood of <span class="math inline">5 \times 10^{-324}</span></li>
<li>The likelihood for the model we just estimated is about <span class="math inline">10^{-1961}</span></li>
<li>You can confirm this if you want by running <code>10 ** -1961</code> in Python, you will get 0</li>
</ul></li>
<li>Instead, we compute with the <i>log</i>likelihood - i.e.&nbsp;the natural logarithm of the likelihood</li>
</ul>
</section>
<section id="a-few-things-to-remember-about-logs" class="slide level2">
<h2>A few things to remember about logs</h2>
<div class="columns">
<div class="column">
<ul>
<li>Logs map numbers between 0 and 1 to <span class="math inline">-\infty</span> to 0</li>
<li>Very small probabilities are very large negative numbers, avoiding rounding problems</li>
<li><span class="math inline">\ln ab = \ln a + \ln b</span></li>
</ul>
</div><div class="column">
<div id="86447b4b" class="cell" data-execution_count="37">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="discrete-choice_files/figure-revealjs/cell-37-output-1.png" alt="A graph of the logarthimic transformation, showing that it maps numbers between 0 and 1 to negative numbers" width="945" height="498"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="the-log-likelihood-function-for-a-multinomial-logit-model" class="slide level2">
<h2>The log-likelihood function for a multinomial logit model</h2>
<p><span class="math display">
\ell = \sum_{n} \ln \frac{e^{V_{n,i=\mathrm{chosen}(n)}}}{\sum_j e^{V_{nj}}}
</span></p>
<ul>
<li>We take the log of each probability</li>
<li>The product becomes a summation</li>
<li>We see the log-likelihood in the Biogeme output</li>
<li>Why was the log-likelihood <span class="math inline">-\infty</span> when we first added the availability constraint?
<ul>
<li><span class="fragment">Because some people chose a mode that was not available to them, making the probability 0</span></li>
</ul></li>
</ul>
</section>
<section id="pseudo-r2-statistics" class="slide level2">
<h2>Pseudo-<span class="math inline">R^2</span> statistics</h2>
<ul>
<li>In linear regression, we have the <span class="math inline">R^2</span> statistic that tells us how well the model fits the data</li>
<li>We don’t have anything quite the same for discrete choice models</li>
<li>Many authors have created pseudo-<span class="math inline">R^2</span> (sometimes called <span class="math inline">\rho^2</span>) metrics based on loglikelihoods</li>
<li>These measure the loglikelihood of your model relative to a <em>null model</em>, either
<ul>
<li>a model with no coefficients, predicting equal probabilities for all alternatives, or</li>
<li>a model with only ASCs (constants), predicting base rates for all alternatives</li>
</ul></li>
</ul>
</section>
<section id="mcfaddens-pseudo-r2" class="slide level2">
<h2>McFadden’s pseudo-<span class="math inline">R^2</span></h2>
<ul>
<li>Most common is probably McFadden’s, <span class="math inline">1 - \frac{\ell}{\ell_C}</span></li>
<li>Or McFadden’s adjusted, <span class="math inline">1 - \frac{\ell - K}{\ell_C}</span> where <span class="math inline">K</span> is number of estimated coefficients that weren’t in the null model, which attempts to correct for overfitting</li>
<li>Anecdotally, pseudo-<span class="math inline">R^2</span> statistics tend to be fairly low</li>
</ul>
</section>
<section id="calculating-pseudo-r2-in-biogeme" class="slide level2">
<h2>Calculating pseudo-<span class="math inline">R^2</span> in Biogeme</h2>
<ul>
<li>Biogeme automatically calculates the log-likelihood at zero</li>
<li>However, comparing to log-likelihood at constants is generally preferred
<ul>
<li>This is more similar to linear regression, where the <span class="math inline">R^2</span> is relative to a model with only an intercept</li>
</ul></li>
<li>Unfortunately, Biogeme does not calculate this automatically</li>
<li>It is pretty easy to calculate though, by removing everything but the ASCs</li>
<li>Exercise: go ahead and do this now</li>
</ul>
</section>
<section id="calculating-pseudo-r2-in-biogeme-results" class="slide level2">
<h2>Calculating pseudo-<span class="math inline">R^2</span> in Biogeme: results</h2>
<div id="6e99a362" class="cell" data-execution_count="38">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>seattle_constants.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a></a><span class="im">import</span> biogeme.database <span class="im">as</span> db, biogeme.biogeme <span class="im">as</span> bio</span>
<span id="cb32-2"><a></a><span class="im">from</span> biogeme <span class="im">import</span> models</span>
<span id="cb32-3"><a></a><span class="im">from</span> biogeme.expressions <span class="im">import</span> Beta, Variable</span>
<span id="cb32-4"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb32-5"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb32-6"><a></a></span>
<span id="cb32-7"><a></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/seattle_trips.csv"</span>) <span class="co"># read data</span></span>
<span id="cb32-8"><a></a></span>
<span id="cb32-9"><a></a><span class="co"># Remove people who chose transit despite transit not being available</span></span>
<span id="cb32-10"><a></a>df <span class="op">=</span> df.loc[(df.mode_choice <span class="op">!=</span> <span class="st">"Transit"</span>) <span class="op">|</span> df.transit_available, :]</span>
<span id="cb32-11"><a></a></span>
<span id="cb32-12"><a></a><span class="co"># create our choice variable - it is coded as text in the data but Biogeme requires</span></span>
<span id="cb32-13"><a></a><span class="co"># it to be numeric</span></span>
<span id="cb32-14"><a></a>df[<span class="st">"numeric_mode"</span>] <span class="op">=</span> df.mode_choice.replace({</span>
<span id="cb32-15"><a></a>    <span class="st">"Car"</span>: <span class="dv">1</span>,</span>
<span id="cb32-16"><a></a>    <span class="st">"Transit"</span>: <span class="dv">2</span>,</span>
<span id="cb32-17"><a></a>    <span class="st">"Walk"</span>: <span class="dv">3</span>,</span>
<span id="cb32-18"><a></a>    <span class="st">"Bike"</span>: <span class="dv">4</span></span>
<span id="cb32-19"><a></a>})</span>
<span id="cb32-20"><a></a></span>
<span id="cb32-21"><a></a>data <span class="op">=</span> db.Database(<span class="st">"Seattle"</span>, pd.get_dummies(df).astype(<span class="st">"float64"</span>))</span>
<span id="cb32-22"><a></a></span>
<span id="cb32-23"><a></a><span class="co"># specify coefficients - all start at zero, have no bounds (None, None), and are</span></span>
<span id="cb32-24"><a></a><span class="co"># estimated rather than fixed (0)</span></span>
<span id="cb32-25"><a></a>asc_bike <span class="op">=</span> Beta(<span class="st">"asc_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb32-26"><a></a></span>
<span id="cb32-27"><a></a>asc_walk <span class="op">=</span> Beta(<span class="st">"asc_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb32-28"><a></a></span>
<span id="cb32-29"><a></a>asc_transit <span class="op">=</span> Beta(<span class="st">"asc_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb32-30"><a></a></span>
<span id="cb32-31"><a></a><span class="co"># we only need one coefficient for travel time</span></span>
<span id="cb32-32"><a></a>b_travel_time <span class="op">=</span> Beta(<span class="st">"b_travel_time"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb32-33"><a></a>b_travel_cost <span class="op">=</span> Beta(<span class="st">"b_travel_cost"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb32-34"><a></a></span>
<span id="cb32-35"><a></a></span>
<span id="cb32-36"><a></a>V <span class="op">=</span> {</span>
<span id="cb32-37"><a></a>    <span class="co"># Car</span></span>
<span id="cb32-38"><a></a>    <span class="dv">1</span>: <span class="dv">0</span>,</span>
<span id="cb32-39"><a></a></span>
<span id="cb32-40"><a></a>    <span class="co"># Transit</span></span>
<span id="cb32-41"><a></a>    <span class="dv">2</span>: asc_transit,</span>
<span id="cb32-42"><a></a></span>
<span id="cb32-43"><a></a>    <span class="co"># Walk</span></span>
<span id="cb32-44"><a></a>    <span class="dv">3</span>: asc_walk,</span>
<span id="cb32-45"><a></a></span>
<span id="cb32-46"><a></a>    <span class="co"># Bike</span></span>
<span id="cb32-47"><a></a>    <span class="dv">4</span>: asc_bike </span>
<span id="cb32-48"><a></a>}</span>
<span id="cb32-49"><a></a></span>
<span id="cb32-50"><a></a>av <span class="op">=</span> {<span class="dv">1</span>: <span class="dv">1</span>, <span class="dv">2</span>: Variable(<span class="st">"transit_available"</span>), <span class="dv">3</span>: <span class="dv">1</span>, <span class="dv">4</span>: <span class="dv">1</span>}</span>
<span id="cb32-51"><a></a></span>
<span id="cb32-52"><a></a>logprob <span class="op">=</span> models.loglogit(V, av, Variable(<span class="st">"numeric_mode"</span>))</span>
<span id="cb32-53"><a></a></span>
<span id="cb32-54"><a></a>model <span class="op">=</span> bio.BIOGEME(data, logprob)</span>
<span id="cb32-55"><a></a>model.modelName <span class="op">=</span> <span class="st">"seattle_constants"</span></span>
<span id="cb32-56"><a></a>model.calculateNullLoglikelihood(av)</span>
<span id="cb32-57"><a></a>result <span class="op">=</span> model.estimate()</span>
<span id="cb32-58"><a></a></span>
<span id="cb32-59"><a></a><span class="cf">assert</span> result.algorithm_has_converged()</span>
<span id="cb32-60"><a></a><span class="bu">print</span>(result.shortSummary())</span>
<span id="cb32-61"><a></a><span class="bu">print</span>(result.getEstimatedParameters())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Results for model seattle_constants
Nbr of parameters:      3
Sample size:            8873
Excluded data:          0
Null log likelihood:        -11974.36
Final log likelihood:       -6211.13
Likelihood ratio test (null):       11526.46
Rho square (null):          0.481
Rho bar square (null):          0.481
Akaike Information Criterion:   12428.26
Bayesian Information Criterion: 12449.53

                Value  Rob. Std err  Rob. t-test  Rob. p-value
asc_bike    -3.943729      0.088213   -44.706999           0.0
asc_transit -2.868313      0.056243   -50.998228           0.0
asc_walk    -1.411608      0.027472   -51.383789           0.0</code></pre>
</div>
</div>
</section>
<section id="calculating-pseudo-r2-in-biogeme-1" class="slide level2">
<h2>Calculating pseudo-<span class="math inline">R^2</span> in Biogeme</h2>
<ul>
<li>Log-likelihood at constants: -6211.13</li>
<li>Log-likelihood at convergence: -4515.951</li>
<li>McFadden’s pseudo-<span class="math inline">R^2</span>: $1 - = 0.273</li>
<li>Estimated parameters other than ASCs: 8</li>
<li>McFadden’s adjusted pseudo-<span class="math inline">R^2</span>: $1 - = 0.272</li>
</ul>
</section>
<section id="comparing-coefficients-of-logistic-regression-models" class="slide level2">
<h2>Comparing coefficients of logistic regression models</h2>
<ul>
<li>In general, you <em>can’t directly compare coefficients from different logistic regressions</em></li>
<li>They may be scaled differently</li>
<li>In a linear regression, the coefficients have the same scale as the dependent variable</li>
<li>But in logistic regression, utility is scaleless</li>
</ul>
</section>
<section id="data-for-choice-modeling-stated-preference-data" class="slide level2">
<h2>Data for choice modeling: stated preference data</h2>
<ul>
<li>There are two broad types of data for choice models: stated preference and revealed preference</li>
<li>Stated preference data comes from surveys where you ask people to choose between options</li>
<li>That might look something like this:</li>
</ul>
<p>Of the following options for internet service, which would you select:</p>
<ul>
<li>Cable modem, 100 megabits/second, 1 outage per month, $55 / month, $50 setup fee</li>
<li>Fiber, 1000 megabits/second, 2 outages per year, $100 / month, $95 setup fee</li>
<li>DSL, 6 megabits/second, 2 outages / month, $30 / month, $25 setup fee</li>
</ul>
</section>
<section id="modeling-with-choice-experiments" class="slide level2">
<h2>Modeling with choice experiments</h2>
<ul>
<li>You then run a choice model on the outcomes, using the attributes of the different alternatives as independent variables</li>
<li>You need to make sure the variables aren’t perfectly correlated
<ul>
<li>for instance, in the above example, if the prices always stayed the same, the model wouldn’t be able to differentiate setup fee from monthly fee preferences</li>
<li>if you have ASCs in your model, this is even more of an issue—if fiber is always 1000 megabits/second, you won’t be able to differentiate the speed from an inherent preference for fiber</li>
</ul></li>
<li>There’s a lot more that goes into designing good choice experiments; see <a href="https://surveyengine.com/wp-content/uploads/2021/11/Designing-and-Conducting-Stated-Choice-Experiments.pdf"><span class="citation" data-cites="bliemer_designing_2024">Bliemer &amp; Rose <span>(2024) Designing and conducting stated choice experiments <em>Handbook of <span>Choice Modelling</span></em></span></span></a></li>
</ul>
</section>
<section id="revealed-preference-data-attributes-of-alternatives" class="slide level2">
<h2>Revealed preference data: attributes of alternatives</h2>
<ul>
<li>A key challenge with revealed preference data is that you don’t observe the attributes of the alternatives, and have to estimate them somehow</li>
<li>How you do this depends on the choice, of course</li>
<li>In transportation, using trip-planning software is common for attributes of alternative routes</li>
<li>In residential location choice, it is common to just randomly sample a few alternatives</li>
<li>Multinomial logit parameters are consistently estimated when alternatives are sampled randomly (ch.&nbsp;8, <span class="citation" data-cites="ben-akiva_discrete_1985">Ben-Akiva &amp; Lerman <a href="#/questions" role="doc-biblioref" onclick="">(1985) <em>Discrete <span>Choice Analysis</span>: <span>Theory</span> and <span>Application</span> to <span>Travel Demand</span></em></a></span>)</li>
</ul>
</section>
<section id="wide-and-long-data" class="slide level2">
<h2>Wide and long data</h2>
<ul>
<li>All of the data we have used so far has been “wide”—there is one row per decision, and attributes of alternatives are in columns (e.g.&nbsp;<code>car_travel_time</code>, <code>walk_travel_time</code>, etc.)</li>
</ul>
<table class="caption-top">
<thead>
<tr class="header">
<th>ID</th>
<th>Chosen</th>
<th>car_travel_time</th>
<th>walk_travel_time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Car</td>
<td>10</td>
<td>23</td>
</tr>
</tbody>
</table>
<ul>
<li>You may sometimes find “long” data—with multiple rows per choice with attributes of different alternatives</li>
</ul>
<table class="caption-top">
<thead>
<tr class="header">
<th>ID</th>
<th>Choice</th>
<th>travel_time</th>
<th>Chosen</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Car</td>
<td>10</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>1</td>
<td>Walk</td>
<td>23</td>
<td>No</td>
</tr>
</tbody>
</table>
<ul>
<li>Biogeme requires wide data; <code>pandas</code> provides the <code>unstack</code> method to convert between formats</li>
</ul>
</section>
<section id="independence-of-irrelevant-alternatives" class="slide level2">
<h2>Independence of irrelevant alternatives</h2>
<ul>
<li>The multinomial logit model assumes the <span class="math inline">\epsilon</span>’s are independent</li>
<li>That is, there are no shared <em>unobserved</em> attributes of alternatives (i.e.&nbsp;not in the model)</li>
<li>A significant implication of this assumption is the <em>independence of irrelevant alternatives</em> property</li>
<li>This says that when the probability of choosing one alternative increases (decreases), the probability of choosing the others decreases (increases) proportionally to the original probability of choosing that mode
<ul>
<li>True at the individual level, not generally true of total forecast market shares</li>
</ul></li>
</ul>
</section>
<section id="the-red-busblue-bus-problem" class="slide level2">
<h2>The red bus/blue bus problem</h2>
<ul>
<li>Suppose you have a model of mode choice, with two alternatives: driving and a red bus</li>
<li>One individual has a 50% probability of choosing each alternative</li>
<li>Suppose you paint half the buses red but don’t change anything about the service</li>
</ul>
</section>
<section id="the-red-busblue-bus-problem-1" class="slide level2">
<h2>The red bus/blue bus problem</h2>
<ul>
<li>You’d expect this individual to now have probabilities 25% red bus, 25% blue bus, and 50% drive</li>
<li>But, half of the probability has to come from each other alternative</li>
<li>So, if blue bus has 25% probability, existing choices must all reduce by the same factor</li>
<li>Red bus: 50% * .75 = 37.5%</li>
<li>Same for car</li>
</ul>
</section>
<section id="the-nested-logit-model" class="slide level2">
<h2>The nested logit model</h2>
<ul>
<li>The nested logit model relaxes the independence of irrelevant alternatives assumption by allowing error correlation between pre-specified alternatives (known as “nests”)</li>
<li>Mathematically, it represents a hierarchical choice where first you choose among nests and then among alternatives within nests</li>
</ul>
</section>
<section id="the-nested-logit-model-1" class="slide level2">
<h2>The nested logit model</h2>
<ul>
<li>For instance, we might think that transit and driving share unobserved attributes
<ul>
<li>Namely, they are both motorized so are more suited for traveling long distances</li>
<li>They are also more protected from rainy Seattle weather</li>
</ul></li>
<li>We will estimate this nested logit model</li>
</ul>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<p><img data-src="discrete-choice_files/figure-revealjs/mermaid-figure-1.png" style="width:8in;height:5.35in"></p>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="the-nested-logit-model-mathematically" class="slide level2">
<h2>The nested logit model: mathematically</h2>
<ul>
<li>The nested logit model is mathematically a hierarchical model—first, a choice between the top-level alternatives
<ul>
<li>e.g.&nbsp;Motorized, Walk, or Bike</li>
</ul></li>
<li>Then, within each nest, a choice of alternatives within that nest</li>
<li>At the top level, the utility of a nest is based on the utility of the items within that nest</li>
<li>The probability of choosing an alternative within a nest is the probability of choosing that nest multiplied by the probability of choosing the alternative given that the nest is chosen, e.g.</li>
</ul>
<p><span class="math display">
P(car) = P(motorized) \times P(car|motorized)
</span></p>
<ul>
<li>Some people actually implement the nested logit model by estimating separate multinomial logit models for each nest and between the nests
<ul>
<li>Not common anymore, modern computers and software can estimate all levels simultaneously which is statistically preferable</li>
</ul></li>
</ul>
</section>
<section id="expected-maximum-utility" class="slide level2">
<h2>Expected maximum utility</h2>
<ul>
<li>The utility of a nest is the maximum of the utilities of the members of that nest</li>
<li>We’ve already seen the formula for this, thanks to our Gumbel-distributed errors:</li>
</ul>
<p><span class="math display">
\Gamma_{\mathrm{nest}} = \ln \sum_{j \in \mathrm{nest}} e^V_{j}
</span></p>
</section>
<section id="top-level-choice-probability" class="slide level2">
<h2>Top-level choice probability</h2>
<ul>
<li>The top-level choice probability is like a multinomial logit, with the expected maximum utility for the nest</li>
</ul>
<p><span class="math display">
P(motorized) = \frac{e^{\ln \sum_{j \in \mathrm{motorized}} V_{j}}}{e^{\ln \sum_{j \in \mathrm{motorized}} V_{j}} + e^{V_{bike}} + e^{V_{walk}}}
</span></p>
</section>
<section id="this-reduces-to-the-multinomial-logit" class="slide level2">
<h2>This reduces to the multinomial logit</h2>
<ul>
<li>With some math we can show this is equivalent to the multinomial logit model</li>
</ul>
<p><span class="math display">
\begin{align*}
P(motorized) &amp;= \frac{e^{\ln \sum_{j \in \mathrm{motorized}} e^{V_{j}}}}{e^{\ln \sum_{j \in \mathrm{motorized}} e^{V_j}} + e^{V_{bike}} + e^{V_{walk}}} \\
             &amp;= \frac{\sum_{j \in \mathrm{motorized}} e^{V_j}}{\sum_{j \in \mathrm{motorized}} e^{V_j} + e^{V_{bike}} + e^{V_{walk}}} \\
             &amp;= \frac{e^{V_{car}} + e^{V_{transit}}}{e^{V_{car}} + e^{V_{transit}} + e^{V_{bike}} + e^{V_{walk}}} \\
             &amp;= \frac{e^{V_{car}}}{e^{V_{car}} + e^{V_{transit}} + e^{V_{bike}} + e^{V_{walk}}} + \frac{e^{V_{transit}}}{e^{V_{car}} + e^{V_{bike}} + e^{V_{bike}} + e^{V_{walk}}} \\
             &amp;= P_{mnl}(car) + P_{mnl}(transit)
\end{align*}
</span></p>
</section>
<section id="scale-parameters" class="slide level2">
<h2>Scale parameters</h2>
<ul>
<li>If the nested logit is equivalent to the multinomial logit, why bother?</li>
<li>There is an additional term that is introduced in the nested logit, the <em>inclusive value</em> parameter <span class="math inline">\theta</span></li>
<li>The utility of choosing a nest, then, is</li>
</ul>
<p><span class="math display">
\theta \ln \sum_{j \in nest} e^{V_j / \theta}
</span></p>
</section>
<section id="what-does-the-scaling-parameter-do" class="slide level2">
<h2>What does the scaling parameter do?</h2>
<p><span class="math display">
\theta \ln \sum_{j \in nest} e^{V_j / \theta}
</span></p>
<ul>
<li>The first <span class="math inline">\theta</span> scales the expected maximum utility to account for correlation between the error terms of the items in the nest</li>
<li>When the error terms are uncorrelated, it is fairly likely that one of them will result in relatively high utility, just by chance
<ul>
<li>Because there are many chances for an error term to be large</li>
</ul></li>
<li>When they are correlated, it is less likely
<ul>
<li>At the extreme, if the error terms were perfectly correlated, there would only be one chance for the error term to result in a large utility</li>
</ul></li>
<li>The second <span class="math inline">\theta</span> normalizes the utilities so that the coefficients are comparable across alternatives in different nests</li>
</ul>
</section>
<section id="the-range-of-theta" class="slide level2">
<h2>The range of <span class="math inline">\theta</span></h2>
<ul>
<li><span class="math inline">\theta</span> should be between 0 and 1</li>
<li>If it is not, the model is not consistent with random utility theory</li>
</ul>
</section>
<section id="estimating-a-nested-logit-model-in-biogeme" class="slide level2">
<h2>Estimating a nested logit model in Biogeme</h2>
<ul>
<li>We will put transit and driving together in a “motorized” nest.</li>
<li>Biogeme does not estimated <span class="math inline">\theta</span>, instead it estimates <span class="math inline">\mu</span> which is <span class="math inline">\frac{1}{\theta}</span></li>
</ul>
</section>
<section id="estimating-a-nested-logit-model-in-biogeme-code" class="slide level2">
<h2>Estimating a nested logit model in Biogeme: code</h2>
<div id="2b4c5bc1" class="cell" data-execution_count="39">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>seattle_nested.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a></a><span class="im">import</span> biogeme.database <span class="im">as</span> db, biogeme.biogeme <span class="im">as</span> bio</span>
<span id="cb34-2"><a></a><span class="im">from</span> biogeme <span class="im">import</span> models</span>
<span id="cb34-3"><a></a><span class="im">from</span> biogeme.nests <span class="im">import</span> OneNestForNestedLogit, NestsForNestedLogit</span>
<span id="cb34-4"><a></a><span class="im">from</span> biogeme.expressions <span class="im">import</span> Beta, Variable</span>
<span id="cb34-5"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb34-6"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb34-7"><a></a></span>
<span id="cb34-8"><a></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/seattle_trips.csv"</span>) <span class="co"># read data</span></span>
<span id="cb34-9"><a></a></span>
<span id="cb34-10"><a></a><span class="co"># Remove people who chose transit despite transit not being available</span></span>
<span id="cb34-11"><a></a>df <span class="op">=</span> df.loc[(df.mode_choice <span class="op">!=</span> <span class="st">"Transit"</span>) <span class="op">|</span> df.transit_available, :]</span>
<span id="cb34-12"><a></a></span>
<span id="cb34-13"><a></a><span class="co"># create our choice variable - it is coded as text in the data but Biogeme requires</span></span>
<span id="cb34-14"><a></a><span class="co"># it to be numeric</span></span>
<span id="cb34-15"><a></a>df[<span class="st">"numeric_mode"</span>] <span class="op">=</span> df.mode_choice.replace({</span>
<span id="cb34-16"><a></a>    <span class="st">"Car"</span>: <span class="dv">1</span>,</span>
<span id="cb34-17"><a></a>    <span class="st">"Transit"</span>: <span class="dv">2</span>,</span>
<span id="cb34-18"><a></a>    <span class="st">"Walk"</span>: <span class="dv">3</span>,</span>
<span id="cb34-19"><a></a>    <span class="st">"Bike"</span>: <span class="dv">4</span></span>
<span id="cb34-20"><a></a>})</span>
<span id="cb34-21"><a></a></span>
<span id="cb34-22"><a></a>data <span class="op">=</span> db.Database(<span class="st">"Seattle"</span>, pd.get_dummies(df).astype(<span class="st">"float64"</span>))</span>
<span id="cb34-23"><a></a></span>
<span id="cb34-24"><a></a><span class="co"># specify coefficients - all start at zero, have no bounds (None, None), and are</span></span>
<span id="cb34-25"><a></a><span class="co"># estimated rather than fixed (0)</span></span>
<span id="cb34-26"><a></a>asc_bike <span class="op">=</span> Beta(<span class="st">"asc_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb34-27"><a></a>b_income_over_100k_bike <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb34-28"><a></a>b_rush_hour_bike <span class="op">=</span> Beta(<span class="st">"b_rush_hour_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb34-29"><a></a></span>
<span id="cb34-30"><a></a>asc_walk <span class="op">=</span> Beta(<span class="st">"asc_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb34-31"><a></a>b_income_over_100k_walk <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb34-32"><a></a>b_rush_hour_walk <span class="op">=</span> Beta(<span class="st">"b_rush_hour_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb34-33"><a></a></span>
<span id="cb34-34"><a></a>asc_transit <span class="op">=</span> Beta(<span class="st">"asc_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb34-35"><a></a>b_income_over_100k_transit <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb34-36"><a></a>b_rush_hour_transit <span class="op">=</span> Beta(<span class="st">"b_rush_hour_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb34-37"><a></a></span>
<span id="cb34-38"><a></a><span class="co"># we only need one coefficient for travel time</span></span>
<span id="cb34-39"><a></a>b_travel_time <span class="op">=</span> Beta(<span class="st">"b_travel_time"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb34-40"><a></a>b_travel_cost <span class="op">=</span> Beta(<span class="st">"b_travel_cost"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb34-41"><a></a></span>
<span id="cb34-42"><a></a><span class="co"># and specify the variables we want to use</span></span>
<span id="cb34-43"><a></a>income_over_100k <span class="op">=</span> Variable(<span class="st">"income_over_100k"</span>)</span>
<span id="cb34-44"><a></a>rush_hour <span class="op">=</span> Variable(<span class="st">"rush_hour"</span>)</span>
<span id="cb34-45"><a></a></span>
<span id="cb34-46"><a></a><span class="co"># but we need the travel time variables for each mode</span></span>
<span id="cb34-47"><a></a>car_travel_time_mins <span class="op">=</span> Variable(<span class="st">"car_travel_time_mins"</span>)</span>
<span id="cb34-48"><a></a>bike_travel_time_mins <span class="op">=</span> Variable(<span class="st">"bike_travel_time_mins"</span>)</span>
<span id="cb34-49"><a></a>walk_travel_time_mins <span class="op">=</span> Variable(<span class="st">"walk_travel_time_mins"</span>)</span>
<span id="cb34-50"><a></a>transit_travel_time_mins <span class="op">=</span> Variable(<span class="st">"transit_travel_time_mins"</span>)</span>
<span id="cb34-51"><a></a></span>
<span id="cb34-52"><a></a>car_travel_cost <span class="op">=</span> Variable(<span class="st">"car_travel_cost"</span>)</span>
<span id="cb34-53"><a></a>bike_travel_cost <span class="op">=</span> Variable(<span class="st">"bike_travel_cost"</span>)</span>
<span id="cb34-54"><a></a>walk_travel_cost <span class="op">=</span> Variable(<span class="st">"walk_travel_cost"</span>)</span>
<span id="cb34-55"><a></a>transit_travel_cost <span class="op">=</span> Variable(<span class="st">"transit_travel_cost"</span>)</span>
<span id="cb34-56"><a></a></span>
<span id="cb34-57"><a></a>V <span class="op">=</span> {</span>
<span id="cb34-58"><a></a>    <span class="co"># Car</span></span>
<span id="cb34-59"><a></a>    <span class="dv">1</span>: b_travel_time <span class="op">*</span> car_travel_time_mins <span class="op">+</span> b_travel_cost <span class="op">*</span> car_travel_cost,</span>
<span id="cb34-60"><a></a></span>
<span id="cb34-61"><a></a>    <span class="co"># Transit</span></span>
<span id="cb34-62"><a></a>    <span class="dv">2</span>: asc_transit <span class="op">+</span> b_income_over_100k_transit <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_transit <span class="op">*</span> rush_hour <span class="op">+</span> b_travel_time <span class="op">*</span> transit_travel_time_mins <span class="op">+</span> b_travel_cost <span class="op">*</span> transit_travel_cost,</span>
<span id="cb34-63"><a></a></span>
<span id="cb34-64"><a></a>    <span class="co"># Walk</span></span>
<span id="cb34-65"><a></a>    <span class="dv">3</span>: asc_walk <span class="op">+</span> b_income_over_100k_walk <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_walk <span class="op">*</span> rush_hour <span class="op">+</span> b_travel_time <span class="op">*</span> walk_travel_time_mins <span class="op">+</span> b_travel_cost <span class="op">*</span> walk_travel_cost,</span>
<span id="cb34-66"><a></a></span>
<span id="cb34-67"><a></a>    <span class="co"># Bike</span></span>
<span id="cb34-68"><a></a>    <span class="dv">4</span>: asc_bike <span class="op">+</span> b_income_over_100k_bike <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_bike <span class="op">*</span> rush_hour <span class="op">+</span> b_travel_time <span class="op">*</span> bike_travel_time_mins <span class="op">+</span> b_travel_cost <span class="op">*</span> bike_travel_cost</span>
<span id="cb34-69"><a></a>}</span>
<span id="cb34-70"><a></a></span>
<span id="cb34-71"><a></a>av <span class="op">=</span> {<span class="dv">1</span>: <span class="dv">1</span>, <span class="dv">2</span>: Variable(<span class="st">"transit_available"</span>), <span class="dv">3</span>: <span class="dv">1</span>, <span class="dv">4</span>: <span class="dv">1</span>}</span>
<span id="cb34-72"><a></a></span>
<span id="cb34-73"><a></a><span class="co"># specify nests</span></span>
<span id="cb34-74"><a></a>mu_motorized <span class="op">=</span> Beta(<span class="st">"mu_motorized"</span>, <span class="dv">1</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb34-75"><a></a>motorized <span class="op">=</span> OneNestForNestedLogit(nest_param<span class="op">=</span>mu_motorized, list_of_alternatives<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">2</span>], name<span class="op">=</span><span class="st">"motorized"</span>)</span>
<span id="cb34-76"><a></a></span>
<span id="cb34-77"><a></a><span class="co"># If you had multiple nests, you would add them to tuple_of_nests after the comma.</span></span>
<span id="cb34-78"><a></a><span class="co"># there always has to be a comma, even when there is only one nest</span></span>
<span id="cb34-79"><a></a>nests <span class="op">=</span> NestsForNestedLogit(choice_set<span class="op">=</span>V.keys(), tuple_of_nests<span class="op">=</span>(motorized,))</span>
<span id="cb34-80"><a></a></span>
<span id="cb34-81"><a></a>logprob <span class="op">=</span> models.lognested(V, av, nests, Variable(<span class="st">"numeric_mode"</span>))</span>
<span id="cb34-82"><a></a></span>
<span id="cb34-83"><a></a>model <span class="op">=</span> bio.BIOGEME(data, logprob)</span>
<span id="cb34-84"><a></a>model.modelName <span class="op">=</span> <span class="st">"seattle_nested"</span></span>
<span id="cb34-85"><a></a>model.calculateNullLoglikelihood(av)</span>
<span id="cb34-86"><a></a>result <span class="op">=</span> model.estimate()</span>
<span id="cb34-87"><a></a></span>
<span id="cb34-88"><a></a><span class="cf">assert</span> result.algorithm_has_converged()</span>
<span id="cb34-89"><a></a><span class="bu">print</span>(result.shortSummary())</span>
<span id="cb34-90"><a></a><span class="bu">print</span>(result.getEstimatedParameters())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Results for model seattle_nested
Nbr of parameters:      12
Sample size:            8873
Excluded data:          0
Null log likelihood:        -11974.36
Final log likelihood:       -4509.657
Likelihood ratio test (null):       14929.4
Rho square (null):          0.623
Rho bar square (null):          0.622
Akaike Information Criterion:   9043.314
Bayesian Information Criterion: 9128.403

                               Value  Rob. Std err  Rob. t-test  Rob. p-value
asc_bike                   -3.404345      0.144008   -23.640007  0.000000e+00
asc_transit                -1.900997      0.333020    -5.708364  1.140673e-08
asc_walk                    0.093281      0.061558     1.515344  1.296854e-01
b_income_over_100k_bike     0.188913      0.185916     1.016119  3.095729e-01
b_income_over_100k_transit -1.964293      0.268527    -7.315070  2.573497e-13
b_income_over_100k_walk     0.412684      0.067211     6.140109  8.246488e-10
b_rush_hour_bike            0.062840      0.223184     0.281560  7.782807e-01
b_rush_hour_transit         0.268288      0.186497     1.438564  1.502742e-01
b_rush_hour_walk           -0.191112      0.090473    -2.112368  3.465490e-02
b_travel_cost              -0.109088      0.013781    -7.915853  2.442491e-15
b_travel_time              -0.057707      0.002075   -27.806547  0.000000e+00
mu_motorized                0.758889      0.080915     9.378821  0.000000e+00</code></pre>
</div>
</div>
</section>
<section id="nested-logit-results" class="slide level2">
<h2>Nested logit results</h2>
<div id="5f4b1432" class="cell" data-execution_count="40">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="208">
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Value</th>
<th style="text-align: right;">Rob. Std err</th>
<th style="text-align: right;">Rob. t-test</th>
<th style="text-align: right;">Rob. p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>asc_bike</td>
<td style="text-align: right;">-3.40435</td>
<td style="text-align: right;">0.144008</td>
<td style="text-align: right;">-23.64</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>asc_transit</td>
<td style="text-align: right;">-1.901</td>
<td style="text-align: right;">0.33302</td>
<td style="text-align: right;">-5.70836</td>
<td style="text-align: right;">1.14067e-08</td>
</tr>
<tr class="odd">
<td>asc_walk</td>
<td style="text-align: right;">0.0932814</td>
<td style="text-align: right;">0.0615579</td>
<td style="text-align: right;">1.51534</td>
<td style="text-align: right;">0.129685</td>
</tr>
<tr class="even">
<td>b_income_over_100k_bike</td>
<td style="text-align: right;">0.188913</td>
<td style="text-align: right;">0.185916</td>
<td style="text-align: right;">1.01612</td>
<td style="text-align: right;">0.309573</td>
</tr>
<tr class="odd">
<td>b_income_over_100k_transit</td>
<td style="text-align: right;">-1.96429</td>
<td style="text-align: right;">0.268527</td>
<td style="text-align: right;">-7.31507</td>
<td style="text-align: right;">2.5735e-13</td>
</tr>
<tr class="even">
<td>b_income_over_100k_walk</td>
<td style="text-align: right;">0.412684</td>
<td style="text-align: right;">0.0672112</td>
<td style="text-align: right;">6.14011</td>
<td style="text-align: right;">8.24649e-10</td>
</tr>
<tr class="odd">
<td>b_rush_hour_bike</td>
<td style="text-align: right;">0.0628397</td>
<td style="text-align: right;">0.223184</td>
<td style="text-align: right;">0.28156</td>
<td style="text-align: right;">0.778281</td>
</tr>
<tr class="even">
<td>b_rush_hour_transit</td>
<td style="text-align: right;">0.268288</td>
<td style="text-align: right;">0.186497</td>
<td style="text-align: right;">1.43856</td>
<td style="text-align: right;">0.150274</td>
</tr>
<tr class="odd">
<td>b_rush_hour_walk</td>
<td style="text-align: right;">-0.191112</td>
<td style="text-align: right;">0.0904728</td>
<td style="text-align: right;">-2.11237</td>
<td style="text-align: right;">0.0346549</td>
</tr>
<tr class="even">
<td>b_travel_cost</td>
<td style="text-align: right;">-0.109088</td>
<td style="text-align: right;">0.013781</td>
<td style="text-align: right;">-7.91585</td>
<td style="text-align: right;">2.44249e-15</td>
</tr>
<tr class="odd">
<td>b_travel_time</td>
<td style="text-align: right;">-0.0577071</td>
<td style="text-align: right;">0.00207531</td>
<td style="text-align: right;">-27.8065</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>mu_motorized</td>
<td style="text-align: right;">0.758889</td>
<td style="text-align: right;">0.0809152</td>
<td style="text-align: right;">9.37882</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="interpreting-the-nested-logit-model" class="slide level2">
<h2>Interpreting the nested logit model</h2>
<div>
<ul>
<li class="fragment"><span class="math inline">\mu</span> is 0.76. What is <span class="math inline">\theta</span>?</li>
<li class="fragment">1 / 0.76 = 1.32</li>
<li class="fragment">Do we accept this as a valid nested logit model?</li>
</ul>
</div>
</section>
<section id="exercise-estimate-a-different-nesting-structure-bike-and-walk-together-in-a-nest" class="slide level2">
<h2>Exercise: estimate a different nesting structure: bike and walk together in a nest</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<p><img data-src="discrete-choice_files/figure-revealjs/mermaid-figure-3.png" style="width:8in;height:5.39in"></p>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="exercise-answer" class="slide level2">
<h2>Exercise answer</h2>
<div id="f4be7c09" class="cell" data-execution_count="41">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>seattle_nested_active.py</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a></a><span class="im">import</span> biogeme.database <span class="im">as</span> db, biogeme.biogeme <span class="im">as</span> bio</span>
<span id="cb36-2"><a></a><span class="im">from</span> biogeme <span class="im">import</span> models</span>
<span id="cb36-3"><a></a><span class="im">from</span> biogeme.nests <span class="im">import</span> OneNestForNestedLogit, NestsForNestedLogit</span>
<span id="cb36-4"><a></a><span class="im">from</span> biogeme.expressions <span class="im">import</span> Beta, Variable</span>
<span id="cb36-5"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb36-6"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb36-7"><a></a></span>
<span id="cb36-8"><a></a>df <span class="op">=</span> pd.read_csv(<span class="st">"data/seattle_trips.csv"</span>) <span class="co"># read data</span></span>
<span id="cb36-9"><a></a></span>
<span id="cb36-10"><a></a><span class="co"># Remove people who chose transit despite transit not being available</span></span>
<span id="cb36-11"><a></a>df <span class="op">=</span> df.loc[(df.mode_choice <span class="op">!=</span> <span class="st">"Transit"</span>) <span class="op">|</span> df.transit_available, :]</span>
<span id="cb36-12"><a></a></span>
<span id="cb36-13"><a></a><span class="co"># create our choice variable - it is coded as text in the data but Biogeme requires</span></span>
<span id="cb36-14"><a></a><span class="co"># it to be numeric</span></span>
<span id="cb36-15"><a></a>df[<span class="st">"numeric_mode"</span>] <span class="op">=</span> df.mode_choice.replace({</span>
<span id="cb36-16"><a></a>    <span class="st">"Car"</span>: <span class="dv">1</span>,</span>
<span id="cb36-17"><a></a>    <span class="st">"Transit"</span>: <span class="dv">2</span>,</span>
<span id="cb36-18"><a></a>    <span class="st">"Walk"</span>: <span class="dv">3</span>,</span>
<span id="cb36-19"><a></a>    <span class="st">"Bike"</span>: <span class="dv">4</span></span>
<span id="cb36-20"><a></a>})</span>
<span id="cb36-21"><a></a></span>
<span id="cb36-22"><a></a>data <span class="op">=</span> db.Database(<span class="st">"Seattle"</span>, pd.get_dummies(df).astype(<span class="st">"float64"</span>))</span>
<span id="cb36-23"><a></a></span>
<span id="cb36-24"><a></a><span class="co"># specify coefficients - all start at zero, have no bounds (None, None), and are</span></span>
<span id="cb36-25"><a></a><span class="co"># estimated rather than fixed (0)</span></span>
<span id="cb36-26"><a></a>asc_bike <span class="op">=</span> Beta(<span class="st">"asc_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb36-27"><a></a>b_income_over_100k_bike <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb36-28"><a></a>b_rush_hour_bike <span class="op">=</span> Beta(<span class="st">"b_rush_hour_bike"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb36-29"><a></a></span>
<span id="cb36-30"><a></a>asc_walk <span class="op">=</span> Beta(<span class="st">"asc_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb36-31"><a></a>b_income_over_100k_walk <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb36-32"><a></a>b_rush_hour_walk <span class="op">=</span> Beta(<span class="st">"b_rush_hour_walk"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb36-33"><a></a></span>
<span id="cb36-34"><a></a>asc_transit <span class="op">=</span> Beta(<span class="st">"asc_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb36-35"><a></a>b_income_over_100k_transit <span class="op">=</span> Beta(<span class="st">"b_income_over_100k_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb36-36"><a></a>b_rush_hour_transit <span class="op">=</span> Beta(<span class="st">"b_rush_hour_transit"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb36-37"><a></a></span>
<span id="cb36-38"><a></a><span class="co"># we only need one coefficient for travel time</span></span>
<span id="cb36-39"><a></a>b_travel_time <span class="op">=</span> Beta(<span class="st">"b_travel_time"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb36-40"><a></a>b_travel_cost <span class="op">=</span> Beta(<span class="st">"b_travel_cost"</span>, <span class="dv">0</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb36-41"><a></a></span>
<span id="cb36-42"><a></a><span class="co"># and specify the variables we want to use</span></span>
<span id="cb36-43"><a></a>income_over_100k <span class="op">=</span> Variable(<span class="st">"income_over_100k"</span>)</span>
<span id="cb36-44"><a></a>rush_hour <span class="op">=</span> Variable(<span class="st">"rush_hour"</span>)</span>
<span id="cb36-45"><a></a></span>
<span id="cb36-46"><a></a><span class="co"># but we need the travel time variables for each mode</span></span>
<span id="cb36-47"><a></a>car_travel_time_mins <span class="op">=</span> Variable(<span class="st">"car_travel_time_mins"</span>)</span>
<span id="cb36-48"><a></a>bike_travel_time_mins <span class="op">=</span> Variable(<span class="st">"bike_travel_time_mins"</span>)</span>
<span id="cb36-49"><a></a>walk_travel_time_mins <span class="op">=</span> Variable(<span class="st">"walk_travel_time_mins"</span>)</span>
<span id="cb36-50"><a></a>transit_travel_time_mins <span class="op">=</span> Variable(<span class="st">"transit_travel_time_mins"</span>)</span>
<span id="cb36-51"><a></a></span>
<span id="cb36-52"><a></a>car_travel_cost <span class="op">=</span> Variable(<span class="st">"car_travel_cost"</span>)</span>
<span id="cb36-53"><a></a>bike_travel_cost <span class="op">=</span> Variable(<span class="st">"bike_travel_cost"</span>)</span>
<span id="cb36-54"><a></a>walk_travel_cost <span class="op">=</span> Variable(<span class="st">"walk_travel_cost"</span>)</span>
<span id="cb36-55"><a></a>transit_travel_cost <span class="op">=</span> Variable(<span class="st">"transit_travel_cost"</span>)</span>
<span id="cb36-56"><a></a></span>
<span id="cb36-57"><a></a>V <span class="op">=</span> {</span>
<span id="cb36-58"><a></a>    <span class="co"># Car</span></span>
<span id="cb36-59"><a></a>    <span class="dv">1</span>: b_travel_time <span class="op">*</span> car_travel_time_mins <span class="op">+</span> b_travel_cost <span class="op">*</span> car_travel_cost,</span>
<span id="cb36-60"><a></a></span>
<span id="cb36-61"><a></a>    <span class="co"># Transit</span></span>
<span id="cb36-62"><a></a>    <span class="dv">2</span>: asc_transit <span class="op">+</span> b_income_over_100k_transit <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_transit <span class="op">*</span> rush_hour <span class="op">+</span> b_travel_time <span class="op">*</span> transit_travel_time_mins <span class="op">+</span> b_travel_cost <span class="op">*</span> transit_travel_cost,</span>
<span id="cb36-63"><a></a></span>
<span id="cb36-64"><a></a>    <span class="co"># Walk</span></span>
<span id="cb36-65"><a></a>    <span class="dv">3</span>: asc_walk <span class="op">+</span> b_income_over_100k_walk <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_walk <span class="op">*</span> rush_hour <span class="op">+</span> b_travel_time <span class="op">*</span> walk_travel_time_mins <span class="op">+</span> b_travel_cost <span class="op">*</span> walk_travel_cost,</span>
<span id="cb36-66"><a></a></span>
<span id="cb36-67"><a></a>    <span class="co"># Bike</span></span>
<span id="cb36-68"><a></a>    <span class="dv">4</span>: asc_bike <span class="op">+</span> b_income_over_100k_bike <span class="op">*</span> income_over_100k <span class="op">+</span> b_rush_hour_bike <span class="op">*</span> rush_hour <span class="op">+</span> b_travel_time <span class="op">*</span> bike_travel_time_mins <span class="op">+</span> b_travel_cost <span class="op">*</span> bike_travel_cost</span>
<span id="cb36-69"><a></a>}</span>
<span id="cb36-70"><a></a></span>
<span id="cb36-71"><a></a>av <span class="op">=</span> {<span class="dv">1</span>: <span class="dv">1</span>, <span class="dv">2</span>: Variable(<span class="st">"transit_available"</span>), <span class="dv">3</span>: <span class="dv">1</span>, <span class="dv">4</span>: <span class="dv">1</span>}</span>
<span id="cb36-72"><a></a></span>
<span id="cb36-73"><a></a><span class="co"># specify nests</span></span>
<span id="cb36-74"><a></a>mu_active <span class="op">=</span> Beta(<span class="st">"mu_active"</span>, <span class="dv">1</span>, <span class="va">None</span>, <span class="va">None</span>, <span class="dv">0</span>)</span>
<span id="cb36-75"><a></a>active <span class="op">=</span> OneNestForNestedLogit(nest_param<span class="op">=</span>mu_active, list_of_alternatives<span class="op">=</span>[<span class="dv">3</span>, <span class="dv">4</span>], name<span class="op">=</span><span class="st">"active"</span>)</span>
<span id="cb36-76"><a></a></span>
<span id="cb36-77"><a></a><span class="co"># If you had multiple nests, you would add them to tuple_of_nests after the comma.</span></span>
<span id="cb36-78"><a></a><span class="co"># there always has to be a comma, even when there is only one nest</span></span>
<span id="cb36-79"><a></a>nests <span class="op">=</span> NestsForNestedLogit(choice_set<span class="op">=</span>V.keys(), tuple_of_nests<span class="op">=</span>(active,))</span>
<span id="cb36-80"><a></a></span>
<span id="cb36-81"><a></a>logprob <span class="op">=</span> models.lognested(V, av, nests, Variable(<span class="st">"numeric_mode"</span>))</span>
<span id="cb36-82"><a></a></span>
<span id="cb36-83"><a></a>model <span class="op">=</span> bio.BIOGEME(data, logprob)</span>
<span id="cb36-84"><a></a>model.modelName <span class="op">=</span> <span class="st">"seattle_nested_active"</span></span>
<span id="cb36-85"><a></a>model.calculateNullLoglikelihood(av)</span>
<span id="cb36-86"><a></a>result <span class="op">=</span> model.estimate()</span>
<span id="cb36-87"><a></a></span>
<span id="cb36-88"><a></a><span class="cf">assert</span> result.algorithm_has_converged()</span>
<span id="cb36-89"><a></a><span class="bu">print</span>(result.shortSummary())</span>
<span id="cb36-90"><a></a><span class="bu">print</span>(result.getEstimatedParameters())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Results for model seattle_nested_active
Nbr of parameters:      12
Sample size:            8873
Excluded data:          0
Null log likelihood:        -11974.36
Final log likelihood:       -4515.486
Likelihood ratio test (null):       14917.74
Rho square (null):          0.623
Rho bar square (null):          0.622
Akaike Information Criterion:   9054.972
Bayesian Information Criterion: 9140.062

                               Value  Rob. Std err  Rob. t-test  Rob. p-value
asc_bike                   -3.288892      0.214599   -15.325765  0.000000e+00
asc_transit                -1.210504      0.080964   -14.951202  0.000000e+00
asc_walk                    0.046757      0.057345     0.815348  4.148729e-01
b_income_over_100k_bike     0.210226      0.175634     1.196953  2.313247e-01
b_income_over_100k_transit -1.511167      0.152876    -9.884944  0.000000e+00
b_income_over_100k_walk     0.420584      0.065411     6.429859  1.277221e-10
b_rush_hour_bike            0.020700      0.215682     0.095975  9.235405e-01
b_rush_hour_transit         0.148930      0.140581     1.059390  2.894222e-01
b_rush_hour_walk           -0.194607      0.088373    -2.202105  2.765788e-02
b_travel_cost              -0.101328      0.010511    -9.639799  0.000000e+00
b_travel_time              -0.055173      0.001863   -29.609326  0.000000e+00
mu_active                   1.071948      0.084551    12.678101  0.000000e+00</code></pre>
</div>
</div>
</section>
<section id="nested-logit-results-again" class="slide level2">
<h2>Nested logit results, again</h2>
<div id="bedbace6" class="cell" data-execution_count="42">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="210">
<table class="caption-top">
<thead>
<tr class="header">
<th></th>
<th style="text-align: right;">Value</th>
<th style="text-align: right;">Rob. Std err</th>
<th style="text-align: right;">Rob. t-test</th>
<th style="text-align: right;">Rob. p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>asc_bike</td>
<td style="text-align: right;">-3.28889</td>
<td style="text-align: right;">0.214599</td>
<td style="text-align: right;">-15.3258</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>asc_transit</td>
<td style="text-align: right;">-1.2105</td>
<td style="text-align: right;">0.0809636</td>
<td style="text-align: right;">-14.9512</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td>asc_walk</td>
<td style="text-align: right;">0.0467565</td>
<td style="text-align: right;">0.0573455</td>
<td style="text-align: right;">0.815348</td>
<td style="text-align: right;">0.414873</td>
</tr>
<tr class="even">
<td>b_income_over_100k_bike</td>
<td style="text-align: right;">0.210226</td>
<td style="text-align: right;">0.175634</td>
<td style="text-align: right;">1.19695</td>
<td style="text-align: right;">0.231325</td>
</tr>
<tr class="odd">
<td>b_income_over_100k_transit</td>
<td style="text-align: right;">-1.51117</td>
<td style="text-align: right;">0.152876</td>
<td style="text-align: right;">-9.88494</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>b_income_over_100k_walk</td>
<td style="text-align: right;">0.420584</td>
<td style="text-align: right;">0.065411</td>
<td style="text-align: right;">6.42986</td>
<td style="text-align: right;">1.27722e-10</td>
</tr>
<tr class="odd">
<td>b_rush_hour_bike</td>
<td style="text-align: right;">0.0207</td>
<td style="text-align: right;">0.215682</td>
<td style="text-align: right;">0.0959749</td>
<td style="text-align: right;">0.923541</td>
</tr>
<tr class="even">
<td>b_rush_hour_transit</td>
<td style="text-align: right;">0.14893</td>
<td style="text-align: right;">0.140581</td>
<td style="text-align: right;">1.05939</td>
<td style="text-align: right;">0.289422</td>
</tr>
<tr class="odd">
<td>b_rush_hour_walk</td>
<td style="text-align: right;">-0.194607</td>
<td style="text-align: right;">0.0883733</td>
<td style="text-align: right;">-2.20211</td>
<td style="text-align: right;">0.0276579</td>
</tr>
<tr class="even">
<td>b_travel_cost</td>
<td style="text-align: right;">-0.101328</td>
<td style="text-align: right;">0.0105114</td>
<td style="text-align: right;">-9.6398</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td>b_travel_time</td>
<td style="text-align: right;">-0.055173</td>
<td style="text-align: right;">0.00186336</td>
<td style="text-align: right;">-29.6093</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td>mu_active</td>
<td style="text-align: right;">1.07195</td>
<td style="text-align: right;">0.0845512</td>
<td style="text-align: right;">12.6781</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="interpreting-the-nested-logit-model-again" class="slide level2">
<h2>Interpreting the nested logit model, again</h2>
<div>
<ul>
<li class="fragment"><span class="math inline">\mu</span> is 1.07. What is <span class="math inline">\theta</span>?</li>
<li class="fragment">1 / 1.07 = 0.93</li>
<li class="fragment">Do we accept this as a valid nested logit model?</li>
<li class="fragment">What does this mean about the error correlation between walking and biking?</li>
</ul>
</div>
</section>
<section id="testing-the-nested-logit-model" class="slide level2">
<h2>Testing the nested logit model</h2>
<ul>
<li>If <span class="math inline">\theta</span> were 1, the results would be the same as the multinomial logit model, and we wouldn’t need a nested logit model</li>
<li>0.93 isn’t that different from 1</li>
<li>How do we know we need a nested logit model?</li>
<li>When there’s just one nest we can use a standard <span class="math inline">z</span>-test and <span class="math inline">p</span>-value
<ul>
<li>Much software doesn’t do the right test, though—we need to test that the nesting parameter (<span class="math inline">\theta</span> or <span class="math inline">\mu</span>) is different from one, not zero like most coefficients</li>
<li>In our case, <span class="math inline">\mu</span> is just under one standard error above 1, so is <em>not</em> statistically significant</li>
<li>We can reject <em>this</em> nesting structure as not being superior to multinomial logit, though there may be other nesting structures that are</li>
</ul></li>
</ul>
</section>
<section id="the-likelihood-ratio-test" class="slide level2">
<h2>The likelihood-ratio test</h2>
<ul>
<li>The standard test for a nested-logit model versus a multinomial logit model is a likelihood-ratio test</li>
<li>This works even when there are multiple nests</li>
<li>The likelihood-ratio is a statistical test for whether the overall improvement in the model justifies the added parameters</li>
<li>The <em>test statistic</em> is <span class="math inline">-2 (\ell_{mnl} - \ell_{nl})</span>
<ul>
<li>This is called a likelihood-<em>ratio</em> test because a difference in logarithms is equivalent to division</li>
</ul></li>
<li>It has a <span class="math inline">\chi^2</span> distribution (yay another distribution)</li>
<li>The number of degrees of freedom is the number of nests you have</li>
</ul>
</section>
<section id="the-likelihood-ratio-test-1" class="slide level2">
<h2>The likelihood-ratio test</h2>
<div>
<ul>
<li class="fragment">Our log-likelihoods are:
<ul>
<li class="fragment">MNL: -4515.951</li>
<li class="fragment">NL: -4515.486</li>
</ul></li>
<li class="fragment">Difference: -0.465</li>
<li class="fragment">Test statistic: 0.930</li>
<li class="fragment"><span class="math inline">\chi^2</span> p-value: 0.34</li>
<li class="fragment">Can we conclude that the NL model is superior to the MNL?</li>
</ul>
</div>
</section>
<section id="the-likelihood-ratio-test-in-code" class="slide level2">
<h2>The likelihood-ratio test, in code</h2>
<div id="a6e51e0c" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a></a><span class="im">import</span> scipy</span>
<span id="cb38-2"><a></a></span>
<span id="cb38-3"><a></a><span class="co"># 0.930 is our test statistic, 1 is the number of degrees of freedom</span></span>
<span id="cb38-4"><a></a><span class="co"># sf is the "survival function", 1 minus the cumulative distribution function</span></span>
<span id="cb38-5"><a></a>scipy.stats.chi2.sf(<span class="fl">0.930</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="211">
<pre><code>0.33486292507904936</code></pre>
</div>
</div>
</section>
<section id="the-likelihood-ratio-test-more-generally" class="slide level2">
<h2>The likelihood-ratio test, more generally</h2>
<ul>
<li>The likelihood-ratio test can be used for any two “nested” models
<ul>
<li>Confusingly, not the same as a nested-logit model</li>
<li>Nested models mean that the more complex model can be transformed into the simple model by restricting some coefficients</li>
<li>For instance, a nested logit can be transformed into an MNL by restricting the <span class="math inline">\theta</span>’s to 1</li>
<li>Or two multinomial logit models where one has a few added coefficients, the more complex model is equivalent to the simpler model if those coefficients are restricted to zero</li>
<li>The number of degrees of freedom is just the number of restrictions</li>
</ul></li>
</ul>
</section>
<section id="multiple-nesting-levels" class="slide level2">
<h2>Multiple nesting levels</h2>
<ul>
<li>The nested logit we just estimated only had one nest</li>
<li>You can estimate nested logit models with multiple nests, and even multiple levels of nests</li>
<li>For instance, you could estimate this model</li>
</ul>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class=""><p></p>
<div>
<p><img data-src="discrete-choice_files/figure-revealjs/mermaid-figure-2.png" style="width:4.77in;height:3.13in"></p>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<ul>
<li>We will have one <span class="math inline">\theta</span> for each nest</li>
<li><span class="math inline">\theta</span>’s for top-level nests should be between 0 and 1</li>
<li><span class="math inline">\theta</span>’s for subnests should be between 0 and the <span class="math inline">\theta</span> in the next higher level nest
<ul>
<li>And a <span class="math inline">z</span>-test should be relative to the <span class="math inline">\theta</span> in the next higher nest, or just use a likelihood-ratio test</li>
</ul></li>
<li>Biogeme can’t directly estimate this type of model; <a href="https://larch.newman.me/">larch</a> (Python) or <a href="http://www.apollochoicemodelling.com">Apollo</a> (R) can.</li>
</ul>
</section>
<section id="going-deeper-scale-parameters-in-nested-logit" class="slide level2">
<h2>Going deeper: scale parameters in nested logit</h2>
<ul>
<li>Another way to think about the nested logit model is that it allows an error term that varies between nests/top-level alternatives and another that varies within each nest</li>
<li>So, for instance, the utilities of biking and walking in our nested logit model above are</li>
</ul>
<p><span class="math display">
\begin{align}
U_{bike} &amp;= V_{bike} + \epsilon_{nonmotorized} + \epsilon_{bike} \\
U_{walk} &amp;= V_{walk} + \epsilon_{nonmotorized} + \epsilon_{walk}
\end{align}
</span></p>
<ul>
<li>What <span class="math inline">\theta</span> actually represents is the ratio of the scales of the error terms at the top-level portion of the model and in the nest</li>
<li>As <span class="math inline">\theta</span> approaches 1, the scales of the error approach equality. When they are equal, the within nest variation is contributing all of the error term, and there is no shared unobserved variation.</li>
</ul>
</section>
<section id="estimation-challenges-with-the-nested-logit-local-optima-i" class="slide level2">
<h2>Estimation challenges with the nested logit: local optima I</h2>
<div class="columns">
<div class="column">
<ul>
<li>Both multinomial logit and nested logit models are solved using maximum likelihood, which is an iterative process of updating coefficients to improve the loglikelihood</li>
<li>The process adjusts the coefficients until it finds a point where it cannot improve the likelihood further through small changes to the coefficients</li>
<li>The <em>multinomial logit</em> model is globally convex—there is only one place where moving the coefficients does not improve the loglikelihood—at the solution</li>
</ul>
</div><div class="column">
<div id="d8ed13e1" class="cell" data-execution_count="44">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="discrete-choice_files/figure-revealjs/cell-44-output-1.png" alt="stylized representation of a multinomial logit log likelihood function, with a single global optimum" width="763" height="389"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="estimation-challenges-with-the-nested-logit-local-optima-ii" class="slide level2">
<h2>Estimation challenges with the nested logit: local optima II</h2>
<div class="columns">
<div class="column">
<ul>
<li>The <em>nested logit</em> model is not—there may be local optima where moving the coefficients a small amount cannot improve the loglikelihood, even if moving them quite a bit might find a set of coefficients with a better loglikelihood</li>
<li>You can experiment with this by adjusting the <em>starting values</em> of the coefficients—the first number in the call to <code>Beta()</code></li>
<li><span class="citation" data-cites="koppelman_self_2006">Koppelman &amp; Bhat <a href="#/questions" role="doc-biblioref" onclick="">(2006) <em>A <span>Self Instructing Course</span> in <span>Mode Choice Modeling</span>: <span>Multinomial</span> and <span>Nested Logit Models</span></em></a></span> recommends trying starting with <span class="math inline">\theta = 0.5</span> (<span class="math inline">\mu = 2</span>) as this may lead to a higher likelihood of finding a valid nested logit solution</li>
</ul>
</div><div class="column">
<div id="fa60d433" class="cell" data-execution_count="45">
<div class="cell-output cell-output-display">
<div>
<figure>
<p><img data-src="discrete-choice_files/figure-revealjs/cell-45-output-1.png" alt="stylized representation of a nested logit log likelihood function, with a local optimum and a global optimum" width="763" height="389"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="estimation-challenges-with-logit-models-generally-scaling" class="slide level2">
<h2>Estimation challenges with logit models generally: scaling</h2>
<ul>
<li>If your variables have very different scales (e.g.&nbsp;income in dollars and immigrant status as a binary variable), you may run into numerical issues</li>
<li>We would expect the coefficient on income to be very small, for example, if it is per dollar</li>
<li>It is often wise to scale variables to not have wildly different scales—e.g.&nbsp;put income in thousands or tens of thousands</li>
</ul>
</section>
<section id="estimation-challenges-with-logit-models-generally-convergence-and-identification" class="slide level2">
<h2>Estimation challenges with logit models generally: convergence and identification</h2>
<ul>
<li>In each of the models above, we checked for convergence</li>
<li>If the model did <em>not</em> converge, it means Biogeme did not find a solution</li>
<li>This usually means an identification issue—for instance, multicollinearity, not excluding one ASC, etc.</li>
<li>There may also be cases where there is an idenfication issue that is indicated but unexpected coefficients, non-finite likelihoods, etc.—if anything looks off, identification is a good thing to think about</li>
<li>Some identification issues may not be apparent in results at all</li>
</ul>
</section>
<section id="conclusion" class="slide level2">
<h2>Conclusion</h2>
<ul>
<li>We covered the binary, multinomial, and nested logit models</li>
<li>The multinomial logit model is used for multiple outcomes; the nested logit is used when you are concerned about independence of irrelevant alternatives</li>
<li>We estimated models using the Biogeme package, other packages are larch (Python) and apollo (R)</li>
</ul>
</section>
<section id="questions" class="slide level2 smaller scrollable">
<h2>Questions?</h2>
<p>Other resources:</p>
<ul>
<li>The quintessential reference, albeit very technical: <span class="citation" data-cites="ben-akiva_discrete_1985">Ben-Akiva &amp; Lerman <a href="#/questions" role="doc-biblioref" onclick="">(1985) <em>Discrete <span>Choice Analysis</span>: <span>Theory</span> and <span>Application</span> to <span>Travel Demand</span></em></a></span></li>
<li>A more practitioner-focused text (free e-book): <a href="http://www.caee.utexas.edu/prof/bhat/courses/lm_draft_060131final-060630.pdf"><span class="citation" data-cites="koppelman_self_2006">Koppelman &amp; Bhat <span>(2006) <em>A <span>Self Instructing Course</span> in <span>Mode Choice Modeling</span>: <span>Multinomial</span> and <span>Nested Logit Models</span></em></span></span></a></li>
<li>Designing choice experiments: <a href="https://surveyengine.com/wp-content/uploads/2021/11/Designing-and-Conducting-Stated-Choice-Experiments.pdf"><span class="citation" data-cites="bliemer_designing_2024">Bliemer &amp; Rose <span>(2024) Designing and conducting stated choice experiments <em>Handbook of <span>Choice Modelling</span></em></span></span></a></li>
</ul>
<p>Part of my job is one-on-one statistical support. Email me: <a href="mailto:mwbc@unc.edu">mwbc@unc.edu</a></p>

<div class="quarto-auto-generated-content">
<p><img src="UNC_logo_RGB.png" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div>
<div id="refs" class="references csl-bib-body" role="list">
<div id="ref-ben-akiva_discrete_1985" class="csl-entry" role="listitem">

</div>
<div id="ref-bliemer_designing_2024" class="csl-entry" role="listitem">

</div>
<div id="ref-koppelman_self_2006" class="csl-entry" role="listitem">

</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1920,

        height: 1080,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>