[
  {
    "objectID": "prepare-data.html",
    "href": "prepare-data.html",
    "title": "Data Matters Discrete Choice Models",
    "section": "",
    "text": "For testing logistic regression.\n\nread_csv(\"data/nhts/trippub.csv\") %>%\n    filter(TRPTRANS %in% c(\"03\", \"04\", \"05\", \"06\") & DRVRCNT >= 1) %>%\n    mutate(carpool=NUMONTRP > 1, cars_per_driver=HHVEHCNT / DRVRCNT,              commute=WHYTRP1S==10, social=WHYTRP1S==50, hhsize=HHSIZE, id=row_number()) %>%\n    slice_sample(n=5000) %>%\n    select(id, carpool, cars_per_driver, hhsize, commute, social) %>%\n    write_csv(\"data/nhts/carpool.csv\")\n\nRows: 923572 Columns: 115\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (74): PERSONID, TDTRPNUM, STRTTIME, ENDTIME, TRPTRANS, VEHID, DROP_PRK, ...\ndbl (41): HOUSEID, TRVLCMIN, TRPMILES, TRPACCMP, TRPHHACC, TRWAITTM, NUMTRAN...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\n\n\n\n\ncovidfuture = read_csv(\"data/covidfuture/covid_pooled_public_w1b_1.1.0b7.csv\")\n\nWarning: One or more parsing issues, see `problems()` for details\n\n\nRows: 8152 Columns: 487\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (448): empl_pre, worker_pre, jobcat_pre, ind_pre, empl_now, worker_now,...\ndbl   (33): resp_id, wfh_now_days, bzvm_now, tr_freq_now_privateveh, tr_freq...\nlgl    (4): yrborn_miss_desc, hhsize_miss_desc, nchildren_miss_desc, Finished\ndate   (2): StartDate, EndDate\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\n\n# create the wfh variable\nworkers = covidfuture %>%\n    filter(worker_pre == \"yes\" | worker_now == \"yes\") %>%\n    mutate(\n        wfh=case_when(\n            wfh_expect == \"No\" ~ \"Unable\",\n            wfh_freq_exp %in% c(\"Never\", \"A few times/year\") ~ \"Rarely\",\n            wfh_freq_exp %in% c(\"A few times/month\", \"Once/week\", \"A few times/week\") ~ \"Often\",\n            wfh_freq_exp == \"Every day\" ~ \"Always\"\n        ),\n        income_100k_plus = hhincome_summary == \"$100,000 or more\",\n        service_worker=\n            !(case_when(ind_now == \"Question not displayed to respondent\" ~ ind_pre, T ~ ind_now) %in% c(\"None of the above\", \"Seen but unanswered\"))\n        ) %>%\n    filter(!is.na(wfh))\n\nselect(workers, resp_id, wfh, age, income_100k_plus, service_worker) %>%\n    write_csv(\"data/covidfuture_wfh.csv\")\n\n\n\n\nFrom apollo\n\nread_csv(\"data/apollo_modeChoiceData.csv\") %>%\n    filter(RP == 1) %>%\n    select(-c(RP, SP, RP_journey, SP_task)) %>%\n    write_csv(\"modechoice_apollo.csv\")\n\nRows: 8000 Columns: 26\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\ndbl (26): ID, RP, SP, RP_journey, SP_task, av_car, av_bus, av_air, av_rail, ...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message."
  },
  {
    "objectID": "discrete-choice.html#about-me",
    "href": "discrete-choice.html#about-me",
    "title": "Introduction to discrete choice models in R",
    "section": "About me",
    "text": "About me\n\n\n\n\nAssistant professor of City and Regional Planning\nResearch focus: transportation modeling and simulation\n\nHeavy use of discrete choice models\n\nPhD in Geography from Arizona State\nThree years experience as transportation modeling software developer"
  },
  {
    "objectID": "discrete-choice.html#before-we-go-any-further",
    "href": "discrete-choice.html#before-we-go-any-further",
    "title": "Introduction to discrete choice models in R",
    "section": "Before we go any further",
    "text": "Before we go any further\n\nSlides, code, and data at https://projects.indicatrix.org/odum-discrete/"
  },
  {
    "objectID": "discrete-choice.html#before-we-go-any-further-1",
    "href": "discrete-choice.html#before-we-go-any-further-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Before we go any further",
    "text": "Before we go any further\n\nIf you haven’t already installed R, RStudio, apollo, and tidyverse, do so now\nR: https://r-project.org\nRStudio: https://rstudio.com\napollo and tidyverse: in RStudio console, run:\n\ninstall.packages(\"tidyverse\")\ninstall.packages(\"apollo\")"
  },
  {
    "objectID": "discrete-choice.html#what-are-discrete-choice-models",
    "href": "discrete-choice.html#what-are-discrete-choice-models",
    "title": "Introduction to discrete choice models in R",
    "section": "What are discrete choice models?",
    "text": "What are discrete choice models?\n\nAny model of a variable that takes on discrete values\nCould be binary (two values), categorical (more than two values), or quantized (e.g., integers)"
  },
  {
    "objectID": "discrete-choice.html#types-of-discrete-choice-models",
    "href": "discrete-choice.html#types-of-discrete-choice-models",
    "title": "Introduction to discrete choice models in R",
    "section": "Types of discrete choice models",
    "text": "Types of discrete choice models\n\nRandom utility models\n\nLogistic regression, multinomial logistic regression, ordered logit, mixed logit\n\nCount models\n\nPoisson and negative binomial regression\n\nMachine learning\n\nRandom forests, support vector machines, k nearest neighbors"
  },
  {
    "objectID": "discrete-choice.html#random-utility-theory",
    "href": "discrete-choice.html#random-utility-theory",
    "title": "Introduction to discrete choice models in R",
    "section": "Random utility theory",
    "text": "Random utility theory\n\nIndividuals are maximizing the utility of their choices\nUtility is an abstract concept of value\nIndividuals choose the choice with the highest utility\nUtility is random because there is a random component to utility\nWe won’t know which choice is the highest utility for an individual, only the probabilities that a particular choice will have the highest utility"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-1",
    "href": "discrete-choice.html#binary-logistic-regression-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression",
    "text": "Binary logistic regression\n\nA very common model for binary (yes/no) outcomes\nProbably familiar to many\nUsually presented as a generalized linear model"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-intuition",
    "href": "discrete-choice.html#binary-logistic-regression-intuition",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression: Intuition",
    "text": "Binary logistic regression: Intuition\n\nLinear functions can take on any value\nProbabilities need to be between 0 and 1\nThe logit function transforms arbitrary linear values to (0, 1)"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-the-math",
    "href": "discrete-choice.html#binary-logistic-regression-the-math",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression: the math",
    "text": "Binary logistic regression: the math\n\\[\ny^* = \\alpha + \\beta_1 x_1 + \\beta_2 x_2 \\cdots + \\epsilon\n\\]\n\\[\n\\epsilon \\thicksim \\mathrm{Logistic}\n\\]\n\\[\np(y = 1) = p(y^* > 0) = \\frac{e^{y^*}}{1 + e^{y^*}}\n\\]"
  },
  {
    "objectID": "discrete-choice.html#the-logit-function",
    "href": "discrete-choice.html#the-logit-function",
    "title": "Introduction to discrete choice models in R",
    "section": "The logit function",
    "text": "The logit function"
  },
  {
    "objectID": "discrete-choice.html#logistic-regression-in-r",
    "href": "discrete-choice.html#logistic-regression-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Logistic regression in R",
    "text": "Logistic regression in R\nnhts-carpool-glm.R\n\nlibrary(tidyverse)\n\ndata = read_csv(\"data/nhts/carpool.csv\")\n\nglm_model = glm(carpool~hhsize+cars_per_driver+commute+social,\n    family=binomial(link=\"logit\"), data)\nsummary(glm_model)"
  },
  {
    "objectID": "discrete-choice.html#logistic-regression-in-r-1",
    "href": "discrete-choice.html#logistic-regression-in-r-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Logistic regression in R",
    "text": "Logistic regression in R\n\n\n\nCall:\nglm(formula = carpool ~ hhsize + cars_per_driver + commute + \n    social, family = binomial(link = \"logit\"), data = data)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.5103  -1.1182  -0.4432   1.1021   2.2223  \n\nCoefficients:\n                Estimate Std. Error z value Pr(>|z|)    \n(Intercept)     -0.87064    0.10399  -8.372  < 2e-16 ***\nhhsize           0.40598    0.02471  16.431  < 2e-16 ***\ncars_per_driver -0.05475    0.05786  -0.946  0.34405    \ncommuteTRUE     -1.75187    0.11251 -15.571  < 2e-16 ***\nsocialTRUE       0.29309    0.10381   2.823  0.00475 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 6929.7  on 4999  degrees of freedom\nResidual deviance: 6301.6  on 4995  degrees of freedom\nAIC: 6311.6\n\nNumber of Fisher Scoring iterations: 4"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model",
    "href": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression as a random utility model",
    "text": "Binary logistic regression as a random utility model\n\nWe can treat the linear predictor in logistic regression as the utility of the modeled outcome\nIn this case, the utility of carpooling\nWe also need a utility of not carpooling\nDecisionmakers will choose the highest utility alternative"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-1",
    "href": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression as a random utility model",
    "text": "Binary logistic regression as a random utility model\n\nUtilities are only meaningful relative to each other\nUsual practice is to set utility of one alternative to 0"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-2",
    "href": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression as a random utility model",
    "text": "Binary logistic regression as a random utility model\n\\[\ny^* = \\alpha + \\beta_1 x_1 + \\beta_2 x_2 \\cdots + \\epsilon\n\\]\n\\[\np(y = 1) = p(y^* > 0)\\\\= \\frac{e^{y^*}}{1 + e^{y^*}}\n\\]"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-3",
    "href": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-3",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression as a random utility model",
    "text": "Binary logistic regression as a random utility model\n\\[\nU_{y=1} = \\alpha + \\beta_1 x_1 + \\beta_2 x_2 \\cdots + \\epsilon_1\n\\]\n\\[\nU_{y=0} = 0 + \\epsilon_0\n\\]\n\\[\np(y = 1) = p(U_{y=1} > U_{y=0})\\\\= \\frac{e^{U_{y=1}}}{e^{U_{y=0}} + e^{U_{y=1}}}\n\\]"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-in-r",
    "href": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression as a random utility model in R",
    "text": "Binary logistic regression as a random utility model in R\nnhts-carpool-apollo.R\n\nlibrary(apollo)\nlibrary(tidyverse)\n\n# Read data - variable must be called \"database\"\ndatabase = read_csv(\"data/nhts/carpool.csv\")"
  },
  {
    "objectID": "discrete-choice.html#but-dont-take-my-word-for-it",
    "href": "discrete-choice.html#but-dont-take-my-word-for-it",
    "title": "Introduction to discrete choice models in R",
    "section": "But don’t take my word for it…",
    "text": "But don’t take my word for it…\n\n\n\nCall:\nglm(formula = carpool ~ hhsize + cars_per_driver + commute + \n    social, family = binomial(link = \"logit\"), data = data)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.5103  -1.1182  -0.4432   1.1021   2.2223  \n\nCoefficients:\n                Estimate Std. Error z value Pr(>|z|)    \n(Intercept)     -0.87064    0.10399  -8.372  < 2e-16 ***\nhhsize           0.40598    0.02471  16.431  < 2e-16 ***\ncars_per_driver -0.05475    0.05786  -0.946  0.34405    \ncommuteTRUE     -1.75187    0.11251 -15.571  < 2e-16 ***\nsocialTRUE       0.29309    0.10381   2.823  0.00475 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 6929.7  on 4999  degrees of freedom\nResidual deviance: 6301.6  on 4995  degrees of freedom\nAIC: 6311.6\n\nNumber of Fisher Scoring iterations: 4"
  },
  {
    "objectID": "discrete-choice.html#what-about-more-than-two-outcomes",
    "href": "discrete-choice.html#what-about-more-than-two-outcomes",
    "title": "Introduction to discrete choice models in R",
    "section": "What about more than two outcomes?",
    "text": "What about more than two outcomes?\n\nRandom utility theory doesn’t constrain us to two outcomes\nWe can have many outcomes, and decisionmakers choose the one with the highest utility\nThis is known as a multinomial model"
  },
  {
    "objectID": "discrete-choice.html#extending-logistic-regression-to-the-multinomial-case",
    "href": "discrete-choice.html#extending-logistic-regression-to-the-multinomial-case",
    "title": "Introduction to discrete choice models in R",
    "section": "Extending logistic regression to the multinomial case",
    "text": "Extending logistic regression to the multinomial case\n\nInstead of two utilities \\(U_{y=1}\\) and \\(U_{y=0}\\), we have arbitrary number of utility functions \\(U_i\\)\nDecisionmakers choose the option with the highest utility\nAs with binary logistic regression, utility functions are usually linear combinations of parameters"
  },
  {
    "objectID": "discrete-choice.html#multinomial-logistic-regression-the-math",
    "href": "discrete-choice.html#multinomial-logistic-regression-the-math",
    "title": "Introduction to discrete choice models in R",
    "section": "Multinomial logistic regression: the math",
    "text": "Multinomial logistic regression: the math\n\nProbability then becomes\n\n\\[\np(y=i)\\\\= p(U_i > \\mathrm{all~other}~U)\\\\\n    =\\frac{e^{U_i}}{e^{U_1} + e^{U_2} \\cdots}\\\\\n    =\\frac{e^{U_i}}{\\sum_{j \\in I} e^{U_j}}\n\\]"
  },
  {
    "objectID": "discrete-choice.html#multinomial-logistic-regression-in-r",
    "href": "discrete-choice.html#multinomial-logistic-regression-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Multinomial logistic regression in R",
    "text": "Multinomial logistic regression in R\n\nWe will build a model of working from home expectation post-pandemic, using data from the COVID Future study.\nWe will estimate four utility functions, for being unable to, rarely, frequently, and always working from home\nBased on age, income, and job type\nThese utility functions will have the same variables but different coefficients\nEach will also have a alternative specific constant—like a constant in logistic regression that represents the base rate, but for each alternative\nOne utility function will be held at zero"
  },
  {
    "objectID": "discrete-choice.html#multinomial-logistic-regression-in-r-1",
    "href": "discrete-choice.html#multinomial-logistic-regression-in-r-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Multinomial logistic regression in R",
    "text": "Multinomial logistic regression in R\ncovidfuture-wfh-mnl.R\n\nlibrary(apollo)\nlibrary(tidyverse)\n\ndatabase = read_csv(\"data/covidfuture_wfh.csv\")\n\napollo_initialise()\n\napollo_control = list(\n    modelName=\"WFH_Postpandemic\",\n    indivID=\"resp_id\"\n)"
  },
  {
    "objectID": "discrete-choice.html#interpreting-multinomial-logit-results",
    "href": "discrete-choice.html#interpreting-multinomial-logit-results",
    "title": "Introduction to discrete choice models in R",
    "section": "Interpreting multinomial logit results",
    "text": "Interpreting multinomial logit results\n\n\n\n\n\n\nRarely\nOften\nAlways\n\n\n\n\nASC\n-0.73\n0.50\n-1.37\n\n\nAge\n-0.03\n-0.01\n0.01\n\n\nHigh income\n0.81\n1.01\n0.53\n\n\nService worker\n-0.94\n-1.27\n-1.54\n\n\n\n\n\nNote: all variables significant at \\(p < 0.05\\)"
  },
  {
    "objectID": "discrete-choice.html#questions-1",
    "href": "discrete-choice.html#questions-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Questions?",
    "text": "Questions?"
  },
  {
    "objectID": "discrete-choice.html#specifying-a-multinomial-logit-model",
    "href": "discrete-choice.html#specifying-a-multinomial-logit-model",
    "title": "Introduction to discrete choice models in R",
    "section": "Specifying a multinomial logit model",
    "text": "Specifying a multinomial logit model\n\nMultinomial logit models can have independent variables that vary at the individual level (e.g., income)\nCan also have variables at the alternative level (e.g., travel time)\nUtilities identified only up to a constant offset\n\nConstant changes to all utilities does not change outcome"
  },
  {
    "objectID": "discrete-choice.html#specifying-a-multinomial-logit-model-1",
    "href": "discrete-choice.html#specifying-a-multinomial-logit-model-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Specifying a multinomial logit model",
    "text": "Specifying a multinomial logit model\n\nVariables that vary at individual level must have different coefficients for each alternative, and one must be zero\nVariables that vary at alternative level may or may not have different coefficients for each alternative, and there is no need have one zero coefficient\n\nBut you do have to know values for unchosen alternatives"
  },
  {
    "objectID": "discrete-choice.html#specifying-a-multinomial-logit-model-2",
    "href": "discrete-choice.html#specifying-a-multinomial-logit-model-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Specifying a multinomial logit model",
    "text": "Specifying a multinomial logit model\n\n\n\n\n\n\n\nG\n\n \n\nclustertt\n\n   \n\ninc\n\n Income   \n\niw\n\n  \n\ninc->iw\n\n   \n\nib\n\n  \n\ninc->ib\n\n   \n\nic\n\n  \n\ninc->ic\n\n   \n\nttw\n\n Travel time of walk   \n\ntw\n\n  \n\nttw->tw\n\n   \n\nttb\n\n Travel time of bus   \n\ntb\n\n  \n\nttb->tb\n\n   \n\nttc\n\n Travel time of car   \n\ntc\n\n  \n\nttc->tc\n\n   \n\nuw\n\n Utility of walk   \n\nub\n\n Utility of bus   \n\nuc\n\n Utility of car   \n\niw->uw\n\n    \n\nmd\n\nMust be different, one must be zero   \n\niw->md\n\n   \n\nib->ub\n\n    \n\nib->md\n\n   \n\nic->uc\n\n    \n\nic->md\n\n   \n\ntw->uw\n\n    \n\ntb->ub\n\n    \n\ntc->uc\n\n    \n\ncs\n\nCan be same   \n\ncs->tw\n\n   \n\ncs->tb\n\n   \n\ncs->tc"
  },
  {
    "objectID": "discrete-choice.html#estimating-a-multinomial-logit-model-in-r",
    "href": "discrete-choice.html#estimating-a-multinomial-logit-model-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Estimating a multinomial logit model in R",
    "text": "Estimating a multinomial logit model in R\n\n\n\n\nWe’re going to build a multinomial logit mode choice model of intercity mode choice\nData from Apollo examples"
  },
  {
    "objectID": "discrete-choice.html#the-data",
    "href": "discrete-choice.html#the-data",
    "title": "Introduction to discrete choice models in R",
    "section": "The data",
    "text": "The data\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nID\nav_car\nav_bus\nav_air\nav_rail\ntime_car\ncost_car\ntime_bus\ncost_bus\naccess_bus\ntime_air\ncost_air\naccess_air\nservice_air\ntime_rail\ncost_rail\naccess_rail\nservice_rail\nfemale\nbusiness\nincome\nchoice\n\n\n\n\n1\n0\n0\n1\n1\n0\n0\n0\n0\n0\n50\n80\n55\n0\n140\n55\n5\n0\n0\n0\n46705\n4\n\n\n1\n0\n0\n1\n1\n0\n0\n0\n0\n0\n70\n80\n45\n0\n170\n45\n20\n0\n0\n0\n46705\n4\n\n\n2\n1\n1\n0\n1\n345\n40\n345\n30\n15\n0\n0\n0\n0\n130\n55\n20\n0\n1\n0\n50123\n2\n\n\n2\n1\n1\n0\n1\n345\n45\n345\n25\n20\n0\n0\n0\n0\n130\n45\n10\n0\n1\n0\n50123\n2\n\n\n3\n0\n0\n1\n1\n0\n0\n0\n0\n0\n90\n65\n40\n0\n130\n35\n20\n0\n1\n0\n67589\n4\n\n\n3\n0\n0\n1\n1\n0\n0\n0\n0\n0\n60\n110\n40\n0\n170\n35\n15\n0\n1\n0\n67589\n4"
  },
  {
    "objectID": "discrete-choice.html#estimation-in-r",
    "href": "discrete-choice.html#estimation-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Estimation in R",
    "text": "Estimation in R\nmode-choice-mnl.R\n\nlibrary(apollo)\nlibrary(tidyverse)\n\ndatabase = read_csv(\"data/modechoice_apollo.csv\")\n\napollo_initialise()\n\napollo_control = list(\n    modelName = \"Apollo_Mode_Choice\",\n    indivID=\"ID\"\n)"
  },
  {
    "objectID": "discrete-choice.html#valuation-using-discrete-choice-models",
    "href": "discrete-choice.html#valuation-using-discrete-choice-models",
    "title": "Introduction to discrete choice models in R",
    "section": "Valuation using discrete choice models",
    "text": "Valuation using discrete choice models\n\nA common use for discrete choice models is to calculate willingness-to-pay\nThe linear-in-parameters utility function puts everything in terms of utility\nIf we have a cost parameter, we can use the model to put everything else in monetary units"
  },
  {
    "objectID": "discrete-choice.html#valuation-using-discrete-choice-models-1",
    "href": "discrete-choice.html#valuation-using-discrete-choice-models-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Valuation using discrete choice models",
    "text": "Valuation using discrete choice models\n\nThe coefficients of the model are how much of x one unit of utility is worth\n\ni.e. partial derivatives of utility with respect to x\n\nWe want value of time, i.e. dollars / hour\nTravel time coefficient is utility / minute\nCost coefficient is utility / dollar\nIf \\(u\\) is utility, \\(c\\) is cost, and \\(t\\) is in-vehicle time, \\(\\frac{\\beta_t}{\\beta_{c}} = \\frac{\\frac{\\delta u}{\\delta t}}{\\frac{\\delta u}{\\delta c}} = \\frac{\\delta c}{\\delta t}\\)"
  },
  {
    "objectID": "discrete-choice.html#valuation-using-discrete-choice-models-2",
    "href": "discrete-choice.html#valuation-using-discrete-choice-models-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Valuation using discrete choice models",
    "text": "Valuation using discrete choice models\n\\[\\beta_c = -0.032\\]\n\\[\\beta_t = -0.0061\\]\n\\[ \\frac{\\beta_t}{\\beta_c} = \\frac{-0.0061}{-0.032} = {£0.191}/\\mathrm{minute} = {£11.46}/\\mathrm{hour} \\]"
  },
  {
    "objectID": "discrete-choice.html#confidence-intervals-for-valuation",
    "href": "discrete-choice.html#confidence-intervals-for-valuation",
    "title": "Introduction to discrete choice models in R",
    "section": "Confidence intervals for valuation",
    "text": "Confidence intervals for valuation\n\nWe can use the Delta method to calculate standard errors for combinations of parameters (Daly, Hess, and Ortúzar 2020)\nImplemented in Apollo using apollo_deltaMethod function"
  },
  {
    "objectID": "discrete-choice.html#exercise",
    "href": "discrete-choice.html#exercise",
    "title": "Introduction to discrete choice models in R",
    "section": "Exercise",
    "text": "Exercise\n\nPeople may value in-vehicle time differently on the train vs. plane vs. car vs. bus\nModify the model to estimate separate in-vehicle time coefficients for each mode, and calculate willingness-to-pay for each\n(One) answer in mode-choice-mnl-in-vehicle-answers.R"
  },
  {
    "objectID": "discrete-choice.html#solution",
    "href": "discrete-choice.html#solution",
    "title": "Introduction to discrete choice models in R",
    "section": "Solution",
    "text": "Solution\n\napollo_beta = c(\n    asc_air = 0,\n    asc_bus = 0,\n    asc_rail = 0,\n    # leaving out an asc_car as base category\n    b_cost = 0,\n    b_access_time = 0,\n    b_in_vehicle_time_air = 0,\n    b_in_vehicle_time_bus = 0,\n    b_in_vehicle_time_car = 0,\n    b_in_vehicle_time_rail = 0,\n    # income and party_size are individual level variable, so\n    # must be different for different alternatives\n    b_income_air = 0,\n    b_income_bus = 0,\n    b_income_rail = 0\n)"
  },
  {
    "objectID": "discrete-choice.html#interpretation",
    "href": "discrete-choice.html#interpretation",
    "title": "Introduction to discrete choice models in R",
    "section": "Interpretation",
    "text": "Interpretation\n\n\nPeople really don’t like being on airplanes"
  },
  {
    "objectID": "discrete-choice.html#correlation-does-not-imply-causation",
    "href": "discrete-choice.html#correlation-does-not-imply-causation",
    "title": "Introduction to discrete choice models in R",
    "section": "Correlation does not imply causation",
    "text": "Correlation does not imply causation\n\nXKCD cartoon demonstrating that correlation does not imply causation"
  },
  {
    "objectID": "discrete-choice.html#correlation-does-not-imply-causation-1",
    "href": "discrete-choice.html#correlation-does-not-imply-causation-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Correlation does not imply causation",
    "text": "Correlation does not imply causation\n\nOf course we can’t interpret model coefficients as causal\nValuation estimates are derived from coefficients\nAny bias in coefficients may affect valuation"
  },
  {
    "objectID": "discrete-choice.html#correlation-does-not-imply-causation-2",
    "href": "discrete-choice.html#correlation-does-not-imply-causation-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Correlation does not imply causation",
    "text": "Correlation does not imply causation\n\nOften, prices will be correlated with unobserved positive aspects, biasing the value of time down\n\nFor example, legroom or class of service in the air travel case\n\nOther variable may be biased too\n\nWe don’t have number of connections in our model. How might this bias the value of time for air travel?"
  },
  {
    "objectID": "discrete-choice.html#questions-2",
    "href": "discrete-choice.html#questions-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Questions?",
    "text": "Questions?"
  },
  {
    "objectID": "discrete-choice.html#predictions-and-market-shares-in-r",
    "href": "discrete-choice.html#predictions-and-market-shares-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Predictions and market shares in R",
    "text": "Predictions and market shares in R\n\n# Make predictions for the existing dataset\npredictions = apollo_prediction(model, apollo_probabilities, apollo_inputs)\n\nRunning predictions from model using parameter estimates...\nPrediction at model estimates\n             car    air   rail    bus\nAggregate 332.00 215.00 327.00 126.00\nAverage     0.33   0.21   0.33   0.13\n\nThe output from apollo_prediction is a matrix containing the\n  predictions at the estimated values."
  },
  {
    "objectID": "discrete-choice.html#predictions-and-market-shares-in-r-1",
    "href": "discrete-choice.html#predictions-and-market-shares-in-r-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Predictions and market shares in R",
    "text": "Predictions and market shares in R\n\npredictions is now a matrix with one row per observation and one column per outcome\nThese contain the predicted probabilities for each observation, based on the estimation dataset"
  },
  {
    "objectID": "discrete-choice.html#predictions-and-market-shares-in-r-2",
    "href": "discrete-choice.html#predictions-and-market-shares-in-r-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Predictions and market shares in R",
    "text": "Predictions and market shares in R\n\nMost often, you will want to make a prediction for a counterfactual scenario, i.e. a change to the data\nThis is kind of clunky in Apollo; you modify the database directly, and then re-run apollo_validateInputs and apollo_prediction"
  },
  {
    "objectID": "discrete-choice.html#predictions-and-market-shares-in-r-3",
    "href": "discrete-choice.html#predictions-and-market-shares-in-r-3",
    "title": "Introduction to discrete choice models in R",
    "section": "Predictions and market shares in R",
    "text": "Predictions and market shares in R\npredictions.R\n\n# Now, make predictions in a counterfactual scenario\n# First, we will give the original database a new name\noriginal_database = database\n\n# then, we will adjust the cost_air column to add a 25 pound tax\n# any time air is available\ndatabase = mutate(\n    original_database,\n    cost_air=ifelse(av_air, cost_air + 25, cost_air)\n    )"
  },
  {
    "objectID": "discrete-choice.html#exercise-1",
    "href": "discrete-choice.html#exercise-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Exercise",
    "text": "Exercise\n\nHow would new rail infrastructure that reduces journey times 25% affect market shares?\n\nRemember to restore original database, and run apollo_validateInputs every time you change the database!\n\nMy solution in prediction-answers.R"
  },
  {
    "objectID": "discrete-choice.html#answers",
    "href": "discrete-choice.html#answers",
    "title": "Introduction to discrete choice models in R",
    "section": "Answers",
    "text": "Answers\n\n# adjust travel times\ndatabase = mutate(\n    original_database,\n    time_rail=time_rail*0.75\n    )\n\n# re-load inputs\napollo_inputs = apollo_validateInputs()\n\nSeveral observations per individual detected based on the value of ID.\n  Setting panelData in apollo_control set to TRUE.\nAll checks on apollo_control completed.\nAll checks on database completed."
  },
  {
    "objectID": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model",
    "href": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model",
    "title": "Introduction to discrete choice models in R",
    "section": "Likelihood function for a discrete choice model",
    "text": "Likelihood function for a discrete choice model\n\nThe likelihood function for a discrete choice model is the joint probability of all the chosen values\nIf you had three people, who chose car, car, and bus to get to work, likelihood is the probability that the first person chose car multiplied by the probability the second person chose car multiplied by the probability the third person chose bus"
  },
  {
    "objectID": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model-the-math",
    "href": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model-the-math",
    "title": "Introduction to discrete choice models in R",
    "section": "Likelihood function for a discrete choice model: the math",
    "text": "Likelihood function for a discrete choice model: the math\n\nIn math:\n\n\\[\n\\prod_n P(y_n | x_n)\\\\\n= \\prod_n \\frac{e^{U_{y_n}}}{\\sum_j e^{U_{j_n}}}\n\\]"
  },
  {
    "objectID": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model-the-math-1",
    "href": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model-the-math-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Likelihood function for a discrete choice model: the math",
    "text": "Likelihood function for a discrete choice model: the math\n\nThis is a vanishingly small number\n\nIn our mode choice example, something like \\(10^{-440}\\)\n\nGenerally too small to be represented in a computer\n\n\n10^-440\n\n[1] 0"
  },
  {
    "objectID": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model-the-math-2",
    "href": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model-the-math-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Likelihood function for a discrete choice model: the math",
    "text": "Likelihood function for a discrete choice model: the math\n\nInstead, computers use the logarithm of likelihood (log-likelihood)\n\n\\[\n\\mathrm{ln} \\prod_n P(y_n | x_n)\\\\\n= \\sum_n \\mathrm{ln} \\frac{e^{U_{y_n}}}{\\sum_j e^{U_{j_n}}}\n\\]\n\nIn our example above, this is -1014"
  },
  {
    "objectID": "discrete-choice.html#comparing-logistic-models-to-each-other",
    "href": "discrete-choice.html#comparing-logistic-models-to-each-other",
    "title": "Introduction to discrete choice models in R",
    "section": "Comparing logistic models to each other",
    "text": "Comparing logistic models to each other\n\nWe can use the log-likelihood to compare two models using a likelihood-ratio test\nThis only works if the two models are nested\n\nThat is, one is a subset of the other, or you can make one into the other by constraining parameters\nNot to be confused with nested logit models which use a different error structure"
  },
  {
    "objectID": "discrete-choice.html#comparing-logistic-models-to-each-other-1",
    "href": "discrete-choice.html#comparing-logistic-models-to-each-other-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Comparing logistic models to each other",
    "text": "Comparing logistic models to each other\n\nLikelihood ratio test statistic is\n\n\\[\n-2(\\ell_1 - \\ell_2)\n\\]\nwhere \\(\\ell_1\\) is the likelihood of the less flexible model and \\(\\ell_2\\) the more flexible model\n\nThis is \\(\\chi^2\\)-distributed with degrees of freedom equal to the number of additional parameters in the more flexible model\nDon’t need to remember order, just put them in the order that makes test statistic positive"
  },
  {
    "objectID": "discrete-choice.html#comparing-logistic-models-to-each-other-2",
    "href": "discrete-choice.html#comparing-logistic-models-to-each-other-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Comparing logistic models to each other",
    "text": "Comparing logistic models to each other\n\n\n\nModel\nLog-likelihood\n\n\n\n\nSame in-vehicle time coefficient\n-1020\n\n\nDifferent in-vehicle time coefficients\n-1014.74\n\n\nTest statistic\n10.52\n\n\nDegrees of freedom\n3"
  },
  {
    "objectID": "discrete-choice.html#comparing-logistic-regression-models-to-each-other",
    "href": "discrete-choice.html#comparing-logistic-regression-models-to-each-other",
    "title": "Introduction to discrete choice models in R",
    "section": "Comparing logistic regression models to each other",
    "text": "Comparing logistic regression models to each other\n\n1 - pchisq(10.52, 3)\n\n[1] 0.01462584"
  },
  {
    "objectID": "discrete-choice.html#comparing-logistic-regreession-models-to-each-other-with-apollo",
    "href": "discrete-choice.html#comparing-logistic-regreession-models-to-each-other-with-apollo",
    "title": "Introduction to discrete choice models in R",
    "section": "Comparing logistic regreession models to each other with Apollo",
    "text": "Comparing logistic regreession models to each other with Apollo\n\nIf we have given our models unique names and run apollo_saveOutput, Apollo can do the test for us\n\n\napollo_lrTest(\"Apollo_Mode_Choice\", \"Apollo_Mode_Choice_Flexible\")\n\n                                  LL par\nApollo_Mode_Choice          -1020.00   9\nApollo_Mode_Choice_Flexible -1014.74  12\nDifference                      5.26   3\n\nLikelihood ratio test-value:    10.52 \nDegrees of freedom:             3 \nLikelihood ratio test p-value:  0.01463"
  },
  {
    "objectID": "discrete-choice.html#goodness-of-fit-metrics-for-logistic-regression-models",
    "href": "discrete-choice.html#goodness-of-fit-metrics-for-logistic-regression-models",
    "title": "Introduction to discrete choice models in R",
    "section": "Goodness of fit metrics for logistic regression models",
    "text": "Goodness of fit metrics for logistic regression models\n\nUnlike linear regression, there is no \\(R^2\\) for a logistic regression\nWe can compare multiple models using a likelihood-ratio test\nBut what if we don’t have multiple models?"
  },
  {
    "objectID": "discrete-choice.html#goodness-of-fit-metrics-for-logistic-regression-models-1",
    "href": "discrete-choice.html#goodness-of-fit-metrics-for-logistic-regression-models-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Goodness of fit metrics for logistic regression models",
    "text": "Goodness of fit metrics for logistic regression models\n\nWe do have the log-likelihood with all coefficients at 0 [LL(0)], and with only ASCs [LL(C)]\n\nLL(0)                            : -1170.86\nLL(C)                            : -1085.14\nLL(final)                        : -1020"
  },
  {
    "objectID": "discrete-choice.html#goodness-of-fit-metrics-for-logistic-regression-models-2",
    "href": "discrete-choice.html#goodness-of-fit-metrics-for-logistic-regression-models-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Goodness of fit metrics for logistic regression models",
    "text": "Goodness of fit metrics for logistic regression models\n\nMany authors have created pseudo-\\(R^2\\) metrics based on how much the model improves loglikelihood relative to these “base” log-likelihoods\nMost common is probably McFadden’s, \\(1 - \\frac{\\ell}{\\ell_C}\\)\nOr McFadden’s adjusted, \\(1 - \\frac{\\ell - K}{\\ell_C}\\) where \\(K\\) is number of estimated coefficients, which attempts to correct for overfitting"
  },
  {
    "objectID": "discrete-choice.html#goodness-of-fit-metrics-for-logistic-regression-models-3",
    "href": "discrete-choice.html#goodness-of-fit-metrics-for-logistic-regression-models-3",
    "title": "Introduction to discrete choice models in R",
    "section": "Goodness of fit metrics for logistic regression models",
    "text": "Goodness of fit metrics for logistic regression models\n\nThese range from 0 to 1, like an \\(R^2\\), with higher values being better fit\nThey can be relative to log-likelihood at constants or log-likelihood at zero\n\nFormer is more like the \\(R^2\\) you’ve seen in linear models, which is usually relative to the mean of \\(y\\)\n\nAnecdotally, pseudo-\\(R^2\\) statistics tend to be fairly low"
  },
  {
    "objectID": "discrete-choice.html#comparing-coefficients-of-logistic-regression-models",
    "href": "discrete-choice.html#comparing-coefficients-of-logistic-regression-models",
    "title": "Introduction to discrete choice models in R",
    "section": "Comparing coefficients of logistic regression models",
    "text": "Comparing coefficients of logistic regression models\n\nIn general, you can’t directly compare coefficients from different logistic regression\nThey may be scaled differently\nIn a linear regression, the coefficients have the same scale as the dependent variable\nBut in logistic regression, utility is scaleless"
  },
  {
    "objectID": "discrete-choice.html#how-is-the-scale-set-in-logistic-regression",
    "href": "discrete-choice.html#how-is-the-scale-set-in-logistic-regression",
    "title": "Introduction to discrete choice models in R",
    "section": "How is the scale set in logistic regression?",
    "text": "How is the scale set in logistic regression?\n\nThe scale of coefficients is arbitrary, but the larger the coefficients are the larger the variance of the error term must be to produce the same predictions\nMultinomial logistic regression has a “scale parameter” which controls the scale of the error and thus the scale of the coefficients, usually assumed to equal 1\nBut if you add predictors to a model so that there is less unexplained variation, the scale of the error term is fixed, so scale of other coefficients will change"
  },
  {
    "objectID": "discrete-choice.html#marginal-effects",
    "href": "discrete-choice.html#marginal-effects",
    "title": "Introduction to discrete choice models in R",
    "section": "Marginal effects",
    "text": "Marginal effects\n\nOne solution to this problem is to use marginal effects—the average change in probability for a unit change in an independent variable\nThis has a scale - the probability scale\nThe marginal effect of a variable depends on the value of that and all other variables due to nonlinearities\nHence, the average marginal effect\n\nUsually, the marginal effect averaged over the entire sample\nSometimes, the marginal effect at mean values for all covariates"
  },
  {
    "objectID": "discrete-choice.html#marginal-effects-in-apollo",
    "href": "discrete-choice.html#marginal-effects-in-apollo",
    "title": "Introduction to discrete choice models in R",
    "section": "Marginal effects in Apollo",
    "text": "Marginal effects in Apollo\n\nApollo doesn’t have a function to directly calculate marginal effects\nBut, we can use prediction function to calculate on our own\nLet’s calculate the marginal effect of in-vehicle travel time by car on all modes"
  },
  {
    "objectID": "discrete-choice.html#marginal-effects-in-apollo-1",
    "href": "discrete-choice.html#marginal-effects-in-apollo-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Marginal effects in Apollo",
    "text": "Marginal effects in Apollo\n\nWe’ll add a small amount to time_car and recalculate probabilities\nWe’ll then divide the change by that small amount to estimate the marginal effect\nThis is a basic finite-differences approximation of the marginal effect"
  },
  {
    "objectID": "discrete-choice.html#interpreting-marginal-effects",
    "href": "discrete-choice.html#interpreting-marginal-effects",
    "title": "Introduction to discrete choice models in R",
    "section": "Interpreting marginal effects",
    "text": "Interpreting marginal effects\n\nIncreasing travel time by car has a large negative effect on probability of choosing car\nUsers are diverted primarily to rail, to air and bus to a lesser extent\nThese are in probability units, so we can compare between models\nThey are small, but they are per additional minute of travel time\nThese marginal effects are dependent on the distribution of covariates in our sample"
  },
  {
    "objectID": "discrete-choice.html#considerations-when-using-marginal-effects",
    "href": "discrete-choice.html#considerations-when-using-marginal-effects",
    "title": "Introduction to discrete choice models in R",
    "section": "Considerations when using marginal effects",
    "text": "Considerations when using marginal effects\n\nDummy variables - may want to perform prediction with all dummies set to zero and one, rather than adding 0.01 to a dummy variable\nElasticities are also a possibility, computing relative change in probability for a relative change in variables"
  },
  {
    "objectID": "discrete-choice.html#exercise-2",
    "href": "discrete-choice.html#exercise-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Exercise",
    "text": "Exercise\n\nCompute and interpret marginal effects for income\n\nMy solution: margins-answers.R"
  },
  {
    "objectID": "discrete-choice.html#answers-1",
    "href": "discrete-choice.html#answers-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Answers",
    "text": "Answers\n\n# Run this after running mode-choice-mnl-in-vehicle-answers.R and predictions.R\n\n# First, we will add 0.01 to the income\ndatabase =\n    mutate(original_database, income=ifelse(av_car, income + 0.01, income))\n\n# re-read inputs\napollo_inputs = apollo_validateInputs()\n\nSeveral observations per individual detected based on the value of ID.\n  Setting panelData in apollo_control set to TRUE.\nAll checks on apollo_control completed.\nAll checks on database completed."
  },
  {
    "objectID": "discrete-choice.html#data-acquisition",
    "href": "discrete-choice.html#data-acquisition",
    "title": "Introduction to discrete choice models in R",
    "section": "Data acquisition",
    "text": "Data acquisition\n\nData acquisition is very difficult if you want to include attributes of the alternatives\n\nYou don’t have to include attributes of alternatives, depends on your research question\n\nYou need information not only on people did do, but what they could have done but chose not to"
  },
  {
    "objectID": "discrete-choice.html#data-acquisition-1",
    "href": "discrete-choice.html#data-acquisition-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Data acquisition",
    "text": "Data acquisition\n\nOne option is to do stated-preference surveys\nYou can include choice experiments where you present aspects of alternatives and ask respondents to choose\nThen you have all the alternative attributes\nBut you still need to make sure they’re reasonable, and standard stated-preference caveats apply (e.g. social desirability bias)"
  },
  {
    "objectID": "discrete-choice.html#data-acquisition-2",
    "href": "discrete-choice.html#data-acquisition-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Data acquisition",
    "text": "Data acquisition\n\nFor revealed preference, you need to come up with alternative attributes yourself\nIn transport, we often use trip planning software to do this (e.g. Google Maps, OSRM, r5r)"
  },
  {
    "objectID": "discrete-choice.html#pitfalls-of-apollo",
    "href": "discrete-choice.html#pitfalls-of-apollo",
    "title": "Introduction to discrete choice models in R",
    "section": "Pitfalls of Apollo",
    "text": "Pitfalls of Apollo\n\nApollo works with global variables in R and expects some variables to have specific names\n\ne.g. database\n\nThis means that settings and data may “leak” between models if you don’t clear your environment between estimations"
  },
  {
    "objectID": "discrete-choice.html#independence-of-irrelevant-alternatives-the-red-busblue-bus-problem",
    "href": "discrete-choice.html#independence-of-irrelevant-alternatives-the-red-busblue-bus-problem",
    "title": "Introduction to discrete choice models in R",
    "section": "Independence of irrelevant alternatives: the red bus/blue bus problem",
    "text": "Independence of irrelevant alternatives: the red bus/blue bus problem\n\nSuppose you have a model of mode choice, with two alternatives: driving and a red bus\nOne individual has a 50% probability of choosing each alternative\nSuppose you paint half the buses red but don’t change anything about the service"
  },
  {
    "objectID": "discrete-choice.html#independence-of-irrelevant-alternatives-the-red-busblue-bus-problem-1",
    "href": "discrete-choice.html#independence-of-irrelevant-alternatives-the-red-busblue-bus-problem-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Independence of irrelevant alternatives: the red bus/blue bus problem",
    "text": "Independence of irrelevant alternatives: the red bus/blue bus problem\n\nYou’d expect this individual to now have probabilities 25% red bus, 25% blue bus, and 50% drive\nBut, half of the probability has to come from each other alternative\nSo, if blue bus has 25% probability, existing choices must all reduce by the same factor\nRed bus: 50% * .75 = 37.5%\nSame for car"
  },
  {
    "objectID": "discrete-choice.html#independence-of-irrelevant-alternatives-the-red-busblue-bus-problem-2",
    "href": "discrete-choice.html#independence-of-irrelevant-alternatives-the-red-busblue-bus-problem-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Independence of irrelevant alternatives: the red bus/blue bus problem",
    "text": "Independence of irrelevant alternatives: the red bus/blue bus problem\n\nThis is true at the individual level, not the level of market shares (Ben-Akiva and Lerman 1985, 109–11)"
  },
  {
    "objectID": "discrete-choice.html#independence-of-irrelevant-alternatives-the-math",
    "href": "discrete-choice.html#independence-of-irrelevant-alternatives-the-math",
    "title": "Introduction to discrete choice models in R",
    "section": "Independence of irrelevant alternatives: the math",
    "text": "Independence of irrelevant alternatives: the math\n\\[ \\frac{\\delta p(b)}{\\delta U_r}\\]\n\\[\n= \\frac{\n    e^{U_b}}{\n        e^{U_r} + e^{U_b} + e^{U_c}}\n    \\frac{\\delta}{\\delta U_r}\n\\]\n\\[\n    = e^{U_b} ( e^{U_r} + e^{U_b} + e^{U_c} \\big)^{-2}\n        \\big[(e^{U_r} + e^{U_b} + e^{U_c}) \\frac{\\delta}{\\delta U_r}\\big]\n\\]\n\\[\n    = e^{U_b} \\big[ ( e^{U_r} + e^{U_b} + e^{U_c} \\big)^{-2} e^{U_r} \\big]\n\\]"
  },
  {
    "objectID": "discrete-choice.html#questions-3",
    "href": "discrete-choice.html#questions-3",
    "title": "Introduction to discrete choice models in R",
    "section": "Questions?",
    "text": "Questions?"
  },
  {
    "objectID": "discrete-choice.html#motivation",
    "href": "discrete-choice.html#motivation",
    "title": "Introduction to discrete choice models in R",
    "section": "Motivation",
    "text": "Motivation\n\nThe independence of irrelevant alternatives property of MNL derives from the assumed error distribution\n\nWhich is also how the probability function is derived\n\nNested logit allows correlation within “nests” of alternatives\nOften used in mode choice or joint choice"
  },
  {
    "objectID": "discrete-choice.html#model-form",
    "href": "discrete-choice.html#model-form",
    "title": "Introduction to discrete choice models in R",
    "section": "Model form",
    "text": "Model form\n\n\n\n\nflowchart LR\n    mc[Mode choice]\n    car[Car]\n    air[Air]\n    bus[Bus]\n    train[Train]\n\n    mc --> car\n    mc --> air\n    mc --> bus\n    mc --> train"
  },
  {
    "objectID": "discrete-choice.html#model-form-1",
    "href": "discrete-choice.html#model-form-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Model form",
    "text": "Model form\n\n\n\n\nflowchart LR\n    mc[Mode choice]\n    car[Car]\n    air[Air]\n    transit[Transit]\n    bus[Bus]\n    train[Train]\n\n    mc --> car\n    mc --> air\n    mc --> transit\n    transit --> bus\n    transit --> train"
  },
  {
    "objectID": "discrete-choice.html#model-form-2",
    "href": "discrete-choice.html#model-form-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Model form",
    "text": "Model form\n\nOften used to represent hierarchical or joint choice\nUsed when there are shared unobserved attributes between alternatives\n\nIn the red bus/blue bus problem, attributes of the bus\n\nDoes not have to, just represents correlation in error term between alternatives"
  },
  {
    "objectID": "discrete-choice.html#nested-logit-the-math",
    "href": "discrete-choice.html#nested-logit-the-math",
    "title": "Introduction to discrete choice models in R",
    "section": "Nested logit: the math",
    "text": "Nested logit: the math\n\\[\nU_i = \\alpha_i + \\beta_{ix} x_i + \\cdots + \\epsilon_{nest} + \\epsilon_{i}\n\\]\n\n\\(\\epsilon_{nest}\\) allows correlation of error terms at the nest level"
  },
  {
    "objectID": "discrete-choice.html#why-do-correlated-error-terms-solve-the-red-busblue-bus-problem",
    "href": "discrete-choice.html#why-do-correlated-error-terms-solve-the-red-busblue-bus-problem",
    "title": "Introduction to discrete choice models in R",
    "section": "Why do correlated error terms solve the red bus/blue bus problem?",
    "text": "Why do correlated error terms solve the red bus/blue bus problem?\n\nEasier to reason through than to do the math\nDefinition of a random-utility model is that whatever alternative has the highest utility is chosen\nUtility has a random component \\(\\epsilon\\), so whether an alternative has highest utility is probabilistic"
  },
  {
    "objectID": "discrete-choice.html#why-do-correlated-error-terms-solve-the-red-busblue-bus-problem-1",
    "href": "discrete-choice.html#why-do-correlated-error-terms-solve-the-red-busblue-bus-problem-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Why do correlated error terms solve the red bus/blue bus problem?",
    "text": "Why do correlated error terms solve the red bus/blue bus problem?\n\nSuppose we are modeling the probability of auto vs. red bus vs. blue bus, and the systematic utilities are all 0\nSo whichever alternative has the highest random error will be chosen\nSuppose we draw the error terms at random from a hat containing numbers 1–10\nThe probability that any one error term is the largest is 1/3"
  },
  {
    "objectID": "discrete-choice.html#why-do-correlated-error-terms-solve-the-red-busblue-bus-problem-2",
    "href": "discrete-choice.html#why-do-correlated-error-terms-solve-the-red-busblue-bus-problem-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Why do correlated error terms solve the red bus/blue bus problem?",
    "text": "Why do correlated error terms solve the red bus/blue bus problem?\n\nBut suppose we think that the unobserved attributes of the red bus and blue bus are the same\nThen we will draw one number for cars, and the same number twice for the red and blue buses\nSince the error terms for the buses are the same, there is now a 50% chance that car will have highest utility, and 50% that the buses will"
  },
  {
    "objectID": "discrete-choice.html#nested-logit-additional-parameters",
    "href": "discrete-choice.html#nested-logit-additional-parameters",
    "title": "Introduction to discrete choice models in R",
    "section": "Nested logit: additional parameters",
    "text": "Nested logit: additional parameters\n\nThe nested logit adds one additional parameter per nest, the inclusive value parameter\nAlso called \\(\\theta\\), \\(\\lambda\\), \\(\\frac{\\mu_m}{\\mu_d}\\), \\(\\frac{1}{\\mu_d}\\), logsum parameter\nInclusive value parameters define how much correlation there is in the alternatives within a nest"
  },
  {
    "objectID": "discrete-choice.html#nested-logit-interpreting-the-inclusive-value-parameter",
    "href": "discrete-choice.html#nested-logit-interpreting-the-inclusive-value-parameter",
    "title": "Introduction to discrete choice models in R",
    "section": "Nested logit: interpreting the inclusive value parameter",
    "text": "Nested logit: interpreting the inclusive value parameter\n\nInclusive value parameters should be between 0 and 1 to align with utility theory\nLarger inclusive value parameters mean less correlation between alternatives in that nest\nInclusive value parameters of 1—same as multinomial logit"
  },
  {
    "objectID": "discrete-choice.html#nested-logit-caution",
    "href": "discrete-choice.html#nested-logit-caution",
    "title": "Introduction to discrete choice models in R",
    "section": "Nested logit: caution",
    "text": "Nested logit: caution\n\nIn order to interpret coefficients from different nests relative to each other, you must use a random utility nested logit model (RUMNL)\nThese normalize the coefficients in each nest to be comparable to each other, by dividing by the inclusive value parameter\nNon-normalized nested logit (NNNL) does not perform this normalization\nRUMNL is default in Apollo, NNNL is default in Stata"
  },
  {
    "objectID": "discrete-choice.html#nested-logit-caution-1",
    "href": "discrete-choice.html#nested-logit-caution-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Nested logit: caution",
    "text": "Nested logit: caution\n\nNested logit inclusive value parameters should be tested with a null hypothesis that they are 1, not 0\nMany statistical packages (including Apollo) don’t do this\nThus, t-values and p-values will be incorrect"
  },
  {
    "objectID": "discrete-choice.html#nested-logit-in-r",
    "href": "discrete-choice.html#nested-logit-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Nested logit in R",
    "text": "Nested logit in R\n\nlibrary(apollo)\nlibrary(tidyverse)\n\ndatabase = read_csv(\"data/modechoice_apollo.csv\")\n\napollo_initialise()\n\napollo_control = list(\n    modelName = \"Nested_Mode_Choice\",\n    indivID=\"ID\"\n)"
  },
  {
    "objectID": "discrete-choice.html#likelihood-ratio-tests-of-the-nested-logit-model",
    "href": "discrete-choice.html#likelihood-ratio-tests-of-the-nested-logit-model",
    "title": "Introduction to discrete choice models in R",
    "section": "Likelihood-ratio tests of the nested logit model",
    "text": "Likelihood-ratio tests of the nested logit model\n\nWe can perform a likelihood-ratio test, since constraining the inclusive value parameter to 1 would be the same as a multinomial logit model\n\n\napollo_lrTest(\"Nested_Mode_Choice\", \"Apollo_Mode_Choice\")\n\nThe order of your two models will be reversed in the output as model 1\n  has better fit than model 2.\n\n                        LL par\nApollo_Mode_Choice -1020.0   9\nNested_Mode_Choice -1016.4  10\nDifference             3.6   1\n\nLikelihood ratio test-value:    7.2 \nDegrees of freedom:             1 \nLikelihood ratio test p-value:  0.00729"
  },
  {
    "objectID": "discrete-choice.html#an-alternative-to-nested-logit-mixed-logit",
    "href": "discrete-choice.html#an-alternative-to-nested-logit-mixed-logit",
    "title": "Introduction to discrete choice models in R",
    "section": "An alternative to nested logit: mixed logit",
    "text": "An alternative to nested logit: mixed logit\n\nIn multinomial logit and nested logit models, parameters are assumed to be constant across the population\nMixed logit allows (a subset of) coefficients to vary across individuals\nBy creating random coefficients that enter multiple utility functions as constants, correlations can be created\nBasically, using random coefficients as additional shared error terms"
  },
  {
    "objectID": "discrete-choice.html#mixed-logit",
    "href": "discrete-choice.html#mixed-logit",
    "title": "Introduction to discrete choice models in R",
    "section": "Mixed logit",
    "text": "Mixed logit\nWe might write our nested model above as\n\\[\nU_{car} = X_{car}B_{car} + \\epsilon_{car}\n\\]\n\\[\nU_{bus} = X_{bus}B_{bus} + \\mu'_{shared} + \\epsilon_{bus}\n\\]\n\\[\nU_{rail} = X_{rail}B_{rail} + \\mu'_{shared} + \\epsilon_{rail}\n\\]\n\\[\nU_{air} = X_{air}B_{air} + \\mu'_{shared} + \\epsilon_{air}\n\\]\n\\(\\mu'_{shared}\\) is a random value which acts as a common error term for the shared modes"
  },
  {
    "objectID": "discrete-choice.html#mixed-logit-1",
    "href": "discrete-choice.html#mixed-logit-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Mixed logit",
    "text": "Mixed logit\n\nMixed logit can also have coefficients that vary\nCommon use is value of time - we know this varies a lot across the population\nWhen using mixed logits, be careful of taking ratios for valuation\n\nRatio of two normally-distributed coefficients is Cauchy distributed, which has no mean\nYou can simulate a mean, it will just be unstable and change each time you run your code."
  },
  {
    "objectID": "discrete-choice.html#an-alternative-to-nested-logit-mixed-logit-1",
    "href": "discrete-choice.html#an-alternative-to-nested-logit-mixed-logit-1",
    "title": "Introduction to discrete choice models in R",
    "section": "An alternative to nested logit: mixed logit",
    "text": "An alternative to nested logit: mixed logit\n\nEstimating mixed logit models is beyond the scope of this course\nFor more information on mixed logit models, see Train (2009) (free ebook available) and the Apollo manual"
  },
  {
    "objectID": "discrete-choice.html#questions-and-contact",
    "href": "discrete-choice.html#questions-and-contact",
    "title": "Introduction to discrete choice models in R",
    "section": "Questions and contact",
    "text": "Questions and contact\nMatt Bhagat-Conway\nmwbc@unc.edu\n@mattwigway"
  },
  {
    "objectID": "discrete-choice.html#references",
    "href": "discrete-choice.html#references",
    "title": "Introduction to discrete choice models in R",
    "section": "References",
    "text": "References\n\n\nBen-Akiva, Moshe, and Stephen R Lerman. 1985. Discrete Choice Analysis: Theory and Application to Travel Demand. MIT Press.\n\n\nDaly, Andrew, Stephane Hess, and Juan de Dios Ortúzar. 2020. “Estimating Willingness-to-Pay from Discrete Choice Models: Setting the Record Straight.” http://www.stephanehess.me.uk/papers/working_papers/Daly_Hess_Ortuzar_2020.pdf.\n\n\nTrain, Kenneth. 2009. Discrete Choice Methods with Simulation. Cambridge, UK: Cambridge University Press."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Odum Discrete Choice Modeling class",
    "section": "",
    "text": "Example code and data\nSlides"
  }
]