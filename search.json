[
  {
    "objectID": "prepare-data.html",
    "href": "prepare-data.html",
    "title": "Data Matters Discrete Choice Models",
    "section": "",
    "text": "For testing logistic regression.\n\nread_csv(\"data/nhts/trippub.csv\") %>%\n    filter(TRPTRANS %in% c(\"03\", \"04\", \"05\", \"06\") & DRVRCNT >= 1) %>%\n    mutate(carpool=NUMONTRP > 1, cars_per_driver=HHVEHCNT / DRVRCNT,              commute=WHYTRP1S==10, social=WHYTRP1S==50, hhsize=HHSIZE, id=row_number()) %>%\n    slice_sample(n=5000) %>%\n    select(id, carpool, cars_per_driver, hhsize, commute, social) %>%\n    write_csv(\"data/nhts/carpool.csv\")\n\nRows: 923572 Columns: 115\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (74): PERSONID, TDTRPNUM, STRTTIME, ENDTIME, TRPTRANS, VEHID, DROP_PRK, ...\ndbl (41): HOUSEID, TRVLCMIN, TRPMILES, TRPACCMP, TRPHHACC, TRWAITTM, NUMTRAN...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\n\n\n\n\ncovidfuture = read_csv(\"data/covidfuture/covid_pooled_public_w1b_1.1.0b7.csv\")\n\nWarning: One or more parsing issues, see `problems()` for details\n\n\nRows: 8152 Columns: 487\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (448): empl_pre, worker_pre, jobcat_pre, ind_pre, empl_now, worker_now,...\ndbl   (33): resp_id, wfh_now_days, bzvm_now, tr_freq_now_privateveh, tr_freq...\nlgl    (4): yrborn_miss_desc, hhsize_miss_desc, nchildren_miss_desc, Finished\ndate   (2): StartDate, EndDate\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\n\n\n# create the wfh variable\nworkers = covidfuture %>%\n    filter(worker_pre == \"yes\" | worker_now == \"yes\") %>%\n    mutate(\n        wfh=case_when(\n            wfh_expect == \"No\" ~ \"Unable\",\n            wfh_freq_exp %in% c(\"Never\", \"A few times/year\") ~ \"Rarely\",\n            wfh_freq_exp %in% c(\"A few times/month\", \"Once/week\", \"A few times/week\") ~ \"Often\",\n            wfh_freq_exp == \"Every day\" ~ \"Always\"\n        ),\n        income_100k_plus = hhincome_summary == \"$100,000 or more\",\n        service_worker=\n            !(case_when(ind_now == \"Question not displayed to respondent\" ~ ind_pre, T ~ ind_now) %in% c(\"None of the above\", \"Seen but unanswered\"))\n        ) %>%\n    filter(!is.na(wfh))\n\nselect(workers, resp_id, wfh, age, income_100k_plus, service_worker) %>%\n    write_csv(\"data/covidfuture_wfh.csv\")\n\n\n\n\nFrom apollo\n\nread_csv(\"data/apollo_modeChoiceData.csv\") %>%\n    filter(RP == 1) %>%\n    select(-c(RP, SP, RP_journey, SP_task)) %>%\n    write_csv(\"modechoice_apollo.csv\")\n\nRows: 8000 Columns: 26\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\ndbl (26): ID, RP, SP, RP_journey, SP_task, av_car, av_bus, av_air, av_rail, ...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message."
  },
  {
    "objectID": "discrete-choice.html#about-me",
    "href": "discrete-choice.html#about-me",
    "title": "Introduction to discrete choice models in R",
    "section": "About me",
    "text": "About me\n\n\n\n\nAssistant professor of City and Regional Planning\nResearch focus: transportation modeling and simulation\n\nHeavy use of discrete choice models\n\nPhD in Geography from Arizona State\nThree years experience as transportation modeling software developer"
  },
  {
    "objectID": "discrete-choice.html#before-we-go-any-further",
    "href": "discrete-choice.html#before-we-go-any-further",
    "title": "Introduction to discrete choice models in R",
    "section": "Before we go any further",
    "text": "Before we go any further\n\nIf you haven’t already installed R, RStudio, apollo, and tidyverse, do so now\nR: https://r-project.org\nRStudio: https://rstudio.com\napollo and tidyverse: in RStudio console, run:\n\ninstall.packages(\"tidyverse\")\ninstall.packages(\"apollo\")"
  },
  {
    "objectID": "discrete-choice.html#what-are-discrete-choice-models",
    "href": "discrete-choice.html#what-are-discrete-choice-models",
    "title": "Introduction to discrete choice models in R",
    "section": "What are discrete choice models?",
    "text": "What are discrete choice models?\n\nAny model of a variable that takes on discrete values\nCould be binary (two values), categorical (more than two values), or quantized (e.g., integers)"
  },
  {
    "objectID": "discrete-choice.html#types-of-discrete-choice-models",
    "href": "discrete-choice.html#types-of-discrete-choice-models",
    "title": "Introduction to discrete choice models in R",
    "section": "Types of discrete choice models",
    "text": "Types of discrete choice models\n\nRandom utility models\n\nLogistic regression, multinomial logistic regression, ordered logit, mixed logit\n\nCount models\n\nPoisson and negative binomial regression\n\nMachine learning\n\nRandom forests, support vector machines, k nearest neighbors"
  },
  {
    "objectID": "discrete-choice.html#random-utility-theory",
    "href": "discrete-choice.html#random-utility-theory",
    "title": "Introduction to discrete choice models in R",
    "section": "Random utility theory",
    "text": "Random utility theory\n\nIndividuals are maximizing the utility of their choices\nUtility is an abstract concept of value\nIndividuals choose the choice with the highest utility\nUtility is random because there is a random component to utility\nWe won’t know which choice is the highest utility for an individual, only the probabilities that a particular choice will have the highest utility"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-1",
    "href": "discrete-choice.html#binary-logistic-regression-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression",
    "text": "Binary logistic regression\n\nA very common model for binary (yes/no) outcomes\nProbably familiar to many\nUsually presented as a generalized linear model"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-intuition",
    "href": "discrete-choice.html#binary-logistic-regression-intuition",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression: Intuition",
    "text": "Binary logistic regression: Intuition\n\nLinear functions can take on any value\nProbabilities need to be between 0 and 1\nThe logit function transforms arbitrary linear values to (0, 1)"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-the-math",
    "href": "discrete-choice.html#binary-logistic-regression-the-math",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression: the math",
    "text": "Binary logistic regression: the math\n\\[\ny^* = \\alpha + \\beta_1 x_1 + \\beta_2 x_2 \\cdots + \\epsilon\n\\]\n\\[\n\\epsilon \\thicksim \\mathrm{Logistic}\n\\]\n\\[\np(y = 1) = p(y^* > 0) = \\frac{e^{y^*}}{1 + e^{y^*}}\n\\]"
  },
  {
    "objectID": "discrete-choice.html#the-logit-function",
    "href": "discrete-choice.html#the-logit-function",
    "title": "Introduction to discrete choice models in R",
    "section": "The logit function",
    "text": "The logit function"
  },
  {
    "objectID": "discrete-choice.html#logistic-regression-in-r",
    "href": "discrete-choice.html#logistic-regression-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Logistic regression in R",
    "text": "Logistic regression in R\nnhts-carpool-glm.R\n\nlibrary(tidyverse)\n\ndata = read_csv(\"data/nhts/carpool.csv\")\n\nglm_model = glm(carpool~hhsize+cars_per_driver+commute+social,\n    family=binomial(link=\"logit\"), data)\nsummary(glm_model)"
  },
  {
    "objectID": "discrete-choice.html#logistic-regression-in-r-1",
    "href": "discrete-choice.html#logistic-regression-in-r-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Logistic regression in R",
    "text": "Logistic regression in R\n\n\n\nCall:\nglm(formula = carpool ~ hhsize + cars_per_driver + commute + \n    social, family = binomial(link = \"logit\"), data = data)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.4758  -1.1048  -0.5243   1.0966   2.2147  \n\nCoefficients:\n                Estimate Std. Error z value Pr(>|z|)    \n(Intercept)     -0.87316    0.10310  -8.469  < 2e-16 ***\nhhsize           0.39877    0.02468  16.156  < 2e-16 ***\ncars_per_driver -0.09750    0.05659  -1.723   0.0849 .  \ncommuteTRUE     -1.59549    0.11134 -14.330  < 2e-16 ***\nsocialTRUE       0.41292    0.10269   4.021 5.79e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 6925.6  on 4999  degrees of freedom\nResidual deviance: 6334.1  on 4995  degrees of freedom\nAIC: 6344.1\n\nNumber of Fisher Scoring iterations: 4"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model",
    "href": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression as a random utility model",
    "text": "Binary logistic regression as a random utility model\n\nWe can treat the linear predictor in logistic regression as the utility of the modeled outcome\nIn this case, the utility of carpooling\nWe also need a utility of not carpooling\nDecisionmakers will choose the highest utility alternative"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-1",
    "href": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression as a random utility model",
    "text": "Binary logistic regression as a random utility model\n\nUtilities are only meaningful relative to each other\nUsual practice is to set utility of one alternative to 0"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-2",
    "href": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression as a random utility model",
    "text": "Binary logistic regression as a random utility model\n\\[\ny^* = \\alpha + \\beta_1 x_1 + \\beta_2 x_2 \\cdots + \\epsilon\n\\]\n\\[\np(y = 1) = p(y^* > 0)\\\\= \\frac{e^{y^*}}{1 + e^{y^*}}\n\\]"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-3",
    "href": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-3",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression as a random utility model",
    "text": "Binary logistic regression as a random utility model\n\\[\nU_{y=1} = \\alpha + \\beta_1 x_1 + \\beta_2 x_2 \\cdots + \\epsilon_1\n\\]\n\\[\nU_{y=0} = 0 + \\epsilon_0\n\\]\n\\[\np(y = 1) = p(U_{y=1} > U_{y=0})\\\\= \\frac{e^{U_{y=1}}}{e^{U_{y=0}} + e^{U_{y=1}}}\n\\]"
  },
  {
    "objectID": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-in-r",
    "href": "discrete-choice.html#binary-logistic-regression-as-a-random-utility-model-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Binary logistic regression as a random utility model in R",
    "text": "Binary logistic regression as a random utility model in R\nnhts-carpool-apollo.R\n\nlibrary(apollo)\nlibrary(tidyverse)\n\n# Read data - variable must be called \"database\"\ndatabase = read_csv(\"data/nhts/carpool.csv\")"
  },
  {
    "objectID": "discrete-choice.html#but-dont-take-my-word-for-it",
    "href": "discrete-choice.html#but-dont-take-my-word-for-it",
    "title": "Introduction to discrete choice models in R",
    "section": "But don’t take my word for it…",
    "text": "But don’t take my word for it…\n\n\n\nCall:\nglm(formula = carpool ~ hhsize + cars_per_driver + commute + \n    social, family = binomial(link = \"logit\"), data = data)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-2.4758  -1.1048  -0.5243   1.0966   2.2147  \n\nCoefficients:\n                Estimate Std. Error z value Pr(>|z|)    \n(Intercept)     -0.87316    0.10310  -8.469  < 2e-16 ***\nhhsize           0.39877    0.02468  16.156  < 2e-16 ***\ncars_per_driver -0.09750    0.05659  -1.723   0.0849 .  \ncommuteTRUE     -1.59549    0.11134 -14.330  < 2e-16 ***\nsocialTRUE       0.41292    0.10269   4.021 5.79e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 6925.6  on 4999  degrees of freedom\nResidual deviance: 6334.1  on 4995  degrees of freedom\nAIC: 6344.1\n\nNumber of Fisher Scoring iterations: 4"
  },
  {
    "objectID": "discrete-choice.html#what-about-more-than-two-outcomes",
    "href": "discrete-choice.html#what-about-more-than-two-outcomes",
    "title": "Introduction to discrete choice models in R",
    "section": "What about more than two outcomes?",
    "text": "What about more than two outcomes?\n\nRandom utility theory doesn’t constrain us to two outcomes\nWe can have many outcomes, and decisionmakers choose the one with the highest utility\nThis is known as a multinomial model"
  },
  {
    "objectID": "discrete-choice.html#extending-logistic-regression-to-the-multinomial-case",
    "href": "discrete-choice.html#extending-logistic-regression-to-the-multinomial-case",
    "title": "Introduction to discrete choice models in R",
    "section": "Extending logistic regression to the multinomial case",
    "text": "Extending logistic regression to the multinomial case\n\nInstead of two utilities \\(U_{y=1}\\) and \\(U_{y=0}\\), we have arbitrary number of utility functions \\(U_i\\)\nDecisionmakers choose the option with the highest utility\nAs with binary logistic regression, utility functions are usually linear combinations of parameters"
  },
  {
    "objectID": "discrete-choice.html#multinomial-logistic-regression-the-math",
    "href": "discrete-choice.html#multinomial-logistic-regression-the-math",
    "title": "Introduction to discrete choice models in R",
    "section": "Multinomial logistic regression: the math",
    "text": "Multinomial logistic regression: the math\n\nProbability then becomes\n\n\\[\np(y=i)\\\\= p(U_i > \\mathrm{all~other}~U)\\\\\n    =\\frac{e^{U_i}}{e^{U_1} + e^{U_2} \\cdots}\\\\\n    =\\frac{e^{U_i}}{\\sum_{j \\in I} e^{U_j}}\n\\]"
  },
  {
    "objectID": "discrete-choice.html#multinomial-logistic-regression-in-r",
    "href": "discrete-choice.html#multinomial-logistic-regression-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Multinomial logistic regression in R",
    "text": "Multinomial logistic regression in R\n\nWe will build a model of working from home expectation post-pandemic, using data from the COVID Future study.\nWe will estimate four utility functions, for being unable to, rarely, frequently, and always working from home\nBased on age, income, and job type\nThese utility functions will have the same variables but different coefficients\nEach will also have a alternative specific constant—like a constant in logistic regression that represents the base rate, but for each alternative\nOne utility function will be held at zero"
  },
  {
    "objectID": "discrete-choice.html#multinomial-logistic-regression-in-r-1",
    "href": "discrete-choice.html#multinomial-logistic-regression-in-r-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Multinomial logistic regression in R",
    "text": "Multinomial logistic regression in R\ncovidfuture-wfh-mnl.R\n\nlibrary(apollo)\nlibrary(tidyverse)\n\ndatabase = read_csv(\"data/covidfuture_wfh.csv\")\n\napollo_initialise()\n\napollo_control = list(\n    modelName=\"WFH_Postpandemic\",\n    indivID=\"resp_id\"\n)"
  },
  {
    "objectID": "discrete-choice.html#interpreting-multinomial-logit-results",
    "href": "discrete-choice.html#interpreting-multinomial-logit-results",
    "title": "Introduction to discrete choice models in R",
    "section": "Interpreting multinomial logit results",
    "text": "Interpreting multinomial logit results\n\n\n\n\n\n\nRarely\nOften\nAlways\n\n\n\n\nASC\n-0.73\n0.50\n-1.37\n\n\nAge\n-0.03\n-0.01\n0.01\n\n\nHigh income\n0.81\n1.01\n0.53\n\n\nService worker\n-0.94\n-1.27\n-1.54\n\n\n\n\n\nNote: all variables significant at \\(p < 0.05\\)"
  },
  {
    "objectID": "discrete-choice.html#questions-1",
    "href": "discrete-choice.html#questions-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Questions?",
    "text": "Questions?"
  },
  {
    "objectID": "discrete-choice.html#specifying-a-multinomial-logit-model",
    "href": "discrete-choice.html#specifying-a-multinomial-logit-model",
    "title": "Introduction to discrete choice models in R",
    "section": "Specifying a multinomial logit model",
    "text": "Specifying a multinomial logit model\n\nMultinomial logit models can have independent variables that vary at the individual level (e.g., income)\nCan also have variables at the alternative level (e.g., travel time)\nUtilities identified only up to a constant offset\n\nConstant changes to all utilities does not change outcome"
  },
  {
    "objectID": "discrete-choice.html#specifying-a-multinomial-logit-model-1",
    "href": "discrete-choice.html#specifying-a-multinomial-logit-model-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Specifying a multinomial logit model",
    "text": "Specifying a multinomial logit model\n\nVariables that vary at individual level must have different coefficients for each alternative, and one must be zero\nVariables that vary at alternative level may or may not have different coefficients for each alternative, and there is no need have one zero coefficient\n\nBut you do have to know values for unchosen alternatives"
  },
  {
    "objectID": "discrete-choice.html#specifying-a-multinomial-logit-model-2",
    "href": "discrete-choice.html#specifying-a-multinomial-logit-model-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Specifying a multinomial logit model",
    "text": "Specifying a multinomial logit model\n\n\n\n\n\n\n\nG\n\n \n\nclustertt\n\n   \n\ninc\n\n Income   \n\niw\n\n  \n\ninc->iw\n\n   \n\nib\n\n  \n\ninc->ib\n\n   \n\nic\n\n  \n\ninc->ic\n\n   \n\nttw\n\n Travel time of walk   \n\ntw\n\n  \n\nttw->tw\n\n   \n\nttb\n\n Travel time of bus   \n\ntb\n\n  \n\nttb->tb\n\n   \n\nttc\n\n Travel time of car   \n\ntc\n\n  \n\nttc->tc\n\n   \n\nuw\n\n Utility of walk   \n\nub\n\n Utility of bus   \n\nuc\n\n Utility of car   \n\niw->uw\n\n    \n\nmd\n\nMust be different, one must be zero   \n\niw->md\n\n   \n\nib->ub\n\n    \n\nib->md\n\n   \n\nic->uc\n\n    \n\nic->md\n\n   \n\ntw->uw\n\n    \n\ntb->ub\n\n    \n\ntc->uc\n\n    \n\ncs\n\nCan be same   \n\ncs->tw\n\n   \n\ncs->tb\n\n   \n\ncs->tc"
  },
  {
    "objectID": "discrete-choice.html#estimating-a-multinomial-logit-model-in-r",
    "href": "discrete-choice.html#estimating-a-multinomial-logit-model-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Estimating a multinomial logit model in R",
    "text": "Estimating a multinomial logit model in R\n\n\n\n\nWe’re going to build a multinomial logit mode choice model of intercity mode choice\nData from Apollo examples"
  },
  {
    "objectID": "discrete-choice.html#the-data",
    "href": "discrete-choice.html#the-data",
    "title": "Introduction to discrete choice models in R",
    "section": "The data",
    "text": "The data\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nID\nav_car\nav_bus\nav_air\nav_rail\ntime_car\ncost_car\ntime_bus\ncost_bus\naccess_bus\ntime_air\ncost_air\naccess_air\nservice_air\ntime_rail\ncost_rail\naccess_rail\nservice_rail\nfemale\nbusiness\nincome\nchoice\n\n\n\n\n1\n0\n0\n1\n1\n0\n0\n0\n0\n0\n50\n80\n55\n0\n140\n55\n5\n0\n0\n0\n46705\n4\n\n\n1\n0\n0\n1\n1\n0\n0\n0\n0\n0\n70\n80\n45\n0\n170\n45\n20\n0\n0\n0\n46705\n4\n\n\n2\n1\n1\n0\n1\n345\n40\n345\n30\n15\n0\n0\n0\n0\n130\n55\n20\n0\n1\n0\n50123\n2\n\n\n2\n1\n1\n0\n1\n345\n45\n345\n25\n20\n0\n0\n0\n0\n130\n45\n10\n0\n1\n0\n50123\n2\n\n\n3\n0\n0\n1\n1\n0\n0\n0\n0\n0\n90\n65\n40\n0\n130\n35\n20\n0\n1\n0\n67589\n4\n\n\n3\n0\n0\n1\n1\n0\n0\n0\n0\n0\n60\n110\n40\n0\n170\n35\n15\n0\n1\n0\n67589\n4"
  },
  {
    "objectID": "discrete-choice.html#estimation-in-r",
    "href": "discrete-choice.html#estimation-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Estimation in R",
    "text": "Estimation in R\nmode-choice-mnl.R\n\nlibrary(apollo)\nlibrary(tidyverse)\n\ndatabase = read_csv(\"data/modechoice_apollo.csv\")\n\napollo_initialise()\n\napollo_control = list(\n    modelName = \"Apollo_Mode_Choice\",\n    indivID=\"ID\"\n)"
  },
  {
    "objectID": "discrete-choice.html#valuation-using-discrete-choice-models",
    "href": "discrete-choice.html#valuation-using-discrete-choice-models",
    "title": "Introduction to discrete choice models in R",
    "section": "Valuation using discrete choice models",
    "text": "Valuation using discrete choice models\n\nA common use for discrete choice models is to calculate willingness-to-pay\nThe linear-in-parameters utility function puts everything in terms of utility\nIf we have a cost parameter, we can use the model to put everything else in monetary units"
  },
  {
    "objectID": "discrete-choice.html#valuation-using-discrete-choice-models-1",
    "href": "discrete-choice.html#valuation-using-discrete-choice-models-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Valuation using discrete choice models",
    "text": "Valuation using discrete choice models\n\nThe coefficients of the model are how much of x one unit of utility is worth\n\ni.e. partial derivatives of utility with respect to x\n\nWe want value of time, i.e. dollars / hour\nTravel time coefficient is utility / minute\nCost coefficient is utility / dollar\nIf \\(u\\) is utility, \\(c\\) is cost, and \\(t\\) is in-vehicle time, \\(\\frac{\\beta_t}{\\beta_{c}} = \\frac{\\frac{\\delta u}{\\delta t}}{\\frac{\\delta u}{\\delta c}} = \\frac{\\delta c}{\\delta t}\\)"
  },
  {
    "objectID": "discrete-choice.html#valuation-using-discrete-choice-models-2",
    "href": "discrete-choice.html#valuation-using-discrete-choice-models-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Valuation using discrete choice models",
    "text": "Valuation using discrete choice models\n\\[\\beta_c = -0.032\\]\n\\[\\beta_t = -0.0061\\]\n\\[ \\frac{\\beta_t}{\\beta_c} = \\frac{-0.0061}{-0.032} = {£0.191}/\\mathrm{minute} = {£11.46}/\\mathrm{hour} \\]"
  },
  {
    "objectID": "discrete-choice.html#confidence-intervals-for-valuation",
    "href": "discrete-choice.html#confidence-intervals-for-valuation",
    "title": "Introduction to discrete choice models in R",
    "section": "Confidence intervals for valuation",
    "text": "Confidence intervals for valuation\n\nWe can use the Delta method to calculate standard errors for combinations of parameters (Daly, Hess, and Ortúzar 2020)\nImplemented in Apollo using apollo_deltaMethod function"
  },
  {
    "objectID": "discrete-choice.html#exercise",
    "href": "discrete-choice.html#exercise",
    "title": "Introduction to discrete choice models in R",
    "section": "Exercise",
    "text": "Exercise\n\nPeople may value in-vehicle time differently on the train vs. plane vs. car vs. bus\nModify the model to estimate separate in-vehicle time coefficients for each mode, and calculate willingness-to-pay for each\n(One) answer in mode-choice-mnl-in-vehicle-answers.R"
  },
  {
    "objectID": "discrete-choice.html#solution",
    "href": "discrete-choice.html#solution",
    "title": "Introduction to discrete choice models in R",
    "section": "Solution",
    "text": "Solution\n\napollo_beta = c(\n    asc_air = 0,\n    asc_bus = 0,\n    asc_rail = 0,\n    # leaving out an asc_car as base category\n    b_cost = 0,\n    b_access_time = 0,\n    b_in_vehicle_time_air = 0,\n    b_in_vehicle_time_bus = 0,\n    b_in_vehicle_time_car = 0,\n    b_in_vehicle_time_rail = 0,\n    # income and party_size are individual level variable, so\n    # must be different for different alternatives\n    b_income_air = 0,\n    b_income_bus = 0,\n    b_income_rail = 0\n)"
  },
  {
    "objectID": "discrete-choice.html#interpretation",
    "href": "discrete-choice.html#interpretation",
    "title": "Introduction to discrete choice models in R",
    "section": "Interpretation",
    "text": "Interpretation\n\n\nPeople really don’t like being on airplanes"
  },
  {
    "objectID": "discrete-choice.html#correlation-does-not-imply-causation",
    "href": "discrete-choice.html#correlation-does-not-imply-causation",
    "title": "Introduction to discrete choice models in R",
    "section": "Correlation does not imply causation",
    "text": "Correlation does not imply causation\n\nXKCD cartoon demonstrating that correlation does not imply causation"
  },
  {
    "objectID": "discrete-choice.html#correlation-does-not-imply-causation-1",
    "href": "discrete-choice.html#correlation-does-not-imply-causation-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Correlation does not imply causation",
    "text": "Correlation does not imply causation\n\nOf course we can’t interpret model coefficients as causal\nValuation estimates are derived from coefficients\nAny bias in coefficients may affect valuation"
  },
  {
    "objectID": "discrete-choice.html#correlation-does-not-imply-causation-2",
    "href": "discrete-choice.html#correlation-does-not-imply-causation-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Correlation does not imply causation",
    "text": "Correlation does not imply causation\n\nOften, prices will be correlated with unobserved positive aspects, biasing the value of time down\n\nFor example, legroom or class of service in the air travel case\n\nOther variable may be biased too\n\nWe don’t have number of connections in our model. How might this bias the value of time for air travel?"
  },
  {
    "objectID": "discrete-choice.html#questions-2",
    "href": "discrete-choice.html#questions-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Questions?",
    "text": "Questions?"
  },
  {
    "objectID": "discrete-choice.html#how-logit-models-are-estimated",
    "href": "discrete-choice.html#how-logit-models-are-estimated",
    "title": "Introduction to discrete choice models in R",
    "section": "How logit models are estimated",
    "text": "How logit models are estimated\n\nUnlike linear regression, there is no closed-form solution\n\ni.e. one you can just calculate\n\nInstead, we use maximum likelihood\nWe define a likelihood function which tells us how likely we are to observe the data we have, given a set of coefficients\nWe then choose a set of coefficients, the starting values, and adjust them until we find the best fit—the maximum of the likelihood function"
  },
  {
    "objectID": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model",
    "href": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model",
    "title": "Introduction to discrete choice models in R",
    "section": "Likelihood function for a discrete choice model",
    "text": "Likelihood function for a discrete choice model\n\nThe likelihood function for a discrete choice model is the joint probability of all the chosen values\nIf you had three people, who chose car, car, and bus to get to work, likelihood is the probability that the first person chose car multiplied by the probability the second person chose car multiplied by the probability the third person chose bus"
  },
  {
    "objectID": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model-the-math",
    "href": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model-the-math",
    "title": "Introduction to discrete choice models in R",
    "section": "Likelihood function for a discrete choice model: the math",
    "text": "Likelihood function for a discrete choice model: the math\n\nIn math:\n\n\\[\n\\prod_n P(y_n | x_n)\\\\\n= \\prod_n \\frac{e^{U_{y_n}}}{\\sum_j e^{U_{j_n}}}\n\\]"
  },
  {
    "objectID": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model-the-math-1",
    "href": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model-the-math-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Likelihood function for a discrete choice model: the math",
    "text": "Likelihood function for a discrete choice model: the math\n\nThis is a vanishingly small number\n\nIn our mode choice example, something like \\(10^{-440}\\)\n\nGenerally too small to be represented in a computer\n\n\n10^-440\n\n[1] 0"
  },
  {
    "objectID": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model-the-math-2",
    "href": "discrete-choice.html#likelihood-function-for-a-discrete-choice-model-the-math-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Likelihood function for a discrete choice model: the math",
    "text": "Likelihood function for a discrete choice model: the math\n\nInstead, computers use the logarithm of likelihood (log-likelihood)\n\n\\[\n\\mathrm{ln} \\prod_n P(y_n | x_n)\\\\\n= \\sum_n \\mathrm{ln} \\frac{e^{U_{y_n}}}{\\sum_j e^{U_{j_n}}}\n\\]\n\nIn our example above, this is -1014"
  },
  {
    "objectID": "discrete-choice.html#comparing-logistic-models-to-each-other",
    "href": "discrete-choice.html#comparing-logistic-models-to-each-other",
    "title": "Introduction to discrete choice models in R",
    "section": "Comparing logistic models to each other",
    "text": "Comparing logistic models to each other\n\nWe can use the log-likelihood to compare two models using a likelihood-ratio test\nThis only works if the two models are nested\n\nThat is, one is a subset of the other, or you can make one into the other by constraining parameters\nNot to be confused with nested logit models which use a different error structure"
  },
  {
    "objectID": "discrete-choice.html#comparing-logistic-models-to-each-other-1",
    "href": "discrete-choice.html#comparing-logistic-models-to-each-other-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Comparing logistic models to each other",
    "text": "Comparing logistic models to each other\n\nLikelihood ratio test statistic is\n\n\\[\n-2(\\ell_1 - \\ell_2)\n\\]\nwhere \\(\\ell_1\\) is the likelihood of the less flexible model and \\(\\ell_2\\) the more flexible model - This is \\(\\chi^2\\)-distributed with degrees of freedom equal to the number of additional parameters in the more flexible model - Don’t need to remember order, just put them in the order that makes test statistic positive"
  },
  {
    "objectID": "discrete-choice.html#comparing-logistic-models-to-each-other-2",
    "href": "discrete-choice.html#comparing-logistic-models-to-each-other-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Comparing logistic models to each other",
    "text": "Comparing logistic models to each other\n\n\n\nModel\nLog-likelihood\n\n\n\n\nSame in-vehicle time coefficient\n-1020\n\n\nDifferent in-vehicle time coefficients\n-1014.74\n\n\nTest statistic\n10.52\n\n\nDegrees of freedom\n3"
  },
  {
    "objectID": "discrete-choice.html#comparing-logistic-regression-models-to-each-other",
    "href": "discrete-choice.html#comparing-logistic-regression-models-to-each-other",
    "title": "Introduction to discrete choice models in R",
    "section": "Comparing logistic regression models to each other",
    "text": "Comparing logistic regression models to each other\n\n1 - pchisq(10.52, 3)\n\n[1] 0.01462584"
  },
  {
    "objectID": "discrete-choice.html#comparing-logistic-regreession-models-to-each-other",
    "href": "discrete-choice.html#comparing-logistic-regreession-models-to-each-other",
    "title": "Introduction to discrete choice models in R",
    "section": "Comparing logistic regreession models to each other",
    "text": "Comparing logistic regreession models to each other"
  },
  {
    "objectID": "discrete-choice.html#goodness-of-fit-metrics-for-logistic-regression-models",
    "href": "discrete-choice.html#goodness-of-fit-metrics-for-logistic-regression-models",
    "title": "Introduction to discrete choice models in R",
    "section": "Goodness of fit metrics for logistic regression models",
    "text": "Goodness of fit metrics for logistic regression models\n\nUnlike linear regression, there is no \\(R^2\\) for a logistic regression"
  },
  {
    "objectID": "discrete-choice.html#marginal-effects",
    "href": "discrete-choice.html#marginal-effects",
    "title": "Introduction to discrete choice models in R",
    "section": "Marginal effects",
    "text": "Marginal effects"
  },
  {
    "objectID": "discrete-choice.html#independence-of-irrelevant-alternatives",
    "href": "discrete-choice.html#independence-of-irrelevant-alternatives",
    "title": "Introduction to discrete choice models in R",
    "section": "Independence of irrelevant alternatives",
    "text": "Independence of irrelevant alternatives\n\nWhen the utility of one alternative is increased, the probabilities of the other alternatives decrease in proportion to their probabilities\n\nAnd vice-versa\nSimilarly when an alternative is added or removed"
  },
  {
    "objectID": "discrete-choice.html#independence-of-irrelevant-alternatives-the-red-busblue-bus-problem",
    "href": "discrete-choice.html#independence-of-irrelevant-alternatives-the-red-busblue-bus-problem",
    "title": "Introduction to discrete choice models in R",
    "section": "Independence of irrelevant alternatives: the red bus/blue bus problem",
    "text": "Independence of irrelevant alternatives: the red bus/blue bus problem\n\nSuppose you have a model of mode choice, with two alternatives: driving and a red bus\nOne individual has a 50% probability of choosing each alternative\nSuppose you paint half the buses red but don’t change anything about the service"
  },
  {
    "objectID": "discrete-choice.html#independence-of-irrelevant-alternatives-the-red-busblue-bus-problem-1",
    "href": "discrete-choice.html#independence-of-irrelevant-alternatives-the-red-busblue-bus-problem-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Independence of irrelevant alternatives: the red bus/blue bus problem",
    "text": "Independence of irrelevant alternatives: the red bus/blue bus problem\n\nYou’d expect this individual to now have probabilities 25% red bus, 25% blue bus, and 50% drive\nBut, half of the probability has to come from each other alternative\nSo, if blue bus has 25% probability, existing choices must all reduce by the same factor\nRed bus: 50% * .75 = 37.5%\nSame for car"
  },
  {
    "objectID": "discrete-choice.html#independence-of-irrelevant-alternatives-the-red-busblue-bus-problem-2",
    "href": "discrete-choice.html#independence-of-irrelevant-alternatives-the-red-busblue-bus-problem-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Independence of irrelevant alternatives: the red bus/blue bus problem",
    "text": "Independence of irrelevant alternatives: the red bus/blue bus problem\n\nThis is true at the individual level, not the level of market shares (Ben-Akiva and Lerman 1985, 109–11)"
  },
  {
    "objectID": "discrete-choice.html#independence-of-irrelevant-alternatives-the-math",
    "href": "discrete-choice.html#independence-of-irrelevant-alternatives-the-math",
    "title": "Introduction to discrete choice models in R",
    "section": "Independence of irrelevant alternatives: the math",
    "text": "Independence of irrelevant alternatives: the math\n\\[ \\frac{\\delta p(b)}{\\delta U_r}\\]\n\\[\n= \\frac{\n    e^{U_b}}{\n        e^{U_r} + e^{U_b} + e^{U_c}}\n    \\frac{\\delta}{\\delta U_r}\n\\]\n\\[\n    = e^{U_b} ( e^{U_r} + e^{U_b} + e^{U_c} \\big)^{-2}\n        \\big[(e^{U_r} + e^{U_b} + e^{U_c}) \\frac{\\delta}{\\delta U_r}\\big]\n\\]\n\\[\n    = e^{U_b} \\big[ ( e^{U_r} + e^{U_b} + e^{U_c} \\big)^{-2} e^{U_r} \\big]\n\\]"
  },
  {
    "objectID": "discrete-choice.html#questions-3",
    "href": "discrete-choice.html#questions-3",
    "title": "Introduction to discrete choice models in R",
    "section": "Questions?",
    "text": "Questions?"
  },
  {
    "objectID": "discrete-choice.html#motivation",
    "href": "discrete-choice.html#motivation",
    "title": "Introduction to discrete choice models in R",
    "section": "Motivation",
    "text": "Motivation\n\nThe independence of irrelevant alternatives property of MNL derives from the assumed error distribution\n\nWhich is also how the probability function is derived\n\nNested logit allows correlation within “nests” of alternatives\nOften used in mode choice or joint choice"
  },
  {
    "objectID": "discrete-choice.html#model-form",
    "href": "discrete-choice.html#model-form",
    "title": "Introduction to discrete choice models in R",
    "section": "Model form",
    "text": "Model form\n\n\n\n\nflowchart LR\n    mc[Mode choice]\n    car[Car]\n    air[Air]\n    bus[Bus]\n    train[Train]\n\n    mc --> car\n    mc --> air\n    mc --> bus\n    mc --> train"
  },
  {
    "objectID": "discrete-choice.html#model-form-1",
    "href": "discrete-choice.html#model-form-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Model form",
    "text": "Model form\n\n\n\n\nflowchart LR\n    mc[Mode choice]\n    car[Car]\n    air[Air]\n    transit[Transit]\n    bus[Bus]\n    train[Train]\n\n    mc --> car\n    mc --> air\n    mc --> transit\n    transit --> bus\n    transit --> train"
  },
  {
    "objectID": "discrete-choice.html#model-form-2",
    "href": "discrete-choice.html#model-form-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Model form",
    "text": "Model form\n\nOften used to represent hierarchical or joint choice\nUsed when there are shared unobserved attributes between alternatives\n\nIn the red bus/blue bus problem, attributes of the bus\n\nDoes not have to, just represents correlation in error term between alternatives"
  },
  {
    "objectID": "discrete-choice.html#nested-logit-the-math",
    "href": "discrete-choice.html#nested-logit-the-math",
    "title": "Introduction to discrete choice models in R",
    "section": "Nested logit: the math",
    "text": "Nested logit: the math\n\\[\nU_i = \\alpha_i + \\beta_{ix} x_i + \\cdots + \\epsilon_{nest} + \\epsilon_{i}\n\\]\n\n\\(\\epsilon_{nest}\\) allows correlation of error terms at the nest level"
  },
  {
    "objectID": "discrete-choice.html#why-do-correlated-error-terms-solve-the-red-busblue-bus-problem",
    "href": "discrete-choice.html#why-do-correlated-error-terms-solve-the-red-busblue-bus-problem",
    "title": "Introduction to discrete choice models in R",
    "section": "Why do correlated error terms solve the red bus/blue bus problem?",
    "text": "Why do correlated error terms solve the red bus/blue bus problem?\n\nEasier to reason through than to do the math\nDefinition of a random-utility model is that whatever alternative has the highest utility is chosen\nUtility has a random component \\(\\epsilon\\), so whether an alternative has highest utility is probabilistic"
  },
  {
    "objectID": "discrete-choice.html#why-do-correlated-error-terms-solve-the-red-busblue-bus-problem-1",
    "href": "discrete-choice.html#why-do-correlated-error-terms-solve-the-red-busblue-bus-problem-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Why do correlated error terms solve the red bus/blue bus problem?",
    "text": "Why do correlated error terms solve the red bus/blue bus problem?\n\nSuppose we are modeling the probability of auto vs. red bus vs. blue bus, and the systematic utilities are all 0\nSo whichever alternative has the highest random error will be chosen\nSuppose we draw the error terms at random from a hat containing numbers 1–10\nThe probability that any one error term is the largest is 1/3"
  },
  {
    "objectID": "discrete-choice.html#why-do-correlated-error-terms-solve-the-red-busblue-bus-problem-2",
    "href": "discrete-choice.html#why-do-correlated-error-terms-solve-the-red-busblue-bus-problem-2",
    "title": "Introduction to discrete choice models in R",
    "section": "Why do correlated error terms solve the red bus/blue bus problem?",
    "text": "Why do correlated error terms solve the red bus/blue bus problem?\n\nBut suppose we think that the unobserved attributes of the red bus and blue bus are the same\nThen we will draw one number for cars, and the same number twice for the red and blue buses\nSince the error terms for the buses are the same, there is now a 50% chance that car will have highest utility, and 50% that the buses will"
  },
  {
    "objectID": "discrete-choice.html#nested-logit-additional-parameters",
    "href": "discrete-choice.html#nested-logit-additional-parameters",
    "title": "Introduction to discrete choice models in R",
    "section": "Nested logit: additional parameters",
    "text": "Nested logit: additional parameters\n\nThe nested logit adds one additional parameter per nest, the inclusive value parameter\nAlso called \\(\\theta\\), \\(\\lambda\\), \\(\\frac{\\mu_m}{\\mu_d}\\), \\(\\frac{1}{\\mu_d}\\), logsum parameter\nInclusive value parameters define how much correlation there is in the alternatives within a nest"
  },
  {
    "objectID": "discrete-choice.html#nested-logit-interpreting-the-inclusive-value-parameter",
    "href": "discrete-choice.html#nested-logit-interpreting-the-inclusive-value-parameter",
    "title": "Introduction to discrete choice models in R",
    "section": "Nested logit: interpreting the inclusive value parameter",
    "text": "Nested logit: interpreting the inclusive value parameter\n\nInclusive value parameters should be between 0 and 1 to align with utility theory\nLarger inclusive value parameters mean less correlation between alternatives in that nest\nInclusive value parameters of 1—same as multinomial logit"
  },
  {
    "objectID": "discrete-choice.html#nested-logit-caution",
    "href": "discrete-choice.html#nested-logit-caution",
    "title": "Introduction to discrete choice models in R",
    "section": "Nested logit: caution",
    "text": "Nested logit: caution\n\nIn order to interpret coefficients from different nests relative to each other, you must use a random utility nested logit model (RUMNL)\nThese normalize the coefficients in each nest to be comparable to each other, by dividing by the inclusive value parameter\nNon-normalized nested logit (NNNL) does not perform this normalization\nRUMNL is default in Apollo, NNNL is default in Stata"
  },
  {
    "objectID": "discrete-choice.html#nested-logit-caution-1",
    "href": "discrete-choice.html#nested-logit-caution-1",
    "title": "Introduction to discrete choice models in R",
    "section": "Nested logit: caution",
    "text": "Nested logit: caution\n\nNested logit inclusive value parameters should be tested with a null hypothesis that they are 1, not 0\nMany statistical packages (including Apollo) don’t do this\nThus, t-values and p-values will be incorrect"
  },
  {
    "objectID": "discrete-choice.html#nested-logit-in-r",
    "href": "discrete-choice.html#nested-logit-in-r",
    "title": "Introduction to discrete choice models in R",
    "section": "Nested logit in R",
    "text": "Nested logit in R\n\nlibrary(apollo)\nlibrary(tidyverse)\n\ndatabase = read_csv(\"data/modechoice_apollo.csv\")\n\napollo_initialise()\n\napollo_control = list(\n    modelName = \"Nested_Mode_Choice\",\n    indivID=\"ID\"\n)"
  },
  {
    "objectID": "discrete-choice.html#references",
    "href": "discrete-choice.html#references",
    "title": "Introduction to discrete choice models in R",
    "section": "References",
    "text": "References\n\n\nBen-Akiva, Moshe, and Stephen R Lerman. 1985. Discrete Choice Analysis: Theory and Application to Travel Demand. MIT Press.\n\n\nDaly, Andrew, Stephane Hess, and Juan de Dios Ortúzar. 2020. “Estimating Willingness-to-Pay from Discrete Choice Models: Setting the Record Straight.” http://www.stephanehess.me.uk/papers/working_papers/Daly_Hess_Ortuzar_2020.pdf."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Odum Discrete Choice Modeling class",
    "section": "",
    "text": "Slides"
  }
]